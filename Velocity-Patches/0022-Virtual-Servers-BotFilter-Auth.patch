From 4d556a75dae1c2c1f3f8a5bdb3074a211e285e44 Mon Sep 17 00:00:00 2001
From: Petr Ilin <hevav@hevav.dev>
Date: Thu, 24 Jun 2021 15:01:38 +0900
Subject: [PATCH] Virtual Servers, BotFilter, Auth

Signed-off-by: Petr Ilin <hevav@hevav.dev>

diff --git a/.gitignore b/.gitignore
index 2ffb4fd0..fbdf3cea 100644
--- a/.gitignore
+++ b/.gitignore
@@ -84,7 +84,7 @@ logs/
 server-icon.png
 /bin/
 run/
-#plugins/
+plugins/
 
 ### Natives stuff ###
 native/mbedtls
diff --git a/api/build.gradle b/api/build.gradle
index 368004ab..b074ecce 100644
--- a/api/build.gradle
+++ b/api/build.gradle
@@ -37,11 +37,12 @@ dependencies {
     api("net.kyori:adventure-text-serializer-legacy")
     api("net.kyori:adventure-text-serializer-plain")
 
-    // ElytraProxy: Revert deprecated kyori dependencies for backward compatibility
+    // ElytraProxy Start: Revert deprecated kyori dependencies for backward compatibility
     api "net.kyori:text-api:${textVersion}"
     api "net.kyori:text-serializer-gson:${textVersion}"
     api "net.kyori:text-serializer-legacy:${textVersion}"
     api "net.kyori:text-serializer-plain:${textVersion}"
+    // ElytraProxy End
 
     api "org.slf4j:slf4j-api:${slf4jVersion}"
     api 'com.google.inject:guice:5.0.1'
diff --git a/api/src/main/java/com/velocitypowered/api/network/ProtocolVersion.java b/api/src/main/java/com/velocitypowered/api/network/ProtocolVersion.java
index a24b9229..0070c5ba 100644
--- a/api/src/main/java/com/velocitypowered/api/network/ProtocolVersion.java
+++ b/api/src/main/java/com/velocitypowered/api/network/ProtocolVersion.java
@@ -22,7 +22,10 @@ import java.util.Set;
 public enum ProtocolVersion {
   UNKNOWN(-1, "Unknown"),
   LEGACY(-2, "Legacy"),
+
+  // ElytraProxy: Maintenance mode
   MAINTENANCE(-99, "Maintenance"),
+
   MINECRAFT_1_7_2(4,
           "1.7.2", "1.7.3", "1.7.4", "1.7.5"),
   MINECRAFT_1_7_6(5,
@@ -232,7 +235,7 @@ public enum ProtocolVersion {
     return this == LEGACY;
   }
 
-  //BotFilter start
+  // BotFilter BackPort Start
   public boolean isBefore(ProtocolVersion other) {
     return this.compareTo(other) < 0;
   }
@@ -248,12 +251,11 @@ public enum ProtocolVersion {
   public boolean isAfterOrEq(ProtocolVersion other) {
     return this.compareTo(other) >= 0;
   }
-  //BotFilter add
 
   public static ProtocolVersion adapt(int protocol) {
     return ID_TO_PROTOCOL_CONSTANT.get(protocol);
   }
-  //BotFilter end
+  // BotFilter BackPort End
 
   @Override
   public String toString() {
diff --git a/api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java b/api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java
index 262e21bd..7ec5bdd0 100644
--- a/api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java
+++ b/api/src/main/java/com/velocitypowered/api/proxy/config/ProxyConfig.java
@@ -121,12 +121,14 @@ public interface ProxyConfig {
    */
   int getLoginRatelimit();
 
+  // BotFilter BackPort Start
   /**
    * Get the limit for how many times a player must login before rate limit will work.
    *
    * @return the max join attempts before rate limiting
    */
   int getLoginRatelimitAttempts();
+  // BotFilter BackPort End
 
   /**
    * Get the proxy favicon shown in the tablist.
diff --git a/native/src/main/java/com/velocitypowered/natives/compression/JavaVelocityCompressor.java b/native/src/main/java/com/velocitypowered/natives/compression/JavaVelocityCompressor.java
index 37b994ba..0c0c0871 100644
--- a/native/src/main/java/com/velocitypowered/natives/compression/JavaVelocityCompressor.java
+++ b/native/src/main/java/com/velocitypowered/natives/compression/JavaVelocityCompressor.java
@@ -38,7 +38,9 @@ public class JavaVelocityCompressor implements VelocityCompressor {
   private boolean disposed = false;
 
   private JavaVelocityCompressor(int level) {
-    level = Math.min(9, level); //BotFilter
+    // BotFilter Backport
+    level = Math.min(9, level);
+
     this.deflater = new Deflater(level);
     this.inflater = new Inflater();
   }
diff --git a/proxy/build.gradle b/proxy/build.gradle
index 578a56e5..ed351cd2 100644
--- a/proxy/build.gradle
+++ b/proxy/build.gradle
@@ -10,12 +10,22 @@ apply from: '../gradle/checkstyle.gradle'
 apply plugin: 'com.github.johnrengelman.shadow'
 
 license {
+    // ElytraProxy Start: Add licenses
     matching(includes: ['**/elytraproxy/**']) {
         header = project.rootProject.file('HEADER_ELYTRAPROXY.txt')
     }
     matching(includes: ['**/elytraproxy/config/helpers/**']) {
         header = project.rootProject.file('HEADER_BUNGEECORD.txt')
     }
+    matching(includes: ['**/virtual/**']) {
+        header = project.rootProject.file('HEADER_BOTFILTER.txt')
+    }
+    matching(includes: ['**/virtual/file/**']) {
+        header = project.rootProject.file('HEADER_ELYTRAPROXY.txt')
+    }
+    matching(includes: ['**/virtual/server/VirtualSessionHandler.java']) {
+        header = project.rootProject.file('HEADER_ELYTRAPROXY.txt')
+    }
     matching(includes: ['**/botfilter/**']) {
         header = project.rootProject.file('HEADER_BOTFILTER.txt')
     }
@@ -25,6 +35,7 @@ license {
     matching(includes: ['**/ElytraProxyCommand.java']) {
         header = project.rootProject.file('HEADER.txt')
     }
+    // ElytraProxy End
     header = project.rootProject.file('HEADER.txt')
 }
 
@@ -39,9 +50,9 @@ jar {
         }
 
         attributes 'Main-Class': 'com.velocitypowered.proxy.Velocity'
-        attributes 'Implementation-Title': "ElytraProxy"
+        attributes 'Implementation-Title': /*"Velocity"*/"ElytraProxy"
         attributes 'Implementation-Version': version
-        attributes 'Implementation-Vendor': "Velocity Contributors, ElytraProxy Contributors"
+        attributes 'Implementation-Vendor': "Velocity Contributors, ElytraProxy Contributors" // ElytraProxy
         attributes 'Multi-Release': 'true'
     }
 }
@@ -52,25 +63,32 @@ shadowJar {
 
 tasks.withType(Checkstyle) {
     exclude('**/com/velocitypowered/proxy/protocol/packet/*.java')
+
+    // ElytraProxy
     exclude('**/net/elytrium/elytraproxy/botfilter/**') // temp
+    exclude('**/net/elytrium/elytraproxy/virtual/**') // temp
     exclude('**/net/elytrium/elytraproxy/config/Settings.java')
 }
 
 dependencies {
-    // BotFilter backport: Add lombok
+    // BotFilter Backport Start: Add lombok
     compileOnly 'org.projectlombok:lombok:1.18.20'
     annotationProcessor 'org.projectlombok:lombok:1.18.20'
 
     testCompileOnly 'org.projectlombok:lombok:1.18.20'
     testAnnotationProcessor 'org.projectlombok:lombok:1.18.20'
+    // BotFilter Backport End
 
-    // Note: we depend on the API twice, first the main sourceset, and then the annotation processor.
-    implementation project(':elytraproxy-api')
-    implementation project(':elytraproxy-api').sourceSets.ap.output
-    implementation project(':elytraproxy-native')
-
-    // ElytraProxy
+    // ElytraProxy Start
     implementation "org.mariadb.jdbc:mariadb-java-client:2.7.3"
+    implementation 'at.favre.lib:bcrypt:0.9.0'
+    implementation 'dev.samstevens.totp:totp:1.7.1'
+
+    // Note: we depend on the API twice, first the main sourceset, and then the annotation processor.
+    implementation project(/*':velocity-api'*/':elytraproxy-api')
+    implementation project(/*':velocity-api'*/':elytraproxy-api').sourceSets.ap.output
+    implementation project(/*':velocity-native'*/':elytraproxy-native')
+    // ElytraProxy End
 
     implementation "io.netty:netty-codec:${nettyVersion}"
     implementation "io.netty:netty-codec-haproxy:${nettyVersion}"
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/ProxyOptions.java b/proxy/src/main/java/com/velocitypowered/proxy/ProxyOptions.java
index 8ac26cda..c80b471a 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/ProxyOptions.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/ProxyOptions.java
@@ -27,7 +27,6 @@ import org.apache.logging.log4j.Logger;
 import org.checkerframework.checker.nullness.qual.Nullable;
 
 public final class ProxyOptions {
-
   private static final Logger logger = LogManager.getLogger(ProxyOptions.class);
   private final boolean help;
   private final @Nullable Integer port;
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/Velocity.java b/proxy/src/main/java/com/velocitypowered/proxy/Velocity.java
index 9d31a75e..fdc14a45 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/Velocity.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/Velocity.java
@@ -70,7 +70,8 @@ public class Velocity {
 
     // ElytraProxy
     logger.warn("PLEASE REPORT ALL BUGS, ERRORS AND JUST NOTES"
-            + " OR SUGGESTIONS ON GITHUB PAGE. (https://github.com/Elytrium/ElytraProxy/issues)");
+        + " OR SUGGESTIONS ON GITHUB PAGE. (https://github.com/Elytrium/ElytraProxy/issues)");
+
     server.getConsoleCommandSource().start();
 
     // If we don't have a console available (because SimpleTerminalConsole returned), then we still
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/VelocityServer.java b/proxy/src/main/java/com/velocitypowered/proxy/VelocityServer.java
index 318363a0..dab1866b 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/VelocityServer.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/VelocityServer.java
@@ -54,9 +54,7 @@ import com.velocitypowered.proxy.protocol.util.GameProfileSerializer;
 import com.velocitypowered.proxy.scheduler.VelocityScheduler;
 import com.velocitypowered.proxy.server.ServerMap;
 import com.velocitypowered.proxy.util.AddressUtil;
-import com.velocitypowered.proxy.util.ClosestLocaleMatcher;
 import com.velocitypowered.proxy.util.EncryptionUtils;
-import com.velocitypowered.proxy.util.FileSystemUtils;
 import com.velocitypowered.proxy.util.VelocityChannelRegistrar;
 import com.velocitypowered.proxy.util.bossbar.AdventureBossBarManager;
 import com.velocitypowered.proxy.util.ratelimit.Ratelimiter;
@@ -80,7 +78,6 @@ import java.util.Locale;
 import java.util.Map;
 import java.util.Objects;
 import java.util.Optional;
-import java.util.ResourceBundle;
 import java.util.UUID;
 import java.util.concurrent.CompletableFuture;
 import java.util.concurrent.ConcurrentHashMap;
@@ -96,11 +93,7 @@ import net.elytrium.elytraproxy.ElytraProxy;
 import net.elytrium.elytraproxy.config.Settings;
 import net.kyori.adventure.audience.Audience;
 import net.kyori.adventure.audience.ForwardingAudience;
-import net.kyori.adventure.key.Key;
 import net.kyori.adventure.text.Component;
-import net.kyori.adventure.translation.GlobalTranslator;
-import net.kyori.adventure.translation.TranslationRegistry;
-import net.kyori.adventure.util.UTF8ResourceBundleControl;
 import net.kyori.adventure.text.serializer.gson.GsonComponentSerializer;
 import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
 import org.apache.logging.log4j.LogManager;
@@ -145,16 +138,18 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
   // ElytraProxy
   @Getter
   private static final Map<UUID, ConnectedPlayer> connectionsByUuid = new ConcurrentHashMap<>();
+
   private final Map<String, ConnectedPlayer> connectionsByName = new ConcurrentHashMap<>();
   private final VelocityConsole console;
   private @MonotonicNonNull Ratelimiter ipAttemptLimiter;
   private final VelocityEventManager eventManager;
   private final VelocityScheduler scheduler;
   private final VelocityChannelRegistrar channelRegistrar = new VelocityChannelRegistrar();
-  // ElytraProxy
+  // ElytraProxy Start
   @Getter
-  private ElytraProxy elytraProxy;
+  private @MonotonicNonNull ElytraProxy elytraProxy;
   private Component maintenanceMotd;
+  // ElytraProxy End
 
   VelocityServer(final ProxyOptions options) {
     pluginManager = new VelocityPluginManager(this);
@@ -184,15 +179,14 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
     String implVersion;
     String implVendor;
     if (pkg != null) {
-      // ElytraProxy
-      implName = MoreObjects.firstNonNull(pkg.getImplementationTitle(), "ElytraProxy");
+      implName = MoreObjects.firstNonNull(pkg.getImplementationTitle(), /*"Velocity"*/"ElytraProxy");
       implVersion = MoreObjects.firstNonNull(pkg.getImplementationVersion(), "<unknown>");
       implVendor = MoreObjects.firstNonNull(pkg.getImplementationVendor(), "Velocity Contributors,"
-          + " ElytraProxy Contributors");
+          + " ElytraProxy Contributors"); // ElytraProxy
     } else {
-      implName = "ElytraProxy";
+      implName = /*"Velocity"*/"ElytraProxy";
       implVersion = "<unknown>";
-      implVendor = "Velocity Contributors, ElytraProxy Contributors";
+      implVendor = "Velocity Contributors, ElytraProxy Contributors"; // ElytraProxy
     }
 
     return new ProxyVersion(implName, implVendor, implVersion);
@@ -212,9 +206,11 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
   void start() {
     // ElytraProxy
     logger.info("Booting up {} {}...", getVersion().getName(), Settings.IMP.VERSION);
+
     console.setupStreams();
 
-    registerTranslations();
+    // ElytraProxy: Removed as unnecessary
+    //registerTranslations();
 
     serverKeyPair = EncryptionUtils.createRsaKeyPair(1024);
 
@@ -223,7 +219,7 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
     // Initialize commands first
 
     // ElytraProxy: Move initialization to ElytraProxy main class
-    // commandManager.register("elytraproxy", new ElytraProxyCommand(this));
+    //commandManager.register("velocity", new VelocityCommand(this));
     commandManager.register("server", new ServerCommand(this));
     commandManager.register("shutdown", new ShutdownCommand(this),"end");
     new GlistCommand(this).register();
@@ -235,7 +231,11 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
     }
 
     ipAttemptLimiter = Ratelimiters.createWithMilliseconds(configuration.getLoginRatelimit(),
-        configuration.getLoginRatelimitAttempts()); // BotFilter backport: global rate limiter
+        configuration.getLoginRatelimitAttempts()); // BotFilter Backport: Global rate limiter
+
+    // ElytraProxy
+    this.elytraProxy = new ElytraProxy(this);
+
     loadPlugins();
 
     // Go ahead and fire the proxy initialization event. We block since plugins should have a chance
@@ -258,11 +258,11 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
     }
 
     Metrics.VelocityMetrics.startMetrics(this, configuration.getMetrics());
-
-    // ElytraProxy
-    this.elytraProxy = new ElytraProxy(this);
   }
 
+
+  // ElytraProxy: Removed as unnecessary
+  /*
   private void registerTranslations() {
     final TranslationRegistry translationRegistry = TranslationRegistry
         .create(Key.key("velocity", "translations"));
@@ -304,6 +304,7 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
     }
     GlobalTranslator.get().addSource(translationRegistry);
   }
+  */
 
   @SuppressFBWarnings("DM_EXIT")
   private void doStartupConfigLoad() {
@@ -457,9 +458,8 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
     }
 
     commandManager.setAnnounceProxyCommands(newConfiguration.isAnnounceProxyCommands());
-    // BotFilter backport: global rate limiter
     ipAttemptLimiter = Ratelimiters.createWithMilliseconds(newConfiguration.getLoginRatelimit(),
-        newConfiguration.getLoginRatelimitAttempts());
+        newConfiguration.getLoginRatelimitAttempts()); // BotFilter Backport: Global rate limiter
     this.configuration = newConfiguration;
     eventManager.fireAndForget(new ProxyReloadEvent());
     return true;
@@ -469,7 +469,7 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
    * Shuts down the proxy, kicking players with the specified {@param reason}.
    *
    * @param explicitExit whether the user explicitly shut down the proxy
-   * @param reason message to kick online players with
+   * @param reason       message to kick online players with
    */
   public void shutdown(boolean explicitExit, Component reason) {
     if (eventManager == null || pluginManager == null || cm == null || scheduler == null) {
@@ -500,8 +500,8 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
           // makes sure that all the disconnect events are being fired
 
           CompletableFuture<Void> playersTeardownFuture = CompletableFuture.allOf(players.stream()
-                  .map(ConnectedPlayer::getTeardownFuture)
-                  .toArray((IntFunction<CompletableFuture<Void>[]>) CompletableFuture[]::new));
+              .map(ConnectedPlayer::getTeardownFuture)
+              .toArray((IntFunction<CompletableFuture<Void>[]>) CompletableFuture[]::new));
 
           playersTeardownFuture.get(10, TimeUnit.SECONDS);
         } catch (TimeoutException e) {
@@ -552,13 +552,12 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
    * @param explicitExit whether the user explicitly shut down the proxy
    */
   public void shutdown(boolean explicitExit) {
+    // ElytraProxy Start
     shutdown(explicitExit,
         LegacyComponentSerializer
             .legacyAmpersand()
-            .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.PROXY_SHUTTING_DOWN
-                .replace("{NL}", "\n")
-                .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-            ));
+            .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.PROXY_SHUTTING_DOWN));
+    // ElytraProxy End
   }
 
   @Override
@@ -650,8 +649,8 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
     Objects.requireNonNull(partialName);
 
     return getAllPlayers().stream().filter(p -> p.getUsername()
-            .regionMatches(true, 0, partialName, 0, partialName.length()))
-            .collect(Collectors.toList());
+        .regionMatches(true, 0, partialName, 0, partialName.length()))
+        .collect(Collectors.toList());
   }
 
   @Override
@@ -659,8 +658,8 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
     Objects.requireNonNull(partialName);
 
     return getAllServers().stream().filter(s -> s.getServerInfo().getName()
-            .regionMatches(true, 0, partialName, 0, partialName.length()))
-            .collect(Collectors.toList());
+        .regionMatches(true, 0, partialName, 0, partialName.length()))
+        .collect(Collectors.toList());
   }
 
   @Override
@@ -670,12 +669,13 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
 
   @Override
   public int getPlayerCount() {
-    // ElytraProxy: Exclude online at servers in list
+    // ElytraProxy Start: Exclude online at servers in list
     return (int) getAllPlayers().stream().filter(p -> p.getCurrentServer()
         .isPresent())
         .filter(p -> !Settings.IMP.MAIN_SETTINGS.IGNORE_ONLINE_AT
             .contains(p.getCurrentServer().get().getServerInfo().getName()))
         .count();
+    // ElytraProxy End
   }
 
   @Override
@@ -771,25 +771,20 @@ public class VelocityServer implements ProxyServer, ForwardingAudience {
     return new VelocityResourcePackInfo.BuilderImpl(url);
   }
 
-  // ElytraProxy
+  // ElytraProxy Start
   public Component getMaintenanceMotd() {
     if (Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED) {
       if (Settings.IMP.MAIN_SETTINGS.MAINTENANCE.MOTD.startsWith("{")) {
         maintenanceMotd = GsonComponentSerializer
             .gson()
-            .deserialize(Settings.IMP.MAIN_SETTINGS.MAINTENANCE.MOTD
-                .replace("{NL}", "\n")
-                .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-            );
+            .deserialize(Settings.IMP.MAIN_SETTINGS.MAINTENANCE.MOTD);
       } else {
         maintenanceMotd = LegacyComponentSerializer
             .legacyAmpersand()
-            .deserialize(Settings.IMP.MAIN_SETTINGS.MAINTENANCE.MOTD
-                .replace("{NL}", "\n")
-                .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-            );
+            .deserialize(Settings.IMP.MAIN_SETTINGS.MAINTENANCE.MOTD);
       }
     }
     return maintenanceMotd;
   }
+  // ElytraProxy End
 }
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/CommandMessages.java b/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/CommandMessages.java
index 59102c9b..40661ade 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/CommandMessages.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/CommandMessages.java
@@ -23,20 +23,25 @@ import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
 
 public class CommandMessages {
 
+  // ElytraProxy Start
+  /*
+  public static final TranslatableComponent PLAYERS_ONLY = Component.translatable(
+      "velocity.command.players-only", NamedTextColor.RED);
+  */
   public static final Component PLAYERS_ONLY = LegacyComponentSerializer
       .legacyAmpersand()
-      .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.PLAYERS_ONLY
-          .replace("{NL}", "\n")
-          .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-      );
+      .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.PLAYERS_ONLY);
 
+  /*
+  public static final TranslatableComponent SERVER_DOES_NOT_EXIST = Component.translatable(
+      "velocity.command.server-does-not-exist", NamedTextColor.RED);
+  */
   public static Component SERVER_DOES_NOT_EXIST(String serverName) {
     return LegacyComponentSerializer
         .legacyAmpersand()
         .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.SERVER_DOES_NOT_EXIST
-            .replace("{NL}", "\n")
-            .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
             .replace("{0}", serverName)
         );
+    // ElytraProxy End
   }
 }
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/GlistCommand.java b/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/GlistCommand.java
index f9251320..a2fe6dcc 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/GlistCommand.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/GlistCommand.java
@@ -37,8 +37,6 @@ import net.elytrium.elytraproxy.config.Settings;
 import net.kyori.adventure.identity.Identity;
 import net.kyori.adventure.text.Component;
 import net.kyori.adventure.text.TextComponent;
-import net.kyori.adventure.text.TranslatableComponent;
-import net.kyori.adventure.text.format.NamedTextColor;
 import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
 
 public class GlistCommand {
@@ -57,7 +55,9 @@ public class GlistCommand {
   public void register() {
     LiteralCommandNode<CommandSource> totalNode = LiteralArgumentBuilder
         .<CommandSource>literal("glist")
-        .requires(source -> source.hasPermission("velocity.command.glist"))
+        // ElytraProxy
+        .requires(source ->
+            source./*getPermissionValue*/hasPermission("velocity.command.glist")/* == Tristate.TRUE*/)
         .executes(this::totalCount)
         .build();
     ArgumentCommandNode<CommandSource, String> serverNode = RequiredArgumentBuilder
@@ -79,12 +79,11 @@ public class GlistCommand {
     final CommandSource source = context.getSource();
     sendTotalProxyCount(source);
     source.sendMessage(Identity.nil(),
+        // ElytraProxy
+        /*Component.translatable("velocity.command.glist-view-all", NamedTextColor.YELLOW));*/
         LegacyComponentSerializer
             .legacyAmpersand()
-            .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.GLIST_VIEW_ALL
-                .replace("{NL}", "\n")
-                .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-            ));
+            .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.GLIST_VIEW_ALL));
     return 1;
   }
 
@@ -100,7 +99,8 @@ public class GlistCommand {
       Optional<RegisteredServer> registeredServer = server.getServer(serverName);
       if (!registeredServer.isPresent()) {
         source.sendMessage(Identity.nil(),
-            CommandMessages.SERVER_DOES_NOT_EXIST(serverName));
+            // ElytraProxy
+            CommandMessages.SERVER_DOES_NOT_EXIST(serverName)/*.args(Component.text(serverName))*/);
         return -1;
       }
       sendServerPlayers(source, registeredServer.get(), false);
@@ -109,23 +109,26 @@ public class GlistCommand {
   }
 
   private void sendTotalProxyCount(CommandSource target) {
-    int online = server.getAllPlayers().size();
-    Component msg = online == 1
+    // ElytraProxy Start
+    int online = server./*getPlayerCount*/getAllPlayers().size();
+    /*TranslatableComponent*/Component msg = online == 1
+        /*
+        ? Component.translatable("velocity.command.glist-player-singular")
+        : Component.translatable("velocity.command.glist-player-plural");
+        */
         ? LegacyComponentSerializer
-            .legacyAmpersand()
-            .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.GLIST_PLAYER_SINGULAR
-                .replace("{NL}", "\n")
-                .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                .replace("{0}", Integer.toString(online)
-        ))
-            : LegacyComponentSerializer
-                .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.GLIST_PLAYER_PLURAL
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                    .replace("{0}", Integer.toString(online)
-        ));
-    target.sendMessage(msg);
+        .legacyAmpersand()
+        .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.GLIST_PLAYER_SINGULAR
+            .replace("{0}", Integer.toString(online)
+            ))
+        : LegacyComponentSerializer
+        .legacyAmpersand()
+        .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.GLIST_PLAYER_PLURAL
+            .replace("{0}", Integer.toString(online)
+            ));
+    target.sendMessage(msg/*.color(NamedTextColor.YELLOW)
+        .args(Component.text(Integer.toString(online), NamedTextColor.GREEN))*/);
+    // ElytraProxy End
   }
 
   private void sendServerPlayers(CommandSource target, RegisteredServer server, boolean fromAll) {
@@ -134,16 +137,20 @@ public class GlistCommand {
       return;
     }
 
-    TextComponent.Builder builder = Component
-        .text().append(
+    // ElytraProxy Start
+    TextComponent.Builder builder = Component.text()
+        .append(/*Component.text("[" + server.getServerInfo().getName() + "] ",
+            NamedTextColor.DARK_AQUA))
+        .append(Component.text("(" + onServer.size() + ")", NamedTextColor.GRAY))
+        .append(Component.text(": "))*/
             LegacyComponentSerializer
                 .legacyAmpersand()
                 .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.GLIST_FORMAT_VIEW_ALL
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
                     .replace("{0}", server.getServerInfo().getName())
-                    .replace("{1}", Integer.toString(onServer.size())
-        ))).resetStyle();
+                    .replace("{1}", Integer.toString(onServer.size()))
+                ))
+        // ElytraProxy End
+        .resetStyle();
 
     for (int i = 0; i < onServer.size(); i++) {
       Player player = onServer.get(i);
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/ServerCommand.java b/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/ServerCommand.java
index fa55a506..f5aef727 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/ServerCommand.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/ServerCommand.java
@@ -64,7 +64,10 @@ public class ServerCommand implements SimpleCommand {
       String serverName = args[0];
       Optional<RegisteredServer> toConnect = server.getServer(serverName);
       if (!toConnect.isPresent()) {
-        player.sendMessage(Identity.nil(), CommandMessages.SERVER_DOES_NOT_EXIST(serverName));
+        // ElytraProxy Start
+        player.sendMessage(Identity.nil(), CommandMessages.SERVER_DOES_NOT_EXIST
+            /*.args(Component.text(*/(serverName))/*)*/;
+        // ElytraProxy End
         return;
       }
 
@@ -77,36 +80,37 @@ public class ServerCommand implements SimpleCommand {
   private void outputServerInformation(Player executor) {
     String currentServer = executor.getCurrentServer().map(ServerConnection::getServerInfo)
         .map(ServerInfo::getName).orElse("<unknown>");
-    executor.sendMessage(Identity.nil(),
+    // ElytraProxy Start
+    executor.sendMessage(Identity.nil(), /*Component.translatable(
+        "velocity.command.server-current-server",
+        NamedTextColor.YELLOW,
+        Component.text(currentServer)));*/
         LegacyComponentSerializer
             .legacyAmpersand()
             .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.SERVER_CURRENT_SERVER
-                .replace("{NL}", "\n")
-                .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
                 .replace("{0}", currentServer)
             ));
 
     List<RegisteredServer> servers = BuiltinCommandUtil.sortedServerList(server);
     if (servers.size() > MAX_SERVERS_TO_LIST) {
-      executor.sendMessage(Identity.nil(),
+      executor.sendMessage(Identity.nil(), /*Component.translatable(
+          "velocity.command.server-too-many", NamedTextColor.RED));*/
           LegacyComponentSerializer
               .legacyAmpersand()
-              .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.SERVER_TOO_MANY
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ));
+              .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.SERVER_TOO_MANY));
       return;
     }
 
     // Assemble the list of servers as components
-    TextComponent.Builder serverListBuilder = Component
-        .text().append(
+    TextComponent.Builder serverListBuilder = Component.text()
+        .append(/*Component.translatable("velocity.command.server-available",
+            NamedTextColor.YELLOW))
+        .append(Component.space());*/
             LegacyComponentSerializer
                 .legacyAmpersand()
                 .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.SERVER_AVAILABLE
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
                 ));
+    // ElytraProxy End
     for (int i = 0; i < servers.size(); i++) {
       RegisteredServer rs = servers.get(i);
       serverListBuilder.append(formatServerComponent(currentServer, rs));
@@ -123,22 +127,21 @@ public class ServerCommand implements SimpleCommand {
     TextComponent serverTextComponent = Component.text(serverInfo.getName());
 
     int connectedPlayers = server.getPlayersConnected().size();
-    Component playersTextComponent;
+    // ElytraProxy Start
+    /*TranslatableComponent*/Component playersTextComponent;
     if (connectedPlayers == 1) {
-      playersTextComponent = LegacyComponentSerializer
-          .legacyAmpersand()
-          .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.SERVER_TOOLTIP_PLAYER_ONLINE
-              .replace("{NL}", "\n")
-              .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              .replace("{0}", String.valueOf(connectedPlayers))
+      playersTextComponent = /*Component.translatable("velocity.command.server-tooltip-player-online");*/
+          LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.SERVER_TOOLTIP_PLAYER_ONLINE
+                  .replace("{0}", String.valueOf(connectedPlayers))
           );
     } else {
-      playersTextComponent = LegacyComponentSerializer
-          .legacyAmpersand()
-          .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.SERVER_TOOLTIP_PLAYERS_ONLINE
-              .replace("{NL}", "\n")
-              .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              .replace("{0}", String.valueOf(connectedPlayers))
+      playersTextComponent = /*Component.translatable("velocity.command.server-tooltip-players-online");*/
+          LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.SERVER_TOOLTIP_PLAYERS_ONLINE
+                  .replace("{0}", String.valueOf(connectedPlayers))
           );
     }
 
@@ -146,32 +149,28 @@ public class ServerCommand implements SimpleCommand {
       serverTextComponent = serverTextComponent.color(NamedTextColor.GREEN)
           .hoverEvent(
               showText(
+                  /*Component.translatable("velocity.command.server-tooltip-current-server")
+                      .append(Component.newline())
+                      .append(playersTextComponent))*/
                   LegacyComponentSerializer
                       .legacyAmpersand()
-                      .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND
-                              .SERVER_TOOLTIP_CURRENT_SERVER
-                          .replace("{NL}", "\n")
-                          .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                          .replace("{0}", LegacyComponentSerializer
-                              .legacySection()
-                              .serialize(playersTextComponent))
+                      .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.SERVER_TOOLTIP_CURRENT_SERVER
+                          .replace("{0}", LegacyComponentSerializer.legacySection().serialize(playersTextComponent))
                       )));
     } else {
       serverTextComponent = serverTextComponent.color(NamedTextColor.GRAY)
           .clickEvent(ClickEvent.runCommand("/server " + serverInfo.getName()))
           .hoverEvent(
-              showText(
+              showText(/*Component.translatable("velocity.command.server-tooltip-offer-connect-server")
+                  .append(Component.newline())
+                  .append(playersTextComponent))*/
                   LegacyComponentSerializer
                       .legacyAmpersand()
-                      .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND
-                              .SERVER_TOOLTIP_OFFER_CONNECT_SERVER
-                          .replace("{NL}", "\n")
-                          .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                          .replace("{0}", LegacyComponentSerializer
-                              .legacySection()
-                              .serialize(playersTextComponent))
+                      .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.SERVER_TOOLTIP_OFFER_CONNECT_SERVER
+                          .replace("{0}", LegacyComponentSerializer.legacySection().serialize(playersTextComponent))
                       )));
     }
+    // ElytraProxy End
     return serverTextComponent;
   }
 
@@ -194,6 +193,7 @@ public class ServerCommand implements SimpleCommand {
 
   @Override
   public boolean hasPermission(final SimpleCommand.Invocation invocation) {
-    return invocation.source().hasPermission("velocity.command.server");
+    // ElytraProxy
+    return invocation.source()./*getPermissionValue*/hasPermission("velocity.command.server")/* != Tristate.FALSE*/;
   }
 }
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/ShutdownCommand.java b/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/ShutdownCommand.java
index 995b6bfc..08da1725 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/ShutdownCommand.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/command/builtin/ShutdownCommand.java
@@ -19,7 +19,6 @@ package com.velocitypowered.proxy.command.builtin;
 
 import com.velocitypowered.api.command.RawCommand;
 import com.velocitypowered.proxy.VelocityServer;
-import net.elytrium.elytraproxy.config.Settings;
 import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
 
 public class ShutdownCommand implements RawCommand {
@@ -36,17 +35,18 @@ public class ShutdownCommand implements RawCommand {
     if (reason.isEmpty() || reason.trim().isEmpty()) {
       server.shutdown(true);
     } else {
+      // ElytraProxy Start
+      /*server.shutdown(true, LegacyComponentSerializer.legacy('&').deserialize(reason));*/
       server.shutdown(true, LegacyComponentSerializer
           .legacyAmpersand()
-          .deserialize(reason
-              .replace("{NL}", "\n")
-              .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-          ));
+          .deserialize(reason));
+      // ElytraProxy End
     }
   }
 
   @Override
   public boolean hasPermission(final Invocation invocation) {
-    return invocation.source().hasPermission("velocity.command.shutdown");
+    // ElytraProxy
+    return invocation.source()/* == server.getConsoleCommandSource()*/.hasPermission("velocity.command.shutdown");
   }
 }
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/config/VelocityConfiguration.java b/proxy/src/main/java/com/velocitypowered/proxy/config/VelocityConfiguration.java
index 71469abd..caf3eb1a 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/config/VelocityConfiguration.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/config/VelocityConfiguration.java
@@ -28,6 +28,7 @@ import com.google.gson.annotations.Expose;
 import com.velocitypowered.api.proxy.config.ProxyConfig;
 import com.velocitypowered.api.util.Favicon;
 import com.velocitypowered.proxy.util.AddressUtil;
+
 import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
 import java.io.File;
 import java.io.IOException;
@@ -58,14 +59,16 @@ public class VelocityConfiguration implements ProxyConfig {
 
   private static final Logger logger = LogManager.getLogger(VelocityConfiguration.class);
 
-  @Expose private String bind = "0.0.0.0:25565";
-  @Expose private String motd = "&3An ElytraProxy Server";
+  // ElytraProxy Start
+  @Expose private String bind = /*"0.0.0.0:25577"*/"0.0.0.0:25565";
+  @Expose private String motd = /*"&3A Velocity Server"*/"&3An ElytraProxy Server";
   @Expose private int showMaxPlayers = 500;
   @Expose private boolean onlineMode = true;
-  @Expose private boolean preventClientProxyConnections = true;
+  @Expose private boolean preventClientProxyConnections = /*false*/true;
   @Expose private PlayerInfoForwarding playerInfoForwardingMode = PlayerInfoForwarding.NONE;
   private byte[] forwardingSecret = generateRandomString(12).getBytes(StandardCharsets.UTF_8);
-  @Expose private boolean announceForge = true;
+  @Expose private boolean announceForge = /*false*/true;
+  // ElytraProxy End
   @Expose private boolean onlineModeKickExistingPlayers = false;
   @Expose private PingPassthroughMode pingPassthrough = PingPassthroughMode.DISABLED;
   private final Servers servers;
@@ -254,19 +257,17 @@ public class VelocityConfiguration implements ProxyConfig {
   public net.kyori.adventure.text.Component getMotd() {
     if (motdAsComponent == null) {
       if (motd.startsWith("{")) {
+        // ElytraProxy Start
+        /*motdAsComponent = GsonComponentSerializer.gson().deserialize(motd);*/
         motdAsComponent = GsonComponentSerializer
             .gson()
-            .deserialize(motd
-                .replace("{NL}", "\n")
-                .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-            );
+            .deserialize(motd);
       } else {
+        /*motdAsComponent = LegacyComponentSerializer.legacy('&').deserialize(motd);*/
         motdAsComponent = LegacyComponentSerializer
             .legacyAmpersand()
-            .deserialize(motd
-                .replace("{NL}", "\n")
-                .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-            );
+            .deserialize(motd);
+        // ElytraProxy End
       }
     }
     return motdAsComponent;
@@ -325,11 +326,12 @@ public class VelocityConfiguration implements ProxyConfig {
     return advanced.getLoginRatelimit();
   }
 
-  //BotFilter - global rate limiter
+  // BotFilter Backport Start: Global rate limiter
   @Override
   public int getLoginRatelimitAttempts() {
     return Settings.IMP.MAIN_SETTINGS.LOGIN_RATELIMIT_ATTEMPTS;
   }
+  // BotFilter Backport End
 
   @Override
   public Optional<Favicon> getFavicon() {
@@ -465,8 +467,10 @@ public class VelocityConfiguration implements ProxyConfig {
     PingPassthroughMode pingPassthroughMode = config.getEnumOrElse("ping-passthrough",
         PingPassthroughMode.DISABLED);
 
-    String bind = config.getOrElse("bind", "0.0.0.0:25565");
-    String motd = config.getOrElse("motd", "&#09add3Am ElytraProxy Server");
+    // ElytraProxy Start
+    String bind = config.getOrElse("bind", /*"0.0.0.0:25577"*/"0.0.0.0:25565");
+    String motd = config.getOrElse("motd", /*"&#09add3A Velocity Server"*/"&#09add3An ElytraProxy Server");
+    // ElytraProxy End
     int maxPlayers = config.getIntOrElse("show-max-players", 500);
     Boolean onlineMode = config.getOrElse("online-mode", true);
     Boolean announceForge = config.getOrElse("announce-forge", true);
@@ -632,26 +636,29 @@ public class VelocityConfiguration implements ProxyConfig {
 
   private static class Advanced {
 
-    @Expose private int compressionThreshold = 512;
-    @Expose private int compressionLevel = 9;
+    // ElytraProxy Start
+    @Expose private int compressionThreshold = /*256*/512;
+    @Expose private int compressionLevel = /*-1*/9;
+    // ElytraProxy End
     @Expose private int loginRatelimit = 3000;
     @Expose private int connectionTimeout = 5000;
     @Expose private int readTimeout = 30000;
     @Expose private boolean proxyProtocol = false;
     @Expose private boolean tcpFastOpen = false;
     @Expose private boolean bungeePluginMessageChannel = true;
-    @Expose private boolean showPingRequests = true;
+    @Expose private boolean showPingRequests = /*false*/true;
     @Expose private boolean failoverOnUnexpectedServerDisconnect = true;
     @Expose private boolean announceProxyCommands = true;
-    @Expose private boolean logCommandExecutions = true;
+    @Expose private boolean logCommandExecutions = /*false*/true;
 
     private Advanced() {
     }
 
     private Advanced(CommentedConfig config) {
       if (config != null) {
-        this.compressionThreshold = config.getIntOrElse("compression-threshold", 512);
-        this.compressionLevel = config.getIntOrElse("compression-level", 9);
+        // ElytraProxy Start
+        this.compressionThreshold = config.getIntOrElse("compression-threshold", /*256*/512);
+        this.compressionLevel = config.getIntOrElse("compression-level", /*-1*/9);
         this.loginRatelimit = config.getIntOrElse("login-ratelimit", 3000);
         this.connectionTimeout = config.getIntOrElse("connection-timeout", 5000);
         this.readTimeout = config.getIntOrElse("read-timeout", 30000);
@@ -662,11 +669,12 @@ public class VelocityConfiguration implements ProxyConfig {
         }
         this.tcpFastOpen = config.getOrElse("tcp-fast-open", false);
         this.bungeePluginMessageChannel = config.getOrElse("bungee-plugin-message-channel", true);
-        this.showPingRequests = config.getOrElse("show-ping-requests", true);
+        this.showPingRequests = config.getOrElse("show-ping-requests", /*false*/true);
         this.failoverOnUnexpectedServerDisconnect = config
             .getOrElse("failover-on-unexpected-server-disconnect", true);
         this.announceProxyCommands = config.getOrElse("announce-proxy-commands", true);
-        this.logCommandExecutions = config.getOrElse("log-command-executions", true);
+        this.logCommandExecutions = config.getOrElse("log-command-executions", /*false*/true);
+        // ElytraProxy End
       }
     }
 
@@ -740,8 +748,10 @@ public class VelocityConfiguration implements ProxyConfig {
   private static class Query {
 
     @Expose private boolean queryEnabled = false;
-    @Expose private int queryPort = 25565;
-    @Expose private String queryMap = "ElytraProxy";
+    // ElytraProxy Start
+    @Expose private int queryPort = /*25577*/25565;
+    @Expose private String queryMap = /*"Velocity"*/"ElytraProxy";
+    // ElytraProxy End
     @Expose private boolean showPlugins = false;
 
     private Query() {
@@ -757,8 +767,10 @@ public class VelocityConfiguration implements ProxyConfig {
     private Query(CommentedConfig config) {
       if (config != null) {
         this.queryEnabled = config.getOrElse("enabled", false);
-        this.queryPort = config.getIntOrElse("port", 25565);
-        this.queryMap = config.getOrElse("map", "ElytraProxy");
+        // ElytraProxy Start
+        this.queryPort = config.getIntOrElse("port", /*25577*/25565);
+        this.queryMap = config.getOrElse("map", /*"Velocity"*/"ElytraProxy");
+        // ElytraProxy End
         this.showPlugins = config.getOrElse("show-plugins", false);
       }
     }
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/MinecraftConnection.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/MinecraftConnection.java
index 03901b49..dc1e6773 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/MinecraftConnection.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/MinecraftConnection.java
@@ -28,12 +28,12 @@ import static com.velocitypowered.proxy.network.Connections.MINECRAFT_ENCODER;
 
 import com.google.common.base.Preconditions;
 import com.velocitypowered.api.network.ProtocolVersion;
-import com.velocitypowered.api.proxy.Player;
 import com.velocitypowered.natives.compression.VelocityCompressor;
 import com.velocitypowered.natives.encryption.VelocityCipher;
 import com.velocitypowered.natives.encryption.VelocityCipherFactory;
 import com.velocitypowered.natives.util.Natives;
 import com.velocitypowered.proxy.VelocityServer;
+import com.velocitypowered.proxy.connection.client.ConnectedPlayer;
 import com.velocitypowered.proxy.connection.client.HandshakeSessionHandler;
 import com.velocitypowered.proxy.connection.client.LoginSessionHandler;
 import com.velocitypowered.proxy.connection.client.StatusSessionHandler;
@@ -64,7 +64,6 @@ import java.security.GeneralSecurityException;
 import java.util.concurrent.TimeUnit;
 import javax.crypto.SecretKey;
 import javax.crypto.spec.SecretKeySpec;
-import net.elytrium.elytraproxy.config.Settings;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 import org.checkerframework.checker.nullness.qual.Nullable;
@@ -90,7 +89,7 @@ public class MinecraftConnection extends ChannelInboundHandlerAdapter {
   /**
    * Initializes a new {@link MinecraftConnection} instance.
    * @param channel the channel on the connection
-   * @param server the Velocity instance
+   * @param server  the Velocity instance
    */
   public MinecraftConnection(Channel channel, VelocityServer server) {
     this.channel = channel;
@@ -139,60 +138,6 @@ public class MinecraftConnection extends ChannelInboundHandlerAdapter {
       }
 
       if (msg instanceof MinecraftPacket) {
-        // ElytraProxy Start
-        // TODO: FIX
-        if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.ENABLE) {
-          InetSocketAddress adr = (InetSocketAddress) ctx.channel().localAddress();
-          InetSocketAddress adr1 = (InetSocketAddress) ctx.channel().remoteAddress();
-          String notifymsg = "{} tried to connect using {}";
-          if (!Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.IGNORED_IPS.contains(
-                  adr1.getAddress().getHostAddress())) {
-            if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.WHITELIST) {
-              if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.IPS_CHECK) {
-                if (!Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.HOSTNAMES.contains(
-                        adr.getAddress().getHostAddress())) {
-                  server.getElytraProxy().getLogger().info(notifymsg,
-                          ctx.channel().remoteAddress(),
-                          adr.getAddress().getHostAddress());
-                  server.getElytraProxy().getStatistics().addBlockedConnection();
-                  return;
-                }
-              }
-              if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.DOMAINS_CHECK) {
-                if (!Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.HOSTNAMES.contains(
-                        adr.getHostName())) {
-                  server.getElytraProxy().getLogger().info(notifymsg,
-                          ctx.channel().remoteAddress(),
-                          adr.getHostName());
-                  server.getElytraProxy().getStatistics().addBlockedConnection();
-                  return;
-                }
-              }
-            } else {
-              if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.IPS_CHECK) {
-                if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.HOSTNAMES.contains(
-                        adr.getAddress().getHostAddress())) {
-                  server.getElytraProxy().getLogger().info(notifymsg,
-                          ctx.channel().remoteAddress(),
-                          adr.getAddress().getHostAddress());
-                  server.getElytraProxy().getStatistics().addBlockedConnection();
-                  return;
-                }
-              }
-              if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.DOMAINS_CHECK) {
-                if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.HOSTNAMES.contains(
-                        adr.getHostName())) {
-                  server.getElytraProxy().getLogger().info(notifymsg,
-                          ctx.channel().remoteAddress(),
-                          adr.getHostName());
-                  server.getElytraProxy().getStatistics().addBlockedConnection();
-                  return;
-                }
-              }
-            }
-          }
-        }
-        // ElytraProxy End
         MinecraftPacket pkt = (MinecraftPacket) msg;
         if (!pkt.handle(sessionHandler)) {
           sessionHandler.handleGeneric((MinecraftPacket) msg);
@@ -222,7 +167,7 @@ public class MinecraftConnection extends ChannelInboundHandlerAdapter {
       if (sessionHandler != null) {
         try {
           // ElytraProxy Start - Fix long message while player disconnect unexpectedly
-          if (cause instanceof ReadTimeoutException && association instanceof Player) {
+          if (cause instanceof ReadTimeoutException && association instanceof ConnectedPlayer) {
             logger.info("{} may have disconnect by closing minecraft.", association);
           } else {
             sessionHandler.exception(cause);
@@ -311,7 +256,7 @@ public class MinecraftConnection extends ChannelInboundHandlerAdapter {
     if (channel.isActive()) {
       boolean is17 = this.getProtocolVersion().compareTo(ProtocolVersion.MINECRAFT_1_8) < 0
           && this.getProtocolVersion().compareTo(ProtocolVersion.MINECRAFT_1_7_2) >= 0;
-      // BotFilter looks like it works ok for Login protocol
+      // BotFilter BackPort: Looks like it works ok for Login protocol
       if (is17 && this.getState() == StateRegistry.PLAY) {
         channel.eventLoop().execute(() -> {
           // 1.7.x versions have a race condition with switching protocol states, so just explicitly
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/MinecraftSessionHandler.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/MinecraftSessionHandler.java
index e3d2cae0..e72f42d6 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/MinecraftSessionHandler.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/MinecraftSessionHandler.java
@@ -53,7 +53,6 @@ import com.velocitypowered.proxy.protocol.packet.title.TitleSubtitlePacket;
 import com.velocitypowered.proxy.protocol.packet.title.TitleTextPacket;
 import com.velocitypowered.proxy.protocol.packet.title.TitleTimesPacket;
 import io.netty.buffer.ByteBuf;
-import net.elytrium.elytraproxy.botfilter.protocol.packet.PlayerPositionAndLook;
 
 public interface MinecraftSessionHandler {
 
@@ -232,10 +231,4 @@ public interface MinecraftSessionHandler {
   default boolean handle(ResourcePackResponse packet) {
     return false;
   }
-
-  //BotFilter start - add handle methods
-  default boolean handle(PlayerPositionAndLook packet) {
-    return false;
-  }
-  //BotFilter end
 }
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/LoginSessionHandler.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/LoginSessionHandler.java
index b8627700..3451c59b 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/LoginSessionHandler.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/LoginSessionHandler.java
@@ -45,17 +45,16 @@ import javax.crypto.Mac;
 import javax.crypto.SecretKey;
 import javax.crypto.spec.SecretKeySpec;
 import net.elytrium.elytraproxy.config.Settings;
-import net.kyori.adventure.text.TextComponent;
+import net.kyori.adventure.text.Component;
 import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
 
 public class LoginSessionHandler implements MinecraftSessionHandler {
 
-  private static final TextComponent MODERN_IP_FORWARDING_FAILURE = LegacyComponentSerializer
-      .legacyAmpersand()
-      .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.MODERN_FORWARDING_FAILED
-          .replace("{NL}", "\n")
-          .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-      );
+  private static final Component MODERN_IP_FORWARDING_FAILURE = /*Component
+      .translatable("velocity.error.modern-forwarding-failed");*/
+      LegacyComponentSerializer
+          .legacyAmpersand()
+          .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.MODERN_FORWARDING_FAILED);
 
   private final VelocityServer server;
   private final VelocityServerConnection serverConn;
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/TransitionSessionHandler.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/TransitionSessionHandler.java
index 35682584..0479c30a 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/TransitionSessionHandler.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/TransitionSessionHandler.java
@@ -38,6 +38,7 @@ import com.velocitypowered.proxy.protocol.packet.PluginMessage;
 import com.velocitypowered.proxy.protocol.util.PluginMessageUtil;
 import java.io.IOException;
 import java.util.concurrent.CompletableFuture;
+import net.elytrium.elytraproxy.virtual.protocol.packet.PlayerPositionAndLook;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 
@@ -54,8 +55,8 @@ public class TransitionSessionHandler implements MinecraftSessionHandler {
 
   /**
    * Creates the new transition handler.
-   * @param server the Velocity server instance
-   * @param serverConn the server connection
+   * @param server       the Velocity server instance
+   * @param serverConn   the server connection
    * @param resultFuture the result future
    */
   TransitionSessionHandler(VelocityServer server,
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/VelocityServerConnection.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/VelocityServerConnection.java
index 62be4a34..9d692eb4 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/VelocityServerConnection.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/backend/VelocityServerConnection.java
@@ -69,8 +69,8 @@ public class VelocityServerConnection implements MinecraftConnectionAssociation,
   /**
    * Initializes a new server connection.
    * @param registeredServer the server to connect to
-   * @param proxyPlayer the player connecting to the server
-   * @param server the Velocity proxy instance
+   * @param proxyPlayer      the player connecting to the server
+   * @param server           the Velocity proxy instance
    */
   public VelocityServerConnection(VelocityRegisteredServer registeredServer,
       ConnectedPlayer proxyPlayer, VelocityServer server) {
@@ -82,7 +82,7 @@ public class VelocityServerConnection implements MinecraftConnectionAssociation,
   /**
    * Connects to the server.
    * @return a {@link com.velocitypowered.api.proxy.ConnectionRequestBuilder.Result} representing
-   *         whether or not the connect succeeded
+   * whether or not the connect succeeded
    */
   public CompletableFuture<Impl> connect() {
     CompletableFuture<Impl> result = new CompletableFuture<>();
@@ -230,7 +230,7 @@ public class VelocityServerConnection implements MinecraftConnectionAssociation,
   /**
    * Sends a plugin message to the server through this connection.
    * @param identifier the channel ID to use
-   * @param data the data
+   * @param data       the data
    * @return whether or not the message was sent
    */
   public boolean sendPluginMessage(ChannelIdentifier identifier, ByteBuf data) {
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/ClientPlaySessionHandler.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/ClientPlaySessionHandler.java
index 67b46aca..7244c29e 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/ClientPlaySessionHandler.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/ClientPlaySessionHandler.java
@@ -68,7 +68,6 @@ import java.util.UUID;
 import java.util.concurrent.CompletableFuture;
 import net.elytrium.elytraproxy.commands.ElytraProxyCommand;
 import net.elytrium.elytraproxy.config.Settings;
-import net.kyori.adventure.identity.Identity;
 import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
@@ -83,12 +82,7 @@ public class ClientPlaySessionHandler implements MinecraftSessionHandler {
   private static final Logger logger = LogManager.getLogger(ClientPlaySessionHandler.class);
 
   private final ConnectedPlayer player;
-  private boolean spawned = false;
-  // ElytraProxy
-  private boolean checkedBySettings = false;
-  private boolean checkedByBrand = false;
-  private boolean willBeKickedChat = false;
-  private boolean willBeKickedUnk = false;
+  private boolean spawned;
   private final List<UUID> serverBossBars = new ArrayList<>();
   private final Queue<PluginMessage> loginPluginMessages = new ArrayDeque<>();
   private final VelocityServer server;
@@ -101,6 +95,7 @@ public class ClientPlaySessionHandler implements MinecraftSessionHandler {
    */
   public ClientPlaySessionHandler(VelocityServer server, ConnectedPlayer player) {
     this.player = player;
+    this.spawned = player.isVirtualServerJoined();
     this.server = server;
   }
 
@@ -122,34 +117,6 @@ public class ClientPlaySessionHandler implements MinecraftSessionHandler {
     }
   }
 
-  // ElytraProxy
-  private void kickIfCheckNotPassed() {
-    if (Settings.IMP.ANTIBOT.ENABLE) {
-      if ((!checkedBySettings) && Settings.IMP.ANTIBOT.CHECK_CLIENT_SETTINGS) {
-        player.disconnect(
-            LegacyComponentSerializer
-                .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.CLIENT_CHECK_SETTINGS
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ));
-        server.getElytraProxy().getStatistics().addBlockedConnection();
-        server.getElytraProxy().getStatistics().addBlockedBots();
-      }
-      if ((!checkedByBrand) && Settings.IMP.ANTIBOT.CHECK_CLIENT_BRAND) {
-        player.disconnect(
-            LegacyComponentSerializer
-                .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.CLIENT_CHECK_BRAND
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ));
-        server.getElytraProxy().getStatistics().addBlockedConnection();
-        server.getElytraProxy().getStatistics().addBlockedBots();
-      }
-    }
-  }
-
   @Override
   public boolean handle(KeepAlive packet) {
     VelocityServerConnection serverConnection = player.getConnectedServer();
@@ -169,74 +136,11 @@ public class ClientPlaySessionHandler implements MinecraftSessionHandler {
   @Override
   public boolean handle(ClientSettings packet) {
     player.setPlayerSettings(packet);
-    // ElytraProxy
-    // TODO: Move to botfilter check
-    String toStringPacket = "{} send settings \"locale= '"
-        + packet.getLocale() + '\''
-        + ", viewDistance=" + packet.getViewDistance()
-        + ", chatVisibility=" + packet.getChatVisibility()
-        + ", chatColors=" + packet.isChatColors()
-        + ", skinParts=" + packet.getSkinParts()
-        + ", mainHand=" + packet.getMainHand()
-        + ", chatFilteringEnabled=" + packet.isChatFilteringEnabled() + '"';
-    if (Settings.IMP.ANTIBOT.ENABLE) {
-      if ((!checkedBySettings) && Settings.IMP.ANTIBOT.CHECK_CLIENT_SETTINGS) {
-        if (packet.toString().contains("null")) {
-          logger.error(toStringPacket, player);
-          player.disconnect(
-              LegacyComponentSerializer
-                  .legacyAmpersand()
-                  .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.CLIENT_CHECK_SETTINGS
-                      .replace("{NL}", "\n")
-                      .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                  ));
-          server.getElytraProxy().getLogger().error("{} has null in settings packet", player);
-          server.getElytraProxy().getStatistics().addBlockedConnection();
-          server.getElytraProxy().getStatistics().addBlockedBots();
-        } else if (!packet.isChatColors()) {
-          logger.error(toStringPacket, player);
-          player.disconnect(
-              LegacyComponentSerializer
-                  .legacyAmpersand()
-                  .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK
-                          .CLIENT_CHECK_SETTINGS_CHAT_COLOR
-                      .replace("{NL}", "\n")
-                      .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                  ));
-          server.getElytraProxy().getLogger().error("{} doesn't send isChatColors packet",
-              player);
-          server.getElytraProxy().getStatistics().addBlockedConnection();
-          server.getElytraProxy().getStatistics().addBlockedBots();
-        } else if (packet.getSkinParts() == 0) {
-          logger.error(toStringPacket, player);
-          player.disconnect(
-              LegacyComponentSerializer
-                  .legacyAmpersand()
-                  .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK
-                          .CLIENT_CHECK_SETTINGS_SKIN_PARTS
-                      .replace("{NL}", "\n")
-                      .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                  ));
-          server.getElytraProxy().getLogger().error("{} doesn't send skin parts packet",
-              player);
-          server.getElytraProxy().getStatistics().addBlockedConnection();
-          server.getElytraProxy().getStatistics().addBlockedBots();
-        }
-        logger.info(toStringPacket, player);
-      }
-    }
-    checkedBySettings = true;
     return false; // will forward onto the server
   }
 
   @Override
   public boolean handle(Chat packet) {
-    // ElytraProxy
-    // TODO: Move to botfilter check
-    if (!willBeKickedChat) {
-      kickIfCheckNotPassed();
-      willBeKickedChat = true;
-    }
     VelocityServerConnection serverConnection = player.getConnectedServer();
     if (serverConnection == null) {
       return true;
@@ -254,41 +158,37 @@ public class ClientPlaySessionHandler implements MinecraftSessionHandler {
               event.getResult()))
           .whenComplete((ignored, throwable) -> {
             // ElytraProxy Start
-            for (ConnectedPlayer player1 : ElytraProxyCommand.getPlayersWithSpy()) {
-              if (player1.hasPermission("elytraproxy.command.commandspy")) {
-                if (!player1.getUsername().equals(player.getUsername())) {
-                  player1.sendMessage(
-                      LegacyComponentSerializer
-                          .legacyAmpersand()
-                          .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.COMMAND_SPY_FORMAT
-                              .replace("{NL}", "\n")
-                              .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                              .replace("{0}", player.getUsername())
-                              .replace("{1}", "/" + originalCommand)
-                          ));
-                }
-              }
-            }
+            ElytraProxyCommand.getPlayersWithSpy().stream()
+                .map(server::getPlayer).forEach(player -> player.ifPresent(p -> {
+                  if (p.hasPermission("elytraproxy.command.commandspy")) {
+                    if (!p.getUsername().equals(p.getUsername())) {
+                      p.sendMessage(
+                          LegacyComponentSerializer
+                              .legacyAmpersand()
+                              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.COMMAND_SPY_FORMAT
+                                  .replace("{0}", p.getUsername())
+                                  .replace("{1}", "/" + originalCommand)
+                              ));
+                    }
+                  }
+                }));
             if (server.getConfiguration().isLogCommandExecutions()) {
-              logger.info(Settings.IMP.MESSAGES.ELYTRAPROXY.CONSOLE_LOG_COMMAND_EXECUTIONS_FORMAT
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                  .replace("&", "")
-                  .replace("{0}", String.valueOf(player))
-                  .replace("{1}", "/" + originalCommand)
+              logger.info(/*"{} -> executed command /{}", player, originalCommand);*/
+                  Settings.IMP.MESSAGES.ELYTRAPROXY.CONSOLE_LOG_COMMAND_EXECUTIONS_FORMAT
+                      .replace("&", "")
+                      .replace("{0}", String.valueOf(player))
+                      .replace("{1}", "/" + originalCommand)
               );
             }
           })
           .exceptionally(e -> {
             logger.info("Exception occurred while running command for {}",
                 player.getUsername(), e);
-            player.sendMessage(Identity.nil(),
+            player.sendMessage(/*Component.translatable("velocity.command.generic-error",
+                NamedTextColor.RED));*/
                 LegacyComponentSerializer
                     .legacyAmpersand()
-                    .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.GENERIC_ERROR
-                        .replace("{NL}", "\n")
-                        .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                    ));
+                    .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.GENERIC_ERROR));
             // ElytraProxy End
             return null;
           });
@@ -354,11 +254,6 @@ public class ClientPlaySessionHandler implements MinecraftSessionHandler {
         player.setClientBrand(PluginMessageUtil.readBrandMessage(packet.content()));
         backendConn.write(PluginMessageUtil
             .rewriteMinecraftBrand(packet, server.getVersion(), player.getProtocolVersion()));
-        if (!checkedByBrand) {
-          logger.info("{} has client brand {}", player,
-              PluginMessageUtil.readBrandMessage(packet.content()));
-          checkedByBrand = true;
-        }
       } else if (BungeeCordMessageResponder.isBungeeCordMessage(packet)) {
         return true;
       } else {
@@ -444,12 +339,6 @@ public class ClientPlaySessionHandler implements MinecraftSessionHandler {
     if (smc != null && !smc.isClosed() && serverConnection.getPhase().consideredComplete()) {
       smc.write(buf.retain());
     }
-    // ElytraProxy
-    // TODO: Move to botfilter check
-    if (!willBeKickedUnk) {
-      kickIfCheckNotPassed();
-      willBeKickedUnk = true;
-    }
   }
 
   @Override
@@ -460,13 +349,11 @@ public class ClientPlaySessionHandler implements MinecraftSessionHandler {
   @Override
   public void exception(Throwable throwable) {
     // ElytraProxy
-    player.disconnect(
+    player.disconnect(/*Component.translatable("velocity.error.player-connection-error",
+        NamedTextColor.RED));*/
         LegacyComponentSerializer
             .legacyAmpersand()
-            .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.PLAYER_CONNECTION_ERROR
-                .replace("{NL}", "\n")
-                .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-            ));
+            .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.PLAYER_CONNECTION_ERROR));
   }
 
   @Override
@@ -723,7 +610,7 @@ public class ClientPlaySessionHandler implements MinecraftSessionHandler {
         }, player.getConnection().eventLoop())
         .exceptionally((ex) -> {
           logger.error(
-              "Exception while finishing regular tab completion, with request {} and response {}",
+              "Exception while finishing regular tab completion, with request {} and response{}",
               request, response, ex);
           return null;
         });
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/ConnectedPlayer.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/ConnectedPlayer.java
index c40d7c3c..925da793 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/ConnectedPlayer.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/ConnectedPlayer.java
@@ -67,7 +67,6 @@ import com.velocitypowered.proxy.protocol.packet.title.GenericTitlePacket;
 import com.velocitypowered.proxy.server.VelocityRegisteredServer;
 import com.velocitypowered.proxy.tablist.VelocityTabList;
 import com.velocitypowered.proxy.tablist.VelocityTabListLegacy;
-import com.velocitypowered.proxy.util.ClosestLocaleMatcher;
 import com.velocitypowered.proxy.util.DurationUtils;
 import com.velocitypowered.proxy.util.collect.CappedSet;
 import io.netty.buffer.ByteBufUtil;
@@ -78,13 +77,14 @@ import java.util.Collection;
 import java.util.Collections;
 import java.util.List;
 import java.util.Locale;
-import java.util.Objects;
 import java.util.Optional;
 import java.util.Queue;
 import java.util.UUID;
 import java.util.concurrent.CompletableFuture;
 import java.util.concurrent.CompletionException;
 import java.util.concurrent.ThreadLocalRandom;
+import lombok.Getter;
+import lombok.Setter;
 import net.elytrium.elytraproxy.config.Settings;
 import net.kyori.adventure.audience.MessageType;
 import net.kyori.adventure.bossbar.BossBar;
@@ -94,10 +94,6 @@ import net.kyori.adventure.pointer.Pointers;
 import net.kyori.adventure.text.Component;
 import net.kyori.adventure.text.serializer.gson.GsonComponentSerializer;
 import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
-import net.kyori.adventure.text.serializer.plain.PlainComponentSerializer;
-import net.kyori.adventure.title.Title;
-import net.kyori.adventure.title.Title.Times;
-import net.kyori.adventure.translation.GlobalTranslator;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 import org.checkerframework.checker.nullness.qual.MonotonicNonNull;
@@ -108,6 +104,11 @@ import org.jetbrains.annotations.NotNull;
 public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
 
   private static final int MAX_PLUGIN_CHANNELS = 1024;
+  // ElytraProxy: Removed as unnecessary
+  /*
+  private static final PlainComponentSerializer PASS_THRU_TRANSLATE = new PlainComponentSerializer(
+      c -> "", TranslatableComponent::key);
+  */
   static final PermissionProvider DEFAULT_PERMISSIONS = s -> PermissionFunction.ALWAYS_UNDEFINED;
 
   private static final Logger logger = LogManager.getLogger(ConnectedPlayer.class);
@@ -140,11 +141,13 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
   private @Nullable ResourcePackInfo pendingResourcePack;
   private @Nullable ResourcePackInfo appliedResourcePack;
   private final @NotNull Pointers pointers = Player.super.pointers().toBuilder()
-          .withDynamic(Identity.UUID, this::getUniqueId)
-          .withDynamic(Identity.NAME, this::getUsername)
-          .withStatic(PermissionChecker.POINTER, getPermissionChecker())
-          .build();
+      .withDynamic(Identity.UUID, this::getUniqueId)
+      .withDynamic(Identity.NAME, this::getUsername)
+      .withStatic(PermissionChecker.POINTER, getPermissionChecker())
+      .build();
   private @Nullable String clientBrand;
+  // ElytraProxy: Virtual Server Joined (need to handle JoinGame packet)
+  @Getter @Setter private boolean virtualServerJoined = false;
 
   ConnectedPlayer(VelocityServer server, GameProfile profile, MinecraftConnection connection,
       @Nullable InetSocketAddress virtualHost, boolean onlineMode) {
@@ -264,22 +267,23 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
     return connection.getProtocolVersion();
   }
 
-  /**
-   * Translates the message in the user's locale.
-   *
-   * @param message the message to translate
-   * @return the translated message
-   */
-  public Component translateMessage(Component message) {
-    Locale locale = ClosestLocaleMatcher.INSTANCE
-        .lookupClosest(this.settings == null ? Locale.getDefault() : this.settings.getLocale());
-    return GlobalTranslator.render(message, locale);
-  }
+  //ElytraProxy Start: Removed as unnecessary
+  ///**
+  // * Translates the message in the user's locale.
+  // *
+  // * @param message the message to translate
+  // * @return the translated message
+  // */
+  //public Component translateMessage(Component message) {
+  //  Locale locale = ClosestLocaleMatcher.INSTANCE
+  //      .lookupClosest(this.settings == null ? Locale.getDefault() : this.settings.getLocale());
+  //  return GlobalTranslator.render(message, locale);
+  //}
 
   @Override
   public void sendMessage(@NonNull Identity identity, @NonNull Component message) {
-    Component translated = translateMessage(message);
-    connection.write(Chat.createClientbound(identity, translated, this.getProtocolVersion()));
+    //Component translated = translateMessage(message);
+    connection.write(Chat.createClientbound(identity, message/*translated*/, this.getProtocolVersion()));
   }
 
   @Override
@@ -288,30 +292,30 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
     Preconditions.checkNotNull(message, "message");
     Preconditions.checkNotNull(type, "type");
 
-    Component translated = translateMessage(message);
-    Chat packet = Chat.createClientbound(identity, translated, this.getProtocolVersion());
+    //Component translated = translateMessage(message);
+    Chat packet = Chat.createClientbound(identity, message/*translated*/, this.getProtocolVersion());
     packet.setType(type == MessageType.CHAT ? Chat.CHAT_TYPE : Chat.SYSTEM_TYPE);
     connection.write(packet);
   }
 
   @Override
   public void sendActionBar(net.kyori.adventure.text.@NonNull Component message) {
-    Component translated = translateMessage(message);
+    //Component translated = translateMessage(message);
 
     ProtocolVersion playerVersion = getProtocolVersion();
     if (playerVersion.compareTo(ProtocolVersion.MINECRAFT_1_11) >= 0) {
       // Use the title packet instead.
       GenericTitlePacket pkt = GenericTitlePacket.constructTitlePacket(
-              GenericTitlePacket.ActionType.SET_ACTION_BAR, playerVersion);
+          GenericTitlePacket.ActionType.SET_ACTION_BAR, playerVersion);
       pkt.setComponent(ProtocolUtils.getJsonChatSerializer(playerVersion)
-          .serialize(translated));
+          .serialize(message/*translated*/));
       connection.write(pkt);
     } else {
       // Due to issues with action bar packets, we'll need to convert the text message into a
       // legacy message and then inject the legacy text into a component... yuck!
       JsonObject object = new JsonObject();
       object.addProperty("text", LegacyComponentSerializer.legacySection()
-          .serialize(translated));
+          .serialize(message/*translated*/));
       Chat chat = new Chat();
       chat.setMessage(object.toString());
       chat.setType(Chat.GAME_INFO_TYPE);
@@ -341,10 +345,12 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
 
   @Override
   public void sendPlayerListHeaderAndFooter(final Component header, final Component footer) {
+    /*
     Component translatedHeader = translateMessage(header);
     Component translatedFooter = translateMessage(footer);
-    this.playerListHeader = translatedHeader;
-    this.playerListFooter = translatedFooter;
+    */
+    this.playerListHeader = header/*translatedHeader*/;
+    this.playerListFooter = footer/*translatedFooter*/;
     if (this.getProtocolVersion().compareTo(ProtocolVersion.MINECRAFT_1_8) >= 0) {
       this.connection.write(HeaderAndFooter.create(header, footer, this.getProtocolVersion()));
     }
@@ -357,17 +363,17 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
           .getProtocolVersion());
 
       GenericTitlePacket titlePkt = GenericTitlePacket.constructTitlePacket(
-                      GenericTitlePacket.ActionType.SET_TITLE, this.getProtocolVersion());
-      titlePkt.setComponent(serializer.serialize(translateMessage(title.title())));
+          GenericTitlePacket.ActionType.SET_TITLE, this.getProtocolVersion());
+      titlePkt.setComponent(serializer.serialize(title.title()/*translateMessage(title.title())*/));
       connection.delayedWrite(titlePkt);
 
       GenericTitlePacket subtitlePkt = GenericTitlePacket.constructTitlePacket(
-              GenericTitlePacket.ActionType.SET_SUBTITLE, this.getProtocolVersion());
-      subtitlePkt.setComponent(serializer.serialize(translateMessage(title.subtitle())));
+          GenericTitlePacket.ActionType.SET_SUBTITLE, this.getProtocolVersion());
+      subtitlePkt.setComponent(serializer.serialize(title.title()/*translateMessage(title.subtitle())*/));
       connection.delayedWrite(subtitlePkt);
 
       GenericTitlePacket timesPkt = GenericTitlePacket.constructTitlePacket(
-              GenericTitlePacket.ActionType.SET_TIMES, this.getProtocolVersion());
+          GenericTitlePacket.ActionType.SET_TIMES, this.getProtocolVersion());
       net.kyori.adventure.title.Title.Times times = title.times();
       if (times != null) {
         timesPkt.setFadeIn((int) DurationUtils.toTicks(times.fadeIn()));
@@ -384,7 +390,7 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
   public void clearTitle() {
     if (this.getProtocolVersion().compareTo(ProtocolVersion.MINECRAFT_1_8) >= 0) {
       connection.write(GenericTitlePacket.constructTitlePacket(
-              GenericTitlePacket.ActionType.HIDE, this.getProtocolVersion()));
+          GenericTitlePacket.ActionType.HIDE, this.getProtocolVersion()));
     }
   }
 
@@ -392,7 +398,7 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
   public void resetTitle() {
     if (this.getProtocolVersion().compareTo(ProtocolVersion.MINECRAFT_1_8) >= 0) {
       connection.write(GenericTitlePacket.constructTitlePacket(
-                      GenericTitlePacket.ActionType.RESET, this.getProtocolVersion()));
+          GenericTitlePacket.ActionType.RESET, this.getProtocolVersion()));
     }
   }
 
@@ -446,16 +452,17 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
 
   /**
    * Disconnects the player from the proxy.
-   * @param reason the reason for disconnecting the player
+   * @param reason      the reason for disconnecting the player
    * @param duringLogin whether the disconnect happened during login
    */
   public void disconnect0(Component reason, boolean duringLogin) {
-    Component translated = this.translateMessage(reason);
+    //Component translated = this.translateMessage(reason);
 
     logger.info("{} has disconnected: {}", this,
-        LegacyComponentSerializer.legacySection().serialize(translated));
-    connection.closeWith(Disconnect.create(translated, this.getProtocolVersion()));
+        LegacyComponentSerializer.legacySection().serialize(reason/*translated*/));
+    connection.closeWith(Disconnect.create(reason/*translated*/, this.getProtocolVersion()));
   }
+  // ElytraProxy End
 
   public @Nullable VelocityServerConnection getConnectedServer() {
     return connectedServer;
@@ -471,9 +478,9 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
 
   /**
    * Handles unexpected disconnects.
-   * @param server the server we disconnected from
+   * @param server    the server we disconnected from
    * @param throwable the exception
-   * @param safe whether or not we can safely reconnect to a new server
+   * @param safe      whether or not we can safely reconnect to a new server
    */
   public void handleConnectionException(RegisteredServer server, Throwable throwable,
       boolean safe) {
@@ -496,32 +503,34 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
 
     Component friendlyError;
     if (connectedServer != null && connectedServer.getServerInfo().equals(server.getServerInfo())) {
-      friendlyError = LegacyComponentSerializer
+      // ElytraProxy Start
+      friendlyError = /*Component.translatable("velocity.error.connected-server-error",
+          Component.text(server.getServerInfo().getName()));*/
+      LegacyComponentSerializer
           .legacyAmpersand()
           .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.CONNECTED_SERVER_ERROR
-              .replace("{NL}", "\n")
-              .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
               .replace("{0}", server.getServerInfo().getName())
           );
     } else {
       logger.error("{}: unable to connect to server {}", this, server.getServerInfo().getName(),
           wrapped);
-      friendlyError = LegacyComponentSerializer
+      friendlyError = /*Component.translatable("velocity.error.connecting-server-error",
+          Component.text(server.getServerInfo().getName()));*/
+      LegacyComponentSerializer
           .legacyAmpersand()
           .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.CONNECTING_SERVER_ERROR
-              .replace("{NL}", "\n")
-              .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
               .replace("{0}", server.getServerInfo().getName())
           );
+      // ElytraProxy Start
     }
     handleConnectionException(server, null, friendlyError, safe);
   }
 
   /**
    * Handles unexpected disconnects.
-   * @param server the server we disconnected from
+   * @param server     the server we disconnected from
    * @param disconnect the disconnect packet
-   * @param safe whether or not we can safely reconnect to a new server
+   * @param safe       whether or not we can safely reconnect to a new server
    */
   public void handleConnectionException(RegisteredServer server, Disconnect disconnect,
       boolean safe) {
@@ -531,40 +540,38 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
     }
 
     Component disconnectReason = GsonComponentSerializer.gson().deserialize(disconnect.getReason());
+    // ElytraProxy Start
+    //String plainTextReason = PASS_THRU_TRANSLATE.serialize(disconnectReason);
     if (connectedServer != null && connectedServer.getServerInfo().equals(server.getServerInfo())) {
       logger.info("{}: kicked from server {}: {}", this, server.getServerInfo().getName(),
+          /*plainTextReason);*/
           LegacyComponentSerializer
               .legacySection()
               .serialize(disconnectReason));
-      // TODO: rewrite this shit
       handleConnectionException(server, disconnectReason,
           LegacyComponentSerializer
               .legacyAmpersand()
               .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.MOVED_TO_NEW_SERVER
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
                   .replace("{0}", server.getServerInfo().getName())
-                  .replace("{1}", LegacyComponentSerializer
-                      .legacySection()
-                      .serialize(disconnectReason))
+                  .replace("{1}", LegacyComponentSerializer.legacySection().serialize(disconnectReason))
               ), safe);
     } else {
       logger.error("{}: disconnected while connecting to {}: {}", this,
-          server.getServerInfo().getName(),
-              LegacyComponentSerializer
-                  .legacySection()
-                  .serialize(disconnectReason));
+          server.getServerInfo().getName(), /*plainTextReason);*/
+          LegacyComponentSerializer
+              .legacySection()
+              .serialize(disconnectReason));
       handleConnectionException(server, disconnectReason,
+          /*Component.translatable("velocity.error.cant-connect", NamedTextColor.RED,
+              Component.text(server.getServerInfo().getName()),
+              disconnectReason),*/
           LegacyComponentSerializer
               .legacyAmpersand()
               .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.CANT_CONNECT
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
                   .replace("{0}", server.getServerInfo().getName())
-                  .replace("{1}", LegacyComponentSerializer
-                      .legacySection()
-                      .serialize(disconnectReason))
+                  .replace("{1}", LegacyComponentSerializer.legacySection().serialize(disconnectReason))
               ), safe);
+      // ElytraProxy End
     }
   }
 
@@ -637,7 +644,7 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
                     // Impossible/nonsensical cases
                     case ALREADY_CONNECTED:
                     case CONNECTION_IN_PROGRESS:
-                    // Fatal case
+                      // Fatal case
                     case CONNECTION_CANCELLED:
                       Component fallbackMsg = res.getMessageComponent();
                       if (fallbackMsg == null) {
@@ -652,19 +659,22 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
                           getProtocolVersion()), ((Impl) status).isSafe());
                       break;
                     case SUCCESS:
-                      // ElytraProxy
-                      sendMessage(Identity.nil(),
-                          LegacyComponentSerializer
-                              .legacyAmpersand()
-                              .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.MOVED_TO_NEW_SERVER
-                                  .replace("{NL}", "\n")
-                                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                                  .replace("{0}", originalEvent
-                                      .getServer().getServerInfo().getName())
-                                  .replace("{1}", LegacyComponentSerializer
-                                      .legacySection()
-                                      .serialize(friendlyReason))
-                              ));
+                      Component requestedMessage = res.getMessageComponent();
+                      if (requestedMessage == null) {
+                        // ElytraProxy Start
+                        requestedMessage = /*Component.translatable("velocity.error.moved-to-new-server",
+                            NamedTextColor.RED,
+                            Component.text(originalEvent.getServer().getServerInfo().getName()),
+                            friendlyReason);*/
+                            LegacyComponentSerializer
+                                .legacyAmpersand()
+                                .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.MOVED_TO_NEW_SERVER
+                                    .replace("{0}", originalEvent.getServer().getServerInfo().getName())
+                                    .replace("{1}", LegacyComponentSerializer.legacySection().serialize(friendlyReason))
+                                );
+                        // ElytraProxy End
+                      }
+                      sendMessage(requestedMessage);
                       break;
                     default:
                       // The only remaining value is successful (no need to do anything!)
@@ -882,7 +892,7 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
         while (!outstandingResourcePacks.isEmpty()) {
           queued = outstandingResourcePacks.peek();
           if (queued.getShouldForce() && getProtocolVersion()
-                  .compareTo(ProtocolVersion.MINECRAFT_1_17) >= 0) {
+              .compareTo(ProtocolVersion.MINECRAFT_1_17) >= 0) {
             break;
           }
           onResourcePackResponse(PlayerResourcePackStatusEvent.Status.DECLINED);
@@ -924,19 +934,19 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
   public boolean onResourcePackResponse(PlayerResourcePackStatusEvent.Status status) {
     final boolean peek = status == PlayerResourcePackStatusEvent.Status.ACCEPTED;
     final ResourcePackInfo queued = peek
-            ? outstandingResourcePacks.peek() : outstandingResourcePacks.poll();
+        ? outstandingResourcePacks.peek() : outstandingResourcePacks.poll();
 
     server.getEventManager().fire(new PlayerResourcePackStatusEvent(this, status, queued))
-            .thenAcceptAsync(event -> {
-              if (event.getStatus() == PlayerResourcePackStatusEvent.Status.DECLINED
-                      && event.getPackInfo() != null && event.getPackInfo().getShouldForce()
-                      && (!event.isOverwriteKick() || event.getPlayer()
-                              .getProtocolVersion().compareTo(ProtocolVersion.MINECRAFT_1_17) >= 0)
-              ) {
-                event.getPlayer().disconnect(Component
-                        .translatable("multiplayer.requiredTexturePrompt.disconnect"));
-              }
-            });
+        .thenAcceptAsync(event -> {
+          if (event.getStatus() == PlayerResourcePackStatusEvent.Status.DECLINED
+              && event.getPackInfo() != null && event.getPackInfo().getShouldForce()
+              && (!event.isOverwriteKick() || event.getPlayer()
+              .getProtocolVersion().compareTo(ProtocolVersion.MINECRAFT_1_17) >= 0)
+          ) {
+            event.getPlayer().disconnect(Component
+                .translatable("multiplayer.requiredTexturePrompt.disconnect"));
+          }
+        });
 
     switch (status) {
       case ACCEPTED:
@@ -1033,7 +1043,7 @@ public class ConnectedPlayer implements MinecraftConnectionAssociation, Player {
         return Optional.of(ConnectionRequestBuilder.Status.CONNECTION_IN_PROGRESS);
       }
       if (connectedServer != null
-              && connectedServer.getServer().getServerInfo().equals(server.getServerInfo())) {
+          && connectedServer.getServer().getServerInfo().equals(server.getServerInfo())) {
         return Optional.of(ALREADY_CONNECTED);
       }
       return Optional.empty();
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/HandshakeSessionHandler.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/HandshakeSessionHandler.java
index 0f398877..b14d7298 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/HandshakeSessionHandler.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/HandshakeSessionHandler.java
@@ -69,15 +69,15 @@ public class HandshakeSessionHandler implements MinecraftSessionHandler {
 
   @Override
   public boolean handle(LegacyHandshake packet) {
-    // ElytraProxy
-    connection.closeWith(LegacyDisconnect
-        .from(
-            LegacyComponentSerializer
-                .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.EXTREMELY_OLD_CLIENT
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                )));
+    // ElytraProxy Start
+    connection.closeWith(LegacyDisconnect.from(/*Component.text(
+        "Your client is extremely old. Please update to a newer version of Minecraft.",
+        NamedTextColor.RED)
+    ));*/
+        LegacyComponentSerializer
+            .legacyAmpersand()
+            .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.EXTREMELY_OLD_CLIENT)));
+    // ElytraProxy End
     return true;
   }
 
@@ -87,7 +87,8 @@ public class HandshakeSessionHandler implements MinecraftSessionHandler {
         cleanVhost(handshake.getServerAddress()), handshake);
     StateRegistry nextState = getStateForProtocol(handshake.getNextStatus());
     if (nextState == null) {
-      LOGGER.error("{} provided invalid protocol {}", ic, handshake.getNextStatus());
+      // ElytraProxy - really spams to console :(
+      // LOGGER.error("{} provided invalid protocol {}", ic, handshake.getNextStatus());
       connection.close(true);
     } else {
       connection.setState(nextState);
@@ -128,21 +129,18 @@ public class HandshakeSessionHandler implements MinecraftSessionHandler {
       return;
     }
 
-    // BotFilter backport start: global rate limiter
+    // BotFilter BackPort Start: Global rate limiter
     /*
     InetAddress address = ((InetSocketAddress) connection.getRemoteAddress()).getAddress();
     if (!server.getIpAttemptLimiter().attempt(address)) {
-      ic.disconnectQuietly(
+      ic.disconnectQuietly(//Component.translatable("velocity.error.logging-in-too-fast"));
           LegacyComponentSerializer
               .legacyAmpersand()
-              .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.LOGGING_IN_TOO_FAST
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ));
+              .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.LOGGING_IN_TOO_FAST));
       return;
     }
     */
-    // BotFilter backport end - global rate limiter
+    // BotFilter BackPort End
 
     connection.setType(getHandshakeConnectionType(handshake));
 
@@ -150,14 +148,13 @@ public class HandshakeSessionHandler implements MinecraftSessionHandler {
     // and lower, otherwise IP information will never get forwarded.
     if (server.getConfiguration().getPlayerInfoForwardingMode() == PlayerInfoForwarding.MODERN
         && handshake.getProtocolVersion().compareTo(ProtocolVersion.MINECRAFT_1_13) < 0) {
-      // ElytraProxy
-      ic.disconnectQuietly(
+      // ElytraProxy Start
+      ic.disconnectQuietly(/*Component.translatable(
+          "velocity.error.modern-forwarding-needs-new-client"));*/
           LegacyComponentSerializer
               .legacyAmpersand()
-              .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.MODERN_FORWARDING_NEEDS_NEW_CLIENT
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ));
+              .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.MODERN_FORWARDING_NEEDS_NEW_CLIENT));
+      // ElytraProxy End
       return;
     }
 
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/InitialInboundConnection.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/InitialInboundConnection.java
index c094cc90..00624abc 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/InitialInboundConnection.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/InitialInboundConnection.java
@@ -79,12 +79,15 @@ public final class InitialInboundConnection implements InboundConnection,
    * @param reason the reason for disconnecting
    */
   public void disconnect(Component reason) {
+    // ElytraProxy Start: Removed as unnecessary
+    /*
     Component translated = GlobalTranslator.render(reason, ClosestLocaleMatcher.INSTANCE
         .lookupClosest(Locale.getDefault()));
+    */
 
     logger.info("{} has disconnected: {}", this,
-        LegacyComponentSerializer.legacySection().serialize(translated));
-    connection.closeWith(Disconnect.create(translated, getProtocolVersion()));
+        LegacyComponentSerializer.legacySection().serialize(reason/*translated*/));
+    connection.closeWith(Disconnect.create(reason/*translated*/, getProtocolVersion()));
   }
 
   /**
@@ -92,8 +95,11 @@ public final class InitialInboundConnection implements InboundConnection,
    * @param reason the reason for disconnecting
    */
   public void disconnectQuietly(Component reason) {
+    /*
     Component translated = GlobalTranslator.render(reason, ClosestLocaleMatcher.INSTANCE
         .lookupClosest(Locale.getDefault()));
-    connection.closeWith(Disconnect.create(translated, getProtocolVersion()));
+    */
+    connection.closeWith(Disconnect.create(reason/*translated*/, getProtocolVersion()));
   }
+  // ElytraProxy End
 }
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/LoginSessionHandler.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/LoginSessionHandler.java
index 942c9911..7ad943c2 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/LoginSessionHandler.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/LoginSessionHandler.java
@@ -44,7 +44,6 @@ import com.velocitypowered.proxy.config.VelocityConfiguration;
 import com.velocitypowered.proxy.connection.MinecraftConnection;
 import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
 import com.velocitypowered.proxy.protocol.StateRegistry;
-import com.velocitypowered.proxy.protocol.packet.Disconnect;
 import com.velocitypowered.proxy.protocol.packet.EncryptionRequest;
 import com.velocitypowered.proxy.protocol.packet.EncryptionResponse;
 import com.velocitypowered.proxy.protocol.packet.ServerLogin;
@@ -61,10 +60,9 @@ import java.util.UUID;
 import java.util.concurrent.CompletableFuture;
 import java.util.concurrent.ExecutionException;
 import java.util.concurrent.ThreadLocalRandom;
+import net.elytrium.elytraproxy.ElytraProxy;
 import net.elytrium.elytraproxy.config.Settings;
 import net.kyori.adventure.text.Component;
-import net.kyori.adventure.text.format.NamedTextColor;
-import net.kyori.adventure.translation.GlobalTranslator;
 import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
@@ -86,7 +84,7 @@ public class LoginSessionHandler implements MinecraftSessionHandler {
   private @MonotonicNonNull ConnectedPlayer connectedPlayer;
 
   LoginSessionHandler(VelocityServer server, MinecraftConnection mcConnection,
-      InitialInboundConnection inbound) {
+                      InitialInboundConnection inbound) {
     this.server = Preconditions.checkNotNull(server, "server");
     this.mcConnection = Preconditions.checkNotNull(mcConnection, "mcConnection");
     this.inbound = Preconditions.checkNotNull(inbound, "inbound");
@@ -96,6 +94,8 @@ public class LoginSessionHandler implements MinecraftSessionHandler {
   public boolean handle(ServerLogin packet) {
     this.login = packet;
     beginPreLogin();
+    // ElytraProxy
+    server.getElytraProxy().getStatistics().addTotalConnectionPerSecond();
     return true;
   }
 
@@ -152,14 +152,13 @@ public class LoginSessionHandler implements MinecraftSessionHandler {
                 GameProfile.class), true);
           } else if (profileResponse.getStatusCode() == 204) {
             // Apparently an offline-mode user logged onto this online-mode proxy.
-            // ElytraProxy
-            inbound.disconnect(
+            // ElytraProxy Start
+            inbound.disconnect(/*Component.translatable("velocity.error.online-mode-only",
+                NamedTextColor.RED));*/
                 LegacyComponentSerializer
                     .legacyAmpersand()
-                    .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.ONLINE_MODE_ONLY
-                        .replace("{NL}", "\n")
-                        .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                    ));
+                    .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.ONLINE_MODE_ONLY));
+            // ElytraProxy End
           } else {
             // Something else went wrong
             logger.error(
@@ -183,8 +182,6 @@ public class LoginSessionHandler implements MinecraftSessionHandler {
   }
 
   private void beginPreLogin() {
-    // ElytraProxy
-    server.getElytraProxy().getStatistics().addTotalConnectionPerSecond();
     ServerLogin login = this.login;
     if (login == null) {
       throw new IllegalStateException("No ServerLogin packet received yet.");
@@ -205,14 +202,34 @@ public class LoginSessionHandler implements MinecraftSessionHandler {
             return;
           }
 
-          if (!result.isForceOfflineMode() && (server.getConfiguration().isOnlineMode() || result
-              .isOnlineModeAllowed())) {
-            // Request encryption.
-            EncryptionRequest request = generateEncryptionRequest();
-            this.verify = Arrays.copyOf(request.getVerifyToken(), 4);
-            mcConnection.write(request);
+          InetSocketAddress adr = inbound.getRemoteAddress();
+          if (!result.isForceOfflineMode()
+              // Reduce amount of Mojang API when player is not checked
+              && !server.getElytraProxy().shouldCheck(login.getUsername(), adr.getAddress())
+              && (server.getConfiguration().isOnlineMode()
+                || result.isOnlineModeAllowed()
+                || (Settings.IMP.AUTH.ENABLE && !Settings.IMP.AUTH.ONLINE_MODE_NEED_AUTH))) {
+            if (Settings.IMP.AUTH.ENABLE) {
+              ListenableFuture<Response> isPremiumResponse = server.getElytraProxy()
+                  .isPremiumRequest(login.getUsername()).execute();
+
+              isPremiumResponse.addListener(() -> {
+                try {
+                  if (isPremiumResponse.get().getStatusCode() == 200) {
+                    requestEncryption();
+                  } else {
+                    initializeOfflineMode();
+                  }
+                } catch (InterruptedException | ExecutionException e) {
+                  logger.error("Unable to authenticate with Mojang", e);
+                  mcConnection.close(true);
+                }
+              }, mcConnection.eventLoop());
+            } else {
+              requestEncryption();
+            }
           } else {
-            initializePlayer(GameProfile.forOfflinePlayer(login.getUsername()), false);
+            initializeOfflineMode();
           }
         }, mcConnection.eventLoop())
         .exceptionally((ex) -> {
@@ -221,6 +238,16 @@ public class LoginSessionHandler implements MinecraftSessionHandler {
         });
   }
 
+  private void requestEncryption() {
+    EncryptionRequest request = generateEncryptionRequest();
+    this.verify = Arrays.copyOf(request.getVerifyToken(), 4);
+    mcConnection.write(request);
+  }
+
+  private void initializeOfflineMode() {
+    initializePlayer(GameProfile.forOfflinePlayer(login.getUsername()), false);
+  }
+
   private EncryptionRequest generateEncryptionRequest() {
     byte[] verify = new byte[4];
     ThreadLocalRandom.current().nextBytes(verify);
@@ -239,69 +266,80 @@ public class LoginSessionHandler implements MinecraftSessionHandler {
         onlineMode);
     final GameProfile finalProfile = profile;
 
-    // BotFilter backport
-    server.getEventManager().fire(profileRequestEvent).thenAcceptAsync(profileEvent -> {
+    // BotFilter BackPort Start
+    server.getEventManager().fire(profileRequestEvent)./*thenComposeAsync*/thenAcceptAsync(profileEvent -> {
       if (mcConnection.isClosed()) {
         // The player disconnected while event execution
-        return;
+        return/* CompletableFuture.completedFuture(null)*/;
       }
+      // BotFilter BackPort End
 
       // Initiate a regular connection and move over to it.
       ConnectedPlayer player = new ConnectedPlayer(server, profileEvent.getGameProfile(),
           mcConnection, inbound.getVirtualHost().orElse(null), onlineMode);
       this.connectedPlayer = player;
-      // ElytraProxy Start: BotFilter and other
       if (!server.canRegisterConnection(player)) {
+        // ElytraProxy Start
         player.disconnect0(
             LegacyComponentSerializer
                 .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.ALREADY_CONNECTED_PROXY
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ), true);
-        return;
+                .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.ALREADY_CONNECTED_PROXY), true);
+        // BotFilter BackPort
+        return/* CompletableFuture.completedFuture(null)*/;
       }
+
+      logger.info("{} has connected", player);
+
+      // BotFilter BackPort Start
       /*
-      SkinSetup setup = server.getElytraProxy()
-          .getDatabase()
-          .getItem("skins", ImmutableMap.of("uuid", player.getUniqueId()), SkinSetup.class);
-      if (setup != null) {
-        List<GameProfile.Property> playerProfile = player.getGameProfileProperties();
-        playerProfile.add(new GameProfile.Property("textures", setup.texture, setup.signature));
-        player.setGameProfileProperties(playerProfile);
-      }
+      return server.getEventManager()
+          .fire(new PermissionsSetupEvent(player, ConnectedPlayer.DEFAULT_PERMISSIONS))
+          .thenAcceptAsync(event -> {
+            if (!mcConnection.isClosed()) {
+              // wait for permissions to load, then set the players permission function
+              final PermissionFunction function = event.createFunction(player);
+              if (function == null) {
+                logger.error(
+                    "A plugin permission provider {} provided an invalid permission function"
+                        + " for player {}. This is a bug in the plugin, not in Velocity. Falling"
+                        + " back to the default permission function.",
+                    event.getProvider().getClass().getName(),
+                    player.getUsername());
+              } else {
+                player.setPermissionFunction(function);
+              }
+              completeLoginProtocolPhaseAndInitialize(player);
+            }
+          }, mcConnection.eventLoop());
       */
-      logger.info("{} has connected", player);
+      // BotFilter BackPort End
+
       server.getElytraProxy().getStatistics().addConnectionPerSecond();
       if (Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
-          && !Settings.IMP.MAIN_SETTINGS.MAINTENANCE
-              .IGNORED_PLAYERS.contains(player.getUsername())) {
+          && !Settings.IMP.MAIN_SETTINGS.MAINTENANCE.IGNORED_PLAYERS.contains(player.getUsername())) {
         player.disconnect0(
             LegacyComponentSerializer
                 .legacyAmpersand()
-                .deserialize(Settings.IMP.MAIN_SETTINGS.MAINTENANCE.DISCONNECT_REASON
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ), true);
+                .deserialize(Settings.IMP.MAIN_SETTINGS.MAINTENANCE.DISCONNECT_REASON), true);
         return;
       }
-      if (Settings.IMP.MAIN_SETTINGS.BANNED_PROTOCOLS
-          .contains(mcConnection.getProtocolVersion().getProtocol())) {
+      if (Settings.IMP.MAIN_SETTINGS.BANNED_PROTOCOLS.contains(mcConnection.getProtocolVersion().getProtocol())) {
         player.disconnect0(
             LegacyComponentSerializer
                 .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.PROTOCOL_BLOCKED
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ), true);
+                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.PROTOCOL_BLOCKED), true);
         return;
       }
+      if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.ENABLE_CHECK_ON_CONNECTION) {
+        server.getElytraProxy().checkHostname(player, null, ElytraProxy.HostnameCheckType.LOGIN);
+      }
       if (Settings.IMP.ANTIBOT.ENABLE) {
         preLoginCheck(player);
       } else {
         completeLoginProtocol(player, true);
-        initialize(player);
+        authOrInitialize(player);
       }
+      // ElytraProxy End
     }, mcConnection.eventLoop()).exceptionally((ex) -> {
       logger.error("Exception during connection of {}", finalProfile, ex);
       return null;
@@ -310,39 +348,87 @@ public class LoginSessionHandler implements MinecraftSessionHandler {
 
   private void preLoginCheck(ConnectedPlayer player) {
     String formattedNickname = player.getUsername().toLowerCase();
-    if (Settings.IMP.ANTIBOT.BANNED_NICK_PATTERNS
-        .stream().anyMatch(formattedNickname::contains)) {
+    if (Settings.IMP.ANTIBOT.BANNED_NICK_PATTERNS.stream().anyMatch(formattedNickname::contains)) {
       player.disconnect0(
           LegacyComponentSerializer
               .legacyAmpersand()
-              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.NICK_BLOCKED
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ), true);
+              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.NICK_BLOCKED), true);
       server.getElytraProxy().getStatistics().addBlockedConnection();
       server.getElytraProxy().getStatistics().addBlockedBots();
       return;
     }
-    // injectBotFilterOrFinishLogin(player);
-
-    // temp
-    completeLoginProtocol(player, true);
-    initialize(player);
+    injectBotFilterOrFinishLogin(player);
   }
 
+  // BotFilter BackPort Start
   private void injectBotFilterOrFinishLogin(ConnectedPlayer player) {
     if (server.getElytraProxy().shouldCheck(player)) {
       server.getElytraProxy().setupPipelineAndStartCheck(player, this);
     } else {
       completeLoginProtocol(player, true);
-      initialize(player);
+      authOrInitialize(player);
+    }
+  }
+
+  /*
+  private void completeLoginProtocolPhaseAndInitialize(ConnectedPlayer player) {
+    int threshold = server.getConfiguration().getCompressionThreshold();
+    if (threshold >= 0 && mcConnection.getProtocolVersion().compareTo(MINECRAFT_1_8) >= 0) {
+      mcConnection.write(new SetCompression(threshold));
+      mcConnection.setCompressionThreshold(threshold);
     }
+    VelocityConfiguration configuration = server.getConfiguration();
+    UUID playerUniqueId = player.getUniqueId();
+    if (configuration.getPlayerInfoForwardingMode() == PlayerInfoForwarding.NONE) {
+      playerUniqueId = UuidUtils.generateOfflinePlayerUuid(player.getUsername());
+    }
+    ServerLoginSuccess success = new ServerLoginSuccess();
+    success.setUsername(player.getUsername());
+    success.setUuid(playerUniqueId);
+    mcConnection.write(success);
+
+    mcConnection.setAssociation(player);
+    mcConnection.setState(StateRegistry.PLAY);
+
+    server.getEventManager().fire(new LoginEvent(player))
+        .thenAcceptAsync(event -> {
+          if (mcConnection.isClosed()) {
+            // The player was disconnected
+            server.getEventManager().fireAndForget(new DisconnectEvent(player,
+                LoginStatus.CANCELLED_BY_USER_BEFORE_COMPLETE));
+            return;
+          }
+
+          Optional<Component> reason = event.getResult().getReasonComponent();
+          if (reason.isPresent()) {
+            player.disconnect0(reason.get(), true);
+          } else {
+            if (!server.registerConnection(player)) {
+              player.disconnect0(Component.translatable("velocity.error.already-connected-proxy"),
+                  true);
+              return;
+            }
+
+            mcConnection.setSessionHandler(new InitialConnectSessionHandler(player));
+            server.getEventManager().fire(new PostLoginEvent(player))
+                .thenCompose((ignored) -> connectToInitialServer(player))
+                .exceptionally((ex) -> {
+                  logger.error("Exception while connecting {} to initial server", player, ex);
+                  return null;
+                });
+          }
+        }, mcConnection.eventLoop())
+        .exceptionally((ex) -> {
+          logger.error("Exception while completing login initialisation phase for {}", player, ex);
+          return null;
+        });
   }
+  */
 
   public void completeLoginProtocol(ConnectedPlayer player, boolean flush) {
     int threshold = server.getConfiguration().getCompressionThreshold();
     if (threshold >= 0 && mcConnection.getProtocolVersion().compareTo(MINECRAFT_1_8) >= 0) {
-      mcConnection.delayedWrite(new SetCompression(threshold));
+      mcConnection./*write*/delayedWrite(new SetCompression(threshold));
       mcConnection.setCompressionThreshold(threshold);
     }
     VelocityConfiguration configuration = server.getConfiguration();
@@ -353,22 +439,39 @@ public class LoginSessionHandler implements MinecraftSessionHandler {
     ServerLoginSuccess success = new ServerLoginSuccess();
     success.setUsername(player.getUsername());
     success.setUuid(playerUniqueId);
-    mcConnection.delayedWrite(success);
+    mcConnection./*write*/delayedWrite(success);
+
     if (flush) {
       mcConnection.flush();
     }
   }
 
+  // ElytraProxy Start
+  public void authOrInitialize(ConnectedPlayer player) {
+    if (Settings.IMP.AUTH.ENABLE && server.getElytraProxy().shouldAuth(player)) {
+      if (Settings.IMP.AUTH.ONLINE_MODE_NEED_AUTH || !player.isOnlineMode()) {
+        server.getElytraProxy().auth(player, this);
+        return;
+      }
+    }
+
+    player.getConnection().setSessionHandler(this);
+    initialize(player);
+  }
+  // ElytraProxy End
 
   public void initialize(ConnectedPlayer player) {
     mcConnection.setAssociation(player);
     mcConnection.setState(StateRegistry.PLAY);
+
     server.getEventManager()
         .fire(new PermissionsSetupEvent(player, ConnectedPlayer.DEFAULT_PERMISSIONS))
         .thenComposeAsync(premissionEvent -> {
+
           if (mcConnection.isClosed()) {
             return CompletableFuture.completedFuture(null);
           }
+
           // wait for permissions to load, then set the players permission function
           final PermissionFunction function = premissionEvent.createFunction(player);
           if (function == null) {
@@ -381,46 +484,44 @@ public class LoginSessionHandler implements MinecraftSessionHandler {
           } else {
             player.setPermissionFunction(function);
           }
-          return server.getEventManager().fire(new LoginEvent(player))
-        .thenAcceptAsync(event -> {
-          if (mcConnection.isClosed()) {
-            // The player was disconnected
-            server.getEventManager().fireAndForget(new DisconnectEvent(player,
-                LoginStatus.CANCELLED_BY_USER_BEFORE_COMPLETE));
-            return;
-          }
-
-          Optional<Component> reason = event.getResult().getReasonComponent();
-          if (reason.isPresent()) {
-            player.disconnect0(reason.get(), true);
-          } else {
-            if (!server.registerConnection(player)) {
-              player.disconnect0(
-                  LegacyComponentSerializer
-                      .legacyAmpersand()
-                      .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.ALREADY_CONNECTED_PROXY
-                          .replace("{NL}", "\n")
-                          .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                      ), true);
-              return;
-            }
 
-            mcConnection.setSessionHandler(new InitialConnectSessionHandler(player));
-            server.getEventManager().fire(new PostLoginEvent(player))
-                .thenCompose((ignored) -> connectToInitialServer(player))
-                .exceptionally((ex) -> {
-                  logger.error("Exception while connecting {} to initial server", player, ex);
-                  return null;
-                });
-          }
-        }, mcConnection.eventLoop());
+          return server.getEventManager().fire(new LoginEvent(player))
+              .thenAcceptAsync(event -> {
+                if (mcConnection.isClosed()) {
+                  // The player was disconnected
+                  server.getEventManager().fireAndForget(new DisconnectEvent(player,
+                      LoginStatus.CANCELLED_BY_USER_BEFORE_COMPLETE));
+                  return;
+                }
+
+                Optional<Component> reason = event.getResult().getReasonComponent();
+                if (reason.isPresent()) {
+                  player.disconnect0(reason.get(), true);
+                } else {
+                  if (!server.registerConnection(player)) {
+                    player.disconnect0(/*Component.translatable("velocity.error.already-connected-proxy"),*/
+                        LegacyComponentSerializer
+                            .legacyAmpersand()
+                            .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.ALREADY_CONNECTED_PROXY), true);
+                    return;
+                  }
+
+                  mcConnection.setSessionHandler(new InitialConnectSessionHandler(player));
+                  server.getEventManager().fire(new PostLoginEvent(player))
+                      .thenCompose((ignored) -> connectToInitialServer(player))
+                      .exceptionally((ex) -> {
+                        logger.error("Exception while connecting {} to initial server", player, ex);
+                        return null;
+                      });
+                }
+              }, mcConnection.eventLoop());
         }, mcConnection.eventLoop())
         .exceptionally((ex) -> {
           logger.error("Exception while completing login initialisation phase for {}", player, ex);
           return null;
         });
   }
-  // ElytraProxy End
+  // BotFilter BackPort End
 
   private CompletableFuture<Void> connectToInitialServer(ConnectedPlayer player) {
     Optional<RegisteredServer> initialFromConfig = player.getNextServerToTry();
@@ -430,17 +531,17 @@ public class LoginSessionHandler implements MinecraftSessionHandler {
     return server.getEventManager().fire(event)
         .thenRunAsync(() -> {
           Optional<RegisteredServer> toTry = event.getInitialServer();
-          if (!toTry.isPresent()) {
-            player.disconnect0(
+          if (toTry.isEmpty()) {
+            // ElytraProxy Start
+            player.disconnect0(/*Component.translatable("velocity.error.no-available-servers",
+                NamedTextColor.RED), true);*/
                 LegacyComponentSerializer
                     .legacyAmpersand()
-                    .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.NO_AVAILABLE_SERVERS
-                        .replace("{NL}", "\n")
-                        .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                    ), true);
+                    .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.NO_AVAILABLE_SERVERS), true);
+            // ElytraProxy End
             return;
           }
-          player.createConnectionRequest(toTry.get()).fireAndForget();
+          player.createConnectionRequest(toTry.get()).connect();
         }, mcConnection.eventLoop());
   }
 
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/StatusSessionHandler.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/StatusSessionHandler.java
index e5ea219d..7022c8e9 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/client/StatusSessionHandler.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/client/StatusSessionHandler.java
@@ -44,6 +44,7 @@ import java.util.List;
 import java.util.Locale;
 import java.util.Optional;
 import java.util.concurrent.CompletableFuture;
+import net.elytrium.elytraproxy.ElytraProxy;
 import net.elytrium.elytraproxy.config.Settings;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
@@ -79,24 +80,27 @@ public class StatusSessionHandler implements MinecraftSessionHandler {
   private ServerPing constructLocalPing(ProtocolVersion version) {
     VelocityConfiguration configuration = server.getConfiguration();
     return new ServerPing(
-        // ElytraProxy
+        // ElytraProxy Start
         new ServerPing.Version(version.getProtocol(),
+            /*"Velocity " + ProtocolVersion.SUPPORTED_VERSION_STRING),*/
             (Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
                 ? Settings.IMP.MAIN_SETTINGS.MAINTENANCE.PING_VERSION
                 : Settings.IMP.MAIN_SETTINGS.PING_VERSION)
-                    .replace('&', '')
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)),
-        new ServerPing.Players(Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
-            ? 0
-            : server.getPlayerCount(),
+                    .replace('&', '')),
+        new ServerPing.Players(/*server.getPlayerCount(), configuration.getShowMaxPlayers(),
+            ImmutableList.of()),*/
+            Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
+                ? 0
+                : server.getPlayerCount(),
             Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
-            ? 0
-            : configuration.getShowMaxPlayers(),
+                ? 0
+                : configuration.getShowMaxPlayers(),
             ImmutableList.of()),
+        /*configuration.getMotd(),*/
         Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
             ? server.getMaintenanceMotd()
             : configuration.getMotd(),
+        // ElytraProxy End
         configuration.getFavicon().orElse(null),
         configuration.isAnnounceForge() ? ModInfo.DEFAULT : null
     );
@@ -176,14 +180,17 @@ public class StatusSessionHandler implements MinecraftSessionHandler {
 
   private CompletableFuture<ServerPing> getInitialPing() {
     VelocityConfiguration configuration = server.getConfiguration();
-    ProtocolVersion shownVersion;
-    // ElytraProxy
+    ProtocolVersion shownVersion/* = ProtocolVersion.isSupported(connection.getProtocolVersion())
+        ? connection.getProtocolVersion() : ProtocolVersion.MAXIMUM_VERSION*/;
+    // ElytraProxy Start
     if (Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED) {
       shownVersion = ProtocolVersion.MAINTENANCE;
     } else {
       shownVersion = ProtocolVersion.isSupported(connection.getProtocolVersion())
-        ? connection.getProtocolVersion() : ProtocolVersion.MAXIMUM_VERSION;
+          ? connection.getProtocolVersion()
+          : ProtocolVersion.MAXIMUM_VERSION;
     }
+    // ElytraProxy End
     PingPassthroughMode passthrough = configuration.getPingPassthrough();
 
     if (passthrough == PingPassthroughMode.DISABLED) {
@@ -206,8 +213,14 @@ public class StatusSessionHandler implements MinecraftSessionHandler {
     this.pingReceived = true;
     getInitialPing()
         .thenCompose(ping -> server.getEventManager().fire(new ProxyPingEvent(inbound, ping)))
-        .thenAcceptAsync(event -> connection.closeWith(
-            LegacyDisconnect.fromServerPing(event.getPing(), packet.getVersion())),
+        .thenAcceptAsync(/*event -> connection.closeWith(
+            LegacyDisconnect.fromServerPing(event.getPing(), packet.getVersion())),*/
+            (event) -> {
+              connection.closeWith(LegacyDisconnect.fromServerPing(event.getPing(), packet.getVersion()));
+              if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.ENABLE_CHECK_ON_PING) {
+                server.getElytraProxy().checkHostname(null, inbound, ElytraProxy.HostnameCheckType.PING);
+              }
+            },
             connection.eventLoop())
         .exceptionally((ex) -> {
           logger.error("Exception while handling legacy ping {}", packet, ex);
@@ -231,18 +244,26 @@ public class StatusSessionHandler implements MinecraftSessionHandler {
 
     getInitialPing()
         // ElytraProxy
-        .thenCompose(Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
-            ? ping -> CompletableFuture.completedFuture(new ProxyPingEvent(inbound, ping))
-            : ping -> server.getEventManager().fire(new ProxyPingEvent(inbound, ping)))
+        .thenCompose(/*ping -> server.getEventManager().fire(new ProxyPingEvent(inbound, ping)))*/
+            Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
+                ? ping -> CompletableFuture.completedFuture(new ProxyPingEvent(inbound, ping))
+                : ping -> server.getEventManager().fire(new ProxyPingEvent(inbound, ping)))
         .thenAcceptAsync(
             (event) -> {
               StringBuilder json = new StringBuilder();
               VelocityServer.getPingGsonInstance(connection.getProtocolVersion())
                   .toJson(event.getPing(), json);
               connection.write(new StatusResponse(json));
+              // BotFilter BackPort Start: Global rate limiter
               server.getIpAttemptLimiter()
-                  //BotFilter - global rate limiter
-                  .unthrottle(((InetSocketAddress)connection.getRemoteAddress()).getAddress());
+                  .unthrottle(((InetSocketAddress) connection.getRemoteAddress()).getAddress());
+              // BotFilter BackPort End
+              // ElytraProxy Start
+              // TODO: FIX
+              if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.ENABLE_CHECK_ON_PING) {
+                server.getElytraProxy().checkHostname(null, inbound, ElytraProxy.HostnameCheckType.PING);
+              }
+              // ElytraProxy End
             },
             connection.eventLoop())
         .exceptionally((ex) -> {
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeConnectionType.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeConnectionType.java
index 5e063b28..836548e7 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeConnectionType.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeConnectionType.java
@@ -36,8 +36,7 @@ public class LegacyForgeConnectionType extends ConnectionTypeImpl {
   }
 
   @Override
-  public GameProfile addGameProfileTokensIfRequired(GameProfile original,
-      PlayerInfoForwarding forwardingType) {
+  public GameProfile addGameProfileTokensIfRequired(GameProfile original, PlayerInfoForwarding forwardingType) {
     // We can't forward the FML token to the server when we are running in legacy forwarding mode,
     // since both use the "hostname" field in the handshake. We add a special property to the
     // profile instead, which will be ignored by non-Forge servers and can be intercepted by a
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeConstants.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeConstants.java
index 7dff8855..3c526c60 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeConstants.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeConstants.java
@@ -67,7 +67,7 @@ public class LegacyForgeConstants {
   /**
    * The payload for the reset packet.
    */
-  static final byte[] FORGE_LEGACY_HANDSHAKE_RESET_DATA = new byte[]{RESET_DATA_DISCRIMINATOR, 0};
+  static final byte[] FORGE_LEGACY_HANDSHAKE_RESET_DATA = new byte[] {RESET_DATA_DISCRIMINATOR, 0};
 
   private LegacyForgeConstants() {
     throw new AssertionError();
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeHandshakeBackendPhase.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeHandshakeBackendPhase.java
index ed435011..8c3ff28b 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeHandshakeBackendPhase.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeHandshakeBackendPhase.java
@@ -106,7 +106,8 @@ public enum LegacyForgeHandshakeBackendPhase implements BackendConnectionPhase {
     }
   };
 
-  @Nullable private final Integer packetToAdvanceOn;
+  @Nullable
+  private final Integer packetToAdvanceOn;
 
   /**
    * Creates an instance of the {@link LegacyForgeHandshakeBackendPhase}.
@@ -123,8 +124,7 @@ public enum LegacyForgeHandshakeBackendPhase implements BackendConnectionPhase {
 
   @Override
   public final boolean handle(VelocityServerConnection serverConnection,
-                              ConnectedPlayer player,
-                              PluginMessage message) {
+      ConnectedPlayer player, PluginMessage message) {
     if (message.getChannel().equals(LegacyForgeConstants.FORGE_LEGACY_HANDSHAKE_CHANNEL)) {
       // Get the phase and check if we need to start the next phase.
       LegacyForgeHandshakeBackendPhase newPhase = getNewPhase(serverConnection, message);
@@ -147,8 +147,7 @@ public enum LegacyForgeHandshakeBackendPhase implements BackendConnectionPhase {
   }
 
   @Override
-  public void onDepartForNewServer(VelocityServerConnection serverConnection,
-                                   ConnectedPlayer player) {
+  public void onDepartForNewServer(VelocityServerConnection serverConnection, ConnectedPlayer player) {
     // If the server we are departing is modded, we must always reset the client's handshake.
     player.getPhase().resetConnectionPhase(player);
   }
@@ -175,11 +174,11 @@ public enum LegacyForgeHandshakeBackendPhase implements BackendConnectionPhase {
    * Get the phase to act on, depending on the packet that has been sent.
    *
    * @param serverConnection The server Velocity is connecting to
-   * @param packet The packet
+   * @param packet           The packet
    * @return The phase to transition to, which may be the same as before.
    */
   private LegacyForgeHandshakeBackendPhase getNewPhase(VelocityServerConnection serverConnection,
-                                                       PluginMessage packet) {
+      PluginMessage packet) {
     if (packetToAdvanceOn != null
         && LegacyForgeUtil.getHandshakePacketDiscriminator(packet) == packetToAdvanceOn) {
       LegacyForgeHandshakeBackendPhase phaseToTransitionTo = nextPhase();
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeHandshakeClientPhase.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeHandshakeClientPhase.java
index 3bb1510f..333a6330 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeHandshakeClientPhase.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeHandshakeClientPhase.java
@@ -55,9 +55,7 @@ public enum LegacyForgeHandshakeClientPhase implements ClientConnectionPhase {
     }
 
     @Override
-    boolean onHandle(ConnectedPlayer player,
-        PluginMessage message,
-        MinecraftConnection backendConn) {
+    boolean onHandle(ConnectedPlayer player, PluginMessage message, MinecraftConnection backendConn) {
       // If we stay in this phase, we do nothing because it means the packet wasn't handled.
       // Returning false indicates this
       return false;
@@ -76,7 +74,6 @@ public enum LegacyForgeHandshakeClientPhase implements ClientConnectionPhase {
   },
 
 
-
   /**
    * The Mod list is sent to the server, captured by Velocity.
    * Transition to {@link #WAITING_SERVER_DATA} when an ACK is sent, which
@@ -89,9 +86,7 @@ public enum LegacyForgeHandshakeClientPhase implements ClientConnectionPhase {
     }
 
     @Override
-    boolean onHandle(ConnectedPlayer player,
-        PluginMessage message,
-        MinecraftConnection backendConn) {
+    boolean onHandle(ConnectedPlayer player, PluginMessage message, MinecraftConnection backendConn) {
       // Read the mod list if we haven't already.
       if (!player.getModInfo().isPresent()) {
         List<ModInfo.Mod> mods = LegacyForgeUtil.readModList(message);
@@ -163,9 +158,7 @@ public enum LegacyForgeHandshakeClientPhase implements ClientConnectionPhase {
     }
 
     @Override
-    boolean onHandle(ConnectedPlayer player,
-        PluginMessage message,
-        MinecraftConnection backendConn) {
+    boolean onHandle(ConnectedPlayer player, PluginMessage message, MinecraftConnection backendConn) {
       super.onHandle(player, message, backendConn);
 
       // just in case the timing is awful
@@ -180,7 +173,8 @@ public enum LegacyForgeHandshakeClientPhase implements ClientConnectionPhase {
     }
   };
 
-  @Nullable private final Integer packetToAdvanceOn;
+  @Nullable
+  private final Integer packetToAdvanceOn;
 
   /**
    * Creates an instance of the {@link LegacyForgeHandshakeClientPhase}.
@@ -196,9 +190,7 @@ public enum LegacyForgeHandshakeClientPhase implements ClientConnectionPhase {
   }
 
   @Override
-  public final boolean handle(ConnectedPlayer player,
-      PluginMessage message,
-      VelocityServerConnection server) {
+  public final boolean handle(ConnectedPlayer player, PluginMessage message, VelocityServerConnection server) {
     if (server != null) {
       MinecraftConnection backendConn = server.getConnection();
       if (backendConn != null
@@ -221,15 +213,12 @@ public enum LegacyForgeHandshakeClientPhase implements ClientConnectionPhase {
   /**
    * Handles the phase tasks.
    *
-   * @param player The player
-   * @param message The message to handle
+   * @param player      The player
+   * @param message     The message to handle
    * @param backendConn The backend connection to write to, if required.
-   *
    * @return true if handled, false otherwise.
    */
-  boolean onHandle(ConnectedPlayer player,
-      PluginMessage message,
-      MinecraftConnection backendConn) {
+  boolean onHandle(ConnectedPlayer player, PluginMessage message, MinecraftConnection backendConn) {
     // Send the packet on to the server.
     backendConn.write(message.retain());
 
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeUtil.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeUtil.java
index f541c789..8b0bd4b9 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeUtil.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/forge/legacy/LegacyForgeUtil.java
@@ -57,7 +57,7 @@ class LegacyForgeUtil {
   static List<ModInfo.Mod> readModList(PluginMessage message) {
     Preconditions.checkNotNull(message, "message");
     Preconditions.checkArgument(message.getChannel().equals(FORGE_LEGACY_HANDSHAKE_CHANNEL),
-            "message is not a FML HS plugin message");
+        "message is not a FML HS plugin message");
 
     ByteBuf contents = message.content().slice();
     byte discriminator = contents.readByte();
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/player/VelocityResourcePackInfo.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/player/VelocityResourcePackInfo.java
index 250e9b3a..e6b8330a 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/player/VelocityResourcePackInfo.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/player/VelocityResourcePackInfo.java
@@ -23,6 +23,7 @@ import net.kyori.adventure.text.Component;
 import org.checkerframework.checker.nullness.qual.Nullable;
 
 public final class VelocityResourcePackInfo implements ResourcePackInfo {
+
   private final String url;
   private final @Nullable byte[] hash;
   private final boolean shouldForce;
@@ -30,7 +31,7 @@ public final class VelocityResourcePackInfo implements ResourcePackInfo {
   private final Origin origin;
 
   private VelocityResourcePackInfo(String url, @Nullable byte[] hash, boolean shouldForce,
-                                  @Nullable Component prompt, Origin origin) {
+      @Nullable Component prompt, Origin origin) {
     this.url = url;
     this.hash = hash;
     this.shouldForce = shouldForce;
@@ -106,5 +107,4 @@ public final class VelocityResourcePackInfo implements ResourcePackInfo {
       this.origin = origin;
     }
   }
-
 }
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionData.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionData.java
index 07b69bae..5872e978 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionData.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionData.java
@@ -23,6 +23,7 @@ import net.kyori.adventure.nbt.CompoundBinaryTag;
 import org.checkerframework.checker.nullness.qual.Nullable;
 
 public final class DimensionData {
+
   private static final String UNKNOWN_DIMENSION_ID = "velocity:unknown_dimension";
 
   private final String registryIdentifier;
@@ -48,26 +49,27 @@ public final class DimensionData {
 
   /**
    * Initializes a new {@link DimensionData} instance.
-   * @param registryIdentifier the identifier for the dimension from the registry.
-   * @param dimensionId the dimension ID contained in the registry (the "id" tag)
-   * @param isNatural indicates if the dimension use natural world generation (e.g. overworld)
-   * @param ambientLight the light level the client sees without external lighting
-   * @param isShrunk indicates if the world is shrunk, aka not the full 256 blocks (e.g. nether)
-   * @param isUltrawarm internal dimension warmth flag
-   * @param hasCeiling indicates if the dimension has a ceiling layer
-   * @param hasSkylight indicates if the dimension should display the sun
-   * @param isPiglinSafe indicates if piglins should naturally zombify in this dimension
-   * @param doBedsWork indicates if players should be able to sleep in beds in this dimension
-   * @param doRespawnAnchorsWork indicates if player respawn points can be used in this dimension
-   * @param hasRaids indicates if raids can be spawned in the dimension
-   * @param logicalHeight the natural max height for the given dimension
+   *
+   * @param registryIdentifier         the identifier for the dimension from the registry.
+   * @param dimensionId                the dimension ID contained in the registry (the "id" tag)
+   * @param isNatural                  indicates if the dimension use natural world generation (e.g. overworld)
+   * @param ambientLight               the light level the client sees without external lighting
+   * @param isShrunk                   indicates if the world is shrunk, aka not the full 256 blocks (e.g. nether)
+   * @param isUltrawarm                internal dimension warmth flag
+   * @param hasCeiling                 indicates if the dimension has a ceiling layer
+   * @param hasSkylight                indicates if the dimension should display the sun
+   * @param isPiglinSafe               indicates if piglins should naturally zombify in this dimension
+   * @param doBedsWork                 indicates if players should be able to sleep in beds in this dimension
+   * @param doRespawnAnchorsWork       indicates if player respawn points can be used in this dimension
+   * @param hasRaids                   indicates if raids can be spawned in the dimension
+   * @param logicalHeight              the natural max height for the given dimension
    * @param burningBehaviourIdentifier the identifier for how burning blocks work in the dimension
-   * @param fixedTime optional. If set to any game daytime value will deactivate time cycle
-   * @param createDragonFight optional. Internal flag used in the end dimension
-   * @param coordinateScale optional, unknown purpose
-   * @param effects optional, unknown purpose
-   * @param minY the world effective lowest build-level
-   * @param height the world height above zero
+   * @param fixedTime                  optional. If set to any game daytime value will deactivate time cycle
+   * @param createDragonFight          optional. Internal flag used in the end dimension
+   * @param coordinateScale            optional, unknown purpose
+   * @param effects                    optional, unknown purpose
+   * @param minY                       the world effective lowest build-level
+   * @param height                     the world height above zero
    */
   public DimensionData(String registryIdentifier,
       @Nullable Integer dimensionId,
@@ -193,11 +195,10 @@ public final class DimensionData {
    * and {@code dimensionId}.
    *
    * @param registryIdentifier the identifier for the dimension from the registry
-   * @param dimensionId optional, dimension ID
+   * @param dimensionId        optional, dimension ID
    * @return a new {@link DimensionData}
    */
-  public DimensionData annotateWith(String registryIdentifier,
-      @Nullable Integer dimensionId) {
+  public DimensionData annotateWith(String registryIdentifier, @Nullable Integer dimensionId) {
     return new DimensionData(registryIdentifier, dimensionId, isNatural, ambientLight, isShrunk,
         isUltrawarm, hasCeiling, hasSkylight, isPiglinSafe, doBedsWork, doRespawnAnchorsWork,
         hasRaids, logicalHeight, burningBehaviourIdentifier, fixedTime, createDragonFight,
@@ -216,8 +217,7 @@ public final class DimensionData {
    * @param version the protocol version
    * @return game dimension data
    */
-  public static DimensionData decodeBaseCompoundTag(CompoundBinaryTag details,
-      ProtocolVersion version) {
+  public static DimensionData decodeBaseCompoundTag(CompoundBinaryTag details, ProtocolVersion version) {
     boolean isNatural = details.getBoolean("natural");
     float ambientLight = details.getFloat("ambient_light");
     boolean isShrunk = details.getBoolean("shrunk");
@@ -241,10 +241,8 @@ public final class DimensionData {
     Integer minY = details.keySet().contains("min_y") ? details.getInt("min_y") : null;
     Integer height = details.keySet().contains("height") ? details.getInt("height") : null;
     if (version.compareTo(ProtocolVersion.MINECRAFT_1_17) >= 0) {
-      Preconditions.checkNotNull(height,
-              "DimensionData requires 'height' to be present for this version");
-      Preconditions.checkNotNull(minY,
-              "DimensionData requires 'minY' to be present for this version");
+      Preconditions.checkNotNull(height, "DimensionData requires 'height' to be present for this version");
+      Preconditions.checkNotNull(minY, "DimensionData requires 'minY' to be present for this version");
     }
     return new DimensionData(
         UNKNOWN_DIMENSION_ID, null, isNatural, ambientLight, isShrunk,
@@ -256,12 +254,12 @@ public final class DimensionData {
   /**
    * Parses a given CompoundTag to a DimensionData instance. Assumes the data is part of a
    * dimension registry.
-   * @param dimTag the compound from the registry to read
+   *
+   * @param dimTag  the compound from the registry to read
    * @param version the protocol version
    * @return game dimension data
    */
-  public static DimensionData decodeRegistryEntry(CompoundBinaryTag dimTag,
-      ProtocolVersion version) {
+  public static DimensionData decodeRegistryEntry(CompoundBinaryTag dimTag, ProtocolVersion version) {
     String registryIdentifier = dimTag.getString("name");
     CompoundBinaryTag details;
     Integer dimensionId = null;
@@ -278,6 +276,7 @@ public final class DimensionData {
 
   /**
    * Encodes the Dimension data as CompoundTag.
+   *
    * @param version the version to serialize as
    * @return compound containing the dimension data
    */
@@ -301,6 +300,7 @@ public final class DimensionData {
 
   /**
    * Serializes details of this dimension.
+   *
    * @return serialized details of this dimension
    */
   public CompoundBinaryTag serializeDimensionDetails() {
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionInfo.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionInfo.java
index 8c7abd8c..bdb2a5e0 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionInfo.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionInfo.java
@@ -29,13 +29,13 @@ public final class DimensionInfo {
 
   /**
    * Initializes a new {@link DimensionInfo} instance.
+   *
    * @param registryIdentifier the identifier for the dimension from the registry
-   * @param levelName the level name as displayed in the F3 menu and logs
-   * @param isFlat if true will set world lighting below surface-level to not display fog
-   * @param isDebugType if true constrains the world to the very limited debug-type world
+   * @param levelName          the level name as displayed in the F3 menu and logs
+   * @param isFlat             if true will set world lighting below surface-level to not display fog
+   * @param isDebugType        if true constrains the world to the very limited debug-type world
    */
-  public DimensionInfo(String registryIdentifier, @Nullable String levelName,
-      boolean isFlat, boolean isDebugType) {
+  public DimensionInfo(String registryIdentifier, @Nullable String levelName, boolean isFlat, boolean isDebugType) {
     this.registryIdentifier = Preconditions.checkNotNull(
         registryIdentifier, "registryIdentifier cannot be null");
     Preconditions.checkArgument(registryIdentifier.length() > 0,
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionRegistry.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionRegistry.java
index 4e7fb52a..224d8d56 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionRegistry.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/registry/DimensionRegistry.java
@@ -20,11 +20,9 @@ package com.velocitypowered.proxy.connection.registry;
 import com.google.common.base.Preconditions;
 import com.google.common.collect.ImmutableSet;
 import com.google.common.collect.Maps;
-
 import com.velocitypowered.api.network.ProtocolVersion;
 import java.util.Map;
 import java.util.Set;
-
 import net.kyori.adventure.nbt.BinaryTag;
 import net.kyori.adventure.nbt.BinaryTagTypes;
 import net.kyori.adventure.nbt.CompoundBinaryTag;
@@ -44,11 +42,11 @@ public final class DimensionRegistry {
    * This WILL raise an IllegalArgumentException if the following is not met:
    * - At least one valid DimensionData instance is provided
    * - At least one valid world name is provided
+   *
    * @param registeredDimensions a populated {@link ImmutableSet} containing dimension data types
-   * @param levelNames a populated {@link ImmutableSet} of the level (world) names the server offers
+   * @param levelNames           a populated {@link ImmutableSet} of the level (world) names the server offers
    */
-  public DimensionRegistry(ImmutableSet<DimensionData> registeredDimensions,
-      ImmutableSet<String> levelNames) {
+  public DimensionRegistry(ImmutableSet<DimensionData> registeredDimensions, ImmutableSet<String> levelNames) {
     Preconditions.checkNotNull(registeredDimensions,
         "registeredDimensions cannot be null");
     Preconditions.checkNotNull(levelNames,
@@ -72,6 +70,7 @@ public final class DimensionRegistry {
 
   /**
    * Returns the internal dimension data type as used by the game.
+   *
    * @param dimensionIdentifier how the dimension is identified by the connection
    * @return game dimension data or null if not registered
    */
@@ -81,6 +80,7 @@ public final class DimensionRegistry {
 
   /**
    * Checks a {@link DimensionInfo} against this registry.
+   *
    * @param toValidate the {@link DimensionInfo} to validate
    * @return true: the dimension information is valid for this registry
    */
@@ -94,6 +94,7 @@ public final class DimensionRegistry {
 
   /**
    * Encodes the stored Dimension registry as CompoundTag.
+   *
    * @return the CompoundTag containing identifier:type mappings
    */
   public ListBinaryTag encodeRegistry(ProtocolVersion version) {
@@ -107,10 +108,10 @@ public final class DimensionRegistry {
 
   /**
    * Decodes a CompoundTag storing a dimension registry.
+   *
    * @param toParse CompoundTag containing a dimension registry
    */
-  public static ImmutableSet<DimensionData> fromGameData(ListBinaryTag toParse,
-      ProtocolVersion version) {
+  public static ImmutableSet<DimensionData> fromGameData(ListBinaryTag toParse, ProtocolVersion version) {
     Preconditions.checkNotNull(toParse, "ListTag cannot be null");
     ImmutableSet.Builder<DimensionData> mappings = ImmutableSet.builder();
     for (BinaryTag iter : toParse) {
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/connection/util/ConnectionMessages.java b/proxy/src/main/java/com/velocitypowered/proxy/connection/util/ConnectionMessages.java
index 0ff0dc89..b16d750f 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/connection/util/ConnectionMessages.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/connection/util/ConnectionMessages.java
@@ -25,22 +25,15 @@ public class ConnectionMessages {
 
   public static final Component ALREADY_CONNECTED = LegacyComponentSerializer
       .legacyAmpersand()
-      .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.ALREADY_CONNECTED
-          .replace("{NL}", "\n")
-          .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-      );
+      .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.ALREADY_CONNECTED);
+
   public static final Component IN_PROGRESS = LegacyComponentSerializer
       .legacyAmpersand()
-      .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.ALREADY_CONNECTING
-          .replace("{NL}", "\n")
-          .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-      );
+      .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.ALREADY_CONNECTING);
+
   public static final Component INTERNAL_SERVER_CONNECTION_ERROR = LegacyComponentSerializer
       .legacyAmpersand()
-      .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.INTERNAL_SERVER_CONNECTION_ERROR
-          .replace("{NL}", "\n")
-          .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-      );
+      .deserialize(Settings.IMP.MESSAGES.VELOCITY.ERROR.INTERNAL_SERVER_CONNECTION_ERROR);
 
   private ConnectionMessages() {
     throw new AssertionError();
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/console/VelocityConsole.java b/proxy/src/main/java/com/velocitypowered/proxy/console/VelocityConsole.java
index 0a59858a..c2759bd7 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/console/VelocityConsole.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/console/VelocityConsole.java
@@ -24,20 +24,13 @@ import com.velocitypowered.api.permission.PermissionFunction;
 import com.velocitypowered.api.permission.Tristate;
 import com.velocitypowered.api.proxy.ConsoleCommandSource;
 import com.velocitypowered.proxy.VelocityServer;
-import com.velocitypowered.proxy.util.ClosestLocaleMatcher;
 import java.util.List;
 import net.elytrium.elytraproxy.config.Settings;
-import java.util.Locale;
 import net.kyori.adventure.identity.Identity;
 import net.kyori.adventure.permission.PermissionChecker;
 import net.kyori.adventure.pointer.Pointers;
 import net.kyori.adventure.text.Component;
 import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
-import net.kyori.text.TextComponent;
-import net.kyori.text.format.TextColor;
-import net.kyori.adventure.text.format.NamedTextColor;
-import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
-import net.kyori.adventure.translation.GlobalTranslator;
 import net.minecrell.terminalconsole.SimpleTerminalConsole;
 import org.apache.logging.log4j.Level;
 import org.apache.logging.log4j.LogManager;
@@ -64,10 +57,14 @@ public final class VelocityConsole extends SimpleTerminalConsole implements Cons
 
   @Override
   public void sendMessage(@NonNull Identity identity, @NonNull Component message) {
+    // ElytraProxy Start: Removed as unnecessary
+    /*
     Component translated = GlobalTranslator.render(message, ClosestLocaleMatcher.INSTANCE
         .lookupClosest(Locale.getDefault()));
-    logger.info(LegacyComponentSerializer.legacySection().serialize(translated));
+    */
+    logger.info(LegacyComponentSerializer.legacySection().serialize(message/*translated*/));
   }
+  // ElytraProxy End
 
   @Override
   public @NonNull Tristate getPermissionValue(@NonNull String permission) {
@@ -130,10 +127,7 @@ public final class VelocityConsole extends SimpleTerminalConsole implements Cons
         sendMessage(
             LegacyComponentSerializer
                 .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.COMMAND_DOES_NOT_EXIST
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ));
+                .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.COMMAND_DOES_NOT_EXIST));
       }
     } catch (Exception e) {
       logger.error("An error occurred while running this command.", e);
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/network/ServerChannelInitializer.java b/proxy/src/main/java/com/velocitypowered/proxy/network/ServerChannelInitializer.java
index ca1c8619..d8c127bf 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/network/ServerChannelInitializer.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/network/ServerChannelInitializer.java
@@ -58,7 +58,7 @@ public class ServerChannelInitializer extends ChannelInitializer<Channel> {
     if (server.getElytraProxy() == null) {
       return;
     }
-    //BotFilter start - global rate limiter
+    // BotFilter backport Start: Global rate limiter
     boolean isProxyProtocol = this.server.getConfiguration().isProxyProtocol();
     if (!isProxyProtocol && !server.getIpAttemptLimiter()
         .attempt(((InetSocketAddress)ch.remoteAddress()).getAddress())) {
@@ -66,7 +66,7 @@ public class ServerChannelInitializer extends ChannelInitializer<Channel> {
       server.getElytraProxy().getStatistics().addBlockedConnection();
       return;
     }
-    //BotFilter end
+    // BotFilter backport End
 
     ch.pipeline()
         .addLast(LEGACY_PING_DECODER, new LegacyPingDecoder())
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/protocol/MinecraftPacket.java b/proxy/src/main/java/com/velocitypowered/proxy/protocol/MinecraftPacket.java
index 7b2184d9..9f4ff6a5 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/protocol/MinecraftPacket.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/protocol/MinecraftPacket.java
@@ -24,7 +24,7 @@ import io.netty.buffer.ByteBuf;
 
 public interface MinecraftPacket {
 
-  //BotFilter start - add default to methods
+  // BotFilter backport Start: Add default to methods
   default void decode(ByteBuf buf, Direction direction, ProtocolVersion protocolVersion) {
     throw new UnsupportedOperationException();
   }
@@ -36,7 +36,7 @@ public interface MinecraftPacket {
   default boolean handle(MinecraftSessionHandler handler) {
     throw new UnsupportedOperationException();
   }
-  //BotFilter end
+  // BotFilter backport End
 
   default int expectedMaxLength(ByteBuf buf, ProtocolUtils.Direction direction,
       ProtocolVersion version) {
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/protocol/StateRegistry.java b/proxy/src/main/java/com/velocitypowered/proxy/protocol/StateRegistry.java
index 1d786691..b9e34cd4 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/protocol/StateRegistry.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/protocol/StateRegistry.java
@@ -73,9 +73,11 @@ import io.netty.util.collection.IntObjectHashMap;
 import io.netty.util.collection.IntObjectMap;
 import it.unimi.dsi.fastutil.objects.Object2IntMap;
 import it.unimi.dsi.fastutil.objects.Object2IntOpenHashMap;
+import java.util.ArrayList;
 import java.util.Collections;
 import java.util.EnumMap;
 import java.util.EnumSet;
+import java.util.List;
 import java.util.Map;
 import java.util.Objects;
 import java.util.function.Supplier;
@@ -297,7 +299,8 @@ public enum StateRegistry {
       clientbound.register(LoginPluginMessage.class, LoginPluginMessage::new,
           map(0x04, MINECRAFT_1_13, false));
     }
-  }, BotFilter{};
+  },
+  VIRTUAL {};
 
   public static final int STATUS_ID = 1;
   public static final int LOGIN_ID = 2;
@@ -323,7 +326,7 @@ public enum StateRegistry {
       this.versions = Collections.unmodifiableMap(mutableVersions);
     }
 
-    //BotFilter public
+    // BotFilter backport: Make public
     public ProtocolRegistry getProtocolRegistry(final ProtocolVersion version) {
       ProtocolRegistry registry = versions.get(version);
       if (registry == null) {
@@ -335,7 +338,7 @@ public enum StateRegistry {
       return registry;
     }
 
-    //BotFilter public
+    // BotFilter backport: Make public
     public <P extends MinecraftPacket> void register(Class<P> clazz, Supplier<P> packetSupplier,
         PacketMapping... mappings) {
       if (mappings.length == 0) {
@@ -394,6 +397,17 @@ public enum StateRegistry {
       }
     }
 
+    public PacketMapping[] getMappingsForPacket(Class<? extends MinecraftPacket> packet, boolean encodeOnly) {
+      ProtocolVersion from = ProtocolVersion.MINIMUM_VERSION;
+      ProtocolVersion to = ProtocolVersion.MAXIMUM_VERSION;
+      List<PacketMapping> mappings = new ArrayList<>();
+      for (ProtocolVersion protocol : EnumSet.range(from, to)) {
+        int id = getProtocolRegistry(protocol).getPacketId(packet);
+        mappings.add(new PacketMapping(id, protocol, null, encodeOnly));
+      }
+      return mappings.toArray(new PacketMapping[0]);
+    }
+
     public class ProtocolRegistry {
 
       public final ProtocolVersion version;
@@ -512,7 +526,7 @@ public enum StateRegistry {
    * @return PacketMapping with the provided arguments
    */
   @SuppressFBWarnings({"UPM_UNCALLED_PRIVATE_METHOD"})
-  //BotFilter public
+  // BotFilter backport: Make public
   public static PacketMapping map(int id, ProtocolVersion version, boolean encodeOnly) {
     return map(id, version, null, encodeOnly);
   }
@@ -526,7 +540,7 @@ public enum StateRegistry {
    * @param lastValidProtocolVersion Last version this Mapping is valid at
    * @return PacketMapping with the provided arguments
    */
-  //BotFilter public
+  // BotFilter backport: Make public
   public static PacketMapping map(int id, ProtocolVersion version,
           ProtocolVersion lastValidProtocolVersion, boolean encodeOnly) {
     return new PacketMapping(id, version, lastValidProtocolVersion, encodeOnly);
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/protocol/netty/GS4QueryHandler.java b/proxy/src/main/java/com/velocitypowered/proxy/protocol/netty/GS4QueryHandler.java
index 8a711ae6..247724dd 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/protocol/netty/GS4QueryHandler.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/protocol/netty/GS4QueryHandler.java
@@ -85,16 +85,18 @@ public class GS4QueryHandler extends SimpleChannelInboundHandler<DatagramPacket>
     return QueryResponse.builder()
         .hostname(PlainComponentSerializer.plain().serialize(
             Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
-            ? server.getMaintenanceMotd()
-            : server.getConfiguration().getMotd()))
+                ? server.getMaintenanceMotd()
+                : server.getConfiguration().getMotd()))
         .gameVersion("")
         .map(server.getConfiguration().getQueryMap())
-        .currentPlayers(Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
-            ? 0
-            : server.getPlayerCount())
-        .maxPlayers(Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
-            ? 0
-            : server.getConfiguration().getShowMaxPlayers())
+        .currentPlayers(
+            Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
+                ? 0
+                : server.getPlayerCount())
+        .maxPlayers(
+            Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
+                ? 0
+                : server.getConfiguration().getShowMaxPlayers())
         .proxyPort(server.getConfiguration().getBind().getPort())
         .proxyHost(server.getConfiguration().getBind().getHostString())
         .players(server.getAllPlayers().stream().filter(p -> p.getCurrentServer()
@@ -103,14 +105,14 @@ public class GS4QueryHandler extends SimpleChannelInboundHandler<DatagramPacket>
                 .contains(p.getCurrentServer().get().getServerInfo().getName()))
             .map(Player::getUsername)
             .collect(Collectors.toList()))
-        .proxyVersion((Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
-            ? Settings.IMP.MAIN_SETTINGS.MAINTENANCE.PING_VERSION
-            : Settings.IMP.MAIN_SETTINGS.PING_VERSION)
-                .replace('&', '')
-                .replace("{NL}", "\n")
-                .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX))
+        .proxyVersion((
+            Settings.IMP.MAIN_SETTINGS.MAINTENANCE.ENABLED
+                ? Settings.IMP.MAIN_SETTINGS.MAINTENANCE.PING_VERSION
+                : Settings.IMP.MAIN_SETTINGS.PING_VERSION)
+                    .replace('&', ''))
         .plugins(
-            server.getConfiguration().shouldQueryShowPlugins() ? getRealPluginInformation()
+            server.getConfiguration().shouldQueryShowPlugins()
+                ? getRealPluginInformation()
                 : Collections.emptyList())
         .build();
   }
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/protocol/packet/JoinGame.java b/proxy/src/main/java/com/velocitypowered/proxy/protocol/packet/JoinGame.java
index 9899ef0c..31b25644 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/protocol/packet/JoinGame.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/protocol/packet/JoinGame.java
@@ -75,6 +75,10 @@ public class JoinGame implements MinecraftPacket {
     this.dimension = dimension;
   }
 
+  public void setPartialHashedSeed(long partialHashedSeed) {
+    this.partialHashedSeed = partialHashedSeed;
+  }
+
   public long getPartialHashedSeed() {
     return partialHashedSeed;
   }
@@ -159,6 +163,10 @@ public class JoinGame implements MinecraftPacket {
     this.biomeRegistry = biomeRegistry;
   }
 
+  public void setCurrentDimensionData(DimensionData dimensionData) {
+    this.currentDimensionData = dimensionData;
+  }
+
   public DimensionData getCurrentDimensionData() {
     return currentDimensionData;
   }
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/protocol/util/PluginMessageUtil.java b/proxy/src/main/java/com/velocitypowered/proxy/protocol/util/PluginMessageUtil.java
index 37d77cf2..c641c510 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/protocol/util/PluginMessageUtil.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/protocol/util/PluginMessageUtil.java
@@ -129,7 +129,7 @@ public final class PluginMessageUtil {
 
     String currentBrand = readBrandMessage(message.content());
     String rewrittenBrand = Settings.IMP.MAIN_SETTINGS.BRAND
-            .replace("{ServerBrand}", currentBrand).replace("{ProxyBrand}", version.getName());
+        .replace("{ServerBrand}", currentBrand).replace("{ProxyBrand}", version.getName());
 
     ByteBuf rewrittenBuf = Unpooled.buffer();
     if (protocolVersion.compareTo(ProtocolVersion.MINECRAFT_1_8) >= 0) {
diff --git a/proxy/src/main/java/com/velocitypowered/proxy/util/bossbar/AdventureBossBarManager.java b/proxy/src/main/java/com/velocitypowered/proxy/util/bossbar/AdventureBossBarManager.java
index 3dc8ea13..697dd589 100644
--- a/proxy/src/main/java/com/velocitypowered/proxy/util/bossbar/AdventureBossBarManager.java
+++ b/proxy/src/main/java/com/velocitypowered/proxy/util/bossbar/AdventureBossBarManager.java
@@ -124,9 +124,9 @@ public class AdventureBossBarManager implements BossBar.Listener {
       return;
     }
     for (ConnectedPlayer player : holder.subscribers) {
-      Component translated = player.translateMessage(newName);
+      //Component translated = player.translateMessage(newName);
       com.velocitypowered.proxy.protocol.packet.BossBar packet = holder.createTitleUpdate(
-          translated, player.getProtocolVersion());
+          newName/*translated*/, player.getProtocolVersion());
       player.getConnection().write(packet);
     }
   }
@@ -208,8 +208,9 @@ public class AdventureBossBarManager implements BossBar.Listener {
           .proxy.protocol.packet.BossBar();
       packet.setUuid(this.id);
       packet.setAction(com.velocitypowered.proxy.protocol.packet.BossBar.ADD);
+      // ElytraProxy: Removed as unnecessary
       packet.setName(ProtocolUtils.getJsonChatSerializer(player.getProtocolVersion())
-          .serialize(player.translateMessage(bar.name())));
+          .serialize(bar.name()/*player.translateMessage(bar.name())*/));
       packet.setColor(COLORS_TO_PROTOCOL.get(bar.color()));
       packet.setOverlay(OVERLAY_TO_PROTOCOL.get(bar.overlay()));
       packet.setPercent(bar.progress());
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/ElytraProxy.java b/proxy/src/main/java/net/elytrium/elytraproxy/ElytraProxy.java
index a2dc13bf..819823c2 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/ElytraProxy.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/ElytraProxy.java
@@ -19,91 +19,139 @@ package net.elytrium.elytraproxy;
 
 import com.velocitypowered.api.command.CommandManager;
 import com.velocitypowered.api.command.CommandSource;
+import com.velocitypowered.api.proxy.InboundConnection;
 import com.velocitypowered.proxy.VelocityServer;
-import com.velocitypowered.proxy.connection.MinecraftConnection;
 import com.velocitypowered.proxy.connection.client.ConnectedPlayer;
 import com.velocitypowered.proxy.connection.client.LoginSessionHandler;
-import com.velocitypowered.proxy.network.Connections;
+import com.velocitypowered.proxy.protocol.StateRegistry;
 import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
-import io.netty.channel.ChannelPipeline;
 import java.io.BufferedReader;
 import java.io.File;
 import java.io.IOException;
 import java.io.InputStreamReader;
+import java.net.InetAddress;
+import java.net.InetSocketAddress;
 import java.net.URL;
 import java.net.URLConnection;
+import java.net.http.HttpClient;
 import java.nio.charset.StandardCharsets;
+import java.sql.SQLException;
+import java.util.Locale;
+import java.util.Map;
+import java.util.concurrent.ConcurrentHashMap;
+import java.util.concurrent.ExecutionException;
+import java.util.concurrent.Executors;
+import java.util.concurrent.ScheduledExecutorService;
+import java.util.concurrent.TimeUnit;
+import lombok.AllArgsConstructor;
 import lombok.Getter;
 import lombok.ToString;
-import net.elytrium.elytraproxy.botfilter.protocol.cache.netty.MultiplePreparedPacketsEncoder;
-import net.elytrium.elytraproxy.botfilter.protocol.cache.netty.PreparedPacketEncoder;
-import net.elytrium.elytraproxy.botfilter.server.BotFilterSessionHandler;
-import net.elytrium.elytraproxy.botfilter.server.VirtualServer;
+import net.elytrium.elytraproxy.auth.handler.AuthSessionHandler;
+import net.elytrium.elytraproxy.auth.model.RegisteredPlayer;
+import net.elytrium.elytraproxy.botfilter.CaptchaGeneration;
+import net.elytrium.elytraproxy.botfilter.handler.BotFilterSessionHandler;
 import net.elytrium.elytraproxy.commands.AlertCommand;
+import net.elytrium.elytraproxy.commands.ChangePasswordCommand;
 import net.elytrium.elytraproxy.commands.ElytraProxyCommand;
 import net.elytrium.elytraproxy.commands.FindCommand;
 import net.elytrium.elytraproxy.commands.SendCommand;
+import net.elytrium.elytraproxy.commands.TotpCommand;
+import net.elytrium.elytraproxy.commands.UnregisterCommand;
 import net.elytrium.elytraproxy.config.Settings;
 import net.elytrium.elytraproxy.database.Database;
+import net.elytrium.elytraproxy.database.MySqlDatabase;
 import net.elytrium.elytraproxy.stats.Statistics;
+import net.elytrium.elytraproxy.virtual.protocol.VirtualProtocol;
+import net.elytrium.elytraproxy.virtual.server.VirtualServer;
 import net.kyori.adventure.identity.Identity;
 import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
+import org.asynchttpclient.BoundRequestBuilder;
+import org.asynchttpclient.ListenableFuture;
+import org.asynchttpclient.Response;
 
 @Getter
 @ToString
 @SuppressFBWarnings({"RV_RETURN_VALUE_IGNORED",
     "OBL_UNSATISFIED_OBLIGATION_EXCEPTION_EDGE"})
 public class ElytraProxy {
+
   private final Logger logger = LogManager.getLogger("ElytraProxy");
   private Database database;
 
-  // BotFilter start
-  private final Logger bfLogger = LogManager.getLogger("BotFilter");
+  private Map<String, CachedUser> cachedBotChecks;
+  private Map<String, CachedUser> cachedAuthChecks;
+  private ScheduledExecutorService scheduler;
 
   private final VelocityServer velocityServer;
   private final VirtualServer virtualServer;
   private final Statistics statistics;
-  // BotFilter end
+
+  private final HttpClient httpClient = HttpClient.newBuilder()
+      .version(HttpClient.Version.HTTP_2)
+      .build();
+
+  static {
+    VirtualProtocol.init();
+  }
 
   public ElytraProxy(VelocityServer velocityServer) {
+    Settings.IMP.reload(new File("ElytraProxy", "config.yml"));
+    initDatabase(velocityServer);
+    initCaching();
+    statistics = new Statistics();
+    statistics.startUpdating();
     // BotFilter start
+    CaptchaGeneration.init();
     this.velocityServer = velocityServer;
     this.virtualServer = new VirtualServer(this);
     this.virtualServer.reload();
     // BotFilter end
-    Settings.IMP.reload(new File("ElytraProxy", "config.yml"));
     registerCommand(velocityServer);
-    //initDatabase(velocityServer);
-    statistics = new Statistics();
-    statistics.startUpdating();
     checkForUpdates();
     logger.info("ElytraProxy was loaded.");
   }
 
-  ///**
-  // * Initializes database, creates missing tables.
-  // *   ,   .
-  // */
-  /*
-  public void initDatabase(VelocityServer server) {
-    try {
-      MysqlConfig config = getConfig().getMySql();
-      database = new MySqlDatabase(config.hostname, config.database, config.user, config.password);
+  public void initCaching() {
+    cachedAuthChecks = new ConcurrentHashMap<>();
+    cachedBotChecks = new ConcurrentHashMap<>();
+    if (scheduler != null) {
+      scheduler.shutdown();
+    }
+    scheduler =
+        Executors.newScheduledThreadPool(1, task -> new Thread(task, "purge-cache"));
+    scheduler.scheduleAtFixedRate(
+        () -> checkCache(cachedAuthChecks, Settings.IMP.AUTH.PURGE_CACHE_MILLIS),
+        Settings.IMP.AUTH.PURGE_CACHE_MILLIS,
+        Settings.IMP.AUTH.PURGE_CACHE_MILLIS,
+        TimeUnit.MILLISECONDS);
+    scheduler.scheduleAtFixedRate(
+        () -> checkCache(cachedBotChecks, Settings.IMP.ANTIBOT.PURGE_CACHE_MILLIS),
+        Settings.IMP.ANTIBOT.PURGE_CACHE_MILLIS,
+        Settings.IMP.ANTIBOT.PURGE_CACHE_MILLIS,
+        TimeUnit.MILLISECONDS);
+  }
+
+  /**
+   * Initializes database, creates missing tables.
+   *   ,   .
+   */
 
-      database.makeTable("skins", ImmutableMap.of(
-              "uuid", "VARCHAR(36)",
-              "texture", "VARCHAR(256)",
-              "signature", "VARCHAR(256)"
-      ));
-    } catch (SQLException e) {
-      logger.error(e);
-      logger.error("" getConfig().getMessages().error.mysqlLoadFailed );
-      server.shutdown();
+  public void initDatabase(VelocityServer server) {
+    Settings.DATABASE config = Settings.IMP.DATABASE;
+    if (config.ENABLED) {
+      try {
+        database = new MySqlDatabase(config.HOSTNAME, config.DATABASE, config.USER, config.PASSWORD);
+        database.makeTable(Settings.IMP.AUTH.TABLE, RegisteredPlayer.getDatabaseItem());
+      } catch (SQLException e) {
+        logger.error(e);
+        logger.error(Settings.IMP.MESSAGES.ELYTRAPROXY.DB_FAILURE);
+        server.shutdown();
+      }
     }
   }
-  */
+
   /**
    * Initializes ElytraProxy commands.
    *   ElytraProxy.
@@ -115,42 +163,193 @@ public class ElytraProxy {
     manager.unregister("alert");
     manager.unregister("find");
     manager.unregister("send");
+    manager.unregister("unregister");
+    manager.unregister("changepass");
 
     manager.register("elytraproxy", new ElytraProxyCommand(server, this));
     manager.register("alert", new AlertCommand(server));
     manager.register("find", new FindCommand(server));
     manager.register("send", new SendCommand(server));
+
+    if (Settings.IMP.AUTH.ENABLE) {
+      manager.register("unregister", new UnregisterCommand(database));
+      manager.register("changepass", new ChangePasswordCommand(database));
+      manager.register("2fa", new TotpCommand(database));
+    }
   }
 
   public boolean shouldCheck(ConnectedPlayer player) {
-    return true;
+    InetSocketAddress adr = (InetSocketAddress) player.getConnection().getRemoteAddress();
+    return shouldCheck(player.getUsername(), adr.getAddress());
+  }
+
+  public boolean shouldCheck(String nickname, InetAddress ip) {
+    if (!Settings.IMP.ANTIBOT.ENABLE) {
+      return false;
+    }
+    if (cachedBotChecks.containsKey(nickname)) {
+      return !ip.equals(cachedBotChecks.get(nickname).getInetAddress());
+    } else {
+      return true;
+    }
+  }
+
+  public boolean shouldAuth(ConnectedPlayer player) {
+    if (Settings.IMP.AUTH.CACHE_AUTH_USERS) {
+      if (cachedAuthChecks.containsKey(player.getUsername())) {
+        InetSocketAddress adr = (InetSocketAddress) player.getConnection().getRemoteAddress();
+        return !adr.getAddress().equals(cachedAuthChecks.get(player.getUsername()).getInetAddress());
+      } else {
+        return true;
+      }
+    } else {
+      return true;
+    }
+  }
+
+  public void cacheSucceedUser(ConnectedPlayer player) {
+    cachedBotChecks.remove(player.getUsername());
+    InetSocketAddress adr = (InetSocketAddress) player.getConnection().getRemoteAddress();
+    cachedBotChecks.put(player.getUsername(), new CachedUser(adr.getAddress(), System.currentTimeMillis()));
+  }
+
+  public void cacheAuthUser(ConnectedPlayer player) {
+    if (Settings.IMP.AUTH.CACHE_AUTH_USERS) {
+      cachedAuthChecks.remove(player.getUsername());
+      InetSocketAddress adr = (InetSocketAddress) player.getConnection().getRemoteAddress();
+      cachedAuthChecks.put(player.getUsername(), new CachedUser(adr.getAddress(), System.currentTimeMillis()));
+    }
   }
 
   public void setupPipelineAndStartCheck(ConnectedPlayer player, LoginSessionHandler handler) {
     try {
-      BotFilterSessionHandler sessionHandler = new BotFilterSessionHandler(player, handler,
-          virtualServer);
-      bfLogger.info(sessionHandler.getPlayer().getUsername());
-
-      MinecraftConnection connection = sessionHandler.getPlayer().getConnection();
-      connection.setSessionHandler(sessionHandler);
-
-      ChannelPipeline pipeline = connection.getChannel().pipeline();
-      System.out.println("pre changed");
-      if (sessionHandler.getPlayer().isOnlineMode()) {
-        pipeline.addAfter(Connections.CIPHER_ENCODER, "prepared-encoder",
-            PreparedPacketEncoder.getEncoder(connection.getProtocolVersion(), true));
-      } else {
-        pipeline.addFirst("prepared-encoder",
-            PreparedPacketEncoder.getEncoder(connection.getProtocolVersion(), false));
-        pipeline.addFirst("multipleprepared-encoder",
-            MultiplePreparedPacketsEncoder.getEncoder(connection.getProtocolVersion()));
+      BotFilterSessionHandler botFilterSessionHandler =
+          new BotFilterSessionHandler(player, handler, virtualServer);
+
+      virtualServer.spawnPlayer(botFilterSessionHandler);
+    } catch (Throwable t) {
+      logger.error("Error", t);
+    }
+  }
+
+  public void auth(ConnectedPlayer player, LoginSessionHandler handler) {
+    if (player.getConnection().getState() != StateRegistry.VIRTUAL) {
+      player.getConnection().setState(StateRegistry.PLAY);
+    }
+    String nickname = player.getUsername().toLowerCase(Locale.ROOT);
+    for (char character : nickname.toCharArray()) {
+      if (!Settings.IMP.AUTH.ALLOWED_NICKNAME_CHARS.contains(String.valueOf(character))) {
+        player.getConnection().closeWith(virtualServer.getPackets().getNicknameInvalid());
+        return;
       }
-      System.out.println("changed");
+    }
+
+    if (!Settings.IMP.AUTH.ONLINE_MODE_NEED_AUTH) {
+      ListenableFuture<Response> isPremiumResponse = isPremiumRequest(nickname).execute();
+
+      isPremiumResponse.addListener(() -> {
+        try {
+          if (isPremiumResponse.get().getStatusCode() == 200) {
+            player.getConnection().closeWith(virtualServer.getPackets().getNicknamePremium());
+          } else {
+            sendToAuthServer(player, handler, nickname);
+          }
+        } catch (InterruptedException | ExecutionException e) {
+          logger.error("Unable to authenticate with Mojang", e);
+          player.getConnection().close(true);
+        }
+      }, player.getConnection().eventLoop());
+    } else {
+      sendToAuthServer(player, handler, nickname);
+    }
+  }
 
-      virtualServer.spawnPlayer(sessionHandler);
+  public BoundRequestBuilder isPremiumRequest(String nickname) {
+    return velocityServer.getAsyncHttpClient()
+        .prepareGet("https://api.mojang.com/users/profiles/minecraft/" + nickname);
+  }
+
+  private void checkCache(Map<String, CachedUser> userMap, long time) {
+    userMap.entrySet().stream()
+        .filter(u -> u.getValue().getCheckTime() + time <= System.currentTimeMillis())
+        .map(Map.Entry::getKey)
+        .forEach(userMap::remove);
+  }
+
+  private void sendToAuthServer(ConnectedPlayer player, LoginSessionHandler handler, String nickname) {
+    try {
+      AuthSessionHandler authSessionHandler =
+          new AuthSessionHandler(player, handler, virtualServer, nickname);
+
+      virtualServer.spawnPlayer(authSessionHandler);
     } catch (Throwable t) {
-      bfLogger.error("Error", t);
+      logger.error("Error", t);
+    }
+  }
+
+  public void checkHostname(ConnectedPlayer player, InboundConnection inbound, HostnameCheckType type) {
+    boolean isLogin = (type == HostnameCheckType.LOGIN);
+    if (isLogin) {
+      if (player.getVirtualHost().isEmpty()) {
+        return;
+      }
+      if (inbound.getVirtualHost().isEmpty()) {
+        return;
+      }
+    }
+
+    String playerHostname;
+    String playerAddress;
+    String playerIp;
+    String playerNick = null;
+    String notifymsg = "{} tried to connect using {}";
+    if (isLogin) {
+      playerHostname = (player.getVirtualHost().get()).getHostName();
+      playerAddress = (player.getVirtualHost().get()).getAddress().getHostAddress();
+      playerIp = player.getRemoteAddress().getAddress().getHostAddress();
+      playerNick = player.getUsername();
+    } else {
+      playerHostname = (inbound.getVirtualHost().get()).getHostName();
+      playerAddress = (inbound.getVirtualHost().get()).getAddress().getHostAddress();
+      playerIp = inbound.getRemoteAddress().getAddress().getHostAddress();
+    }
+
+    if (!Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.IGNORED_IPS.contains(playerIp)) {
+      if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.WHITELIST) {
+        if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.IPS_CHECK) {
+          if (!Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.HOSTNAMES.contains(playerAddress)) {
+            getLogger().info(notifymsg, isLogin ? playerNick : playerIp, playerAddress);
+            getStatistics().addBlockedConnection();
+            getStatistics().addBlockedBots();
+            return;
+          }
+        }
+        if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.DOMAINS_CHECK) {
+          if (!Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.HOSTNAMES.contains(playerHostname)) {
+            getLogger().info(notifymsg, isLogin ? playerNick : playerIp, playerHostname);
+            getStatistics().addBlockedConnection();
+            getStatistics().addBlockedBots();
+            return;
+          }
+        }
+      } else {
+        if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.IPS_CHECK) {
+          if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.HOSTNAMES.contains(playerAddress)) {
+            getLogger().info(notifymsg, isLogin ? playerNick : playerIp, playerAddress);
+            getStatistics().addBlockedConnection();
+            getStatistics().addBlockedBots();
+            return;
+          }
+        }
+        if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.DOMAINS_CHECK) {
+          if (Settings.IMP.MAIN_SETTINGS.HOSTNAMES_MANAGER.HOSTNAMES.contains(playerHostname)) {
+            getLogger().info(notifymsg, isLogin ? playerNick : playerIp, playerHostname);
+            getStatistics().addBlockedConnection();
+            getStatistics().addBlockedBots();
+            return;
+          }
+        }
+      }
     }
   }
 
@@ -160,19 +359,13 @@ public class ElytraProxy {
       source.sendMessage(Identity.nil(),
           LegacyComponentSerializer
               .legacyAmpersand()
-              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.RELOAD_SUCCESS
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ));
+              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.RELOAD_SUCCESS));
     } catch (Exception e) {
       logger.error("Unable to reload configuration", e);
       source.sendMessage(Identity.nil(),
           LegacyComponentSerializer
               .legacyAmpersand()
-              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.RELOAD_FAILURE
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ));
+              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.RELOAD_FAILURE));
     }
   }
 
@@ -197,4 +390,16 @@ public class ElytraProxy {
       logger.warn("Unable to check for updates.", ex);
     }
   }
+
+  public enum HostnameCheckType {
+    LOGIN,
+    PING
+  }
+
+  @AllArgsConstructor
+  @Getter
+  private static class CachedUser {
+    private InetAddress inetAddress;
+    private long checkTime;
+  }
 }
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/auth/handler/AuthSessionHandler.java b/proxy/src/main/java/net/elytrium/elytraproxy/auth/handler/AuthSessionHandler.java
new file mode 100644
index 00000000..26b8d99c
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/auth/handler/AuthSessionHandler.java
@@ -0,0 +1,239 @@
+/*
+ * Copyright (C) 2021 Elytrium
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.auth.handler;
+
+import at.favre.lib.crypto.bcrypt.BCrypt;
+import com.google.common.collect.ImmutableMap;
+import com.velocitypowered.proxy.connection.MinecraftConnection;
+import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
+import com.velocitypowered.proxy.connection.client.ConnectedPlayer;
+import com.velocitypowered.proxy.connection.client.LoginSessionHandler;
+import com.velocitypowered.proxy.protocol.packet.Chat;
+import dev.samstevens.totp.code.CodeGenerator;
+import dev.samstevens.totp.code.CodeVerifier;
+import dev.samstevens.totp.code.DefaultCodeGenerator;
+import dev.samstevens.totp.code.DefaultCodeVerifier;
+import dev.samstevens.totp.time.SystemTimeProvider;
+import dev.samstevens.totp.time.TimeProvider;
+import java.net.InetSocketAddress;
+import java.nio.charset.StandardCharsets;
+import java.util.List;
+import java.util.Map;
+import java.util.concurrent.atomic.AtomicInteger;
+import lombok.Getter;
+import net.elytrium.elytraproxy.auth.model.RegisteredPlayer;
+import net.elytrium.elytraproxy.config.Settings;
+import net.elytrium.elytraproxy.database.Database;
+import net.elytrium.elytraproxy.virtual.server.ServerPackets;
+import net.elytrium.elytraproxy.virtual.server.VirtualServer;
+import net.elytrium.elytraproxy.virtual.server.VirtualSessionHandler;
+
+public class AuthSessionHandler extends VirtualSessionHandler {
+  private static final TimeProvider timeProvider = new SystemTimeProvider();
+  private static final CodeGenerator codeGenerator = new DefaultCodeGenerator();
+  @Getter
+  private static final CodeVerifier verifier = new DefaultCodeVerifier(codeGenerator, timeProvider);
+  private final Database database;
+  private final RegisteredPlayer playerInfo;
+  private final ServerPackets packets;
+  private final MinecraftConnection connection;
+  private final String ip;
+  private boolean totp = false;
+
+  private int attempts = Settings.IMP.AUTH.LOGIN_ATTEMPTS;
+
+  public AuthSessionHandler(
+      ConnectedPlayer player, MinecraftSessionHandler originalHandler,
+      VirtualServer virtualServer, String lowercaseNickname) {
+    super(player, originalHandler, virtualServer);
+    this.database = virtualServer.getElytraProxy().getDatabase();
+    this.packets = virtualServer.getPackets();
+    this.connection = player.getConnection();
+    this.playerInfo = fetchInfo(lowercaseNickname);
+    this.ip = ((InetSocketAddress) connection.getRemoteAddress()).getAddress().getHostAddress();
+  }
+
+
+  @Override
+  public boolean handle(Chat chat) {
+    String[] args = chat.getMessage().split(" ");
+    if (args.length != 0) {
+      switch (args[0]) {
+        case "/reg":
+        case "/register":
+        case "/r":
+          if (args.length >= 3 && !totp && playerInfo == null && args[1].equals(args[2])) {
+            register(args[1]);
+            finish();
+          } else {
+            sendMessage();
+          }
+          break;
+        case "/log":
+        case "/login":
+        case "/l":
+          if (args.length >= 2 && !totp && playerInfo != null) {
+            if (checkPassword(args[1])) {
+              finishOrTotp();
+            } else if (attempts-- != 0) {
+              connection.write(packets.getWrongPasswordChat());
+            } else {
+              connection.closeWith(packets.getWrongPassword());
+            }
+          } else {
+            sendMessage();
+          }
+          break;
+        case "/totp":
+        case "/2fa":
+          if (args.length >= 2 && totp) {
+            if (verifier.isValidCode(playerInfo.totpToken, args[1])) {
+              finish();
+            } else {
+              sendMessage();
+            }
+          } else {
+            sendMessage();
+          }
+          break;
+        default:
+          sendMessage();
+          break;
+      }
+    }
+    return true;
+  }
+
+  @Override
+  public void onSpawn() {
+    virtualServer.loginComplete(this);
+    connection.write(packets.getAuthPosition());
+    connection.write(packets.getStaticWorldPacket());
+    connection.write(packets.getNoAbilities());
+    if (playerInfo == null) {
+      checkIp();
+    } else {
+      checkCase();
+    }
+    sendMessage();
+    connection.flush();
+  }
+
+  public static RegisteredPlayer fetchInfo(Database database, String nickname) {
+    return database.getItem(
+        Settings.IMP.AUTH.TABLE,
+        ImmutableMap.of("lowercaseNickname", nickname),
+        RegisteredPlayer.class);
+  }
+
+  private RegisteredPlayer fetchInfo(String nickname) {
+    return fetchInfo(database, nickname);
+  }
+
+  private boolean checkPassword(String password) {
+    return BCrypt.verifyer().verify(
+        password.getBytes(StandardCharsets.UTF_8),
+        playerInfo.hash.getBytes(StandardCharsets.UTF_8)
+    ).verified;
+  }
+
+  private void checkIp() {
+    List<RegisteredPlayer> alreadyRegistered = database.getItems(
+        Settings.IMP.AUTH.TABLE,
+        ImmutableMap.of("ip", ip),
+        RegisteredPlayer.class
+    );
+
+    AtomicInteger sizeOfValid = new AtomicInteger(alreadyRegistered.size());
+    long checkDate = System.currentTimeMillis() - Settings.IMP.AUTH.IP_LIMIT_VALID_TIME;
+    Map<String, Object> clearIpMap = ImmutableMap.of("ip", "");
+
+    alreadyRegistered.stream()
+        .filter(e -> e.regdate < checkDate)
+        .map(e -> ImmutableMap.of("lowercaseNickname", (Object) e.lowercaseNickname))
+        .forEach(e -> {
+          database.updateMap(
+              Settings.IMP.AUTH.TABLE, e, clearIpMap
+          );
+          sizeOfValid.decrementAndGet();
+        });
+
+    if (sizeOfValid.get() >= Settings.IMP.AUTH.IP_LIMIT_REGISTRATIONS) {
+      connection.closeWith(packets.getIpLimit());
+    }
+  }
+
+  private void checkCase() {
+    if (!player.getUsername().equals(playerInfo.nickname)) {
+      connection.closeWith(packets.getWrongNicknameCase());
+    }
+  }
+
+  private void register(String password) {
+    String hash = genHash(password);
+
+    RegisteredPlayer registeredPlayer = new RegisteredPlayer(
+        player.getUsername(),
+        lowercaseNickname,
+        hash,
+        ip,
+        "",
+        System.currentTimeMillis()
+    );
+
+    database.insert(
+        Settings.IMP.AUTH.TABLE,
+        registeredPlayer,
+        RegisteredPlayer.class,
+        false
+    );
+  }
+
+  private void finishOrTotp() {
+    if (playerInfo.totpToken.isEmpty()) {
+      finish();
+    } else {
+      totp = true;
+      sendMessage();
+    }
+  }
+
+  private void finish() {
+    disconnected();
+    connection.setSessionHandler(originalHandler);
+    ((LoginSessionHandler) originalHandler).initialize(player);
+    virtualServer.getElytraProxy().cacheAuthUser(player);
+  }
+
+  private void sendMessage() {
+    if (totp) {
+      connection.write(packets.getTotpChat());
+    } else if (playerInfo == null) {
+      connection.write(packets.getRegisterChat());
+    } else {
+      connection.write(packets.getLoginChat());
+    }
+  }
+
+  public static String genHash(String password) {
+    return BCrypt.withDefaults().hashToString(
+        Settings.IMP.AUTH.BCRYPT_COST,
+        password.toCharArray()
+    );
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/auth/model/RegisteredPlayer.java b/proxy/src/main/java/net/elytrium/elytraproxy/auth/model/RegisteredPlayer.java
new file mode 100644
index 00000000..94fff09d
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/auth/model/RegisteredPlayer.java
@@ -0,0 +1,48 @@
+/*
+ * Copyright (C) 2021 Elytrium
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.auth.model;
+
+import java.util.Map;
+import lombok.AllArgsConstructor;
+import lombok.Getter;
+import lombok.NoArgsConstructor;
+import net.elytrium.elytraproxy.database.DatabaseItem;
+
+@NoArgsConstructor
+@AllArgsConstructor
+public class RegisteredPlayer {
+  public String nickname;
+  public String lowercaseNickname;
+  public String hash;
+  public String ip;
+  public String totpToken;
+  public Long regdate;
+
+  private static final Map<String, String> tableInfo = Map.of(
+      "nickname", "VARCHAR(16)",
+      "lowercaseNickname", "VARCHAR(16)",
+      "hash", "VARCHAR(128)",
+      "ip", "VARCHAR(15)",
+      "totpToken", "VARCHAR(32)",
+      "regdate", "BIGINT UNSIGNED"
+  );
+
+  private static final String primaryKey = "lowercaseNickname";
+
+  @Getter private static final DatabaseItem databaseItem = new DatabaseItem(tableInfo, primaryKey);
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/CaptchaGeneration.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/CaptchaGeneration.java
new file mode 100644
index 00000000..f989c6fe
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/CaptchaGeneration.java
@@ -0,0 +1,157 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.botfilter;
+
+import java.awt.Color;
+import java.awt.Font;
+import java.awt.FontFormatException;
+import java.awt.GraphicsEnvironment;
+import java.awt.image.BufferedImage;
+import java.io.File;
+import java.io.IOException;
+import java.util.ArrayList;
+import java.util.List;
+import java.util.concurrent.Executors;
+import java.util.concurrent.ThreadLocalRandom;
+import java.util.concurrent.ThreadPoolExecutor;
+import java.util.concurrent.atomic.AtomicInteger;
+import javax.imageio.ImageIO;
+import lombok.SneakyThrows;
+import lombok.experimental.UtilityClass;
+import net.elytrium.elytraproxy.botfilter.generator.CaptchaPainter;
+import net.elytrium.elytraproxy.botfilter.generator.map.CraftMapCanvas;
+import net.elytrium.elytraproxy.botfilter.generator.map.MapPalette;
+import net.elytrium.elytraproxy.botfilter.cache.CachedCaptcha;
+import net.elytrium.elytraproxy.virtual.protocol.packet.MapDataPacket;
+import net.elytrium.elytraproxy.config.Settings;
+import org.apache.logging.log4j.LogManager;
+import org.apache.logging.log4j.Logger;
+
+/**
+ * @author Leymooo
+ * @author hevav
+ */
+@UtilityClass
+public class CaptchaGeneration {
+
+  private static final CraftMapCanvas cachedBackgroundMap = new CraftMapCanvas();
+  private final Logger logger = LogManager.getLogger("ElytraProxy");
+  private final CaptchaPainter painter = new CaptchaPainter();
+  private final List<Font> fonts = new ArrayList<>();
+  private final AtomicInteger fontCounter = new AtomicInteger(0);
+  private final AtomicInteger colorCounter = new AtomicInteger(0);
+
+  public void init() {
+    try {
+      if (!Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.BACKPLATE_PATH.equals("")) {
+        cachedBackgroundMap.drawImage(0, 0,
+            ImageIO.read(new File(Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.BACKPLATE_PATH)));
+      }
+    } catch (IOException e) {
+      e.printStackTrace();
+    }
+
+    int fontSize = Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.FONT_SIZE;
+
+    fonts.clear();
+    if (Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.USE_STANDARD_FONTS) {
+      fonts.add(new Font(Font.SANS_SERIF, Font.PLAIN, fontSize));
+      fonts.add(new Font(Font.SERIF, Font.PLAIN, fontSize));
+      fonts.add(new Font(Font.MONOSPACED, Font.BOLD, fontSize));
+    }
+
+    GraphicsEnvironment ge = GraphicsEnvironment.getLocalGraphicsEnvironment();
+
+    if (Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.FONTS_PATH != null) {
+      Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.FONTS_PATH.forEach(fontFile -> {
+        try {
+          if (!fontFile.equals("")) {
+            logger.info("Loading font " + fontFile);
+            Font font = Font.createFont(Font.TRUETYPE_FONT, new File(fontFile));
+            ge.registerFont(font);
+            fonts.add(font.deriveFont(Font.PLAIN).deriveFont((float) fontSize));
+          }
+        } catch (FontFormatException | IOException e) {
+          e.printStackTrace();
+        }
+      });
+    }
+
+    new Thread(CaptchaGeneration::generateImages).start();
+  }
+
+  @SneakyThrows
+  @SuppressWarnings("StatementWithEmptyBody")
+  public void generateImages() {
+    ThreadPoolExecutor ex =
+        (ThreadPoolExecutor) Executors.newFixedThreadPool(
+            Runtime.getRuntime().availableProcessors());
+    for (int i = 100; i <= 999; i++) {
+      ex.execute(CaptchaGeneration::genNewPacket);
+    }
+
+    long start = System.currentTimeMillis();
+    while (ex.getActiveCount() != 0) {
+      // Busy wait
+    }
+
+    logger.info("Captcha generated in " + (System.currentTimeMillis() - start) + " ms.");
+    ex.shutdownNow();
+    System.gc();
+  }
+
+  public void genNewPacket() {
+    String answer = randomAnswer();
+    final CraftMapCanvas map = new CraftMapCanvas(cachedBackgroundMap.getCanvas());
+    int fontNumber = fontCounter.getAndIncrement();
+    if (fontNumber >= fonts.size()) {
+      fontNumber = 0;
+      fontCounter.set(0);
+    }
+    BufferedImage image =
+        painter.draw(fonts.get(fontNumber), randomNotWhiteColor(), answer);
+    map.drawImage(0, 0, image);
+    MapDataPacket packet = new MapDataPacket(0, (byte) 0, map.getMapData());
+    CachedCaptcha.createCaptchaPacket(packet, answer);
+  }
+
+  private Color randomNotWhiteColor() {
+    MapPalette.Color[] colors = MapPalette.getColors();
+
+    int index = colorCounter.getAndIncrement();
+    if (index >= colors.length) {
+      index = 0;
+      colorCounter.set(0);
+    }
+
+    return colors[index].toJava();
+  }
+
+  private String randomAnswer() {
+    int length = Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.LENGTH;
+    String pattern = Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.PATTERN;
+
+    char[] text = new char[length];
+    for (int i = 0; i < length; i++) {
+      text[i] = pattern.charAt(ThreadLocalRandom.current().nextInt(pattern.length()));
+    }
+    return new String(text);
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/cache/CachedCaptcha.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/cache/CachedCaptcha.java
new file mode 100644
index 00000000..d6395cd0
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/cache/CachedCaptcha.java
@@ -0,0 +1,48 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.botfilter.cache;
+
+import java.util.ArrayList;
+import java.util.List;
+import java.util.concurrent.atomic.AtomicInteger;
+import net.elytrium.elytraproxy.virtual.protocol.packet.MapDataPacket;
+
+/**
+ * @author Leymooo
+ * @author hevav
+ */
+public class CachedCaptcha {
+
+  private static final List<CaptchaHandler> captchas = new ArrayList<>();
+  private static final AtomicInteger counterAtomic = new AtomicInteger(0);
+
+  public static void createCaptchaPacket(MapDataPacket map, String answer) {
+    captchas.add(new CaptchaHandler(map, answer));
+  }
+
+  public static CaptchaHandler randomCaptcha() {
+    int counter = counterAtomic.incrementAndGet();
+    if (counter >= captchas.size()) {
+      counter = 0;
+      counterAtomic.set(0);
+    }
+    return captchas.get(counter);
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/cache/CaptchaHandler.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/cache/CaptchaHandler.java
new file mode 100644
index 00000000..3fd7ee02
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/cache/CaptchaHandler.java
@@ -0,0 +1,33 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.botfilter.cache;
+
+import lombok.AllArgsConstructor;
+import lombok.Getter;
+import lombok.NoArgsConstructor;
+import net.elytrium.elytraproxy.virtual.protocol.packet.MapDataPacket;
+
+@NoArgsConstructor
+@AllArgsConstructor
+@Getter
+public class CaptchaHandler {
+  private MapDataPacket map;
+  private String answer;
+}
\ No newline at end of file
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/CaptchaPainter.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/CaptchaPainter.java
new file mode 100644
index 00000000..2af5c118
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/CaptchaPainter.java
@@ -0,0 +1,220 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.botfilter.generator;
+
+import java.awt.Color;
+import java.awt.Font;
+import java.awt.Graphics;
+import java.awt.Graphics2D;
+import java.awt.Rectangle;
+import java.awt.RenderingHints;
+import java.awt.font.GlyphVector;
+import java.awt.geom.AffineTransform;
+import java.awt.geom.Point2D;
+import java.awt.geom.Rectangle2D;
+import java.awt.image.BufferedImage;
+import java.awt.image.ConvolveOp;
+import java.awt.image.Kernel;
+import java.util.Random;
+import net.elytrium.elytraproxy.config.Settings;
+
+public class CaptchaPainter {
+
+  private static final int width = 128;
+  private static final int height = 128;
+  private final Color background = Color.WHITE;
+  private final Random rnd = new Random();
+
+  public BufferedImage draw(Font font, Color fGround, String text) {
+    if (font == null) {
+      throw new IllegalArgumentException("Font can not be null.");
+    }
+    if (fGround == null) {
+      throw new IllegalArgumentException("Foreground color can not be null.");
+    }
+    if (text == null || text.length() < 1) {
+      throw new IllegalArgumentException("No text given.");
+    }
+
+    BufferedImage img = createImage();
+
+    final Graphics g = img.getGraphics();
+    try {
+      final Graphics2D g2 = configureGraphics(g, font, fGround);
+      draw(g2, text);
+    } finally {
+      g.dispose();
+    }
+
+    img = postProcess(img);
+
+    return img;
+  }
+
+  protected void draw(Graphics2D g, String text) {
+    final GlyphVector vector = g.getFont().createGlyphVector(g.getFontRenderContext(), text);
+
+    transform(g, text, vector);
+
+    final Rectangle bounds = vector.getPixelBounds(null, 0, height);
+    final float bw = (float) bounds.getWidth();
+    final float bh = (float) bounds.getHeight();
+
+    final boolean outlineEnabled = Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.FONT_OUTLINE;
+
+    final float wr = width / bw
+        * (rnd.nextFloat() / 20 + (outlineEnabled ? 0.89f : 0.92f))
+        * 1;
+    final float hr = height / bh
+        * (rnd.nextFloat() / 20 + (outlineEnabled ? 0.68f : 0.75f))
+        * 1;
+    g.translate((width - bw * wr) / 2, (height - bh * hr) / 2);
+    g.scale(wr, hr);
+
+    final float bx = (float) bounds.getX();
+    final float by = (float) bounds.getY();
+    if (outlineEnabled) {
+      g.draw(vector.getOutline(Math.signum(rnd.nextFloat() - 0.5f) * 1
+          * width / 200 - bx, Math.signum(rnd.nextFloat() - 0.5f) * 1
+          * height / 70 + height - by));
+    }
+    g.drawGlyphVector(vector, -bx, height - by);
+  }
+
+  protected BufferedImage createImage() {
+    return new BufferedImage(width, height, BufferedImage.TYPE_3BYTE_BGR);
+  }
+
+  protected Graphics2D configureGraphics(Graphics g, Font font, Color fGround) {
+    if (!(g instanceof Graphics2D)) {
+      throw new IllegalStateException("Graphics (" + g
+          + ") that is not an instance of Graphics2D.");
+    }
+    final Graphics2D g2 = (Graphics2D) g;
+
+    configureGraphicsQuality(g2);
+
+    g2.setColor(fGround);
+    g2.setBackground(background);
+    g2.setFont(font);
+
+    g2.clearRect(0, 0, width, height);
+
+    return g2;
+  }
+
+  protected void configureGraphicsQuality(Graphics2D g2) {
+    g2.setRenderingHint(RenderingHints.KEY_TEXT_ANTIALIASING,
+        RenderingHints.VALUE_TEXT_ANTIALIAS_ON);
+    g2.setRenderingHint(RenderingHints.KEY_FRACTIONALMETRICS,
+        RenderingHints.VALUE_FRACTIONALMETRICS_ON);
+    g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,
+        RenderingHints.VALUE_ANTIALIAS_ON);
+    g2.setRenderingHint(RenderingHints.KEY_COLOR_RENDERING,
+        RenderingHints.VALUE_COLOR_RENDER_QUALITY);
+    g2.setRenderingHint(RenderingHints.KEY_DITHERING,
+        RenderingHints.VALUE_DITHER_ENABLE);
+    g2.setRenderingHint(RenderingHints.KEY_INTERPOLATION,
+        RenderingHints.VALUE_INTERPOLATION_BICUBIC);
+    g2.setRenderingHint(RenderingHints.KEY_ALPHA_INTERPOLATION,
+        RenderingHints.VALUE_ALPHA_INTERPOLATION_QUALITY);
+    g2.setRenderingHint(RenderingHints.KEY_RENDERING,
+        RenderingHints.VALUE_RENDER_QUALITY);
+
+  }
+
+  protected void transform(Graphics2D g, String text, GlyphVector v) {
+    final int glyphNum = v.getNumGlyphs();
+
+    Point2D prePos = null;
+    Rectangle2D preBounds = null;
+
+    double rotateCur = (rnd.nextDouble() - 0.5) * Math.PI / 8;
+    double rotateStep = Math.signum(rotateCur)
+        * (rnd.nextDouble() * 3 * Math.PI / 8 / glyphNum);
+    final boolean rotateEnabled = Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.FONT_ROTATE;
+
+    for (int fi = 0; fi < glyphNum; fi++) {
+      if (rotateEnabled) {
+        final AffineTransform tr = AffineTransform
+            .getRotateInstance(rotateCur);
+        if (rnd.nextDouble() < 0.25) {
+          rotateStep *= -1;
+        }
+        rotateCur += rotateStep;
+        v.setGlyphTransform(fi, tr);
+      }
+      final Point2D pos = v.getGlyphPosition(fi);
+      final Rectangle2D bounds = v.getGlyphVisualBounds(fi).getBounds2D();
+      Point2D newPos;
+      if (prePos == null) {
+        newPos = new Point2D.Double(pos.getX() - bounds.getX(),
+            pos.getY());
+      } else {
+        newPos = new Point2D.Double(
+            preBounds.getMaxX()
+                + pos.getX()
+                - bounds.getX()
+                - Math.min(preBounds.getWidth(),
+                bounds.getWidth())
+                * (rnd.nextDouble() / 20 + (rotateEnabled ? 0.27
+                : 0.1)), pos.getY());
+      }
+      v.setGlyphPosition(fi, newPos);
+      prePos = newPos;
+      preBounds = v.getGlyphVisualBounds(fi).getBounds2D();
+    }
+  }
+
+  protected BufferedImage postProcess(BufferedImage img) {
+    if (Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.FONT_RIPPLE) {
+      final Rippler.AxisConfig vertical = new Rippler.AxisConfig(
+          rnd.nextDouble() * 2 * Math.PI, (1 + rnd.nextDouble() * 2)
+          * Math.PI, img.getHeight() / 10.0);
+      final Rippler.AxisConfig horizontal = new Rippler.AxisConfig(
+          rnd.nextDouble() * 2 * Math.PI, (2 + rnd.nextDouble() * 2)
+          * Math.PI, img.getWidth() / 100.0);
+      final Rippler op = new Rippler(vertical, horizontal);
+
+      img = op.filter(img, createImage());
+    }
+
+    if (Settings.IMP.ANTIBOT.CAPTCHA_GENERATOR.FONT_BLUR) {
+      final float[] blurArray = new float[9];
+      fillBlurArray(blurArray);
+      final ConvolveOp op = new ConvolveOp(new Kernel(3, 3, blurArray),
+          ConvolveOp.EDGE_NO_OP, null);
+
+      img = op.filter(img, createImage());
+    }
+    return img;
+  }
+
+  protected void fillBlurArray(float[] array) {
+    float sum = 0;
+    for (int fi = 0; fi < array.length; fi++) {
+      array[fi] = rnd.nextFloat();
+      sum += array[fi];
+    }
+    for (int fi = 0; fi < array.length; fi++) {
+      array[fi] /= sum;
+    }
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/Rippler.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/Rippler.java
new file mode 100644
index 00000000..39005a9d
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/Rippler.java
@@ -0,0 +1,175 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.botfilter.generator;
+
+import java.awt.image.BufferedImage;
+
+/**
+ * A filter to generate ripple (wave) effected images. Uses a transformed sinus
+ * wave for this. This class is thread safe.
+ *
+ * @author akiraly
+ */
+public class Rippler {
+
+  /**
+   * Class to respresent wave tranforming information for an axis.
+   */
+  public static class AxisConfig {
+
+    private final double start;
+
+    private final double length;
+
+    private final double amplitude;
+
+    /**
+     * Constructor.
+     *
+     * @param start     the starting x offset to generate wave values. Should be
+     *                  between 0 and 2 * {@link Math#PI}.
+     * @param length    the length of x to be used to generate wave values.
+     *                  Should be between 0 and 4 * {@link Math#PI}.
+     * @param amplitude the maximum y value, if it is too big, some
+     *                  important parts of the image (like the text) can "wave" out on the
+     *                  top or on the bottom of the image.
+     */
+    public AxisConfig(double start, double length, double amplitude) {
+      this.start = normalize(start, 2);
+      this.length = normalize(length, 4);
+      this.amplitude = amplitude;
+    }
+
+    /**
+     * Normalizes parameter to fall into [0, multi * {@link Math#PI}].
+     *
+     * @param a     to be normalized
+     * @param multi multiplicator used for end value
+     * @return normalized value
+     */
+    protected double normalize(double a, int multi) {
+      final double piMulti = multi * Math.PI;
+
+      a = Math.abs(a);
+      final double d = Math.floor(a / piMulti);
+
+      return a - d * piMulti;
+    }
+
+    /**
+     * @return wave part start value
+     */
+    public double getStart() {
+      return start;
+    }
+
+    /**
+     * @return wave part length
+     */
+    public double getLength() {
+      return length;
+    }
+
+    /**
+     * @return amplitude used to transform the wave part
+     */
+    public double getAmplitude() {
+      return amplitude;
+    }
+  }
+
+  private final AxisConfig vertical;
+
+  private final AxisConfig horizontal;
+
+  /**
+   * Constructor.
+   *
+   * @param vertical   config to calculate waving deltas from x axis (so to
+   *                   modify y values), not null
+   * @param horizontal config to calculate waving deltas from y axis (so to
+   *                   modify x values), not null
+   */
+  public Rippler(AxisConfig vertical, AxisConfig horizontal) {
+    this.vertical = vertical;
+    this.horizontal = horizontal;
+  }
+
+  /**
+   * Draws a rippled (waved) variant of source into destination.
+   *
+   * @param src  to be transformed, not null
+   * @param dest to hold the result, not null
+   * @return dest is returned
+   */
+  public BufferedImage filter(BufferedImage src, BufferedImage dest) {
+    final int width = src.getWidth();
+    final int height = src.getHeight();
+
+    final int[] verticalDelta = calcDeltaArray(vertical, width);
+
+    final int[] horizontalDelta = calcDeltaArray(horizontal, height);
+
+    for (int x = 0; x < width; x++) {
+      for (int y = 0; y < height; y++) {
+        final int ny = (y + verticalDelta[x] + height) % height;
+        final int nx = (x + horizontalDelta[ny] + width) % width;
+        dest.setRGB(nx, ny, src.getRGB(x, y));
+      }
+    }
+
+    return dest;
+  }
+
+  /**
+   * Calculates wave delta array.
+   *
+   * @param axisConfig config object to transform the wave, not null
+   * @param num        number of points needed, positive
+   * @return the calculated num length delta array
+   */
+  protected int[] calcDeltaArray(AxisConfig axisConfig, int num) {
+    final int[] delta = new int[num];
+
+    final double start = axisConfig.getStart();
+    final double period = axisConfig.getLength() / num;
+    final double amplitude = axisConfig.getAmplitude();
+
+    for (int fi = 0; fi < num; fi++) {
+      delta[fi] = (int) Math.round(amplitude * Math.sin(start + fi * period));
+    }
+
+    return delta;
+  }
+
+  /**
+   * @return vertical config, not null
+   */
+  public AxisConfig getVertical() {
+    return vertical;
+  }
+
+  /**
+   * @return horizontal config, not null
+   */
+  public AxisConfig getHorizontal() {
+    return horizontal;
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/map/CraftMapCanvas.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/map/CraftMapCanvas.java
new file mode 100644
index 00000000..65cc30c6
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/map/CraftMapCanvas.java
@@ -0,0 +1,68 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.botfilter.generator.map;
+
+import java.awt.image.BufferedImage;
+import java.util.Arrays;
+import lombok.Getter;
+import net.elytrium.elytraproxy.virtual.protocol.packet.MapDataPacket;
+
+@Getter
+public class CraftMapCanvas {
+
+  private final byte[] canvas;
+  private static final int MAP_SIZE = 16384; //128x128
+
+  public CraftMapCanvas() {
+    this.canvas = new byte[MAP_SIZE];
+    Arrays.fill(this.canvas, MapPalette.WHITE);
+  }
+
+  public CraftMapCanvas(byte[] canvas) {
+    final byte[] canvasBuf = new byte[MAP_SIZE];
+    System.arraycopy(canvas, 0, canvasBuf, 0, MAP_SIZE);
+    this.canvas = canvasBuf;
+  }
+
+  public void setPixel(int x, int y, byte color) {
+    if (x >= 0 && y >= 0 && x < 128 && y < 128) {
+      this.canvas[y * 128 + x] = color;
+    }
+  }
+
+  public void drawImage(int x, int y, BufferedImage image) {
+    int[] bytes = MapPalette.imageToBytes(image);
+    int width = image.getWidth(null);
+    int height = image.getHeight(null);
+
+    for (int x2 = 0; x2 < width; ++x2) {
+      for (int y2 = 0; y2 < height; ++y2) {
+        byte color = (byte) bytes[y2 * width + x2];
+        if (color != MapPalette.WHITE) {
+          this.setPixel(x + x2, y + y2, color);
+        }
+      }
+    }
+  }
+
+  public MapDataPacket.MapData getMapData() {
+    return new MapDataPacket.MapData(128, 128, 0, 0, this.canvas);
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/map/MapPalette.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/map/MapPalette.java
new file mode 100644
index 00000000..7e77910b
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/generator/map/MapPalette.java
@@ -0,0 +1,183 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.botfilter.generator.map;
+
+import java.awt.image.BufferedImage;
+import java.util.Map;
+import java.util.concurrent.ConcurrentHashMap;
+import lombok.AllArgsConstructor;
+import lombok.Getter;
+
+public final class MapPalette {
+
+  @Getter
+  private static final Color[] colors = new Color[] {
+      c(0, 0, 0), c(0, 0, 0), c(0, 0, 0), c(0, 0, 0),
+      c(89, 125, 39), c(109, 153, 48), c(127, 178, 56), c(67, 94, 29),
+      c(174, 164, 115), c(213, 201, 140), c(247, 233, 163), c(130, 123, 86),
+      c(140, 140, 140), c(171, 171, 171), c(199, 199, 199), c(105, 105, 105),
+      c(180, 0, 0), c(220, 0, 0), c(255, 0, 0), c(135, 0, 0),
+      c(112, 112, 180), c(138, 138, 220), c(160, 160, 255), c(84, 84, 135),
+      c(117, 117, 117), c(144, 144, 144), c(167, 167, 167), c(88, 88, 88),
+      c(0, 87, 0), c(0, 106, 0), c(0, 124, 0), c(0, 65, 0),
+      c(180, 180, 180), c(220, 220, 220), c(255, 255, 255), c(135, 135, 135),
+      c(115, 118, 129), c(141, 144, 158), c(164, 168, 184), c(86, 88, 97),
+      c(106, 76, 54), c(130, 94, 66), c(151, 109, 77), c(79, 57, 40),
+      c(79, 79, 79), c(96, 96, 96), c(112, 112, 112), c(59, 59, 59),
+      c(45, 45, 180), c(55, 55, 220), c(64, 64, 255), c(33, 33, 135),
+      c(100, 84, 50), c(123, 102, 62), c(143, 119, 72), c(75, 63, 38),
+      c(180, 177, 172), c(220, 217, 211), c(255, 252, 245), c(135, 133, 129),
+      c(152, 89, 36), c(186, 109, 44), c(216, 127, 51), c(114, 67, 27),
+      c(125, 53, 152), c(153, 65, 186), c(178, 76, 216), c(94, 40, 114),
+      c(72, 108, 152), c(88, 132, 186), c(102, 153, 216), c(54, 81, 114),
+      c(161, 161, 36), c(197, 197, 44), c(229, 229, 51), c(121, 121, 27),
+      c(89, 144, 17), c(109, 176, 21), c(127, 204, 25), c(67, 108, 13),
+      c(170, 89, 116), c(208, 109, 142), c(242, 127, 165), c(128, 67, 87),
+      c(53, 53, 53), c(65, 65, 65), c(76, 76, 76), c(40, 40, 40),
+      c(108, 108, 108), c(132, 132, 132), c(153, 153, 153), c(81, 81, 81),
+      c(53, 89, 108), c(65, 109, 132), c(76, 127, 153), c(40, 67, 81),
+      c(89, 44, 125), c(109, 54, 153), c(127, 63, 178), c(67, 33, 94),
+      c(36, 53, 125), c(44, 65, 153), c(51, 76, 178), c(27, 40, 94),
+      c(72, 53, 36), c(88, 65, 44), c(102, 76, 51), c(54, 40, 27),
+      c(72, 89, 36), c(88, 109, 44), c(102, 127, 51), c(54, 67, 27),
+      c(108, 36, 36), c(132, 44, 44), c(153, 51, 51), c(81, 27, 27),
+      c(17, 17, 17), c(21, 21, 21), c(25, 25, 25), c(13, 13, 13),
+      c(176, 168, 54), c(215, 205, 66), c(250, 238, 77), c(132, 126, 40),
+      c(64, 154, 150), c(79, 188, 183), c(92, 219, 213), c(48, 115, 112),
+      c(52, 90, 180), c(63, 110, 220), c(74, 128, 255), c(39, 67, 135),
+      c(0, 153, 40), c(0, 187, 50), c(0, 217, 58), c(0, 114, 30),
+      c(91, 60, 34), c(111, 74, 42), c(129, 86, 49), c(68, 45, 25),
+      c(79, 1, 0), c(96, 1, 0), c(112, 2, 0), c(59, 1, 0),
+  };
+
+  public static final byte WHITE = 34;
+
+  private static final Map<Color, Byte> colorToIndexMap = new ConcurrentHashMap<>();
+
+  private static Color c(int r, int g, int b) {
+    return new Color(r, g, b);
+  }
+
+  private static double getDistance(Color c1, Color c2) {
+    double rmean = (double) (c1.getRed() + c2.getRed()) / 2.0D;
+    double r = c1.getRed() - c2.getRed();
+    double g = c1.getGreen() - c2.getGreen();
+    int b = c1.getBlue() - c2.getBlue();
+    double weightR = 2.0D + rmean / 256.0D;
+    double weightG = 4.0D;
+    double weightB = 2.0D + (255.0D - rmean) / 256.0D;
+
+    return weightR * r * r + weightG * g * g + weightB * (double) b * (double) b;
+  }
+
+  /**
+   * Convert an Image to a byte[] using the palette.
+   *
+   * @param image The image to convert.
+   * @return A byte[] containing the pixels of the image.
+   */
+  public static int[] imageToBytes(final BufferedImage image) {
+    int[] result = image.getRGB(0, 0, image.getWidth(), image.getHeight(),
+        null, 0, image.getWidth());
+    for (int i = 0; i < result.length; ++i) {
+      result[i] = tryFastMatchColor(result[i]);
+    }
+    return result;
+  }
+
+  public static byte tryFastMatchColor(int rgb) {
+    if (getAlpha(rgb) < 128) {
+      return WHITE;
+    }
+
+    Color color = simplifyRGB(rgb);
+    Byte colorId = colorToIndexMap.get(color);
+    if (colorId != null) {
+      return colorId;
+    } else {
+      return matchColor(color);
+    }
+  }
+
+  /**
+   * Get the index of the closest matching color in the palette to the given
+   * color.
+   *
+   * @param color The Color to match.
+   * @return The index in the palette.
+   */
+  public static byte matchColor(Color color) {
+    int index = 0;
+    double best = -1.0D;
+
+    for (int i = 4; i < colors.length; ++i) {
+      double distance = getDistance(color, colors[i]);
+
+      if (distance < best || best == -1.0D) {
+        best = distance;
+        index = i;
+      }
+    }
+
+    byte matched = (byte) (index < 128 ? index : -129 + (index - 127));
+    colorToIndexMap.put(color, matched);
+
+    return matched;
+  }
+
+  private static Color simplifyRGB(int rgb) {
+    int r = ((rgb & 0xff0000) >>> 16);
+    int g = ((rgb & 0xff00) >>> 8);
+    int b = (rgb & 0xff);
+
+    return new Color(r, g, b);
+  }
+
+  private static int getAlpha(int rgb) {
+    return (rgb & 0xff000000) >>> 24;
+  }
+
+  @AllArgsConstructor
+  @Getter
+  public static class Color {
+    private final int red;
+    private final int green;
+    private final int blue;
+
+    @Override
+    public int hashCode() {
+      return (red << 16) | (green << 8) | (blue);
+    }
+
+    @Override
+    public boolean equals(Object otherColor) {
+      if (otherColor instanceof Color) {
+        Color checkColor = (Color) otherColor;
+        return checkColor.red == red && checkColor.blue == blue && checkColor.green == green;
+      } else {
+        return false;
+      }
+    }
+
+    public java.awt.Color toJava() {
+      return new java.awt.Color(red, green, blue);
+    }
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/handler/BotFilterSessionHandler.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/handler/BotFilterSessionHandler.java
new file mode 100644
index 00000000..bd098798
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/handler/BotFilterSessionHandler.java
@@ -0,0 +1,358 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.botfilter.handler;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.connection.MinecraftConnection;
+import com.velocitypowered.proxy.connection.client.ConnectedPlayer;
+import com.velocitypowered.proxy.connection.client.LoginSessionHandler;
+import com.velocitypowered.proxy.protocol.MinecraftPacket;
+import com.velocitypowered.proxy.protocol.packet.Chat;
+import com.velocitypowered.proxy.protocol.packet.ClientSettings;
+import com.velocitypowered.proxy.protocol.packet.PluginMessage;
+import com.velocitypowered.proxy.protocol.util.PluginMessageUtil;
+import io.netty.buffer.ByteBuf;
+import java.util.Objects;
+import lombok.Getter;
+import lombok.Setter;
+import net.elytrium.elytraproxy.botfilter.cache.CachedCaptcha;
+import net.elytrium.elytraproxy.botfilter.cache.CaptchaHandler;
+import net.elytrium.elytraproxy.config.Settings;
+import net.elytrium.elytraproxy.stats.Statistics;
+import net.elytrium.elytraproxy.virtual.protocol.packet.SetExp;
+import net.elytrium.elytraproxy.virtual.server.ServerPackets;
+import net.elytrium.elytraproxy.virtual.server.VirtualServer;
+import net.elytrium.elytraproxy.virtual.server.world.chunk.SimpleChunk;
+import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
+import org.apache.logging.log4j.Logger;
+
+@Getter
+public class BotFilterSessionHandler extends FallingCheckHandler {
+
+  public static final long TOTAL_TICKS = Settings.IMP.ANTIBOT.FALLING_CHECK_TICKS;
+  private static final long TOTAL_TIME = (TOTAL_TICKS * 50) - 100;
+
+  private final Statistics statistics;
+  private final Logger logger;
+  private final ServerPackets packets;
+  private final MinecraftConnection connection;
+  private final MinecraftPacket fallingCheckPos;
+  private final MinecraftPacket fallingCheckChunk;
+  private final MinecraftPacket fallingCheckView;
+  private final double captchaY = Settings.IMP.ANTIBOT.CAPTCHA_COORDS.Y;
+  @Setter
+  private String captchaAnswer;
+  private int ignoredTicks = 0;
+  private long joinTime = System.currentTimeMillis();
+  private int attempts = Settings.IMP.ANTIBOT.CAPTCHA_ATTEMPTS;
+  private boolean startedListening = false;
+  private int nonValidPacketsSize = 0;
+  @Getter
+  private CheckState state = CheckState.valueOf(Settings.IMP.ANTIBOT.CHECK_STATE);
+  private boolean checkedBySettings = false;
+  private boolean checkedByBrand = false;
+
+  public BotFilterSessionHandler(ConnectedPlayer player, LoginSessionHandler originalHandler, VirtualServer virtualServer) {
+    super(player.getProtocolVersion(), player, originalHandler, virtualServer);
+    this.statistics = virtualServer.getElytraProxy().getStatistics();
+    this.logger = virtualServer.getElytraProxy().getLogger();
+    this.packets = virtualServer.getPackets();
+    this.connection = player.getConnection();
+    this.fallingCheckPos = packets.createPlayerPosAndLookPacket(validX, validY, validZ, 0, 0);
+    this.fallingCheckChunk = packets.createChunkDataPacket(
+        new SimpleChunk(Math.floorDiv(validX, 16), Math.floorDiv(validZ, 16)), validY);
+    this.fallingCheckView = packets.createUpdateViewPosition(validX, validZ);
+  }
+
+  @Override
+  public boolean handle(Chat chat) {
+    if (state == CheckState.CAPTCHA_POSITION || state == CheckState.ONLY_CAPTCHA) {
+      String message = chat.getMessage();
+      if (message.length() > 256) {
+        return false;
+      } else if (message.equals(captchaAnswer)) {
+        finishCheck();
+      } else if (--attempts != 0) {
+        sendCaptcha();
+      } else {
+        statistics.addBlockedBots();
+        connection.closeWith(packets.getCaptchaFailed());
+      }
+    }
+    return true;
+  }
+
+  @Override
+  public boolean handle(PluginMessage packet) {
+    if (PluginMessageUtil.isMcBrand(packet) && !checkedByBrand) {
+      logger.info("{} has client brand {}", player,
+          PluginMessageUtil.readBrandMessage(packet.content()));
+      checkedByBrand = true;
+    }
+    return true;
+  }
+
+  @Override
+  public boolean handle(ClientSettings packet) {
+    if ((!checkedBySettings) && Settings.IMP.ANTIBOT.CHECK_CLIENT_SETTINGS) {
+      if (packet.toString().contains("null")) {
+        logger.error("{} -> " + packet, player);
+        player.disconnect(
+            LegacyComponentSerializer
+                .legacyAmpersand()
+                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.CLIENT_CHECK_SETTINGS));
+        logger.error("{} has null in settings packet", player);
+        statistics.addBlockedConnection();
+        statistics.addBlockedBots();
+      } else if (!packet.isChatColors()) {
+        logger.error("{} -> " + packet, player);
+        player.disconnect(
+            LegacyComponentSerializer
+                .legacyAmpersand()
+                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.CLIENT_CHECK_SETTINGS_CHAT_COLOR));
+        logger.error("{} doesn't send isChatColors packet",
+            player);
+        statistics.addBlockedConnection();
+        statistics.addBlockedBots();
+      } else if (packet.getSkinParts() == 0) {
+        logger.error("{} -> " + packet, player);
+        player.disconnect(
+            LegacyComponentSerializer
+                .legacyAmpersand()
+                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.CLIENT_CHECK_SETTINGS_SKIN_PARTS));
+        logger.error("{} doesn't send skin parts packet",
+            player);
+        statistics.addBlockedConnection();
+        statistics.addBlockedBots();
+      }
+    }
+    checkedBySettings = true;
+    return true;
+  }
+
+  @Override
+  public void handleUnknown(ByteBuf packet) {
+    if (packet.readableBytes() > 2048) {
+      statistics.addBlockedBots();
+      connection.closeWith(packets.getTooBigPacket());
+    }
+  }
+
+  private void finishCheck() {
+    if (System.currentTimeMillis() - joinTime < TOTAL_TIME && state != CheckState.ONLY_CAPTCHA) {
+      if (state == CheckState.CAPTCHA_POSITION && ticks < TOTAL_TICKS) {
+        connection.write(packets.getResetSlot());
+        state = CheckState.ONLY_POSITION;
+      } else {
+        if (state == CheckState.CAPTCHA_ON_POSITION_FAILED) {
+          changeStateToCaptcha();
+        } else {
+          statistics.addBlockedBots();
+          connection.closeWith(packets.getFallingCheckFailed());
+        }
+      }
+      return;
+    }
+    kickIfCheckNotPassed();
+    state = CheckState.SUCCESSFULLY;
+    disconnected();
+    if ((Settings.IMP.AUTH.ONLINE_MODE_NEED_AUTH || !player.isOnlineMode())
+        && !Settings.IMP.ANTIBOT.NEED_TO_RECONNECT) {
+      connection.write(packets.getSuccessfulBotFilterChat());
+      ((LoginSessionHandler) originalHandler).authOrInitialize(player);
+    } else {
+      connection.closeWith(packets.getSuccessfulBotFilterDisconnect());
+    }
+    virtualServer.getElytraProxy().cacheSucceedUser(player);
+  }
+
+  @Override
+  public void onMove() {
+    if (!startedListening && state != CheckState.ONLY_CAPTCHA) {
+      if (x == validX && z == validZ) {
+        startedListening = true;
+        connection.write(packets.getAntiBotBrand());
+      }
+      if (nonValidPacketsSize > Settings.IMP.ANTIBOT.NON_VALID_POSITION_XZ_ATTEMPTS) {
+        fallingCheckFailed();
+        return;
+      }
+      lastY = validY;
+      nonValidPacketsSize++;
+    }
+    if (startedListening) {
+      if (lastY == captchaY || onGround) {
+        return;
+      }
+      if (state == CheckState.ONLY_CAPTCHA) {
+        if (lastY != y && waitingTeleportId == -1) {
+          setCaptchaPosition(true);
+        }
+        return;
+      }
+      if (lastY - y == 0) {
+        ignoredTicks++;
+        return;
+      }
+      if (ticks >= TOTAL_TICKS) {
+        if (state == CheckState.CAPTCHA_POSITION) {
+          changeStateToCaptcha();
+        } else {
+          finishCheck();
+        }
+        return;
+      }
+      // System.out.println("lastY=" + lastY + "; y=" + y + "; diff=" + (lastY - y) + ";" +
+      //    " need=" + getLoadedChunkSpeed(ticks) + "; ticks=" + ticks +
+      //    "; x=" + x + "; z=" + z + "; vx=" + validX + "; vz=" + validZ);
+      if (ignoredTicks > Settings.IMP.ANTIBOT.NON_VALID_POSITION_Y_ATTEMPTS) {
+        fallingCheckFailed();
+        return;
+      }
+      if ((x != validX && z != validZ) || checkY()) {
+        fallingCheckFailed();
+        return;
+      }
+      if (state == CheckState.CAPTCHA_POSITION && waitingTeleportId == -1) {
+        setCaptchaPosition(false);
+      }
+      if ((state == CheckState.CAPTCHA_ON_POSITION_FAILED || state == CheckState.ONLY_POSITION)) {
+        SetExp expBuf = packets.getExperience().get(ticks);
+        if (expBuf != null) {
+          connection.write(expBuf);
+        }
+      }
+      ticks++;
+    }
+  }
+
+  @Override
+  public void onSpawn() {
+    ((LoginSessionHandler) originalHandler).completeLoginProtocol(player, false);
+    virtualServer.loginComplete(this);
+    if (state == BotFilterSessionHandler.CheckState.ONLY_CAPTCHA) {
+      sendCaptcha();
+      connection.write(packets.getCaptchaPosition());
+      connection.write(packets.getStaticWorldPacket());
+    } else if (state == BotFilterSessionHandler.CheckState.CAPTCHA_POSITION) {
+      sendCaptcha();
+      sendFallingCheckPackets();
+    } else if (state == BotFilterSessionHandler.CheckState.ONLY_POSITION
+        || state == BotFilterSessionHandler.CheckState.CAPTCHA_ON_POSITION_FAILED) {
+      sendFallingCheckPackets();
+    }
+    connection.flush();
+  }
+
+  private void sendFallingCheckPackets() {
+    connection.write(fallingCheckPos);
+    if (connection.getProtocolVersion().isAfterOrEq(ProtocolVersion.MINECRAFT_1_14)) {
+      connection.write(fallingCheckView);
+    }
+    connection.write(fallingCheckChunk);
+  }
+
+  private void sendCaptcha() {
+    CaptchaHandler captchaHandler = CachedCaptcha.randomCaptcha();
+    String captchaAnswer = captchaHandler.getAnswer();
+    setCaptchaAnswer(captchaAnswer);
+    connection.write(packets.getSetSlot());
+    connection.write(captchaHandler.getMap());
+    connection.write(packets.getCheckingCaptchaChat());
+  }
+
+  private boolean checkY() {
+    double speed = getLoadedChunkSpeed(ticks);
+    return (Math.abs(lastY - y - speed) > Settings.IMP.ANTIBOT.MAX_VALID_POSITION_DIFFERENCE);
+  }
+
+  private void fallingCheckFailed() {
+    if (state == CheckState.CAPTCHA_ON_POSITION_FAILED) {
+      changeStateToCaptcha();
+      return;
+    }
+    statistics.addBlockedBots();
+    connection.closeWith(packets.getFallingCheckFailed());
+  }
+
+  private void setCaptchaPosition(boolean disableFall) {
+    connection.write(packets.getCaptchaPosition());
+    connection.write(packets.getStaticWorldPacket());
+    if (disableFall) {
+      connection.write(packets.getNoAbilities());
+    }
+    connection.flush();
+    waitingTeleportId = 9876;
+  }
+
+  private void changeStateToCaptcha() {
+    state = CheckState.ONLY_CAPTCHA;
+    joinTime = System.currentTimeMillis() + 3500;
+    setCaptchaPosition(true);
+    if (captchaAnswer == null) {
+      sendCaptcha();
+    }
+  }
+
+  private void kickIfCheckNotPassed() {
+    if ((!checkedBySettings) && Settings.IMP.ANTIBOT.CHECK_CLIENT_SETTINGS) {
+      player.disconnect(
+          LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.CLIENT_CHECK_SETTINGS));
+      statistics.addBlockedConnection();
+      statistics.addBlockedBots();
+    }
+    if ((!checkedByBrand) && Settings.IMP.ANTIBOT.CHECK_CLIENT_BRAND) {
+      player.disconnect(
+          LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.KICK.CLIENT_CHECK_BRAND));
+      statistics.addBlockedConnection();
+      statistics.addBlockedBots();
+    }
+  }
+
+  @Override
+  public boolean equals(Object o) {
+    if (this == o) {
+      return true;
+    }
+    if (o == null || getClass() != o.getClass()) {
+      return false;
+    }
+    BotFilterSessionHandler that = (BotFilterSessionHandler) o;
+    return player.getUsername().equals(that.player.getUsername());
+  }
+
+  @Override
+  public int hashCode() {
+    return Objects.hash(player.getUsername());
+  }
+
+  public enum CheckState {
+    ONLY_POSITION,
+    ONLY_CAPTCHA,
+    CAPTCHA_POSITION,
+    CAPTCHA_ON_POSITION_FAILED,
+    SUCCESSFULLY,
+    FAILED
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/handler/FallingCheckHandler.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/handler/FallingCheckHandler.java
new file mode 100644
index 00000000..5de8e7b5
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/handler/FallingCheckHandler.java
@@ -0,0 +1,139 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.botfilter.handler;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
+import com.velocitypowered.proxy.connection.client.ConnectedPlayer;
+import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
+import java.util.concurrent.ThreadLocalRandom;
+import net.elytrium.elytraproxy.config.Settings;
+import net.elytrium.elytraproxy.virtual.protocol.packet.Player;
+import net.elytrium.elytraproxy.virtual.protocol.packet.PlayerPosition;
+import net.elytrium.elytraproxy.virtual.protocol.packet.PlayerPositionAndLook;
+import net.elytrium.elytraproxy.virtual.protocol.packet.TeleportConfirm;
+import net.elytrium.elytraproxy.virtual.server.VirtualServer;
+import net.elytrium.elytraproxy.virtual.server.VirtualSessionHandler;
+
+@SuppressFBWarnings(value = "URF_UNREAD_PUBLIC_OR_PROTECTED_FIELD",
+    justification = "  teleportId       ")
+public abstract class FallingCheckHandler extends VirtualSessionHandler {
+  private static final double[] loadedChunkSpeedCache = new double[Settings.IMP.ANTIBOT.FALLING_CHECK_TICKS];
+
+  static {
+    for (int i = 0; i < Settings.IMP.ANTIBOT.FALLING_CHECK_TICKS; ++i) {
+      loadedChunkSpeedCache[i] = -((Math.pow(0.98, i) - 1) * 3.92);
+    }
+  }
+
+  public double x;
+  public double y;
+  public double z;
+  public boolean onGround = false;
+
+  public int teleportId = -1;
+
+  public int waitingTeleportId = 9876;
+
+  public double lastY;
+  public int validX;
+  public int validY;
+  public int validZ;
+  public int ticks = 1;
+
+  public final ProtocolVersion version;
+
+  public FallingCheckHandler(
+      ProtocolVersion version, ConnectedPlayer player,
+      MinecraftSessionHandler sessionHandler, VirtualServer virtualServer) {
+    super(player, sessionHandler, virtualServer);
+    this.version = version;
+    validX = ThreadLocalRandom.current().nextInt(16384) + 256;
+    validY = ThreadLocalRandom.current().nextInt(256);
+    validZ = ThreadLocalRandom.current().nextInt(16384) + 256;
+
+    x = validX;
+    y = validY;
+    z = validZ;
+  }
+
+  @Override
+  public String toString() {
+    throw new UnsupportedOperationException("Not supported yet.");
+  }
+
+  @Override
+  public boolean handle(Player player) {
+    this.onGround = player.isOnGround();
+    return true;
+  }
+
+  @Override
+  public boolean handle(PlayerPosition pos) {
+    x = pos.getX();
+    lastY = y;
+    y = pos.getY();
+    z = pos.getZ();
+    onGround = pos.isOnGround();
+    onMove();
+    return true;
+  }
+
+
+  @Override
+  public boolean handle(PlayerPositionAndLook posRot) {
+    if (version.isBeforeOrEq(ProtocolVersion.MINECRAFT_1_8)
+        && posRot.getX() == validX && posRot.getY() == validY && posRot.getZ() == validZ
+        && waitingTeleportId == 9876) {
+      ticks = 0;
+      y = -1;
+      lastY = -1;
+      waitingTeleportId = -1;
+    }
+    x = posRot.getX();
+    lastY = y;
+    y = posRot.getY();
+    z = posRot.getZ();
+    onGround = posRot.isOnGround();
+    onMove();
+    return true;
+  }
+
+  @Override
+  public boolean handle(TeleportConfirm confirm) {
+    if (confirm.getTeleportId() == waitingTeleportId) {
+      ticks = 0;
+      y = -1;
+      lastY = -1;
+      waitingTeleportId = -1;
+    }
+    return true;
+  }
+
+  public abstract void onMove();
+
+  public static double getLoadedChunkSpeed(int ticks) {
+    if (ticks == -1) return 0;
+    return loadedChunkSpeedCache[ticks];
+  }
+
+  @Override
+  public abstract void onSpawn();
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/BotFilterProtocol.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/BotFilterProtocol.java
deleted file mode 100644
index 24d2a5ad..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/BotFilterProtocol.java
+++ /dev/null
@@ -1,91 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.protocol;
-
-import static com.velocitypowered.api.network.ProtocolVersion.MINECRAFT_1_13;
-import static com.velocitypowered.api.network.ProtocolVersion.MINECRAFT_1_14;
-import static com.velocitypowered.api.network.ProtocolVersion.MINECRAFT_1_15;
-import static com.velocitypowered.api.network.ProtocolVersion.MINECRAFT_1_16;
-import static com.velocitypowered.api.network.ProtocolVersion.MINECRAFT_1_16_2;
-import static com.velocitypowered.api.network.ProtocolVersion.MINECRAFT_1_17;
-import static com.velocitypowered.api.network.ProtocolVersion.MINECRAFT_1_7_2;
-import static com.velocitypowered.api.network.ProtocolVersion.MINECRAFT_1_9;
-import static com.velocitypowered.proxy.protocol.StateRegistry.map;
-
-import com.velocitypowered.api.network.ProtocolVersion;
-import com.velocitypowered.proxy.protocol.StateRegistry;
-import net.elytrium.elytraproxy.botfilter.protocol.packet.JoinGame;
-import net.elytrium.elytraproxy.botfilter.protocol.packet.PlayerPositionAndLook;
-import net.elytrium.elytraproxy.botfilter.protocol.packet.world.ChunkData;
-import net.elytrium.elytraproxy.botfilter.protocol.packet.world.UpdateLight;
-import net.elytrium.elytraproxy.botfilter.protocol.packet.UpdateViewPosition;
-
-public class BotFilterProtocol {
-
-  public static void init() {
-    StateRegistry.BotFilter.clientbound.register(
-        JoinGame.class, JoinGame::new,
-        map(0x01, MINECRAFT_1_7_2, false),
-        map(0x23, MINECRAFT_1_9, false),
-        map(0x25, MINECRAFT_1_13, false),
-        map(0x25, MINECRAFT_1_14, false),
-        map(0x26, MINECRAFT_1_15, false),
-        map(0x25, MINECRAFT_1_16, false),
-        map(0x24, MINECRAFT_1_16_2, false),
-        map(0x26, MINECRAFT_1_17, false)
-    );
-    StateRegistry.BotFilter.clientbound.register(
-        PlayerPositionAndLook.class, PlayerPositionAndLook::new,
-        map(0x08, ProtocolVersion.MINECRAFT_1_7_2, true),
-        map(0x2E, ProtocolVersion.MINECRAFT_1_9, true),
-        map(0x2F, ProtocolVersion.MINECRAFT_1_12_1, true),
-        map(0x32, ProtocolVersion.MINECRAFT_1_13, true),
-        map(0x35, ProtocolVersion.MINECRAFT_1_14, true),
-        map(0x36, ProtocolVersion.MINECRAFT_1_15, true),
-        map(0x35, ProtocolVersion.MINECRAFT_1_16, true),
-        map(0x34, ProtocolVersion.MINECRAFT_1_16_2, true),
-        map(0x38, ProtocolVersion.MINECRAFT_1_17, true));
-
-    StateRegistry.BotFilter.clientbound.register(
-        ChunkData.class, ChunkData::new,
-        map(0x21, ProtocolVersion.MINECRAFT_1_7_2, true),
-        map(0x21, ProtocolVersion.MINECRAFT_1_8, true),
-        map(0x20, ProtocolVersion.MINECRAFT_1_9, true),
-        map(0x22, ProtocolVersion.MINECRAFT_1_13, true),
-        map(0x21, ProtocolVersion.MINECRAFT_1_14, true),
-        map(0x22, ProtocolVersion.MINECRAFT_1_15, true),
-        map(0x21, ProtocolVersion.MINECRAFT_1_16, true),
-        map(0x20, ProtocolVersion.MINECRAFT_1_16_2, true),
-        map(0x22, ProtocolVersion.MINECRAFT_1_17, true));
-
-    StateRegistry.BotFilter.clientbound.register(
-        UpdateLight.class, UpdateLight::new,
-        map(0x24, ProtocolVersion.MINECRAFT_1_14, true),
-        map(0x25, ProtocolVersion.MINECRAFT_1_15, true),
-        map(0x24, ProtocolVersion.MINECRAFT_1_16, true),
-        map(0x23, ProtocolVersion.MINECRAFT_1_16_2, true),
-        map(0x25, ProtocolVersion.MINECRAFT_1_17, true));
-
-    StateRegistry.BotFilter.clientbound.register(
-        UpdateViewPosition.class, UpdateViewPosition::new,
-        map(0x49, ProtocolVersion.MINECRAFT_1_17, true));
-
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/ByteBufCreator.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/ByteBufCreator.java
deleted file mode 100644
index eaddde7a..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/ByteBufCreator.java
+++ /dev/null
@@ -1,52 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.protocol.cache;
-
-import com.velocitypowered.natives.compression.VelocityCompressor;
-import com.velocitypowered.natives.util.BufferPreference;
-import com.velocitypowered.natives.util.Natives;
-import io.netty.buffer.ByteBuf;
-import io.netty.buffer.Unpooled;
-
-public class ByteBufCreator {
-
-  private static boolean directBuffers = false;
-
-  static {
-    VelocityCompressor compressor = Natives.compress.get().create(1);
-    if (compressor.preferredBufferType() == BufferPreference.DIRECT_PREFERRED
-        || compressor.preferredBufferType() == BufferPreference.DIRECT_REQUIRED) {
-      directBuffers = true;
-    }
-    compressor.close();
-  }
-
-  public static ByteBuf newBuffer() {
-    return directBuffers ? Unpooled.directBuffer() : Unpooled.buffer();
-  }
-
-  public static ByteBuf newBuffer(int length) {
-    return directBuffers ? Unpooled.directBuffer(length) : Unpooled.buffer(length);
-  }
-
-  public static boolean isDirectBufferPreferred() {
-    return directBuffers;
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/MultiplePreparedPackets.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/MultiplePreparedPackets.java
deleted file mode 100644
index 5c7a907c..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/MultiplePreparedPackets.java
+++ /dev/null
@@ -1,100 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.protocol.cache;
-
-import com.google.common.base.Preconditions;
-import com.velocitypowered.api.network.ProtocolVersion;
-import com.velocitypowered.proxy.connection.MinecraftConnection;
-import io.netty.buffer.ByteBuf;
-import java.util.EnumMap;
-import java.util.EnumSet;
-import java.util.HashSet;
-import java.util.Map;
-
-public class MultiplePreparedPackets {
-
-  private Map<ProtocolVersion, ByteBuf> multiplePayloadBuf = new EnumMap<ProtocolVersion, ByteBuf>(
-      ProtocolVersion.class);
-  private PreparedPacket[] onlineModePackets;
-
-  public MultiplePreparedPackets(PreparedPacket... preparedPackets) {
-    for (PreparedPacket packet : preparedPackets) {
-      Preconditions.checkState(packet.isFinished(), "PreparedPacket is not adapted");
-    }
-    onlineModePackets = preparedPackets;
-    createOfflineModePayload(preparedPackets);
-  }
-
-  private void createOfflineModePayload(PreparedPacket... preparedPackets) {
-    for (ProtocolVersion protocolVersion : EnumSet
-        .range(ProtocolVersion.MINIMUM_VERSION, ProtocolVersion.MAXIMUM_VERSION)) {
-      ByteBuf multiple = ByteBufCreator.newBuffer();
-      for (PreparedPacket preparedPacket : preparedPackets) {
-        ByteBuf buf = preparedPacket.getBuffer(protocolVersion);
-        if (buf == null) {
-          continue;
-        }
-        multiple.writeBytes(buf);
-        buf.release();
-      }
-
-      if (multiple.readableBytes() == 0) {
-        multiple.release();
-        continue;
-      }
-      //Deduplicate
-      for (ByteBuf byteBuf : multiplePayloadBuf.values()) {
-        if (byteBuf.equals(multiple)) {
-          multiple.release();
-          multiple = byteBuf;
-          break;
-        }
-      }
-      multiplePayloadBuf.put(protocolVersion, multiple);
-    }
-  }
-
-  public void write(MinecraftConnection connection, boolean onlineMode) {
-    if (onlineMode) {
-      for (PreparedPacket preparedPacket : onlineModePackets) {
-        preparedPacket.selfWrite(connection, false);
-      }
-    } else {
-      connection.delayedWrite(this);
-    }
-  }
-
-  public ByteBuf getBuffer(ProtocolVersion protocolVersion) {
-    return multiplePayloadBuf.get(protocolVersion).retainedSlice();
-  }
-
-  public int getBuffetLength(ProtocolVersion protocolVersion) {
-    return multiplePayloadBuf.get(protocolVersion).readableBytes();
-  }
-
-  public void release() {
-    for (PreparedPacket preparedPacket : onlineModePackets) {
-      preparedPacket.releaseBuffers();
-    }
-    for (ByteBuf byteBuf : new HashSet<>(multiplePayloadBuf.values())) {
-      byteBuf.release();
-    }
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/PacketCompressor.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/PacketCompressor.java
deleted file mode 100644
index 97590be3..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/PacketCompressor.java
+++ /dev/null
@@ -1,69 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.protocol.cache;
-
-import com.velocitypowered.natives.compression.VelocityCompressor;
-import com.velocitypowered.natives.util.Natives;
-import com.velocitypowered.proxy.config.VelocityConfiguration;
-import com.velocitypowered.proxy.protocol.ProtocolUtils;
-import io.netty.buffer.ByteBuf;
-import io.netty.buffer.Unpooled;
-import java.util.function.Supplier;
-
-public class PacketCompressor {
-
-  private final ThreadLocal<VelocityCompressor> compressors = ThreadLocal
-      .withInitial(() -> Natives.compress.get().create(12));
-  private final Supplier<VelocityConfiguration> velocityConfiguration;
-
-  /**
-   * Constructs VelocityPacketCompressor.
-   *
-   * @param velocityConfiguration configuration
-   */
-  public PacketCompressor(Supplier<VelocityConfiguration> velocityConfiguration) {
-    this.velocityConfiguration = velocityConfiguration;
-
-  }
-
-  public boolean isCompressionEnabled() {
-    return velocityConfiguration.get().getCompressionThreshold() >= 0;
-  }
-
-  public boolean shouldCompress(int i) {
-    return isCompressionEnabled() && i >= velocityConfiguration.get().getCompressionThreshold();
-  }
-
-  public ByteBuf compress(ByteBuf source) {
-    VelocityCompressor compressor = compressors.get();
-    ByteBuf destination =
-        ByteBufCreator.isDirectBufferPreferred() ? Unpooled.directBuffer() : Unpooled.buffer();
-    int uncompressed = source.readableBytes();
-    ProtocolUtils.writeVarInt(destination, uncompressed);
-    try {
-      compressor.deflate(source, destination);
-    } catch (Exception e) {
-      throw new RuntimeException(e);
-    } finally {
-      source.release();
-    }
-    return destination;
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/PreparedPacket.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/PreparedPacket.java
deleted file mode 100644
index 9d2e722d..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/PreparedPacket.java
+++ /dev/null
@@ -1,217 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.protocol.cache;
-
-import com.velocitypowered.api.network.ProtocolVersion;
-import com.velocitypowered.proxy.connection.MinecraftConnection;
-import com.velocitypowered.proxy.protocol.MinecraftPacket;
-import com.velocitypowered.proxy.protocol.ProtocolUtils;
-import com.velocitypowered.proxy.protocol.ProtocolUtils.Direction;
-import com.velocitypowered.proxy.protocol.StateRegistry;
-import io.netty.buffer.ByteBuf;
-import io.netty.util.ReferenceCountUtil;
-import java.util.EnumMap;
-import java.util.EnumSet;
-import java.util.HashSet;
-import java.util.Map;
-import java.util.Map.Entry;
-import net.elytrium.elytraproxy.botfilter.protocol.BotFilterProtocol;
-
-public class PreparedPacket<T extends MinecraftPacket> {
-
-  static {
-    BotFilterProtocol.init();
-  }
-
-  private final Map<ProtocolVersion, ByteBufHolder> packets =
-      new EnumMap<>(ProtocolVersion.class);
-  private boolean finished = false;
-
-  public PreparedPacket() {
-  }
-
-  public void prepareSinge(T packet, ProtocolVersion version) {
-    prepare(packet, version, version);
-  }
-
-  public void prepareSinge(T packet, ProtocolVersion version, StateRegistry protocol) {
-    prepare(packet, version, version, protocol);
-  }
-
-  public void prepare(T packet) {
-    prepare(packet, ProtocolVersion.MINIMUM_VERSION, ProtocolVersion.MAXIMUM_VERSION);
-  }
-
-  public void prepare(T packet, ProtocolVersion from) {
-    prepare(packet, from, ProtocolVersion.MAXIMUM_VERSION);
-  }
-
-  public void prepare(T packet, ProtocolVersion from, StateRegistry protocol) {
-    prepare(packet, from, ProtocolVersion.MAXIMUM_VERSION, protocol);
-  }
-
-  public void prepare(T packet, ProtocolVersion from, ProtocolVersion to) {
-    prepare(packet, from, to, StateRegistry.BotFilter);
-  }
-
-  public void prepare(T packet, ProtocolVersion from, ProtocolVersion to, StateRegistry protocol) {
-    for (ProtocolVersion protocolVersion : EnumSet.range(from, to)) {
-      ByteBuf buf = encodePacket(packet, protocolVersion, protocol);
-      ByteBufHolder holder = getHolder(buf, protocolVersion);
-      packets.put(protocolVersion, holder);
-    }
-  }
-
-  /*
-  public void preparePacketAndCopy(T packet, ProtocolVersion start, ProtocolVersion end,
-      StateRegistry protocol) {
-    ByteBuf buf = encodePacket(packet, start, protocol);
-    ByteBufHolder holder = new ByteBufHolder(start.isBefore(ProtocolVersion.MINECRAFT_1_8), buf);
-    for (ProtocolVersion protocolVersion : EnumSet.range(start, end)) {
-      prepared.put(protocolVersion, holder);
-    }
-  }
-  */
-
-  private ByteBuf encodePacket(T packet, ProtocolVersion version, StateRegistry protocol) {
-    int id = getPacketId(packet, version, protocol);
-    ByteBuf byteBuf = ByteBufCreator.newBuffer();
-    ProtocolUtils.writeVarInt(byteBuf, id);
-    packet.encode(byteBuf, Direction.CLIENTBOUND, version);
-    return byteBuf;
-  }
-
-  private int getPacketId(T packet, ProtocolVersion version, StateRegistry protocol) {
-    try {
-      return protocol.clientbound.getProtocolRegistry(version).getPacketId(packet.getClass());
-    } catch (Exception e) {
-      return protocol.clientbound.getProtocolRegistry(version).getPacketId(
-          (Class<? extends MinecraftPacket>) packet.getClass().getSuperclass());
-    }
-  }
-
-  public ByteBuf getBuffer(ProtocolVersion version) {
-    ByteBufHolder holder = packets.get(version);
-    return holder == null ? null : holder.byteBuf.retainedSlice();
-  }
-
-  public int getBufferLength(ProtocolVersion version) {
-    ByteBufHolder holder = packets.get(version);
-    return holder == null ? 0 : holder.byteBuf.readableBytes();
-  }
-
-  public void selfWrite(MinecraftConnection mc, boolean flush) {
-    if (packets.containsKey(mc.getProtocolVersion())) {
-      if (flush) {
-        mc.write(this);
-      } else {
-        mc.delayedWrite(this);
-      }
-    }
-  }
-
-  public boolean isFinished() {
-    return finished;
-  }
-
-  private ByteBufHolder getHolder(ByteBuf buf, ProtocolVersion version) {
-    if (version.isBefore(ProtocolVersion.MINECRAFT_1_8)) {
-      ByteBufHolder holder = packets.get(ProtocolVersion.MINECRAFT_1_7_2);
-      if (holder != null && holder.byteBuf.equals(buf)) {
-        buf.release();
-        return holder;
-      }
-      return new ByteBufHolder(true, buf);
-    }
-
-    for (ByteBufHolder holder : new HashSet<>(packets.values())) {
-      if (!holder.mc1_7 && holder.byteBuf.equals(buf)) {
-        buf.release();
-        return holder;
-      }
-    }
-    return new ByteBufHolder(false, buf);
-  }
-
-  public void processCompress(PacketCompressor packetCompressor) {
-    if (finished) {
-      throw new IllegalStateException("Packet compression does not allowed after adapt");
-    }
-    for (Entry<ProtocolVersion, ByteBufHolder> prepared : packets.entrySet()) {
-      ByteBufHolder holder = prepared.getValue();
-      if (holder.mc1_7 || holder.compressed) {
-        continue;
-      }
-      ByteBuf current = holder.byteBuf;
-      ByteBuf newBuf;
-      int bytes = current.readableBytes();
-      holder.compressed = true;
-      if (packetCompressor.shouldCompress(bytes)) {
-        newBuf = packetCompressor.compress(current);
-      } else {
-        newBuf = ByteBufCreator.newBuffer(2 + current.readableBytes());
-        ProtocolUtils.writeVarInt(newBuf, 0);
-        newBuf.writeBytes(current);
-      }
-      newBuf.capacity(newBuf.readableBytes());
-      holder.byteBuf = newBuf;
-    }
-  }
-
-  public void finish() {
-    for (Entry<ProtocolVersion, ByteBufHolder> prepared : packets.entrySet()) {
-      ByteBufHolder holder = prepared.getValue();
-      if (holder.varint) {
-        continue;
-      }
-      ByteBuf current = holder.byteBuf;
-      ByteBuf buf = ByteBufCreator.newBuffer(5 + current.readableBytes());
-      ProtocolUtils.writeVarInt(buf, current.readableBytes());
-      buf.writeBytes(current);
-      buf.capacity(buf.readableBytes());
-      ReferenceCountUtil.safeRelease(current);
-      holder.byteBuf = buf;
-      holder.varint = true;
-    }
-    finished = true;
-  }
-
-  public void releaseBuffers() {
-    for (ByteBufHolder holder : new HashSet<>(packets.values())) {
-      holder.byteBuf.release();
-    }
-  }
-
-  private static class ByteBufHolder {
-
-    private final boolean mc1_7;
-    private ByteBuf byteBuf;
-    private boolean compressed = false;
-    private boolean varint = false;
-
-    public ByteBufHolder(boolean mc1_7, ByteBuf byteBuf) {
-      this.mc1_7 = mc1_7;
-      this.byteBuf = byteBuf;
-      if (mc1_7) {
-        compressed = true;
-      }
-    }
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/netty/MultiplePreparedPacketsEncoder.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/netty/MultiplePreparedPacketsEncoder.java
deleted file mode 100644
index dfd775ca..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/netty/MultiplePreparedPacketsEncoder.java
+++ /dev/null
@@ -1,70 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.protocol.cache.netty;
-
-import com.velocitypowered.api.network.ProtocolVersion;
-import io.netty.buffer.ByteBuf;
-import io.netty.channel.ChannelHandler.Sharable;
-import io.netty.channel.ChannelHandlerContext;
-import io.netty.handler.codec.MessageToMessageEncoder;
-import java.util.EnumMap;
-import java.util.List;
-import java.util.Map;
-import lombok.RequiredArgsConstructor;
-import net.elytrium.elytraproxy.botfilter.protocol.cache.MultiplePreparedPackets;
-
-@Sharable
-@RequiredArgsConstructor
-public class MultiplePreparedPacketsEncoder extends
-    MessageToMessageEncoder<MultiplePreparedPackets> {
-
-  private static Map<ProtocolVersion, MultiplePreparedPacketsEncoder> encoders = new EnumMap<>(
-      ProtocolVersion.class);
-
-  static {
-    for (ProtocolVersion version : ProtocolVersion.SUPPORTED_VERSIONS) {
-      encoders.put(version, new MultiplePreparedPacketsEncoder(version));
-    }
-  }
-
-  private final ProtocolVersion protocolVersion;
-
-  @Override
-  protected void encode(ChannelHandlerContext ctx, MultiplePreparedPackets msg, List<Object> out)
-      throws Exception {
-    System.out.println("Processing multiple encoder");
-    ByteBuf buf = msg.getBuffer(protocolVersion);
-    out.add(buf);
-  }
-
-  /*
-  @Override
-  protected ByteBuf allocateBuffer(ChannelHandlerContext ctx, MultiplePreparedPackets msg,
-      boolean preferDirect) throws Exception {
-    int length = msg.getBuffetLength(protocolVersion);
-    return ByteBufCreator.isDirectBufferPreferred() ? ctx.alloc().directBuffer(length)
-        : ctx.alloc().heapBuffer(length);
-  }
-  */
-
-  public static MultiplePreparedPacketsEncoder getEncoder(ProtocolVersion version) {
-    return encoders.get(version);
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/netty/PreparedPacketEncoder.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/netty/PreparedPacketEncoder.java
deleted file mode 100644
index da613aa7..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/cache/netty/PreparedPacketEncoder.java
+++ /dev/null
@@ -1,75 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.protocol.cache.netty;
-
-import com.google.common.collect.HashBasedTable;
-import com.google.common.collect.Table;
-import com.velocitypowered.api.network.ProtocolVersion;
-import com.velocitypowered.natives.encryption.JavaVelocityCipher;
-import com.velocitypowered.natives.util.Natives;
-import io.netty.buffer.ByteBuf;
-import io.netty.channel.ChannelHandler.Sharable;
-import io.netty.channel.ChannelHandlerContext;
-import io.netty.handler.codec.MessageToMessageEncoder;
-import java.util.List;
-import lombok.RequiredArgsConstructor;
-import net.elytrium.elytraproxy.botfilter.protocol.cache.PreparedPacket;
-
-@Sharable
-@RequiredArgsConstructor
-public class PreparedPacketEncoder extends MessageToMessageEncoder<PreparedPacket> {
-
-  private static final boolean IS_JAVA_CIPHER = Natives.cipher.get() == JavaVelocityCipher.FACTORY;
-  private static Table<ProtocolVersion, Boolean, PreparedPacketEncoder> encoders = HashBasedTable
-      .create(ProtocolVersion.SUPPORTED_VERSIONS.size(), 2);
-
-  static {
-    for (ProtocolVersion version : ProtocolVersion.SUPPORTED_VERSIONS) {
-      encoders.put(version, true, new PreparedPacketEncoder(version, true));
-      encoders.put(version, false, new PreparedPacketEncoder(version, false));
-    }
-  }
-
-  private final ProtocolVersion protocolVersion;
-  private final boolean onlineMode;
-
-
-  @Override
-  protected void encode(ChannelHandlerContext ctx, PreparedPacket msg, List<Object> out)
-      throws Exception {
-    System.out.println("Processing prepared");
-    ByteBuf buf = msg.getBuffer(protocolVersion);
-    out.add(buf);
-  }
-
-  /*
-  @Override
-  protected ByteBuf allocateBuffer(ChannelHandlerContext ctx, PreparedPacket msg,
-      boolean preferDirect) throws Exception {
-    int length = msg.getBufferLength(protocolVersion);
-    boolean direct = onlineMode ? IS_JAVA_CIPHER : ByteBufCreator.isDirectBufferPreferred();
-    return direct ? ctx.alloc().directBuffer(length) : ctx.alloc().heapBuffer(length);
-  }
-  */
-
-  public static PreparedPacketEncoder getEncoder(ProtocolVersion version, boolean onlineMode) {
-    return encoders.get(version, onlineMode);
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/registry/Dimension.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/registry/Dimension.java
deleted file mode 100644
index c661943c..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/registry/Dimension.java
+++ /dev/null
@@ -1,95 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.protocol.data.registry;
-
-import com.velocitypowered.api.network.ProtocolVersion;
-import lombok.AllArgsConstructor;
-import lombok.Data;
-import lombok.NonNull;
-import net.kyori.adventure.nbt.CompoundBinaryTag;
-import net.kyori.adventure.nbt.CompoundBinaryTag.Builder;
-
-@AllArgsConstructor
-@Data
-public class Dimension {
-
-  public static final Dimension OVERWORLD = new Dimension("minecraft:overworld", 0, false, true,
-      0.0f, null, false, "minecraft:infiniburn_overworld",
-      false, true, true, "minecraft:overworld", true, 0, 256, 256, 1.0f, false, false);
-
-  @NonNull
-  private final String key;
-  private final int id;
-
-  private final boolean piglinSafe;
-  private final boolean natural;
-  private final float ambientLight;
-  private final Long fixedTime;
-  private final boolean shrunk;
-  @NonNull
-  private final String infiniburn;
-  private final boolean respawnAnchorWorks;
-  private final boolean hasSkylight;
-  private final boolean bedWorks;
-  @NonNull
-  private final String effects;
-  private final boolean hasRaids;
-  private final int minY;
-  private final int height;
-  private final int logicalHeight;
-  private final float coordinateScale;
-  private final boolean ultrawarm;
-  private final boolean hasCeiling;
-
-
-  public CompoundBinaryTag encodeAttributes(ProtocolVersion protocolVersion) {
-    Builder tag = CompoundBinaryTag.builder()
-        .putString("name", key)
-        .putBoolean("natural", natural)
-        .putBoolean("has_skylight", hasSkylight)
-        .putBoolean("has_ceiling", hasCeiling);
-    if (fixedTime != null) {
-      tag.putLong("fixed_time", fixedTime);
-    }
-
-    tag.putBoolean("shrunk", shrunk)
-        .putFloat("ambient_light", ambientLight)
-        .putBoolean("ultrawarm", ultrawarm)
-        .putBoolean("has_raids", hasRaids)
-        .putBoolean("respawn_anchor_works", respawnAnchorWorks)
-        .putBoolean("bed_works", bedWorks)
-        .putBoolean("piglin_safe", piglinSafe)
-        .putString("infiniburn", infiniburn)
-        .putInt("logical_height", logicalHeight);
-
-    if (protocolVersion.isAfterOrEq(ProtocolVersion.MINECRAFT_1_16_2)) {
-      tag.remove("name")
-          .remove("shrunk")
-          .putString("effects", effects)
-          .putFloat("coordinate_scale", coordinateScale);
-    }
-    if (protocolVersion.isAfterOrEq(ProtocolVersion.MINECRAFT_1_17)) {
-      tag.putInt("min_y", minY);
-      tag.putInt("height", height);
-    }
-
-    return tag.build();
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/registry/DimensionRegistry.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/registry/DimensionRegistry.java
deleted file mode 100644
index 6fa56c9e..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/registry/DimensionRegistry.java
+++ /dev/null
@@ -1,134 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.protocol.data.registry;
-
-import com.google.common.base.Preconditions;
-import com.velocitypowered.api.network.ProtocolVersion;
-import com.velocitypowered.proxy.connection.registry.DimensionInfo;
-import java.util.Collection;
-import java.util.HashMap;
-import java.util.HashSet;
-import java.util.List;
-import java.util.Map;
-import java.util.Map.Entry;
-import java.util.Set;
-import java.util.stream.Collectors;
-import net.kyori.adventure.nbt.BinaryTagTypes;
-import net.kyori.adventure.nbt.CompoundBinaryTag;
-import net.kyori.adventure.nbt.ListBinaryTag;
-
-public class DimensionRegistry {
-
-  private final Map<Dimension, List<Biome>> dimensions = new HashMap<>();
-  private Dimension activeDimension;
-  private DimensionInfo activeDimensionInfo;
-
-  public void addDimension(Dimension dimension, List<Biome> biomes) {
-    Preconditions.checkNotNull(dimension);
-    Preconditions.checkNotNull(biomes);
-    Preconditions.checkState(!biomes.isEmpty());
-    dimensions.put(dimension, biomes);
-  }
-
-  public void removeDimension(Dimension dimension) {
-    dimensions.remove(dimension);
-  }
-
-  public Dimension getDimension(int id) {
-    return dimensions.keySet().stream().filter(dim -> dim.getId() == id).findAny().orElse(null);
-  }
-
-  public Dimension getDimension(String key) {
-    return dimensions.keySet().stream().filter(dim -> key.equals(dim.getKey())).findAny()
-        .orElse(null);
-  }
-
-  public List<Biome> getBiomes(Dimension dimension) {
-    return dimensions.get(dimension);
-  }
-
-  public List<String> getWorldNames() {
-    return dimensions.keySet().stream().map(dim -> dim.getKey()).collect(Collectors.toList());
-  }
-
-  public Dimension getActiveDimension() {
-    return activeDimension;
-  }
-
-  public void setActiveDimension(Dimension activeDimension) {
-    Preconditions
-        .checkState(dimensions.containsKey(activeDimension), "Dimension does not registered");
-    this.activeDimension = activeDimension;
-  }
-
-  public DimensionInfo getActiveDimensionInfo() {
-    return activeDimensionInfo;
-  }
-
-  public void setActiveDimensionInfo(DimensionInfo activeDimensionInfo) {
-    Preconditions.checkState(activeDimension != null, "Active dimension does not set");
-    this.activeDimensionInfo = activeDimensionInfo;
-  }
-
-  public CompoundBinaryTag encode(ProtocolVersion protocolVersion) {
-    ListBinaryTag.Builder<CompoundBinaryTag> dimensionsBuilder = ListBinaryTag
-        .builder(BinaryTagTypes.COMPOUND);
-    for (Entry<Dimension, List<Biome>> dimensionEntry : dimensions.entrySet()) {
-      Dimension dimension = dimensionEntry.getKey();
-      CompoundBinaryTag attributes = dimension.encodeAttributes(protocolVersion);
-      if (protocolVersion.isBeforeOrEq(ProtocolVersion.MINECRAFT_1_16_1)) {
-        dimensionsBuilder.add(attributes);
-      } else {
-        CompoundBinaryTag dimensionData = CompoundBinaryTag.builder()
-            .putString("name", dimension.getKey())
-            .putInt("id", dimension.getId())
-            .put("element", attributes).build();
-        dimensionsBuilder.add(dimensionData);
-      }
-    }
-    if (protocolVersion.isBeforeOrEq(ProtocolVersion.MINECRAFT_1_16_1)) {
-      return CompoundBinaryTag.builder().put("dimension", dimensionsBuilder.build()).build();
-    } else {
-      CompoundBinaryTag encodedDimensions = CompoundBinaryTag.builder()
-          .putString("type", "minecraft:dimension_type")
-          .put("value", dimensionsBuilder.build())
-          .build();
-      return CompoundBinaryTag.builder()
-          .put("minecraft:dimension_type", encodedDimensions)
-          .put("minecraft:worldgen/biome", createBiomeRegistry(dimensions.values())).build();
-    }
-  }
-
-  private CompoundBinaryTag createBiomeRegistry(Collection<List<Biome>> allBiomes) {
-    Set<Biome> biomes = new HashSet<>();
-    for (List<Biome> biomeLise : allBiomes) {
-      biomes.addAll(biomeLise);
-    }
-
-    ListBinaryTag.Builder<CompoundBinaryTag> biomesBuilder = ListBinaryTag
-        .builder(BinaryTagTypes.COMPOUND);
-    for (Biome biome : biomes) {
-      biomesBuilder.add(biome.encodeBiome());
-    }
-    return CompoundBinaryTag.builder()
-        .putString("type", "minecraft:worldgen/biome")
-        .put("value", biomesBuilder.build()).build();
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/JoinGame.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/JoinGame.java
deleted file mode 100644
index ab8d3f63..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/JoinGame.java
+++ /dev/null
@@ -1,109 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.protocol.packet;
-
-import com.velocitypowered.api.network.ProtocolVersion;
-import com.velocitypowered.proxy.connection.registry.DimensionInfo;
-import com.velocitypowered.proxy.protocol.MinecraftPacket;
-import com.velocitypowered.proxy.protocol.ProtocolUtils;
-import io.netty.buffer.ByteBuf;
-import lombok.AllArgsConstructor;
-import lombok.Builder;
-import lombok.Data;
-import lombok.NoArgsConstructor;
-import net.elytrium.elytraproxy.botfilter.protocol.data.registry.DimensionRegistry;
-
-@Data
-@Builder
-@NoArgsConstructor
-@AllArgsConstructor
-public class JoinGame implements MinecraftPacket {
-
-  private int entityId;
-  private short gamemode;
-  private int dimension;
-  private long partialHashedSeed;
-  private short difficulty;
-  private boolean hardcore;
-  private int maxPlayers;
-  private String levelType;
-  private int viewDistance;
-  private boolean reducedDebugInfo;
-  private boolean showRespawnScreen;
-  private DimensionRegistry dimensionRegistry;
-  private short previousGamemode;
-
-  @Override
-  public void encode(ByteBuf buf, ProtocolUtils.Direction direction, ProtocolVersion version) {
-    buf.writeInt(entityId);
-    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_16_2)) {
-      buf.writeBoolean(hardcore);
-      buf.writeByte(gamemode);
-    } else {
-      buf.writeByte(hardcore ? gamemode | 0x8 : gamemode);
-    }
-    DimensionInfo dimensionInfo = dimensionRegistry.getActiveDimensionInfo();
-    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_16)) {
-      buf.writeByte(previousGamemode);
-      ProtocolUtils.writeStringArray(buf,
-          dimensionRegistry.getWorldNames().toArray(new String[0])); //worldNames
-      ProtocolUtils.writeCompoundTag(buf, dimensionRegistry.encode(version));
-      if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_16_2)) {
-        ProtocolUtils.writeCompoundTag(buf,
-            dimensionRegistry.getActiveDimension().encodeAttributes(version));
-        ProtocolUtils.writeString(buf, dimensionInfo.getRegistryIdentifier());
-      } else {
-        ProtocolUtils.writeString(buf, dimensionInfo.getRegistryIdentifier());
-        ProtocolUtils.writeString(buf, dimensionInfo.getLevelName());
-      }
-    } else if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_9_1)) {
-      buf.writeInt(dimension);
-    } else {
-      buf.writeByte(dimension);
-    }
-    if (version.isBeforeOrEq(ProtocolVersion.MINECRAFT_1_13_2)) {
-      buf.writeByte(difficulty);
-    }
-    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_15)) {
-      buf.writeLong(partialHashedSeed);
-    }
-    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_16_2)) {
-      ProtocolUtils.writeVarInt(buf, maxPlayers);
-    } else {
-      buf.writeByte(maxPlayers);
-    }
-    if (version.isBefore(ProtocolVersion.MINECRAFT_1_16)) {
-      ProtocolUtils.writeString(buf, levelType);
-    }
-    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_14)) {
-      ProtocolUtils.writeVarInt(buf, viewDistance);
-    }
-    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_8)) {
-      buf.writeBoolean(reducedDebugInfo);
-    }
-    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_15)) {
-      buf.writeBoolean(showRespawnScreen);
-    }
-    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_16)) {
-      buf.writeBoolean(dimensionInfo.isDebugType());
-      buf.writeBoolean(dimensionInfo.isFlat());
-    }
-  }
-}
\ No newline at end of file
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/world/UpdateLight.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/world/UpdateLight.java
deleted file mode 100644
index e0083dca..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/world/UpdateLight.java
+++ /dev/null
@@ -1,125 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.protocol.packet.world;
-
-import com.velocitypowered.api.network.ProtocolVersion;
-import com.velocitypowered.proxy.protocol.MinecraftPacket;
-import com.velocitypowered.proxy.protocol.ProtocolUtils;
-import com.velocitypowered.proxy.protocol.ProtocolUtils.Direction;
-import io.netty.buffer.ByteBuf;
-import java.util.BitSet;
-import net.elytrium.elytraproxy.botfilter.protocol.util.mcprotocollib.NibbleArray3d;
-import net.elytrium.elytraproxy.botfilter.server.world.chunk.ChunkSnapshot;
-import net.elytrium.elytraproxy.botfilter.server.world.chunk.LightSection;
-
-public class UpdateLight implements MinecraftPacket {
-
-  private final ChunkSnapshot chunk;
-  private final NibbleArray3d[] skyLight = new NibbleArray3d[18];
-  private final NibbleArray3d[] blockLight = new NibbleArray3d[18];
-  private int skyLightMask = 0;
-  private int blockLightMask = 0;
-  private int emptySkyLightMask = 0;
-  private int emptyBlockLightMask = 0;
-
-  private int skyLightArrayCount;
-  private int blockLightArrayCount;
-
-  public UpdateLight() {
-    chunk = null;
-  }
-
-  public UpdateLight(ChunkSnapshot chunkSnapshot) {
-    this.chunk = chunkSnapshot;
-    prepareLighting();
-  }
-
-  @Override
-  public void encode(ByteBuf buf, Direction direction, ProtocolVersion version) {
-    ProtocolUtils.writeVarInt(buf, chunk.getX());
-    ProtocolUtils.writeVarInt(buf, chunk.getZ());
-
-    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_16)) {
-      buf.writeBoolean(true); //trust edges
-    }
-
-    if (version.isBefore(ProtocolVersion.MINECRAFT_1_17)) {
-      ProtocolUtils.writeVarInt(buf, skyLightMask);
-      ProtocolUtils.writeVarInt(buf, blockLightMask);
-      ProtocolUtils.writeVarInt(buf, emptySkyLightMask);
-      ProtocolUtils.writeVarInt(buf, emptyBlockLightMask);
-    } else {
-      write117Mask(buf, skyLightMask);
-      write117Mask(buf, blockLightMask);
-      write117Mask(buf, emptySkyLightMask);
-      write117Mask(buf, emptyBlockLightMask);
-    }
-
-    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_17)) {
-      ProtocolUtils.writeVarInt(buf, skyLightArrayCount);
-    }
-    for (NibbleArray3d array3d : skyLight) {
-      if (array3d != null) {
-        ProtocolUtils.writeByteArray(buf, array3d.getData());
-      }
-    }
-    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_17)) {
-      ProtocolUtils.writeVarInt(buf, blockLightArrayCount);
-    }
-    for (NibbleArray3d nibbleArray3d : blockLight) {
-      if (nibbleArray3d != null) {
-        ProtocolUtils.writeByteArray(buf, nibbleArray3d.getData());
-      }
-    }
-  }
-
-  private void prepareLighting() {
-
-    LightSection[] lightSections = chunk.getLight();
-
-    for (int i = 0; i < lightSections.length; i++) {
-      LightSection section = lightSections[i];
-      if (section.getSkyLight() == LightSection.NO_LIGHT) {
-        emptySkyLightMask |= 1 << i;
-      } else if (section.getSkyLight() != LightSection.ALL_LIGHT) {
-        skyLightMask |= 1 << i;
-        skyLight[i] = section.getSkyLight();
-        skyLightArrayCount++;
-      }
-
-      if (section.getBlockLight() != LightSection.NO_LIGHT) {
-        blockLightMask |= 1 << i;
-        blockLight[i] = section.getBlockLight();
-        blockLightArrayCount++;
-      } else {
-        emptyBlockLightMask |= 1 << i;
-      }
-    }
-  }
-
-  private static void write117Mask(ByteBuf buf, int mask) {
-    BitSet bitSet = BitSet.valueOf(new long[]{mask});
-    long[] mk = bitSet.toLongArray();
-    ProtocolUtils.writeVarInt(buf, mk.length);
-    for (long m : mk) {
-      buf.writeLong(m);
-    }
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/BotFilterSessionHandler.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/BotFilterSessionHandler.java
deleted file mode 100644
index 97223ada..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/BotFilterSessionHandler.java
+++ /dev/null
@@ -1,68 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.server;
-
-import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
-import com.velocitypowered.proxy.connection.client.ConnectedPlayer;
-import com.velocitypowered.proxy.connection.client.LoginSessionHandler;
-import java.util.Objects;
-import lombok.Data;
-
-@Data
-public class BotFilterSessionHandler implements MinecraftSessionHandler {
-
-  private final ConnectedPlayer player;
-  private final LoginSessionHandler originalHandler;
-  private final VirtualServer virtualServer;
-
-  @Override
-  public void disconnected() {
-    virtualServer.disconnected(this);
-  }
-
-  @Override
-  public void deactivated() {
-    virtualServer.disconnected(this);
-  }
-
-  private void finishCheck() {
-    player.getConnection().setSessionHandler(originalHandler);
-    originalHandler.initialize(player);
-    //fakeServer.getBotFilter().restoreOriginalHandlers(user);
-    //afterCheck.run();
-  }
-
-  @Override
-  public boolean equals(Object o) {
-    if (this == o) {
-      return true;
-    }
-    if (o == null || getClass() != o.getClass()) {
-      return false;
-    }
-    BotFilterSessionHandler that = (BotFilterSessionHandler) o;
-    return player.getUsername().equals(that.player.getUsername());
-  }
-
-  @Override
-  public int hashCode() {
-    return Objects.hash(player.getUsername());
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/ServerPackets.java b/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/ServerPackets.java
deleted file mode 100644
index 6919e5e1..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/ServerPackets.java
+++ /dev/null
@@ -1,198 +0,0 @@
-/*
- * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
- *
- * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.botfilter.server;
-
-import com.google.common.collect.ImmutableList;
-import com.velocitypowered.api.network.ProtocolVersion;
-import com.velocitypowered.proxy.connection.registry.DimensionInfo;
-import com.velocitypowered.proxy.protocol.StateRegistry;
-import com.velocitypowered.proxy.protocol.packet.Disconnect;
-import java.util.ArrayList;
-import java.util.Arrays;
-import java.util.List;
-import lombok.Getter;
-import net.elytrium.elytraproxy.botfilter.protocol.cache.MultiplePreparedPackets;
-import net.elytrium.elytraproxy.botfilter.protocol.cache.PacketCompressor;
-import net.elytrium.elytraproxy.botfilter.protocol.cache.PreparedPacket;
-import net.elytrium.elytraproxy.botfilter.protocol.data.registry.Biome;
-import net.elytrium.elytraproxy.botfilter.protocol.data.registry.Dimension;
-import net.elytrium.elytraproxy.botfilter.protocol.data.registry.DimensionRegistry;
-import net.elytrium.elytraproxy.botfilter.protocol.packet.JoinGame;
-import net.elytrium.elytraproxy.botfilter.protocol.packet.PlayerPositionAndLook;
-import net.elytrium.elytraproxy.botfilter.protocol.packet.UpdateViewPosition;
-import net.elytrium.elytraproxy.botfilter.protocol.packet.world.ChunkData;
-import net.elytrium.elytraproxy.botfilter.protocol.packet.world.UpdateLight;
-import net.elytrium.elytraproxy.botfilter.server.world.VirtualWorld;
-import net.elytrium.elytraproxy.botfilter.server.world.chunk.SimpleChunk;
-import net.kyori.adventure.text.Component;
-import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
-
-@Getter
-public class ServerPackets {
-
-  private final PacketCompressor packetCompressor;
-  private final VirtualServer virtualServer;
-  private VirtualWorld virtualWorld;
-  //JoinGame + Chunks + Light + PlayerPosAndLook
-  private MultiplePreparedPackets spawnPackets;
-  private PreparedPacket<Disconnect> alreadyConnected;
-
-  public ServerPackets(PacketCompressor packetCompressor,
-      VirtualServer virtualServer) {
-    this.packetCompressor = packetCompressor;
-    this.virtualServer = virtualServer;
-  }
-
-  public void createPackets() {
-    releaseAll();
-    this.virtualWorld = new VirtualWorld(Dimension.OVERWORLD,
-        new DimensionInfo(Dimension.OVERWORLD.getKey(), Dimension.OVERWORLD.getKey(), true, false));
-    virtualWorld.setSkyLight(0, 60, 0,
-        (byte) 1); //1.7 workaround //TODO: Maybe broken with new light system realiztion
-
-    /*
-    for (int x = 0; x < 16; x++) {
-      for (int z = 0; z < 16; z++) {
-        virtualWorld.setBlock(x, 40, z, SimpleBlock.GRANITE);
-        virtualWorld.setBlock(x, 60, z, SimpleBlock.GRANITE);
-      }
-    }
-    for (int x = 1; x < 15; x++) {
-      for (int z = 1; z < 15; z++) {
-        if (x % 3 == 0 && z % 3 == 0) {
-          virtualWorld.setBlock(x, 40, z, SimpleBlock.BARRIER);
-          virtualWorld.setBlockLight(x, 41, z, (byte) 15);
-        }
-      }
-    }
-    for (int x = 0; x < 16; x++) {
-      for (int y = 40; y <= 60; y++) {
-        virtualWorld.setBlock(x, y, 0, SimpleBlock.GRANITE);
-        virtualWorld.setBlock(0, y, x, SimpleBlock.GRANITE);
-        virtualWorld.setBlock(x, y, 15, SimpleBlock.GRANITE);
-        virtualWorld.setBlock(15, y, x, SimpleBlock.GRANITE);
-      }
-    }
-    */
-
-    List<PreparedPacket> preparedPackets = new ArrayList<>();
-    preparedPackets.add(createJoinGamePacket());
-    preparedPackets.addAll(createChunksPackets());
-    preparedPackets.addAll(createUpdateLightPackets());
-    preparedPackets.add(createPlayerPosAndLookPacket());
-    spawnPackets = new MultiplePreparedPackets(preparedPackets.toArray(new PreparedPacket[0]));
-    alreadyConnected = createDisconnectPacket("&cAlready connected", StateRegistry.LOGIN);
-    virtualWorld = null;
-  }
-
-  //TODO use Dimensions ids for < 1.16 version
-  private PreparedPacket<JoinGame> createJoinGamePacket() {
-    DimensionRegistry dimensionRegistry = new DimensionRegistry();
-    dimensionRegistry.addDimension(
-        Dimension.OVERWORLD, ImmutableList.of(Biome.PLAINTS, Biome.SWAMP, Biome.SWAMP_HILLS));
-    dimensionRegistry.setActiveDimension(Dimension.OVERWORLD);
-    dimensionRegistry.setActiveDimensionInfo(
-        new DimensionInfo("minecraft:overworld", "minecraft:overworld", false, false));
-    PreparedPacket<JoinGame> joinGame = new PreparedPacket<>();
-    joinGame.prepare(JoinGame.builder().entityId(0).gamemode((short) 1).dimension(0).
-        partialHashedSeed(1).difficulty((short) 0).maxPlayers(1).levelType("flat").viewDistance(4)
-        .reducedDebugInfo(false).showRespawnScreen(true).hardcore(false)
-        .dimensionRegistry(dimensionRegistry).build());
-
-    return processCompression(joinGame);
-  }
-
-  private PreparedPacket<PlayerPositionAndLook> createPlayerPosAndLookPacket() {
-    PreparedPacket<PlayerPositionAndLook> playerPosAndLook = new PreparedPacket<>();
-    playerPosAndLook.prepare(new PlayerPositionAndLook(6, 60, 6, 0f, 0f, -133, false, true));
-    return processCompression(playerPosAndLook);
-  }
-
-  private List<PreparedPacket<ChunkData>> createChunksPackets() {
-    List<PreparedPacket<ChunkData>> packets = new ArrayList<>();
-    for (SimpleChunk chunk : virtualWorld.getChunks()) {
-      packets.add(createChunkDataPacket(chunk));
-    }
-    return packets;
-  }
-
-  private PreparedPacket<ChunkData> createChunkDataPacket(SimpleChunk chunk) {
-    PreparedPacket<ChunkData> chunkPacket = new PreparedPacket<>();
-    chunkPacket.prepare(new ChunkData(chunk.getFullChunkSnapshot(),
-        chunk.getWorld().getDimension().isHasSkylight()));
-    return processCompression(chunkPacket);
-  }
-
-  private List<PreparedPacket<UpdateLight>> createUpdateLightPackets() {
-    List<PreparedPacket<UpdateLight>> packets = new ArrayList<>();
-    for (SimpleChunk chunk : virtualWorld.getChunks()) {
-      packets.add(createUpdateLightPacket(chunk));
-    }
-    return packets;
-  }
-
-  private PreparedPacket<UpdateLight> createUpdateLightPacket(SimpleChunk chunk) {
-    PreparedPacket<UpdateLight> lightPacket = new PreparedPacket<>();
-    lightPacket
-        .prepare(new UpdateLight(chunk.getFullChunkSnapshot()), ProtocolVersion.MINECRAFT_1_14);
-    return processCompression(lightPacket);
-  }
-
-  private PreparedPacket<UpdateViewPosition> createUpdateViewPositionPacket(SimpleChunk chunk) {
-    PreparedPacket<UpdateViewPosition> update = new PreparedPacket<>();
-    update.prepare(new UpdateViewPosition(chunk.getX(), chunk.getZ()),
-        ProtocolVersion.MINECRAFT_1_17);
-    return processCompression(update);
-  }
-
-  private PreparedPacket<Disconnect> createDisconnectPacket(String message,
-      StateRegistry protocol) {
-    Component component = LegacyComponentSerializer.legacyAmpersand().deserialize(message);
-    PreparedPacket<Disconnect> disconnect = new PreparedPacket<>();
-    disconnect.prepare(Disconnect.create(component, ProtocolVersion.MINECRAFT_1_7_2),
-        ProtocolVersion.MINECRAFT_1_7_2, ProtocolVersion.MINECRAFT_1_15_2, protocol);
-    disconnect.prepare(Disconnect.create(component, ProtocolVersion.MINECRAFT_1_16),
-        ProtocolVersion.MINECRAFT_1_16, protocol);
-    if (protocol == StateRegistry.LOGIN) {
-      disconnect.finish();
-      return disconnect;
-    }
-    return processCompression(disconnect);
-  }
-
-  private <T extends PreparedPacket<?>> T processCompression(T preparedPacket) {
-    if (packetCompressor.isCompressionEnabled()) {
-      preparedPacket.processCompress(packetCompressor);
-    }
-    preparedPacket.finish();
-    return preparedPacket;
-  }
-
-  public void releaseAll() {
-    for (PreparedPacket packet : Arrays.asList(alreadyConnected)) {
-      if (packet != null) {
-        packet.releaseBuffers();
-      }
-    }
-    if (spawnPackets != null) {
-      spawnPackets.release();
-    }
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/commands/AlertCommand.java b/proxy/src/main/java/net/elytrium/elytraproxy/commands/AlertCommand.java
index d1cbb572..f01a0c0e 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/commands/AlertCommand.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/commands/AlertCommand.java
@@ -44,26 +44,17 @@ public class AlertCommand implements SimpleCommand {
       source.sendMessage(
           LegacyComponentSerializer
               .legacyAmpersand()
-              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.ALERT_MESSAGE_NEEDED
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ));
+              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.ALERT_MESSAGE_NEEDED));
     } else {
       String message = String.join(" ", args);
       Component component = LegacyComponentSerializer
           .legacyAmpersand()
-          .deserialize((Settings.IMP.MESSAGES.ELYTRAPROXY.ALERT_PREFIX + message)
-              .replace("{NL}", "\n")
-              .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-          );
+          .deserialize((Settings.IMP.MESSAGES.ELYTRAPROXY.ALERT_PREFIX + message));
       if (server.getAllPlayers().size() == 0) {
         source.sendMessage(
             LegacyComponentSerializer
                 .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.ALERT_SERVER_EMPTY
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ));
+                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.ALERT_SERVER_EMPTY));
       } else if (server.getAllPlayers().size() >= 1) {
         if (!(source instanceof Player)) {
           source.sendMessage(component);
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/commands/ChangePasswordCommand.java b/proxy/src/main/java/net/elytrium/elytraproxy/commands/ChangePasswordCommand.java
new file mode 100644
index 00000000..0eca4179
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/commands/ChangePasswordCommand.java
@@ -0,0 +1,57 @@
+/*
+ * Copyright (C) 2021 Elytrium
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.commands;
+
+import com.google.common.collect.ImmutableMap;
+import com.velocitypowered.api.command.CommandSource;
+import com.velocitypowered.api.command.SimpleCommand;
+import com.velocitypowered.api.proxy.Player;
+import net.elytrium.elytraproxy.auth.handler.AuthSessionHandler;
+import net.elytrium.elytraproxy.config.Settings;
+import net.elytrium.elytraproxy.database.Database;
+import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
+
+public class ChangePasswordCommand implements SimpleCommand {
+
+  private final Database database;
+
+  public ChangePasswordCommand(Database database) {
+    this.database = database;
+  }
+
+  @Override
+  public void execute(final Invocation invocation) {
+    final CommandSource source = invocation.source();
+    final String[] args = invocation.arguments();
+
+    if (args.length != 1 || !(source instanceof Player)) {
+      source.sendMessage(
+          LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.AUTH.STRINGS.CHANGE_PASSWORD_USAGE));
+    } else {
+      database.updateMap(Settings.IMP.AUTH.TABLE,
+          ImmutableMap.of("nickname", ((Player) source).getUsername()),
+          ImmutableMap.of("hash", AuthSessionHandler.genHash(args[0])));
+      source.sendMessage(
+          LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.AUTH.STRINGS.CHANGE_PASSWORD_SUCCESSFUL));
+    }
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/commands/ElytraProxyCommand.java b/proxy/src/main/java/net/elytrium/elytraproxy/commands/ElytraProxyCommand.java
index 4a622823..850e4d73 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/commands/ElytraProxyCommand.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/commands/ElytraProxyCommand.java
@@ -27,11 +27,13 @@ import com.velocitypowered.proxy.command.builtin.CommandMessages;
 import com.velocitypowered.proxy.connection.client.ConnectedPlayer;
 import java.util.ArrayList;
 import java.util.Arrays;
+import java.util.Collections;
 import java.util.List;
 import java.util.Locale;
 import java.util.Map;
 import java.util.Timer;
 import java.util.TimerTask;
+import java.util.UUID;
 import lombok.Getter;
 import net.elytrium.elytraproxy.ElytraProxy;
 import net.elytrium.elytraproxy.config.Settings;
@@ -46,7 +48,7 @@ import org.checkerframework.checker.nullness.qual.NonNull;
 public class ElytraProxyCommand implements SimpleCommand {
 
   @Getter
-  private static final List<ConnectedPlayer> playersWithSpy = new ArrayList<>();
+  private static final List<UUID> playersWithSpy = Collections.synchronizedList(new ArrayList<>());
 
   private interface SubCommand {
 
@@ -75,22 +77,16 @@ public class ElytraProxyCommand implements SimpleCommand {
   }
 
   private void usage(CommandSource source) {
-    source.sendMessage(Identity.nil(), Component.text("eThis server is using ElytraProxy"
-          + " that based on Velocity Proxy"));
-    source.sendMessage(Identity.nil(), Component.text("eOriginal Velocity by astei"
-          + " and many-many contributors"));
-    source.sendMessage(Identity.nil(), Component.text("eElytraProxy by Elytrium dev team"));
-    source.sendMessage(Identity.nil(), Component.text("dMade With Love "));
-    source.sendMessage(Identity.nil(), Component.text("a"
-          + "https://github.com/Elytrium/ElytraProxy"));
+    source.sendMessage(Identity.nil(), Component.text("eThis server is using ElytraProxy by Elytrium devs team"));
+    source.sendMessage(Identity.nil(), Component.text("eOriginal Velocity by astei and many-many contributors"));
+    source.sendMessage(Identity.nil(), Component.text("ahttps://github.com/Elytrium/ElytraProxy"));
     if (source.hasPermission("elytraproxy.command.reload")
         || source.hasPermission("elytraproxy.command.stats")
         || source.hasPermission("elytraproxy.command.commandspy")) {
       source.sendMessage(Identity.nil(), Component.text("aCommands: "));
       source.sendMessage(Identity.nil(), Component.text("6/elytraproxy reload 7-f"
           + " reloads proxy server itself, without plugins"));
-      source.sendMessage(Identity.nil(), Component.text("6/elytraproxy stats 7-f"
-          + " enable action bar statistic"));
+      source.sendMessage(Identity.nil(), Component.text("6/elytraproxy stats 7-f enable action bar statistics"));
     }
   }
 
@@ -128,8 +124,7 @@ public class ElytraProxyCommand implements SimpleCommand {
 
     if (currentArgs.length == 1) {
       return commands.entrySet().stream()
-          .filter(e -> e.getKey().regionMatches(true, 0, currentArgs[0], 0,
-              currentArgs[0].length()))
+          .filter(e -> e.getKey().regionMatches(true, 0, currentArgs[0], 0, currentArgs[0].length()))
           .filter(e -> e.getValue().hasPermission(source, new String[0]))
           .map(Map.Entry::getKey)
           .collect(ImmutableList.toImmutableList());
@@ -176,31 +171,22 @@ public class ElytraProxyCommand implements SimpleCommand {
     public void execute(CommandSource source, String @NonNull [] args) {
       try {
         if (server.reloadConfiguration()) {
-          source.sendMessage(Identity.nil(),
+          source.sendMessage(
               LegacyComponentSerializer
                   .legacyAmpersand()
-                  .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.RELOAD_SUCCESS
-                      .replace("{NL}", "\n")
-                      .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                  ));
+                  .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.RELOAD_SUCCESS));
         } else {
-          source.sendMessage(Identity.nil(),
+          source.sendMessage(
               LegacyComponentSerializer
                   .legacyAmpersand()
-                  .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.RELOAD_FAILURE
-                      .replace("{NL}", "\n")
-                      .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                  ));
+                  .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.RELOAD_FAILURE));
         }
       } catch (Exception e) {
         logger.error("Unable to reload configuration", e);
-        source.sendMessage(Identity.nil(),
+        source.sendMessage(
             LegacyComponentSerializer
                 .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.RELOAD_FAILURE
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ));
+                .deserialize(Settings.IMP.MESSAGES.VELOCITY.COMMAND.RELOAD_FAILURE));
       }
 
       elytraProxy.reload(source);
@@ -214,7 +200,7 @@ public class ElytraProxyCommand implements SimpleCommand {
 
   private static class Stats implements SubCommand {
 
-    private final List<ConnectedPlayer> playersWithStats = new ArrayList<>();
+    private final List<UUID> playersWithStats = Collections.synchronizedList(new ArrayList<>());
 
     private Stats(VelocityServer server) {
 
@@ -226,19 +212,16 @@ public class ElytraProxyCommand implements SimpleCommand {
               return;
             }
             Statistics statistics = server.getElytraProxy().getStatistics();
-            for (ConnectedPlayer player : playersWithStats) {
-              player.sendActionBar(
-                  LegacyComponentSerializer
-                      .legacyAmpersand()
-                      .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.STATS_FORMAT
-                          .replace("{NL}", "\n")
-                          .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                          .replace("{0}", String.valueOf(statistics.getBlockedConnections()))
-                          .replace("{1}", String.valueOf(statistics.getConnectionsPerSecond()))
-                          .replace("{2}", String.valueOf(statistics.getPingsPerSecond()))
-                          .replace("{3}", String.valueOf(statistics.getTotalConnectionsPerSecond()))
-                      ));
-            }
+            playersWithStats.stream().map(server::getPlayer).forEach(player -> player.ifPresent(p -> p.sendActionBar(
+                LegacyComponentSerializer
+                    .legacyAmpersand()
+                    .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.STATS_FORMAT
+                        .replace("{0}", String.valueOf(statistics.getBlockedConnections()))
+                        .replace("{1}", String.valueOf(statistics.getConnectionsPerSecond()))
+                        .replace("{2}", String.valueOf(statistics.getPingsPerSecond()))
+                        .replace("{3}", String.valueOf(statistics.getTotalConnectionsPerSecond()))
+                        .replace("{4}", String.valueOf(p.getPing()))
+                    ))));
           } catch (Exception e) {
             e.printStackTrace();
           }
@@ -253,24 +236,18 @@ public class ElytraProxyCommand implements SimpleCommand {
         return;
       }
       ConnectedPlayer player = (ConnectedPlayer) source;
-      if (playersWithStats.contains(player)) {
+      if (playersWithStats.contains(player.getUniqueId())) {
         source.sendMessage(
             LegacyComponentSerializer
                 .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.STATS_DISABLED
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ));
-        playersWithStats.remove(player);
+                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.STATS_DISABLED));
+        playersWithStats.remove(player.getUniqueId());
       } else {
         source.sendMessage(
             LegacyComponentSerializer
                 .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.STATS_ENABLED
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ));
-        playersWithStats.add(player);
+                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.STATS_ENABLED));
+        playersWithStats.add(player.getUniqueId());
       }
     }
 
@@ -282,10 +259,6 @@ public class ElytraProxyCommand implements SimpleCommand {
 
   private static class CommandSpy implements SubCommand {
 
-
-    private CommandSpy() {
-    }
-
     @Override
     public void execute(CommandSource source, String @NonNull [] args) {
       if (!(source instanceof Player)) {
@@ -293,24 +266,18 @@ public class ElytraProxyCommand implements SimpleCommand {
         return;
       }
       ConnectedPlayer player = (ConnectedPlayer) source;
-      if (playersWithSpy.contains(player)) {
+      if (playersWithSpy.contains(player.getUniqueId())) {
         source.sendMessage(
             LegacyComponentSerializer
                 .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.COMMAND_SPY_DISABLED
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ));
-        playersWithSpy.remove(player);
+                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.COMMAND_SPY_DISABLED));
+        playersWithSpy.remove(player.getUniqueId());
       } else {
         source.sendMessage(
             LegacyComponentSerializer
                 .legacyAmpersand()
-                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.COMMAND_SPY_ENABLED
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-                ));
-        playersWithSpy.add(player);
+                .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.COMMAND_SPY_ENABLED));
+        playersWithSpy.add(player.getUniqueId());
       }
     }
 
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/commands/FindCommand.java b/proxy/src/main/java/net/elytrium/elytraproxy/commands/FindCommand.java
index 0230c0d7..9d9acf7c 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/commands/FindCommand.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/commands/FindCommand.java
@@ -63,10 +63,7 @@ public class FindCommand implements SimpleCommand {
       source.sendMessage(
           LegacyComponentSerializer
               .legacyAmpersand()
-              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.FIND_USERNAME_NEEDED
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ));
+              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.FIND_USERNAME_NEEDED));
     } else {
       Optional<Player> player = server.getPlayer(args[0]);
       if (player.isPresent()) {
@@ -76,8 +73,6 @@ public class FindCommand implements SimpleCommand {
             LegacyComponentSerializer
                 .legacyAmpersand()
                 .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.FIND_USER_ONLINE_AT
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
                     .replace("{0}", pl.getUsername())
                     .replace("{1}", srv.getServerInfo().getName())
                 )));
@@ -86,8 +81,6 @@ public class FindCommand implements SimpleCommand {
             LegacyComponentSerializer
                 .legacyAmpersand()
                 .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.USER_NOT_ONLINE
-                    .replace("{NL}", "\n")
-                    .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
                     .replace("{0}", args[0])
                 ));
       }
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/commands/MessageCommand.java b/proxy/src/main/java/net/elytrium/elytraproxy/commands/MessageCommand.java
deleted file mode 100644
index c93d30cb..00000000
--- a/proxy/src/main/java/net/elytrium/elytraproxy/commands/MessageCommand.java
+++ /dev/null
@@ -1,122 +0,0 @@
-/*
- * Copyright (C) 2021 Elytrium
- *
- * This program is free software: you can redistribute it and/or modify
- * it under the terms of the GNU Affero General Public License as published by
- * the Free Software Foundation, either version 3 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU Affero General Public License for more details.
- *
- * You should have received a copy of the GNU Affero General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
- */
-
-package net.elytrium.elytraproxy.commands;
-
-import com.google.common.collect.ImmutableList;
-import com.velocitypowered.api.command.CommandSource;
-import com.velocitypowered.api.command.SimpleCommand;
-import com.velocitypowered.api.proxy.Player;
-import com.velocitypowered.api.proxy.ProxyServer;
-import com.velocitypowered.api.proxy.ServerConnection;
-import java.util.Arrays;
-import java.util.List;
-import java.util.Optional;
-import java.util.stream.Collectors;
-import net.elytrium.elytraproxy.config.Settings;
-import net.kyori.adventure.text.Component;
-import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
-
-public class MessageCommand implements SimpleCommand {
-
-  private final ProxyServer server;
-
-  public MessageCommand(ProxyServer server) {
-    this.server = server;
-  }
-
-  @Override
-  public List<String> suggest(final SimpleCommand.Invocation invocation) {
-    final CommandSource source = invocation.source();
-
-    if (source instanceof Player) {
-      Optional<ServerConnection> serverConnection = ((Player) source).getCurrentServer();
-      if (serverConnection.isPresent()) {
-        return serverConnection.get()
-            .getServer()
-            .getPlayersConnected()
-            .stream()
-            .map(Player::getUsername)
-            .collect(Collectors.toList());
-      }
-    }
-    return ImmutableList.of();
-  }
-
-  @Override
-  public void execute(final Invocation invocation) {
-    final CommandSource source = invocation.source();
-    final String[] args = invocation.arguments();
-
-    if (args.length == 0) {
-      source.sendMessage(
-          LegacyComponentSerializer
-              .legacyAmpersand()
-              .deserialize("&c  ,     "
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ));
-      return;
-    }
-
-    if (args.length == 1) {
-      source.sendMessage(
-          LegacyComponentSerializer
-              .legacyAmpersand()
-              .deserialize("&c ,     "
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ));
-      return;
-    }
-
-    Optional<Player> playerOptional = server.getPlayer(args[0]);
-    if (playerOptional.isPresent()) {
-      Player player = playerOptional.get();
-      String message = String.join(" ", Arrays.copyOfRange(args, 1, args.length - 1));
-      String author = (source instanceof Player) ? ((Player) source).getUsername()
-          : Settings.IMP.MESSAGES.ELYTRAPROXY.IF_CONSOLE
-              .replace("{NL}", "\n")
-              .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX);
-
-      Component component = LegacyComponentSerializer
-          .legacyAmpersand()
-          .deserialize("&d&l[{0}->{1}] {2}"
-              .replace("{NL}", "\n")
-              .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              .replace("{0}", author)
-              .replace("{1}", player.getUsername())
-              .replace("{2}", message)
-          );
-
-      player.sendMessage(component);
-    } else {
-      source.sendMessage(
-          LegacyComponentSerializer
-              .legacyAmpersand()
-              .deserialize("&c  ,     "
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ));
-    }
-  }
-
-  @Override
-  public boolean hasPermission(final SimpleCommand.Invocation invocation) {
-    return true;
-  }
-}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/commands/SendCommand.java b/proxy/src/main/java/net/elytrium/elytraproxy/commands/SendCommand.java
index b4480320..4103669d 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/commands/SendCommand.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/commands/SendCommand.java
@@ -77,10 +77,7 @@ public class SendCommand implements SimpleCommand {
       source.sendMessage(
           LegacyComponentSerializer
               .legacyAmpersand()
-              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.SEND_NOT_ENOUGH_ARGUMENTS
-                  .replace("{NL}", "\n")
-                  .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
-              ));
+              .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.SEND_NOT_ENOUGH_ARGUMENTS));
       return;
     }
 
@@ -90,16 +87,13 @@ public class SendCommand implements SimpleCommand {
       return;
     }
 
-    String sender = (source instanceof Player) ? ((Player) source).getUsername()
-        : Settings.IMP.MESSAGES.ELYTRAPROXY.IF_CONSOLE
-            .replace("{NL}", "\n")
-            .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX);
+    String sender = (source instanceof Player)
+        ? ((Player) source).getUsername()
+        : Settings.IMP.MESSAGES.ELYTRAPROXY.IF_CONSOLE;
 
     Component summoned = LegacyComponentSerializer
         .legacyAmpersand()
         .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.SEND_YOU_GOT_SUMMONED
-            .replace("{NL}", "\n")
-            .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
             .replace("{0}", target.getServerInfo().getName())
             .replace("{1}", sender)
         );
@@ -135,8 +129,6 @@ public class SendCommand implements SimpleCommand {
               LegacyComponentSerializer
                   .legacyAmpersand()
                   .deserialize(Settings.IMP.MESSAGES.ELYTRAPROXY.USER_NOT_ONLINE
-                      .replace("{NL}", "\n")
-                      .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX)
                       .replace("{0}", args[0])
                   ));
         }
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/commands/TotpCommand.java b/proxy/src/main/java/net/elytrium/elytraproxy/commands/TotpCommand.java
new file mode 100644
index 00000000..0824e96b
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/commands/TotpCommand.java
@@ -0,0 +1,156 @@
+/*
+ * Copyright (C) 2021 Elytrium
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.commands;
+
+import com.google.common.collect.ImmutableMap;
+import com.velocitypowered.api.command.CommandSource;
+import com.velocitypowered.api.command.SimpleCommand;
+import com.velocitypowered.api.proxy.Player;
+import dev.samstevens.totp.qr.QrData;
+import dev.samstevens.totp.recovery.RecoveryCodeGenerator;
+import dev.samstevens.totp.secret.DefaultSecretGenerator;
+import dev.samstevens.totp.secret.SecretGenerator;
+import java.net.URLEncoder;
+import java.nio.charset.StandardCharsets;
+import java.util.Locale;
+import lombok.SneakyThrows;
+import net.elytrium.elytraproxy.auth.handler.AuthSessionHandler;
+import net.elytrium.elytraproxy.auth.model.RegisteredPlayer;
+import net.elytrium.elytraproxy.config.Settings;
+import net.elytrium.elytraproxy.database.Database;
+import net.kyori.adventure.text.event.ClickEvent;
+import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
+
+public class TotpCommand implements SimpleCommand {
+
+  private final SecretGenerator secretGenerator = new DefaultSecretGenerator();
+  private final Database database;
+
+  public TotpCommand(Database database) {
+    this.database = database;
+  }
+
+  @SneakyThrows
+  @Override
+  public void execute(final Invocation invocation) {
+    final CommandSource source = invocation.source();
+    final String[] args = invocation.arguments();
+
+    if (args.length == 0 || !(source instanceof Player)) {
+      sendUsage(source);
+    } else {
+      String username = ((Player) source).getUsername();
+
+      switch (args[0]) {
+        case "enable":
+          RegisteredPlayer playerInfo =
+              AuthSessionHandler.fetchInfo(database, username.toLowerCase(Locale.ROOT));
+
+          if (playerInfo == null) {
+            source.sendMessage(LegacyComponentSerializer
+                .legacyAmpersand()
+                .deserialize(Settings.IMP.AUTH.STRINGS.TOTP_NON_REGISTERED));
+            return;
+          }
+
+          if (!playerInfo.totpToken.isBlank()) {
+            source.sendMessage(LegacyComponentSerializer
+                .legacyAmpersand()
+                .deserialize(Settings.IMP.AUTH.STRINGS.TOTP_ALREADY_ENABLED));
+            return;
+          }
+
+          String secret = secretGenerator.generate();
+
+          database.updateMap(Settings.IMP.AUTH.TABLE,
+              ImmutableMap.of("nickname", username),
+              ImmutableMap.of("totpToken", secret));
+
+          source.sendMessage(LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.AUTH.STRINGS.TOTP_SUCCESSFUL));
+
+          QrData data = new QrData.Builder()
+              .label(username)
+              .secret(secret)
+              .issuer(Settings.IMP.AUTH.TOTP_ISSUER)
+              .build();
+
+          String qrUrl = Settings.IMP.AUTH.QR_GENERATOR_URL
+              .replace("{data}", URLEncoder.encode(data.getUri(), StandardCharsets.UTF_8));
+
+          source.sendMessage(LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.AUTH.STRINGS.TOTP_QR)
+              .clickEvent(ClickEvent.openUrl(qrUrl)));
+
+          source.sendMessage(LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.AUTH.STRINGS.TOTP_TOKEN + secret)
+              .clickEvent(ClickEvent.suggestCommand(secret)));
+
+          RecoveryCodeGenerator recoveryCodes = new RecoveryCodeGenerator();
+          String[] codes = recoveryCodes.generateCodes(16);
+          source.sendMessage(LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.AUTH.STRINGS.TOTP_RECOVERY
+                  + String.join(", ", codes)));
+          break;
+        case "disable":
+          if (args.length != 2) {
+            sendUsage(source);
+            return;
+          }
+
+          playerInfo =
+              AuthSessionHandler.fetchInfo(database, username.toLowerCase(Locale.ROOT));
+
+          if (playerInfo == null) {
+            source.sendMessage(LegacyComponentSerializer
+                .legacyAmpersand()
+                .deserialize(Settings.IMP.AUTH.STRINGS.TOTP_NON_REGISTERED));
+            return;
+          }
+
+          if (AuthSessionHandler.getVerifier().isValidCode(playerInfo.totpToken, args[1])) {
+            database.updateMap(Settings.IMP.AUTH.TABLE,
+                ImmutableMap.of("nickname", username),
+                ImmutableMap.of("totpToken", ""));
+            source.sendMessage(LegacyComponentSerializer
+                .legacyAmpersand()
+                .deserialize(Settings.IMP.AUTH.STRINGS.TOTP_DISABLED));
+          } else {
+            source.sendMessage(LegacyComponentSerializer
+                .legacyAmpersand()
+                .deserialize(Settings.IMP.AUTH.STRINGS.TOTP_WRONG));
+          }
+          break;
+        default:
+          sendUsage(source);
+          break;
+      }
+    }
+  }
+
+  private void sendUsage(CommandSource source) {
+    source.sendMessage(
+        LegacyComponentSerializer
+            .legacyAmpersand()
+            .deserialize(Settings.IMP.AUTH.STRINGS.TOTP_USAGE));
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/commands/UnregisterCommand.java b/proxy/src/main/java/net/elytrium/elytraproxy/commands/UnregisterCommand.java
new file mode 100644
index 00000000..75066f58
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/commands/UnregisterCommand.java
@@ -0,0 +1,61 @@
+/*
+ * Copyright (C) 2021 Elytrium
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.commands;
+
+import com.google.common.collect.ImmutableMap;
+import com.velocitypowered.api.command.CommandSource;
+import com.velocitypowered.api.command.SimpleCommand;
+import java.util.Locale;
+import net.elytrium.elytraproxy.config.Settings;
+import net.elytrium.elytraproxy.database.Database;
+import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
+
+public class UnregisterCommand implements SimpleCommand {
+
+  private final Database database;
+
+  public UnregisterCommand(Database database) {
+    this.database = database;
+  }
+
+  @Override
+  public void execute(final Invocation invocation) {
+    final CommandSource source = invocation.source();
+    final String[] args = invocation.arguments();
+
+    if (args.length != 1) {
+      source.sendMessage(
+          LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.AUTH.STRINGS.UNREGISTER_USAGE));
+    } else {
+      database.deleteMap(
+          Settings.IMP.AUTH.TABLE,
+          ImmutableMap.of("lowercaseNickname", args[0].toLowerCase(Locale.ROOT)));
+      source.sendMessage(
+          LegacyComponentSerializer
+              .legacyAmpersand()
+              .deserialize(Settings.IMP.AUTH.STRINGS.UNREGISTER_SUCCESSFUL));
+    }
+  }
+
+  @Override
+  public boolean hasPermission(final Invocation invocation) {
+    return invocation.source().hasPermission("elytraproxy.auth.unregister");
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/config/Config.java b/proxy/src/main/java/net/elytrium/elytraproxy/config/Config.java
index 9b5cedfd..871941bb 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/config/Config.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/config/Config.java
@@ -96,6 +96,10 @@ public class Config {
       if (value instanceof Configuration) {
         set((Configuration) value, newPath);
         continue;
+      } else if (value instanceof String) {
+        set(newPath, ((String) value).replace("{NL}", "\n")
+            .replace("{PRFX}", Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX));
+        continue;
       }
       set(newPath, value);
     }
@@ -193,7 +197,7 @@ public class Config {
           save(lines, current, value, indent + 2);
         } else {
           lines.add(spacing + toNodeName(field.getName() + ": ")
-              + toYamlString(field.get(instance), spacing));
+              + toYamlString(field, field.get(instance), spacing));
         }
       }
     } catch (RuntimeException e) {
@@ -236,7 +240,10 @@ public class Config {
   public @interface Ignore {
   }
 
-  private String toYamlString(Object value, String spacing) {
+  private String toYamlString(Field field, Object value, String spacing) {
+    if (value == null) {
+      return "null";
+    }
     if (value instanceof List) {
       Collection<?> listValue = (Collection<?>) value;
       if (listValue.isEmpty()) {
@@ -245,7 +252,7 @@ public class Config {
       StringBuilder m = new StringBuilder();
       for (Object obj : listValue) {
         m.append(
-          System.lineSeparator()).append(spacing).append("- ").append(toYamlString(obj, spacing));
+            System.lineSeparator()).append(spacing).append("- ").append(toYamlString(field, obj, spacing));
       }
       return m.toString();
     }
@@ -254,9 +261,15 @@ public class Config {
       if (stringValue.isEmpty()) {
         return "''";
       }
-      return "\"" + stringValue + "\"";
+      String quoted = "\"" + stringValue + "\"";
+      //noinspection ConstantConditions | We don't need to replace when IMP is initalizing
+      if (Settings.IMP == null || field.getName().equalsIgnoreCase("prefix")) {
+        return quoted;
+      }
+      return quoted.replace("\n", "{NL}")
+          .replace(Settings.IMP.MESSAGES.ELYTRAPROXY.PREFIX, "{PRFX}");
     }
-    return value != null ? value.toString() : "null";
+    return value.toString();
   }
 
   /**
@@ -317,9 +330,7 @@ public class Config {
               instance = value;
               split = Arrays.copyOfRange(split, 1, split.length);
               continue;
-            } catch (NoSuchFieldException
-                    | NoSuchMethodException
-                    | InvocationTargetException ignore) {
+            } catch (NoSuchFieldException | NoSuchMethodException | InvocationTargetException ignore) {
               //
             }
             return null;
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/config/Settings.java b/proxy/src/main/java/net/elytrium/elytraproxy/config/Settings.java
index 2751d0bc..9ba78800 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/config/Settings.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/config/Settings.java
@@ -27,7 +27,7 @@ public class Settings extends Config {
   public static final Settings IMP = new Settings();
 
   @Final
-  public String VERSION = "0.1.2-DEV";
+  public String VERSION = "3.0.1";
 
   @Create
   public MESSAGES MESSAGES;
@@ -37,16 +37,13 @@ public class Settings extends Config {
     @Create
     public MESSAGES.ELYTRAPROXY ELYTRAPROXY;
 
-    @Create
-    public MESSAGES.VELOCITY VELOCITY;
-
     public static class ELYTRAPROXY {
-      public String PREFIX = "&5&l[ElytraProxy]";
+      public String PREFIX = "&5&l[ElytraProxy]&f";
       public String ALERT_PREFIX = "&8[&4Alert&8]&f ";
       public String IF_CONSOLE = "CONSOLE";
       public String ALERT_MESSAGE_NEEDED = "{PRFX} &fYou must supply a message.";
       public String ALERT_SERVER_EMPTY = "{PRFX} &fServer is empty.";
-      public String STATS_FORMAT = "&c&lTotal Blocked: &6&l{0}&c&l | Connections Per Second: &6&l{1}&c&l | Pings Per Second: &6&l{2}&c&l | Total Connections Per Second: &6&l{3}";
+      public String STATS_FORMAT = "&c&lTotal Blocked: &6&l{0} &c&l| Connections Per Second: &6&l{1} &c&l| Pings Per Second: &6&l{2} &c&l| Total Connections Per Second: &6&l{3} &c&l| Ping: &6&l{4}";
       public String STATS_ENABLED = "{PRFX} &fNow you see statistics in your action bar.";
       public String STATS_DISABLED = "{PRFX} &fYou're no longer see statistics in your action bar.";
       public String FIND_USERNAME_NEEDED = "{PRFX} &fPlease follow this command by a user name.";
@@ -60,12 +57,13 @@ public class Settings extends Config {
       public String CONSOLE_LOG_COMMAND_EXECUTIONS_FORMAT = "{0} -> executed command {1}";
       public String RELOAD_SUCCESS = "{PRFX} &fElytraProxy configuration successfully reloaded.";
       public String RELOAD_FAILURE = "{PRFX} &cUnable to reload your ElytraProxy configuration. Check the console for more details.";
+      public String DB_FAILURE = "Unable to connect to database.";
 
       @Create
       public MESSAGES.ELYTRAPROXY.KICK KICK;
 
-      @Comment("Kick messages")
       public static class KICK {
+        @Comment("Kick messages")
         public String PROXY_SHUTTING_DOWN = "&cProxy shutting down.";
         public String PROTOCOL_BLOCKED = "&c1.7.x not supported";
         public String NICK_BLOCKED = "&cYour nickname contains forbidden phrases.";
@@ -74,20 +72,18 @@ public class Settings extends Config {
         public String CLIENT_CHECK_SETTINGS_SKIN_PARTS = "&cPlease enable any option from the skin customization to join the server.{NL}&eOptions > Skin Customization";
         public String CLIENT_CHECK_BRAND = "&cYour client doesn't send brand packets.";
       }
-      /*
-      public String MYSQL_LOAD_FAILED: "    . ..."
-      */
     }
 
-    @Comment({
-        "You may found other languages translations here: ",
-        "https://github.com/VelocityPowered/Velocity/tree/dev/2.0.0/proxy/src/main/resources/com/velocitypowered/proxy/l10n"
-    })
+    @Create
+    public MESSAGES.VELOCITY VELOCITY;
+
     public static class VELOCITY {
+      @Comment({
+          "You may found other languages translations here: ",
+          "https://github.com/VelocityPowered/Velocity/tree/dev/3.0.0/proxy/src/main/resources/com/velocitypowered/proxy/l10n"
+      })
       @Create
       public MESSAGES.VELOCITY.ERROR ERROR;
-      @Create
-      public MESSAGES.VELOCITY.COMMAND COMMAND;
 
       public static class ERROR {
         public String ALREADY_CONNECTED = "&cYou are already connected to this server!";
@@ -107,6 +103,9 @@ public class Settings extends Config {
         public String EXTREMELY_OLD_CLIENT = "&cYour client is extremely old. Please update to a newer version of Minecraft.";
       }
 
+      @Create
+      public MESSAGES.VELOCITY.COMMAND COMMAND;
+
       public static class COMMAND {
         public String GENERIC_ERROR = "{PRFX} &fAn error occurred while running this command.";
         public String COMMAND_DOES_NOT_EXIST = "{PRFX} &fThis command does not exist.";
@@ -147,22 +146,19 @@ public class Settings extends Config {
         "{ServerBrand} - returns the server on which the player is located",
         "{ProxyBrand} - returns the proxy original brand"
     })
-    public String BRAND = "{ServerBrand} => {ProxyBrand} (by ElytraDev)";
+    public String BRAND = "{ServerBrand} => {ProxyBrand} (by Elytrium)";
     @Comment("Changes server version in ping request")
-    public String PING_VERSION = "ElytraProxy (by ElytraDev)";
+    public String PING_VERSION = "ElytraProxy (by Elytrium)";
 
     @Create
     public MAIN_SETTINGS.HOSTNAMES_MANAGER HOSTNAMES_MANAGER;
 
-    @Create
-    public MAIN_SETTINGS.MAINTENANCE MAINTENANCE;
-
-    @Comment({
-        "Allows you to reject connection to the server for all domains except yours and direct ip",
-        "Most likely does not work with SRV records"
-    })
     public static class HOSTNAMES_MANAGER {
-      public boolean ENABLE = false;
+      @Comment({
+          "Allows you to reject connection to the server for all domains except yours and direct ip"
+      })
+      public boolean ENABLE_CHECK_ON_PING = false;
+      public boolean ENABLE_CHECK_ON_CONNECTION = false;
       @Comment("If whitelist enabled, all hostnames (domains and ips) in list WON'T BE BLOCKED, but other hostnames WILL BE BLOCKED")
       public boolean WHITELIST = true;
       public boolean DOMAINS_CHECK = false;
@@ -171,15 +167,19 @@ public class Settings extends Config {
       @Comment("IP's in this list will be ignored in check.")
       public List<String> IGNORED_IPS = Arrays.asList("127.0.0.1", "your-haproxy-ip");
     }
+
     @Comment("Players who are on these servers will not be counted in ping request and in the query request.")
     public List<String> IGNORE_ONLINE_AT = Arrays.asList("auth");
 
+    @Create
+    public MAIN_SETTINGS.MAINTENANCE MAINTENANCE;
+
     public static class MAINTENANCE {
       public boolean ENABLED = false;
       public String PING_VERSION = "Maintenance";
       public String MOTD = "&cMaintenance, please wait.";
       public String DISCONNECT_REASON = "&cSorry, but now server is not available due to maintenance";
-      public List<String> IGNORED_PLAYERS = Arrays.asList("4anonymous4");
+      public List<String> IGNORED_PLAYERS = Arrays.asList("mdxd44");
     }
   }
 
@@ -190,6 +190,21 @@ public class Settings extends Config {
     public boolean ENABLE = true;
     public boolean CHECK_CLIENT_SETTINGS = true;
     public boolean CHECK_CLIENT_BRAND = true;
+    public long PURGE_CACHE_MILLIS = 3600000;
+    public int CAPTCHA_ATTEMPTS = 2;
+    public int NON_VALID_POSITION_XZ_ATTEMPTS = 10;
+    public int NON_VALID_POSITION_Y_ATTEMPTS = 10;
+    public int FALLING_CHECK_TICKS = 128;
+    public double MAX_VALID_POSITION_DIFFERENCE = 0.01;
+    public String BRAND = "ElytraProxy BotFilter";
+    @Comment({
+        "If the player needs to reconnect after passing AntiBot check.",
+        "If ONLINE_MODE_NEED_AUTH here and online-mode in velocity.toml is set, then premium players need to reconnect"
+    })
+    public boolean NEED_TO_RECONNECT = false;
+
+    @Comment("Available - ONLY_POSITION, ONLY_CAPTCHA, CAPTCHA_POSITION, CAPTCHA_ON_POSITION_FAILED, SUCCESSFULLY")
+    public String CHECK_STATE = "CAPTCHA_POSITION";
     @Comment({
         "If the player's nickname contains something from this list, hes connection will be rejected",
         "In lowercase"
@@ -197,16 +212,156 @@ public class Settings extends Config {
     public List<String> BANNED_NICK_PATTERNS = Arrays.asList(
         "dropbot", "mcspam", "mcdrop", "mcrage", "mcstorm", "extremebot", "cipher", "biboran"
     );
+
+    @Create
+    public ANTIBOT.CAPTCHA_GENERATOR CAPTCHA_GENERATOR;
+
+    public static class CAPTCHA_GENERATOR {
+      @Comment("Path to the background image to draw on captcha (any format, 128x128), none if empty")
+      public String BACKPLATE_PATH = "";
+      @Comment("Path to the font files to draw on captcha (ttf), can be empty")
+      public List<String> FONTS_PATH = List.of("");
+      @Comment("Use standard fonts(SANS_SERIF/SERIF/MONOSPACED), use false only if you provide fonts path")
+      public boolean USE_STANDARD_FONTS = true;
+      public int FONT_SIZE = 50;
+      public boolean FONT_OUTLINE = true;
+      public boolean FONT_ROTATE = true;
+      public boolean FONT_RIPPLE = true;
+      public boolean FONT_BLUR = true;
+      public String PATTERN = "abcdefghijklmnopqrtuvwxyz1234567890";
+      public int LENGTH = 3;
+    }
+
+    @Create
+    public ANTIBOT.BOTFILTER_DIMENSION BOTFILTER_DIMENSION;
+
+    public static class BOTFILTER_DIMENSION {
+      @Comment({
+          "Normal dimension - 0",
+          "Cave dimension - 1",
+          "Nether - 2",
+          "The end - 3",
+      })
+      public int ID = 3;
+      @Comment({
+          "Normal dimension - 0",
+          "The end - 1",
+          "Nether - 2"
+      })
+      public int LEGACY_ID = 1;
+      @Comment({
+          "Normal dimension - minecraft:overworld",
+          "Cave dimension - minecraft:overworld_caves",
+          "The end - minecraft:the_end",
+          "Nether - minecraft:nether"
+      })
+      public String MODERN_KEY = "minecraft:the_end";
+      public boolean HARDCORE_HEARTS = true;
+    }
+
+    @Create
+    public ANTIBOT.STRINGS STRINGS;
+
+    public static class STRINGS {
+      public String CHECKING = "{PRFX} Bot-Filter check was started, please wait..";
+      public String CHECKING_CAPTCHA = "{PRFX} Please, solve the captcha";
+      public String SUCCESSFUL_CRACKED = "{PRFX} Successfully passed Bot-Filter check. ";
+      public String SUCCESSFUL_PREMIUM = "{PRFX} Successfully passed Bot-Filter check. Please, rejoin the server";
+      public String CAPTCHA_FAILED = "{PRFX} You've mistaken in captcha check. Please, rejoin the server.";
+      public String TOO_BIG_PACKET = "{PRFX} Your client sent too big packet.";
+      public String FALLING_CHECK_FAILED = "{PRFX} Falling Check was failed. Please, rejoin the server.";
+    }
+
+    @Create
+    public ANTIBOT.CAPTCHA_COORDS CAPTCHA_COORDS;
+
+    public static class CAPTCHA_COORDS {
+      public double X = 0;
+      public double Y = 0;
+      public double Z = 0;
+      public double YAW = 0;
+      public double PITCH = 0;
+    }
   }
 
-  /*
   @Create
   public AUTH AUTH;
 
   public static class AUTH {
     public boolean ENABLE = true;
-    public boolean ONLINE_MODE_REQUIRES_LOGIN = false;
+    public boolean ONLINE_MODE_NEED_AUTH = false;
+    public boolean CACHE_AUTH_USERS = true;
+    public long PURGE_CACHE_MILLIS = 3600000;
+    @Comment({
+        "QR Generator URL, set {data} placeholder"
+    })
+    public String QR_GENERATOR_URL = "https://api.qrserver.com/v1/create-qr-code/?data={data}&size=200x200&ecc=M&margin=30";
     public String TABLE = "auth";
+    public String TOTP_ISSUER = "ElytraProxy Auth";
+    public int BCRYPT_COST = 10;
+    public int LOGIN_ATTEMPTS = 3;
+    public int IP_LIMIT_REGISTRATIONS = 3;
+    @Comment("Time in milliseconds, when ip limit works")
+    public long IP_LIMIT_VALID_TIME = 21600000;
+    public String ALLOWED_NICKNAME_CHARS = "abcdefghijklmnopqrstuvwxyz_0123456789";
+
+    @Create
+    public AUTH.STRINGS STRINGS;
+
+    public static class STRINGS {
+      public String LOGIN = "{PRFX} Please, login using &a/l password";
+      public String TOTP = "{PRFX} Please, enter your 2FA key using &a/2fa key";
+      public String PASSWORD_WRONG = "{PRFX} Password is wrong";
+      public String WRONG_NICKNAME_CASE = "{PRFX} The case of your nickname is wrong. Nickname is CaSe SeNsItIvE.";
+      public String REGISTER = "{PRFX} Please, register using &a/reg password password";
+      public String NICKNAME_PREMIUM = "{PRFX} Your nickname is set on premium account. Please, change your nickname";
+      public String NICKNAME_INVALID = "{PRFX} Your nickname includes forbidden characters. Please, change your nickname";
+      public String IP_LIMIT = "{PRFX} Your IP has reached max registered accounts. If this is an error, restart your router, or wait about 6 hours";
+      public String UNREGISTER_USAGE = "{PRFX} Usage: /unregister <nickname>";
+      public String UNREGISTER_SUCCESSFUL = "{PRFX} Successfully unregistered player";
+      public String CHANGE_PASSWORD_USAGE = "{PRFX} Usage: /changepass <old password> <new password>";
+      public String CHANGE_PASSWORD_SUCCESSFUL = "{PRFX} Successfully changed password";
+      public String TOTP_USAGE = "{PRFX} Usage: &a/2fa enable &for &a/2fa disable <totp key>";
+      public String TOTP_WRONG = "{PRFX} Wrong totp key";
+      public String TOTP_SUCCESSFUL = "{PRFX} Successfully enabled 2FA";
+      public String TOTP_ALREADY_ENABLED = "{PRFX} 2FA is already enabled. Disable it using /2fa disable <totp key>";
+      public String TOTP_NON_REGISTERED = "{PRFX} You are not registered on this proxy.";
+      public String TOTP_DISABLED = "{PRFX} Successfully disabled 2FA";
+      public String TOTP_QR = "{PRFX} Click to open 2FA QR code in browser. ";
+      public String TOTP_TOKEN = "{PRFX} Your TOTP token (Click to copy): ";
+      public String TOTP_RECOVERY = "{PRFX} Your recovey codes: ";
+    }
+
+    @Create
+    public AUTH.AUTH_COORDS AUTH_COORDS;
+
+    public static class AUTH_COORDS {
+      public double X = 0;
+      public double Y = 0;
+      public double Z = 0;
+      public double YAW = 0;
+      public double PITCH = 0;
+    }
+  }
+
+  @Create
+  public VIRTUAL VIRTUAL;
+
+  @Comment("Settings of Virtual Server")
+  public static class VIRTUAL {
+    public boolean LOAD_WORLD = false;
+    @Comment("World file type: schematic")
+    public String WORLD_FILE_TYPE = "schematic";
+    public String WORLD_FILE_PATH = "world.schematic";
+
+    @Create
+    public VIRTUAL.VIRTUAL_COORDS VIRTUAL_COORDS;
+
+    public static class VIRTUAL_COORDS {
+      public int X = 0;
+      public int Y = 0;
+      public int Z = 0;
+    }
   }
 
   @Create
@@ -214,16 +369,14 @@ public class Settings extends Config {
 
   @Comment("Database settings")
   public static class DATABASE {
-    //@Comment(" . mysql  mysql))")
-    //public String STORAGE_TYPE = "mysql";
-    @Comment("Settings for MYSQL")
-    public String HOSTNAME = "127.0.0.1";
-    public int PORT = 3306;
+    // @Comment("  , mysql  mysql))")
+    // public String STORAGE_TYPE = "mysql";
+    public boolean ENABLED = true;
+    public String HOSTNAME = "127.0.0.1:3306";
     public String USER = "user";
     public String PASSWORD = "password";
     public String DATABASE = "elytraproxy";
   }
-  */
 
   public void reload(File file) {
     load(file);
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/Configuration.java b/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/Configuration.java
index 00e952da..dff43f2b 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/Configuration.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/Configuration.java
@@ -63,8 +63,8 @@ public final class Configuration {
       String key = (entry.getKey() == null) ? "null" : entry.getKey().toString();
 
       if (entry.getValue() instanceof Map) {
-        this.self.put(key, new Configuration((Map) entry.getValue(),
-            (defaults == null) ? null : defaults.getSection(key)));
+        this.self
+            .put(key, new Configuration((Map) entry.getValue(), (defaults == null) ? null : defaults.getSection(key)));
       } else {
         this.self.put(key, entry.getValue());
       }
@@ -124,8 +124,7 @@ public final class Configuration {
 
   public void set(String path, Object value) {
     if (value instanceof Map) {
-      value = new Configuration((Map) value,
-          (defaults == null) ? null : defaults.getSection(path));
+      value = new Configuration((Map) value, (defaults == null) ? null : defaults.getSection(path));
     }
 
     Configuration section = getSectionFor(path);
@@ -143,9 +142,9 @@ public final class Configuration {
   /*------------------------------------------------------------------------*/
   public Configuration getSection(String path) {
     Object def = getDefault(path);
-    return (Configuration) get(path,
-        (def instanceof Configuration) ? def : new Configuration((
-            defaults == null) ? null : defaults.getSection(path)));
+    return (Configuration) get(path, (def instanceof Configuration)
+        ? def
+        : new Configuration((defaults == null) ? null : defaults.getSection(path)));
   }
 
   /**
@@ -338,6 +337,7 @@ public final class Configuration {
         result.add((Character) object);
       }
     }
+
     return result;
   }
 
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/ConfigurationProvider.java b/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/ConfigurationProvider.java
index f822dec9..34025952 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/ConfigurationProvider.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/ConfigurationProvider.java
@@ -43,8 +43,7 @@ import java.util.Map;
 
 public abstract class ConfigurationProvider {
 
-  private static final Map<Class<? extends ConfigurationProvider>,
-      ConfigurationProvider> providers = new HashMap<>();
+  private static final Map<Class<? extends ConfigurationProvider>, ConfigurationProvider> providers = new HashMap<>();
 
   static {
     try {
@@ -52,6 +51,12 @@ public abstract class ConfigurationProvider {
     } catch (NoClassDefFoundError ex) {
       // Ignore, no SnakeYAML
     }
+
+    try {
+      providers.put(JsonConfiguration.class, new JsonConfiguration());
+    } catch (NoClassDefFoundError ex) {
+      // Ignore, no Gson
+    }
   }
 
   public static ConfigurationProvider getProvider(Class<? extends ConfigurationProvider> provider) {
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/JsonConfiguration.java b/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/JsonConfiguration.java
new file mode 100644
index 00000000..90d42c71
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/JsonConfiguration.java
@@ -0,0 +1,131 @@
+/*
+ * This file is part of BungeeCord, licensed under the BSD License (BSD).
+ *
+ * Copyright (c) 2012 md_5
+ *
+ * All rights reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions are met:
+ *
+ *     * Redistributions of source code must retain the above copyright notice,
+ *       this list of conditions and the following disclaimer.
+ *     * Redistributions in binary form must reproduce the above copyright notice,
+ *       this list of conditions and the following disclaimer in the documentation
+ *       and/or other materials provided with the distribution.
+ *     * The name of the author may not be used to endorse or promote products derived
+ *       from this software without specific prior written permission.
+ *     * You may not use the software for commercial software hosting services without
+ *       written permission from the author.
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
+ * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
+ * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
+ * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
+ * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
+ * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
+ * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
+ * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
+ * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
+ */
+
+package net.elytrium.elytraproxy.config.helpers;
+
+import com.google.common.base.Charsets;
+import com.google.gson.Gson;
+import com.google.gson.GsonBuilder;
+import com.google.gson.JsonElement;
+import com.google.gson.JsonSerializationContext;
+import com.google.gson.JsonSerializer;
+import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.io.OutputStreamWriter;
+import java.io.Reader;
+import java.io.Writer;
+import java.lang.reflect.Type;
+import java.util.LinkedHashMap;
+import java.util.Map;
+import lombok.AccessLevel;
+import lombok.NoArgsConstructor;
+
+@NoArgsConstructor(access = AccessLevel.PACKAGE)
+public class JsonConfiguration extends ConfigurationProvider {
+
+  private final Gson json = new GsonBuilder().serializeNulls().setPrettyPrinting()
+      .registerTypeAdapter(Configuration.class, new JsonSerializer<Configuration>() {
+        @Override
+        public JsonElement serialize(Configuration src, Type typeOfSrc, JsonSerializationContext context) {
+          return context.serialize(((Configuration) src).self);
+        }
+      }).create();
+
+  @Override
+  public void save(Configuration config, File file) throws IOException {
+    try (Writer writer = new OutputStreamWriter(new FileOutputStream(file), Charsets.UTF_8)) {
+      save(config, writer);
+    }
+  }
+
+  @Override
+  public void save(Configuration config, Writer writer) {
+    json.toJson(config.self, writer);
+  }
+
+  @Override
+  public Configuration load(File file) throws IOException {
+    return load(file, null);
+  }
+
+  @Override
+  public Configuration load(File file, Configuration defaults) throws IOException {
+    try (FileInputStream is = new FileInputStream(file)) {
+      return load(is, defaults);
+    }
+  }
+
+  @Override
+  public Configuration load(Reader reader) {
+    return load(reader, null);
+  }
+
+  @Override
+  @SuppressWarnings("unchecked")
+  public Configuration load(Reader reader, Configuration defaults) {
+    Map<String, Object> map = json.fromJson(reader, LinkedHashMap.class);
+    if (map == null) {
+      map = new LinkedHashMap<>();
+    }
+    return new Configuration(map, defaults);
+  }
+
+  @Override
+  public Configuration load(InputStream is) {
+    return load(is, null);
+  }
+
+  @Override
+  public Configuration load(InputStream is, Configuration defaults) {
+    return load(new InputStreamReader(is, Charsets.UTF_8), defaults);
+  }
+
+  @Override
+  public Configuration load(String string) {
+    return load(string, null);
+  }
+
+  @Override
+  @SuppressWarnings("unchecked")
+  public Configuration load(String string, Configuration defaults) {
+    Map<String, Object> map = json.fromJson(string, LinkedHashMap.class);
+    if (map == null) {
+      map = new LinkedHashMap<>();
+    }
+    return new Configuration(map, defaults);
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/YamlConfiguration.java b/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/YamlConfiguration.java
index 5dad48c8..1bb31546 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/YamlConfiguration.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/config/helpers/YamlConfiguration.java
@@ -56,26 +56,23 @@ import org.yaml.snakeyaml.representer.Representer;
 @NoArgsConstructor(access = AccessLevel.PACKAGE)
 public class YamlConfiguration extends ConfigurationProvider {
 
-  private final ThreadLocal<Yaml> yaml = new ThreadLocal<Yaml>() {
-    @Override
-    protected Yaml initialValue() {
-      Representer representer = new Representer() {
-        {
-          representers.put(Configuration.class, new Represent() {
-            @Override
-            public Node representData(Object data) {
-              return represent(((Configuration) data).self);
-            }
-          });
-        }
-      };
-
-      DumperOptions options = new DumperOptions();
-      options.setDefaultFlowStyle(DumperOptions.FlowStyle.BLOCK);
-
-      return new Yaml(new Constructor(), representer, options);
-    }
-  };
+  private final ThreadLocal<Yaml> yaml = ThreadLocal.withInitial(() -> {
+    Representer representer = new Representer() {
+      {
+        representers.put(Configuration.class, new Represent() {
+          @Override
+          public Node representData(Object data) {
+            return represent(((Configuration) data).self);
+          }
+        });
+      }
+    };
+
+    DumperOptions options = new DumperOptions();
+    options.setDefaultFlowStyle(DumperOptions.FlowStyle.BLOCK);
+
+    return new Yaml(new Constructor(), representer, options);
+  });
 
   @Override
   public void save(Configuration config, File file) throws IOException {
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/database/Database.java b/proxy/src/main/java/net/elytrium/elytraproxy/database/Database.java
index 09325f56..a04b2e34 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/database/Database.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/database/Database.java
@@ -24,13 +24,17 @@ public abstract class Database {
 
   public abstract void query(String query);
 
+  public void makeTable(String table, DatabaseItem databaseItem) { // TODO: Auto make tables with @annotations
+    makeTable(table, databaseItem.getTableInfo(), databaseItem.getPrimaryKey());
+  }
+
   public abstract void makeTable(String table, Map<String, String> keys);
 
+  public abstract void makeTable(String table, Map<String, String> keys, String primaryKey);
+
   public abstract void insertMap(String table, Map<String, Object> toInsert, boolean update);
 
-  public abstract void updateMap(String table,
-                                 Map<String, Object> whereUpdate,
-                                 Map<String, Object> toUpdate);
+  public abstract void updateMap(String table, Map<String, Object> whereUpdate, Map<String, Object> toUpdate);
 
   public abstract void deleteMap(String table, Map<String, Object> whereDelete);
 
@@ -38,6 +42,8 @@ public abstract class Database {
 
   public abstract <T> T getItem(String table, Map<String, Object> where, Class<T> type);
 
+  public abstract <T> List<T> getItems(String table, Map<String, Object> where, Class<T> type);
+
   public abstract <T> List<T> getItems(String table, Class<T> type);
 
   public abstract <T> T queryResult(String query, Class<T> type);
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/database/DatabaseItem.java b/proxy/src/main/java/net/elytrium/elytraproxy/database/DatabaseItem.java
new file mode 100644
index 00000000..41e75f2c
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/database/DatabaseItem.java
@@ -0,0 +1,31 @@
+/*
+ * Copyright (C) 2021 Elytrium
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.database;
+
+import java.util.Map;
+import lombok.Getter;
+
+public class DatabaseItem {
+  @Getter private final Map<String, String> tableInfo;
+  @Getter private final String primaryKey;
+
+  public DatabaseItem(Map<String, String> tableInfo, String primaryKey) {
+    this.tableInfo = tableInfo;
+    this.primaryKey = primaryKey;
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/database/MySqlDatabase.java b/proxy/src/main/java/net/elytrium/elytraproxy/database/MySqlDatabase.java
index 1c705b50..e8844c94 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/database/MySqlDatabase.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/database/MySqlDatabase.java
@@ -38,16 +38,14 @@ public class MySqlDatabase extends Database {
 
   /**
    * Initializes and connects to MySQL Database.
-   * @param host Hostname to connect, with port
+   *
+   * @param host     Hostname to connect, with port
    * @param database Database name
-   * @param user Username
+   * @param user     Username
    * @param password Password of user
    * @throws SQLException Throws if connection was unsuccessful
    */
-  public MySqlDatabase(String host,
-                       String database,
-                       String user,
-                       String password) throws SQLException {
+  public MySqlDatabase(String host, String database, String user, String password) throws SQLException {
     String url = "jdbc:mysql://" + host + "/" + database
         + "?autoReconnect=true&cmaxReconnets=5&initialTimeout=1&useSSL=false";
 
@@ -67,39 +65,44 @@ public class MySqlDatabase extends Database {
     }
   }
 
+  @Override
+  public void makeTable(String table, Map<String, String> keys, String primaryKey) {
+    query("CREATE TABLE IF NOT EXISTS " + table + " ("
+        + joinStream(keys.entrySet().stream().map(e -> e.getKey() + " " + e.getValue()))
+        + ", PRIMARY KEY (" + primaryKey + "))");
+  }
+
   @Override
   public void makeTable(String table, Map<String, String> keys) {
     query("CREATE TABLE IF NOT EXISTS " + table + " ("
-        + keyFromStream(keys.entrySet().stream().map(e -> e.getKey() + " " + e.getValue())) + ")");
+        + joinStream(keys.entrySet().stream().map(e -> e.getKey() + " " + e.getValue())) + ")");
   }
 
   @Override
   public void insertMap(String table, Map<String, Object> toInsert, boolean update) {
-    String keyString = keyFromStream(toInsert.keySet().stream().map(s -> s));
+    String keyString = joinStream(toInsert.keySet().stream().map(s -> s));
     String valueString = keyFromStream(toInsert.values().stream());
 
-    String request = "INSERT INTO %s (%s) VALUES(%s)";
+    String request = "INSERT INTO " + table + " (" + keyString + ") VALUES(" + valueString + ")";
     if (update) {
       request += " ON DUPLICATE KEY UPDATE";
     }
 
-    query(String.format(request, table, keyString, valueString));
+    query(request);
   }
 
   @Override
-  public void updateMap(String table,
-                        Map<String, Object> whereUpdate,
-                        Map<String, Object> toUpdate) {
+  public void updateMap(String table, Map<String, Object> whereUpdate, Map<String, Object> toUpdate) {
     String where = entryFromStream(whereUpdate.entrySet().stream(), " AND ");
     String set = entryFromStream(toUpdate.entrySet().stream(), ", ");
 
-    query(String.format("UPDATE %s SET %s WHERE %s", table, set, where));
+    query("UPDATE " + table + " SET " + set + " WHERE " + where);
   }
 
   @Override
   public void deleteMap(String table, Map<String, Object> whereDelete) {
     String entryString = entryFromStream(whereDelete.entrySet().stream(), " AND ");
-    query(String.format("DELETE FROM %s WHERE %s", table, entryString));
+    query("DELETE FROM " + table + " WHERE " + entryString);
   }
 
   @Override
@@ -115,12 +118,18 @@ public class MySqlDatabase extends Database {
   @Override
   public <T> T getItem(String table, Map<String, Object> where, Class<T> type) {
     String entryString = entryFromStream(where.entrySet().stream(), " AND ");
-    return queryResult(String.format("SELECT * FROM %s WHERE %s", table, entryString), type);
+    return queryResult("SELECT * FROM " + table + " WHERE " + entryString, type);
   }
 
   @Override
   public <T> List<T> getItems(String table, Class<T> type) {
-    return queryResultList(String.format("SELECT * FROM %s", table), type);
+    return queryResultList("SELECT * FROM " + table, type);
+  }
+
+  @Override
+  public <T> List<T> getItems(String table, Map<String, Object> where, Class<T> type) {
+    String entryString = entryFromStream(where.entrySet().stream(), " AND ");
+    return queryResultList("SELECT * FROM " + table + " WHERE " + entryString, type);
   }
 
   @Override
@@ -171,11 +180,8 @@ public class MySqlDatabase extends Database {
   }
 
   private <T> Map<String, Object> serializeToMap(T from, Class<T> type)
-      throws NoSuchMethodException,
-      IllegalAccessException,
-      InvocationTargetException,
-      InstantiationException,
-      SQLException {
+      throws NoSuchMethodException, IllegalAccessException,
+      InvocationTargetException, InstantiationException, SQLException {
 
     Map<String, Object> map = new HashMap<>();
 
@@ -190,11 +196,8 @@ public class MySqlDatabase extends Database {
   }
 
   private <T> T serializeFromSet(ResultSet set, Class<T> type)
-      throws NoSuchMethodException,
-      IllegalAccessException,
-      InvocationTargetException,
-      InstantiationException,
-      SQLException {
+      throws NoSuchMethodException, IllegalAccessException,
+      InvocationTargetException, InstantiationException, SQLException {
 
     T result = type.getConstructor().newInstance();
 
@@ -208,15 +211,20 @@ public class MySqlDatabase extends Database {
     return result;
   }
 
-  private String keyFromStream(Stream<Object> stream) {
+  private String joinStream(Stream<Object> stream) {
     return stream
         .map(Object::toString)
         .collect(Collectors.joining(", "));
   }
 
+  private String keyFromStream(Stream<Object> stream) {
+    return joinStream(stream.map(e -> (e instanceof String) ? "\"" + e + "\"" : e));
+  }
+
   private String entryFromStream(Stream<Map.Entry<String, Object>> stream, String delimiter) {
     return stream
-        .map(entry -> entry.getKey() + " = " + entry.getValue())
+        .map(entry -> entry.getKey() + " = "
+            + ((entry.getValue() instanceof String) ? "\"" + entry.getValue() + "\"" : entry.getValue()))
         .collect(Collectors.joining(delimiter));
   }
 }
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/file/SchematicFile.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/file/SchematicFile.java
new file mode 100644
index 00000000..736a08e7
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/file/SchematicFile.java
@@ -0,0 +1,89 @@
+/*
+ * Copyright (C) 2021 Elytrium
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.file;
+
+import java.io.IOException;
+import java.io.InputStream;
+import java.nio.file.Path;
+import lombok.Getter;
+import net.elytrium.elytraproxy.virtual.server.world.SimpleBlock;
+import net.elytrium.elytraproxy.virtual.server.world.VirtualWorld;
+import net.kyori.adventure.nbt.BinaryTagIO;
+import net.kyori.adventure.nbt.CompoundBinaryTag;
+
+@Getter
+public class SchematicFile implements WorldFile {
+  private short width;
+  private short height;
+  private short length;
+  private byte[] blocks;
+  private byte[] addBlocks = new byte[0];
+
+  public SchematicFile(Path file) throws IOException {
+    CompoundBinaryTag tag = BinaryTagIO.reader().read(file, BinaryTagIO.Compression.GZIP);
+    fromNBT(tag);
+  }
+
+  public SchematicFile(InputStream stream) throws IOException {
+    CompoundBinaryTag tag = BinaryTagIO.reader().read(stream, BinaryTagIO.Compression.GZIP);
+    fromNBT(tag);
+  }
+
+  public SchematicFile(CompoundBinaryTag tag) {
+    fromNBT(tag);
+  }
+
+  @Override
+  public void toWorld(VirtualWorld world, int offsetX, int offsetY, int offsetZ) {
+    short[] blockIds = new short[blocks.length];
+
+    for (int index = 0; index < blocks.length; index++) {
+      if ((index >> 1) >= addBlocks.length) {
+        blockIds[index] = (short) (blocks[index] & 0xFF);
+      } else {
+        if ((index & 1) == 0) {
+          blockIds[index] = (short) (((addBlocks[index >> 1] & 0x0F) << 8) + (addBlocks[index] & 0xFF));
+        } else {
+          blockIds[index] = (short) (((addBlocks[index >> 1] & 0xF0) << 4) + (addBlocks[index] & 0xFF));
+        }
+      }
+    }
+
+    for (int x = 0; x < width; ++x) {
+      for (int y = 0; y < height; ++y) {
+        for (int z = 0; z < length; ++z) {
+          // System.out.println(x + " " + y + " " + z + ": " + blockIds[(y * length + z) * width + x]);
+          world.setBlock(
+              x + offsetX, y + offsetY, z + offsetZ,
+              SimpleBlock.fromLegacyId(blockIds[(y * length + z) * width + x]));
+        }
+      }
+    }
+  }
+
+  private void fromNBT(CompoundBinaryTag tag) {
+    width = tag.getShort("Width");
+    height = tag.getShort("Height");
+    length = tag.getShort("Length");
+    blocks = tag.getByteArray("Blocks");
+
+    if (tag.keySet().contains("AddBlocks")) {
+      addBlocks = tag.getByteArray("AddBlocks");
+    }
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/file/WorldFile.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/file/WorldFile.java
new file mode 100644
index 00000000..6595acf8
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/file/WorldFile.java
@@ -0,0 +1,24 @@
+/*
+ * Copyright (C) 2021 Elytrium
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.file;
+
+import net.elytrium.elytraproxy.virtual.server.world.VirtualWorld;
+
+public interface WorldFile {
+  void toWorld(VirtualWorld world, int offsetX, int offsetY, int offsetZ);
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/VirtualProtocol.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/VirtualProtocol.java
new file mode 100644
index 00000000..376a7f2d
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/VirtualProtocol.java
@@ -0,0 +1,182 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.protocol;
+
+import static com.velocitypowered.proxy.protocol.StateRegistry.map;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.protocol.StateRegistry;
+import com.velocitypowered.proxy.protocol.packet.Chat;
+import com.velocitypowered.proxy.protocol.packet.ClientSettings;
+import com.velocitypowered.proxy.protocol.packet.Disconnect;
+import com.velocitypowered.proxy.protocol.packet.JoinGame;
+import com.velocitypowered.proxy.protocol.packet.PluginMessage;
+import com.velocitypowered.proxy.protocol.packet.Respawn;
+import net.elytrium.elytraproxy.virtual.protocol.packet.MapDataPacket;
+import net.elytrium.elytraproxy.virtual.protocol.packet.Player;
+import net.elytrium.elytraproxy.virtual.protocol.packet.PlayerAbilities;
+import net.elytrium.elytraproxy.virtual.protocol.packet.PlayerPosition;
+import net.elytrium.elytraproxy.virtual.protocol.packet.PlayerPositionAndLook;
+import net.elytrium.elytraproxy.virtual.protocol.packet.SetExp;
+import net.elytrium.elytraproxy.virtual.protocol.packet.SetSlot;
+import net.elytrium.elytraproxy.virtual.protocol.packet.TeleportConfirm;
+import net.elytrium.elytraproxy.virtual.protocol.packet.UpdateViewPosition;
+import net.elytrium.elytraproxy.virtual.protocol.packet.world.ChunkData;
+
+public class VirtualProtocol {
+  public static void init() {
+    StateRegistry.VIRTUAL.serverbound.register(
+        TeleportConfirm.class, TeleportConfirm::new,
+        map(0x00, ProtocolVersion.MINECRAFT_1_9, true));
+    StateRegistry.VIRTUAL.serverbound.register(
+        PlayerPositionAndLook.class, PlayerPositionAndLook::new,
+        map(0x06, ProtocolVersion.MINECRAFT_1_7_2, false), //TODO: Right 1.7 value
+        map(0x06, ProtocolVersion.MINECRAFT_1_8, false),
+        map(0x0D, ProtocolVersion.MINECRAFT_1_9, false),
+        map(0x0F, ProtocolVersion.MINECRAFT_1_12, false),
+        map(0x0E, ProtocolVersion.MINECRAFT_1_12_1, false),
+        map(0x11, ProtocolVersion.MINECRAFT_1_13, false),
+        map(0x12, ProtocolVersion.MINECRAFT_1_14, false),
+        map(0x13, ProtocolVersion.MINECRAFT_1_16, false),
+        map(0x12, ProtocolVersion.MINECRAFT_1_17, false));
+    StateRegistry.VIRTUAL.serverbound.register(
+        PlayerPosition.class, PlayerPosition::new,
+        map(0x0B, ProtocolVersion.MINECRAFT_1_7_2, false), //TODO: Right 1.7 value
+        map(0x04, ProtocolVersion.MINECRAFT_1_7_6, false), //TODO: Right 1.7 value
+        map(0x04, ProtocolVersion.MINECRAFT_1_8, false),
+        map(0x0C, ProtocolVersion.MINECRAFT_1_9, false),
+        map(0x0E, ProtocolVersion.MINECRAFT_1_12, false),
+        map(0x0D, ProtocolVersion.MINECRAFT_1_12_1, false),
+        map(0x10, ProtocolVersion.MINECRAFT_1_13, false),
+        map(0x11, ProtocolVersion.MINECRAFT_1_14, false),
+        map(0x12, ProtocolVersion.MINECRAFT_1_16, false),
+        map(0x11, ProtocolVersion.MINECRAFT_1_17, false));
+    StateRegistry.VIRTUAL.serverbound.register(
+        Player.class, Player::new,
+        map(0x03, ProtocolVersion.MINECRAFT_1_7_2, false),
+        map(0x03, ProtocolVersion.MINECRAFT_1_8, false),
+        map(0x0F, ProtocolVersion.MINECRAFT_1_9, false),
+        map(0x0D, ProtocolVersion.MINECRAFT_1_12, false),
+        map(0x0C, ProtocolVersion.MINECRAFT_1_12_1, false),
+        map(0x0F, ProtocolVersion.MINECRAFT_1_13, false),
+        map(0x14, ProtocolVersion.MINECRAFT_1_14, false),
+        map(0x15, ProtocolVersion.MINECRAFT_1_16, false),
+        map(0x14, ProtocolVersion.MINECRAFT_1_17, false));
+    StateRegistry.VIRTUAL.clientbound.register(
+        PlayerPositionAndLook.class, PlayerPositionAndLook::new,
+        map(0x08, ProtocolVersion.MINECRAFT_1_7_2, true),
+        map(0x2E, ProtocolVersion.MINECRAFT_1_9, true),
+        map(0x2F, ProtocolVersion.MINECRAFT_1_12_1, true),
+        map(0x32, ProtocolVersion.MINECRAFT_1_13, true),
+        map(0x35, ProtocolVersion.MINECRAFT_1_14, true),
+        map(0x36, ProtocolVersion.MINECRAFT_1_15, true),
+        map(0x35, ProtocolVersion.MINECRAFT_1_16, true),
+        map(0x34, ProtocolVersion.MINECRAFT_1_16_2, true),
+        map(0x38, ProtocolVersion.MINECRAFT_1_17, true));
+    StateRegistry.VIRTUAL.clientbound.register(
+        ChunkData.class, ChunkData::new,
+        map(0x21, ProtocolVersion.MINECRAFT_1_7_2, true),
+        map(0x21, ProtocolVersion.MINECRAFT_1_8, true),
+        map(0x20, ProtocolVersion.MINECRAFT_1_9, true),
+        map(0x22, ProtocolVersion.MINECRAFT_1_13, true),
+        map(0x21, ProtocolVersion.MINECRAFT_1_14, true),
+        map(0x22, ProtocolVersion.MINECRAFT_1_15, true),
+        map(0x21, ProtocolVersion.MINECRAFT_1_16, true),
+        map(0x20, ProtocolVersion.MINECRAFT_1_16_2, true),
+        map(0x22, ProtocolVersion.MINECRAFT_1_17, true));
+    StateRegistry.VIRTUAL.clientbound.register(
+        SetSlot.class, SetSlot::new,
+        map(0x2F, ProtocolVersion.MINECRAFT_1_7_2, true),
+        map(0x2F, ProtocolVersion.MINECRAFT_1_8, true),
+        map(0x16, ProtocolVersion.MINECRAFT_1_9, true),
+        map(0x17, ProtocolVersion.MINECRAFT_1_13, true),
+        map(0x16, ProtocolVersion.MINECRAFT_1_14, true),
+        map(0x17, ProtocolVersion.MINECRAFT_1_15, true),
+        map(0x16, ProtocolVersion.MINECRAFT_1_16, true),
+        map(0x15, ProtocolVersion.MINECRAFT_1_16_2, true),
+        map(0x16, ProtocolVersion.MINECRAFT_1_17, true));
+    StateRegistry.VIRTUAL.clientbound.register(
+        MapDataPacket.class, MapDataPacket::new,
+        map(0x34, ProtocolVersion.MINECRAFT_1_7_2, true), //TODO: True 1.7 value
+        map(0x34, ProtocolVersion.MINECRAFT_1_8, true),
+        map(0x24, ProtocolVersion.MINECRAFT_1_9, true),
+        map(0x26, ProtocolVersion.MINECRAFT_1_13, true),
+        map(0x26, ProtocolVersion.MINECRAFT_1_14, true),
+        map(0x27, ProtocolVersion.MINECRAFT_1_15, true),
+        map(0x26, ProtocolVersion.MINECRAFT_1_16, true),
+        map(0x25, ProtocolVersion.MINECRAFT_1_16_2, true),
+        map(0x27, ProtocolVersion.MINECRAFT_1_17, true));
+    StateRegistry.VIRTUAL.clientbound.register(
+        PlayerAbilities.class, PlayerAbilities::new,
+        map(0x39, ProtocolVersion.MINECRAFT_1_7_2, true), //TODO: True 1.7 value
+        map(0x39, ProtocolVersion.MINECRAFT_1_8, true),
+        map(0x2B, ProtocolVersion.MINECRAFT_1_9, true),
+        map(0x2C, ProtocolVersion.MINECRAFT_1_12_1, true),
+        map(0x2E, ProtocolVersion.MINECRAFT_1_13, true),
+        map(0x31, ProtocolVersion.MINECRAFT_1_14, true),
+        map(0x32, ProtocolVersion.MINECRAFT_1_15, true),
+        map(0x31, ProtocolVersion.MINECRAFT_1_16, true),
+        map(0x30, ProtocolVersion.MINECRAFT_1_16_2, true),
+        map(0x32, ProtocolVersion.MINECRAFT_1_17, true));
+    StateRegistry.VIRTUAL.clientbound.register(
+        SetExp.class, SetExp::new,
+        map(0x2B, ProtocolVersion.MINECRAFT_1_7_2, true),
+        map(0x1F, ProtocolVersion.MINECRAFT_1_8, true),
+        map(0x3D, ProtocolVersion.MINECRAFT_1_9, true),
+        map(0x3F, ProtocolVersion.MINECRAFT_1_12, true),
+        map(0x40, ProtocolVersion.MINECRAFT_1_12_1, true),
+        map(0x43, ProtocolVersion.MINECRAFT_1_13, true),
+        map(0x47, ProtocolVersion.MINECRAFT_1_14, true),
+        map(0x48, ProtocolVersion.MINECRAFT_1_15, true),
+        map(0x51, ProtocolVersion.MINECRAFT_1_17, true));
+    StateRegistry.VIRTUAL.clientbound.register(
+        UpdateViewPosition.class, UpdateViewPosition::new,
+        map(0x40, ProtocolVersion.MINECRAFT_1_7_2, true),
+        map(0x40, ProtocolVersion.MINECRAFT_1_14, true),
+        map(0x41, ProtocolVersion.MINECRAFT_1_15, true),
+        map(0x40, ProtocolVersion.MINECRAFT_1_16_1, true),
+        map(0x49, ProtocolVersion.MINECRAFT_1_17, true));
+
+    StateRegistry.VIRTUAL.serverbound.register(
+        Chat.class, Chat::new,
+        StateRegistry.PLAY.serverbound.getMappingsForPacket(Chat.class, false));
+    StateRegistry.VIRTUAL.serverbound.register(
+        ClientSettings.class, ClientSettings::new,
+        StateRegistry.PLAY.serverbound.getMappingsForPacket(ClientSettings.class, false));
+    StateRegistry.VIRTUAL.serverbound.register(
+        PluginMessage.class, PluginMessage::new,
+        StateRegistry.PLAY.serverbound.getMappingsForPacket(PluginMessage.class, false));
+    StateRegistry.VIRTUAL.clientbound.register(
+        Chat.class, Chat::new,
+        StateRegistry.PLAY.clientbound.getMappingsForPacket(Chat.class, true));
+    StateRegistry.VIRTUAL.clientbound.register(
+        JoinGame.class, JoinGame::new,
+        StateRegistry.PLAY.clientbound.getMappingsForPacket(JoinGame.class, true));
+    StateRegistry.VIRTUAL.clientbound.register(
+        Disconnect.class, Disconnect::new,
+        StateRegistry.PLAY.clientbound.getMappingsForPacket(Disconnect.class, true));
+    StateRegistry.VIRTUAL.clientbound.register(
+        PluginMessage.class, PluginMessage::new,
+        StateRegistry.PLAY.clientbound.getMappingsForPacket(PluginMessage.class, true));
+    StateRegistry.VIRTUAL.clientbound.register(
+        Respawn.class, Respawn::new,
+        StateRegistry.PLAY.clientbound.getMappingsForPacket(Respawn.class, true));
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/cache/PreparedPacket.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/cache/PreparedPacket.java
new file mode 100644
index 00000000..60a2eba9
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/cache/PreparedPacket.java
@@ -0,0 +1,113 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.protocol.cache;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.protocol.MinecraftPacket;
+import com.velocitypowered.proxy.protocol.ProtocolUtils;
+import com.velocitypowered.proxy.protocol.ProtocolUtils.Direction;
+import com.velocitypowered.proxy.protocol.StateRegistry;
+import io.netty.buffer.ByteBuf;
+import io.netty.buffer.Unpooled;
+import java.util.ArrayList;
+import java.util.EnumSet;
+import java.util.List;
+import java.util.Map;
+import java.util.concurrent.ConcurrentHashMap;
+import java.util.function.Supplier;
+import java.util.stream.Collectors;
+
+public class PreparedPacket {
+
+  private final Map<ProtocolVersion, List<ByteBuf>> packets =
+      new ConcurrentHashMap<>();
+
+  public <T extends MinecraftPacket> PreparedPacket prepare(T packet) {
+    return prepare((Supplier<T>) () -> packet, ProtocolVersion.MINIMUM_VERSION, ProtocolVersion.MAXIMUM_VERSION);
+  }
+
+  public <T extends MinecraftPacket> PreparedPacket prepare(T packet, ProtocolVersion from) {
+    return prepare((Supplier<T>) () -> packet, from, ProtocolVersion.MAXIMUM_VERSION);
+  }
+
+  public <T extends MinecraftPacket> PreparedPacket prepare(T packet, ProtocolVersion from, StateRegistry protocol) {
+    return prepare(() -> packet, from, ProtocolVersion.MAXIMUM_VERSION, protocol);
+  }
+
+  public <T extends MinecraftPacket> PreparedPacket prepare(T packet, ProtocolVersion from, ProtocolVersion to) {
+    return prepare(() -> packet, from, to, StateRegistry.VIRTUAL);
+  }
+
+  public <T extends MinecraftPacket> PreparedPacket prepare(Supplier<T> packet) {
+    return prepare(packet, ProtocolVersion.MINIMUM_VERSION, ProtocolVersion.MAXIMUM_VERSION);
+  }
+
+  public <T extends MinecraftPacket> PreparedPacket prepare(Supplier<T> packet, ProtocolVersion from) {
+    return prepare(packet, from, ProtocolVersion.MAXIMUM_VERSION);
+  }
+
+  public <T extends MinecraftPacket> PreparedPacket prepare(Supplier<T> packet, ProtocolVersion from, StateRegistry protocol) {
+    return prepare(packet, from, ProtocolVersion.MAXIMUM_VERSION, protocol);
+  }
+
+  public <T extends MinecraftPacket> PreparedPacket prepare(Supplier<T> packet, ProtocolVersion from, ProtocolVersion to) {
+    return prepare(packet, from, to, StateRegistry.VIRTUAL);
+  }
+
+  public <T extends MinecraftPacket> PreparedPacket prepare(Supplier<T> packet, ProtocolVersion from, ProtocolVersion to, StateRegistry protocol) {
+    for (ProtocolVersion protocolVersion : EnumSet.range(from, to)) {
+      ByteBuf buf = encodePacket(packet.get(), protocolVersion, protocol);
+      if (packets.containsKey(protocolVersion)) {
+        packets.get(protocolVersion).add(buf);
+      } else {
+        List<ByteBuf> list = new ArrayList<>();
+        list.add(buf);
+        packets.put(protocolVersion, list);
+      }
+    }
+
+    return this;
+  }
+
+  public List<ByteBuf> getPackets(ProtocolVersion version) {
+    return packets.get(version).stream().map(ByteBuf::copy).collect(Collectors.toList());
+  }
+
+  public boolean hasPacketsFor(ProtocolVersion version) {
+    return packets.containsKey(version);
+  }
+
+  private <T extends MinecraftPacket> ByteBuf encodePacket(T packet, ProtocolVersion version, StateRegistry protocol) {
+    int id = getPacketId(packet, version, protocol);
+    ByteBuf byteBuf = Unpooled.buffer();
+    ProtocolUtils.writeVarInt(byteBuf, id);
+    packet.encode(byteBuf, Direction.CLIENTBOUND, version);
+    return byteBuf;
+  }
+
+  private <T extends MinecraftPacket> int getPacketId(T packet, ProtocolVersion version, StateRegistry protocol) {
+    try {
+      return protocol.clientbound.getProtocolRegistry(version).getPacketId(packet.getClass());
+    } catch (Exception e) {
+      return protocol.clientbound.getProtocolRegistry(version).getPacketId(
+          (Class<? extends MinecraftPacket>) packet.getClass().getSuperclass());
+    }
+  }
+}
\ No newline at end of file
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/cache/PreparedPacketEncoder.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/cache/PreparedPacketEncoder.java
new file mode 100644
index 00000000..54e7d0a7
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/cache/PreparedPacketEncoder.java
@@ -0,0 +1,39 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.protocol.cache;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import io.netty.channel.ChannelHandlerContext;
+import io.netty.handler.codec.MessageToMessageEncoder;
+import java.util.List;
+import lombok.AllArgsConstructor;
+
+@AllArgsConstructor
+public class PreparedPacketEncoder extends MessageToMessageEncoder<PreparedPacket> {
+  private final ProtocolVersion protocolVersion;
+
+  @Override
+  protected void encode(ChannelHandlerContext ctx, PreparedPacket msg, List<Object> out)
+      throws Exception {
+    if (msg.hasPacketsFor(protocolVersion)) {
+      out.addAll(msg.getPackets(protocolVersion));
+    }
+  }
+}
\ No newline at end of file
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/registry/Biome.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/registry/Biome.java
similarity index 79%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/registry/Biome.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/registry/Biome.java
index fb35f4d1..be9a81b8 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/registry/Biome.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/registry/Biome.java
@@ -17,34 +17,47 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.data.registry;
+package net.elytrium.elytraproxy.virtual.protocol.data.registry;
 
+import com.google.common.collect.ImmutableList;
+import java.util.List;
+import java.util.stream.Collectors;
 import javax.annotation.Nullable;
 import lombok.Data;
 import lombok.NonNull;
 import lombok.RequiredArgsConstructor;
+import net.elytrium.elytraproxy.virtual.protocol.data.registry.Biome.Effects.MoodSound;
 import net.kyori.adventure.nbt.CompoundBinaryTag;
 import net.kyori.adventure.nbt.CompoundBinaryTag.Builder;
-import net.elytrium.elytraproxy.botfilter.protocol.data.registry.Biome.Effects.MoodSound;
+import net.kyori.adventure.nbt.ListBinaryTag;
 
 public class Biome {
 
-  public static final Biome PLAINTS = new Biome("minecraft:plains", 1,
+  public static final Biome PLAINS = new Biome("minecraft:plains", 1,
       new Element("rain", 0.125f, 0.8f, 0.05f, 0.4f, "plains",
           Effects.builder(7907327, 329011, 12638463, 415920)
-              .moodSound(MoodSound.of(6000, 2.0d, 8, "minecraft:ambient.cave")).build()));
+              .moodSound(MoodSound.of(6000, 2.0d, 8, "minecraft:ambient.cave"))
+              .build())
+  );
 
   public static final Biome SWAMP = new Biome("minecraft:swamp", 6,
       new Element("rain", -0.2F, 0.8f, 0.1F, 0.9F, "swamp",
           Effects.builder(7907327, 329011, 12638463, 415920).grassColorModifier("swamp")
               .foliageColor(6975545)
-              .moodSound(MoodSound.of(6000, 2.0d, 8, "minecraft:ambient.cave")).build()));
+              .moodSound(MoodSound.of(6000, 2.0d, 8, "minecraft:ambient.cave"))
+              .build())
+  );
 
   public static final Biome SWAMP_HILLS = new Biome("minecraft:swamp_hills", 134,
       new Element("rain", -0.1F, 0.8f, 0.3F, 0.9F, "swamp",
           Effects.builder(7907327, 329011, 12638463, 415920).grassColorModifier("swamp")
               .foliageColor(6975545)
-              .moodSound(MoodSound.of(6000, 2.0d, 8, "minecraft:ambient.cave")).build()));
+              .moodSound(MoodSound.of(6000, 2.0d, 8, "minecraft:ambient.cave"))
+              .build())
+  );
+
+  public static final List<Biome> REGISTERED_BIOMES = ImmutableList.of(PLAINS);
+
   public final String name;
   public final int id;
   public final Element element;
@@ -62,6 +75,14 @@ public class Biome {
         .put("element", element.encode()).build();
   }
 
+  public static CompoundBinaryTag getRegistry() {
+    return CompoundBinaryTag.builder()
+        .putString("type", "minecraft:worldgen/biome")
+        .put("value", ListBinaryTag
+            .from(REGISTERED_BIOMES.stream().map(Biome::encodeBiome)
+                .collect(Collectors.toList()))).build();
+  }
+
   public static class Element {
 
     public final String precipitation;
@@ -72,9 +93,8 @@ public class Biome {
     public final String category;
     public final Effects effects;
 
-    public Element(String precipitation, float depth, float temperature, float scale,
-        float downfall,
-        String category, Effects effects) {
+    public Element(String precipitation, float depth, float temperature,
+                   float scale, float downfall, String category, Effects effects) {
       this.precipitation = precipitation;
       this.depth = depth;
       this.temperature = temperature;
@@ -106,13 +126,20 @@ public class Biome {
     private final int fogColor;
     private final int waterColor;
 
-    @Nullable private final Integer foliageColor;
-    @Nullable private final String grassColorModifier;
-    @Nullable private final Music music;
-    @Nullable private final String ambientSound;
-    @Nullable private final AdditionsSound additionsSound;
-    @Nullable private final MoodSound moodSound;
-    @Nullable private final Particle particle;
+    @Nullable
+    private final Integer foliageColor;
+    @Nullable
+    private final String grassColorModifier;
+    @Nullable
+    private final Music music;
+    @Nullable
+    private final String ambientSound;
+    @Nullable
+    private final AdditionsSound additionsSound;
+    @Nullable
+    private final MoodSound moodSound;
+    @Nullable
+    private final Particle particle;
 
     public CompoundBinaryTag encode() {
       Builder result = CompoundBinaryTag.builder();
@@ -145,8 +172,7 @@ public class Biome {
       return result.build();
     }
 
-    public static EffectsBuilder builder(int skyColor, int waterFogColor, int fogColor,
-        int waterColor) {
+    public static EffectsBuilder builder(int skyColor, int waterFogColor, int fogColor, int waterColor) {
       return new EffectsBuilder().skyColor(skyColor).waterFogColor(waterFogColor).fogColor(fogColor)
           .waterColor(waterColor);
     }
@@ -158,7 +184,8 @@ public class Biome {
       private final int tickDelay;
       private final double offset;
       private final int blockSearchExtent;
-      @NonNull private final String sound;
+      @NonNull
+      private final String sound;
 
       public CompoundBinaryTag encode() {
         return CompoundBinaryTag.builder()
@@ -174,7 +201,8 @@ public class Biome {
     public static class Music {
 
       private final boolean replaceCurrentMusic;
-      @NonNull private final String sound;
+      @NonNull
+      private final String sound;
       private final int maxDelay;
       private final int minDelay;
 
@@ -191,7 +219,8 @@ public class Biome {
     @RequiredArgsConstructor(staticName = "of")
     public static class AdditionsSound {
 
-      @NonNull private final String sound;
+      @NonNull
+      private final String sound;
       private final double tickChance;
 
       public CompoundBinaryTag encode() {
@@ -206,7 +235,8 @@ public class Biome {
     public static class Particle {
 
       private final float probability;
-      @NonNull private final ParticleOptions options;
+      @NonNull
+      private final ParticleOptions options;
 
       public CompoundBinaryTag encode() {
         return CompoundBinaryTag.builder()
@@ -218,7 +248,8 @@ public class Biome {
       @RequiredArgsConstructor
       public static class ParticleOptions {
 
-        @NonNull private final String type;
+        @NonNull
+        private final String type;
 
         public CompoundBinaryTag encode() {
           return CompoundBinaryTag.builder()
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/storage/BlockStorage.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/storage/BlockStorage.java
similarity index 82%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/storage/BlockStorage.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/storage/BlockStorage.java
index 8f207fa2..5f3788a0 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/storage/BlockStorage.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/storage/BlockStorage.java
@@ -17,14 +17,13 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.data.storage;
+package net.elytrium.elytraproxy.virtual.protocol.data.storage;
 
 import com.velocitypowered.api.network.ProtocolVersion;
 import io.netty.buffer.ByteBuf;
 import lombok.NonNull;
+import net.elytrium.elytraproxy.virtual.server.world.SimpleBlock;
 import org.jetbrains.annotations.NotNull;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version;
 
 public interface BlockStorage {
 
@@ -42,8 +41,8 @@ public interface BlockStorage {
     return y << 8 | z << 4 | x;
   }
 
-  static BlockStorage create(Version version) {
-    if (version.isBefore(Version.MINECRAFT_1_9)) {
+  static BlockStorage create(ProtocolVersion version) {
+    if (version.isBefore(ProtocolVersion.MINECRAFT_1_9)) {
       return new BlockStorage17();
     } else {
       return new BlockStorage19(version);
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/storage/BlockStorage17.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/storage/BlockStorage17.java
similarity index 84%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/storage/BlockStorage17.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/storage/BlockStorage17.java
index 755d5a11..732d9fbb 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/storage/BlockStorage17.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/storage/BlockStorage17.java
@@ -17,7 +17,7 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.data.storage;
+package net.elytrium.elytraproxy.virtual.protocol.data.storage;
 
 import com.velocitypowered.api.network.ProtocolVersion;
 import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
@@ -26,11 +26,10 @@ import java.util.Arrays;
 import lombok.AccessLevel;
 import lombok.NonNull;
 import lombok.RequiredArgsConstructor;
+import net.elytrium.elytraproxy.virtual.protocol.util.mcprotocollib.NibbleArray3d;
+import net.elytrium.elytraproxy.virtual.server.world.SimpleBlock;
+import net.elytrium.elytraproxy.virtual.server.world.chunk.SimpleChunk;
 import org.jetbrains.annotations.NotNull;
-import net.elytrium.elytraproxy.botfilter.protocol.util.mcprotocollib.NibbleArray3d;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version;
-import net.elytrium.elytraproxy.botfilter.server.world.chunk.SimpleChunk;
 
 @RequiredArgsConstructor(access = AccessLevel.PRIVATE)
 public class BlockStorage17 implements BlockStorage {
@@ -66,7 +65,7 @@ public class BlockStorage17 implements BlockStorage {
     } else if (pass == 1) {
       NibbleArray3d metadata = new NibbleArray3d(16 * 16 * 16);
       for (int i = 0; i < blocks.length; i++) {
-        metadata.set(i, blocks[i] == null ? 0 : blocks[i].getData(Version.MINECRAFT_1_7));
+        metadata.set(i, blocks[i] == null ? 0 : blocks[i].getData(ProtocolVersion.MINECRAFT_1_7_2));
       }
       buf.writeBytes(metadata.getData());
       pass = 0;
@@ -82,7 +81,7 @@ public class BlockStorage17 implements BlockStorage {
     byte[] raw = new byte[blocks.length];
     for (int i = 0; i < blocks.length; i++) {
       SimpleBlock block = blocks[i];
-      raw[i] = (byte) (block == null ? 0 : block.getId(Version.MINECRAFT_1_7));
+      raw[i] = (byte) (block == null ? 0 : block.getId(ProtocolVersion.MINECRAFT_1_7_2));
     }
     buf.writeBytes(raw);
   }
@@ -92,7 +91,7 @@ public class BlockStorage17 implements BlockStorage {
     for (int i = 0; i < blocks.length; i++) {
       SimpleBlock block = blocks[i];
       raw[i] = (short) (block == null ? 0
-          : (block.getId(Version.MINECRAFT_1_8) << 4 | block.getData(Version.MINECRAFT_1_8)));
+          : (block.getId(ProtocolVersion.MINECRAFT_1_8) << 4 | block.getData(ProtocolVersion.MINECRAFT_1_8)));
     }
     for (Short s : raw) {
       buf.writeShortLE(s);
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/storage/BlockStorage19.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/storage/BlockStorage19.java
similarity index 82%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/storage/BlockStorage19.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/storage/BlockStorage19.java
index 708be90c..f45e0165 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/data/storage/BlockStorage19.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/data/storage/BlockStorage19.java
@@ -17,7 +17,7 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.data.storage;
+package net.elytrium.elytraproxy.virtual.protocol.data.storage;
 
 import com.velocitypowered.api.network.ProtocolVersion;
 import com.velocitypowered.proxy.protocol.ProtocolUtils;
@@ -30,23 +30,23 @@ import java.util.Map;
 import lombok.AccessLevel;
 import lombok.AllArgsConstructor;
 import lombok.NonNull;
+import net.elytrium.elytraproxy.virtual.protocol.util.CompactStorage;
+import net.elytrium.elytraproxy.virtual.protocol.util.mcprotocollib.BitStorage116;
+import net.elytrium.elytraproxy.virtual.protocol.util.mcprotocollib.BitStorage19;
+import net.elytrium.elytraproxy.virtual.server.world.SimpleBlock;
+import net.elytrium.elytraproxy.virtual.server.world.SimpleBlock.Version;
+import net.elytrium.elytraproxy.virtual.server.world.chunk.SimpleChunk;
 import org.jetbrains.annotations.NotNull;
-import net.elytrium.elytraproxy.botfilter.protocol.util.CompactStorage;
-import net.elytrium.elytraproxy.botfilter.protocol.util.mcprotocollib.BitStorage116;
-import net.elytrium.elytraproxy.botfilter.protocol.util.mcprotocollib.BitStorage19;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version;
-import net.elytrium.elytraproxy.botfilter.server.world.chunk.SimpleChunk;
 
 @AllArgsConstructor(access = AccessLevel.PRIVATE)
 public class BlockStorage19 implements BlockStorage {
 
-  private final Version version;
+  private final ProtocolVersion version;
   private List<SimpleBlock> palette = new ArrayList<>();
   private Map<Integer, SimpleBlock> rawToBlock = new HashMap<>();
   private CompactStorage storage;
 
-  public BlockStorage19(Version version) {
+  public BlockStorage19(ProtocolVersion version) {
     this.version = version;
     this.storage = createStorage(4);
     palette.add(SimpleBlock.AIR);
@@ -77,7 +77,7 @@ public class BlockStorage19 implements BlockStorage {
   public void write(ByteBuf buf, ProtocolVersion version) {
     buf.writeByte(storage.getBitsPerEntry());
     if (storage.getBitsPerEntry() > 8) {
-      if (this.version.isBefore(Version.MINECRAFT_1_13)) {
+      if (this.version.isBefore(ProtocolVersion.MINECRAFT_1_13)) {
         ProtocolUtils.writeVarInt(buf, 0);
       }
     } else {
@@ -93,7 +93,7 @@ public class BlockStorage19 implements BlockStorage {
   public int getDataLength(ProtocolVersion version) {
     int length = 1;
     if (storage.getBitsPerEntry() > 8) {
-      if (this.version.isBefore(Version.MINECRAFT_1_13)) {
+      if (this.version.isBefore(ProtocolVersion.MINECRAFT_1_13)) {
         length += 1;
       }
     } else {
@@ -146,9 +146,9 @@ public class BlockStorage19 implements BlockStorage {
       return 4;
     } else if (newSize < 9) {
       return newSize;
-    } else if (version.isBefore(Version.MINECRAFT_1_13)) {
+    } else if (version.isBefore(ProtocolVersion.MINECRAFT_1_13)) {
       return 13;
-    } else if (version.isBefore(Version.MINECRAFT_1_16_4)) {
+    } else if (version.isBefore(ProtocolVersion.MINECRAFT_1_16_4)) {
       return 14;
     } else {
       return 15;
@@ -156,7 +156,7 @@ public class BlockStorage19 implements BlockStorage {
   }
 
   private CompactStorage createStorage(int bits) {
-    return version.isBefore(Version.MINECRAFT_1_16)
+    return version.isBefore(ProtocolVersion.MINECRAFT_1_16)
         ? new BitStorage19(bits, SimpleChunk.MAX_BLOCKS_PER_SECTION)
         : new BitStorage116(bits, SimpleChunk.MAX_BLOCKS_PER_SECTION);
   }
@@ -171,8 +171,8 @@ public class BlockStorage19 implements BlockStorage {
         + '}';
   }
 
-  private static int toRaw(SimpleBlock state, Version version) {
-    if (version.isBefore(Version.MINECRAFT_1_13)) {
+  private static int toRaw(SimpleBlock state, ProtocolVersion version) {
+    if (version.isBefore(ProtocolVersion.MINECRAFT_1_13)) {
       return (state.getId(version) << 4) | (state.getData(version) & 0xF);
     } else {
       return state.getId(version);
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/MapDataPacket.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/MapDataPacket.java
new file mode 100644
index 00000000..8d00e584
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/MapDataPacket.java
@@ -0,0 +1,74 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.protocol.packet;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.protocol.MinecraftPacket;
+import com.velocitypowered.proxy.protocol.ProtocolUtils;
+import io.netty.buffer.ByteBuf;
+import lombok.AllArgsConstructor;
+import lombok.Data;
+import lombok.EqualsAndHashCode;
+import lombok.Getter;
+import lombok.NoArgsConstructor;
+
+@Data
+@NoArgsConstructor
+@AllArgsConstructor
+@EqualsAndHashCode(callSuper = false)
+public class MapDataPacket implements MinecraftPacket {
+
+  private int mapId;
+  private byte scale;
+  private MapData data;
+
+  @Override
+  public void encode(ByteBuf buf, ProtocolUtils.Direction direction, ProtocolVersion version) {
+    ProtocolUtils.writeVarInt(buf, this.mapId);
+    buf.writeByte(this.scale);
+    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_9)
+        && version.isBefore(ProtocolVersion.MINECRAFT_1_17)) {
+      buf.writeBoolean(false);
+    }
+    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_14)) {
+      buf.writeBoolean(false);
+    }
+    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_17)) {
+      buf.writeBoolean(false);
+    } else {
+      ProtocolUtils.writeVarInt(buf, 0);
+    }
+    buf.writeByte(data.getColumns());
+    buf.writeByte(data.getRows());
+    buf.writeByte(data.getX());
+    buf.writeByte(data.getY());
+    ProtocolUtils.writeByteArray(buf, data.getData());
+  }
+
+  @AllArgsConstructor
+  @Getter
+  public static class MapData {
+    private final int columns;
+    private final int rows;
+    private final int x;
+    private final int y;
+    private final byte[] data;
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/Player.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/Player.java
new file mode 100644
index 00000000..b0d2521e
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/Player.java
@@ -0,0 +1,51 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.protocol.packet;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
+import com.velocitypowered.proxy.protocol.MinecraftPacket;
+import com.velocitypowered.proxy.protocol.ProtocolUtils;
+import io.netty.buffer.ByteBuf;
+import lombok.AllArgsConstructor;
+import lombok.Data;
+import lombok.EqualsAndHashCode;
+import lombok.NoArgsConstructor;
+import net.elytrium.elytraproxy.virtual.server.VirtualSessionHandler;
+
+@Data
+@NoArgsConstructor
+@AllArgsConstructor
+@EqualsAndHashCode(callSuper = false)
+public class Player implements MinecraftPacket {
+
+  private boolean onGround;
+
+  @Override
+  public void decode(ByteBuf buf, ProtocolUtils.Direction direction, ProtocolVersion protocolVersion) {
+    this.onGround = buf.readBoolean();
+  }
+
+  @Override
+  public boolean handle(MinecraftSessionHandler handler) {
+    ((VirtualSessionHandler) handler).handle(this);
+    return false;
+  }
+}
\ No newline at end of file
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/PlayerAbilities.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/PlayerAbilities.java
new file mode 100644
index 00000000..5101c6dd
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/PlayerAbilities.java
@@ -0,0 +1,53 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.protocol.packet;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
+import com.velocitypowered.proxy.protocol.MinecraftPacket;
+import com.velocitypowered.proxy.protocol.ProtocolUtils;
+import io.netty.buffer.ByteBuf;
+import lombok.AllArgsConstructor;
+import lombok.Data;
+import lombok.EqualsAndHashCode;
+import lombok.NoArgsConstructor;
+
+@Data
+@NoArgsConstructor
+@AllArgsConstructor
+@EqualsAndHashCode(callSuper = false)
+public class PlayerAbilities implements MinecraftPacket {
+
+  byte flags;
+  float speed;
+  float field;
+
+  @Override
+  public void encode(ByteBuf buf, ProtocolUtils.Direction direction, ProtocolVersion protocolVersion) {
+    buf.writeByte(this.flags);
+    buf.writeFloat(this.speed);
+    buf.writeFloat(this.field);
+  }
+
+  @Override
+  public boolean handle(MinecraftSessionHandler handler) {
+    return false;
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/PlayerPosition.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/PlayerPosition.java
new file mode 100644
index 00000000..2d65f5fe
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/PlayerPosition.java
@@ -0,0 +1,56 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.protocol.packet;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
+import com.velocitypowered.proxy.protocol.MinecraftPacket;
+import com.velocitypowered.proxy.protocol.ProtocolUtils;
+import io.netty.buffer.ByteBuf;
+import lombok.AllArgsConstructor;
+import lombok.Data;
+import lombok.EqualsAndHashCode;
+import lombok.NoArgsConstructor;
+import net.elytrium.elytraproxy.virtual.server.VirtualSessionHandler;
+
+@Data
+@NoArgsConstructor
+@AllArgsConstructor
+@EqualsAndHashCode(callSuper = false)
+public class PlayerPosition implements MinecraftPacket {
+
+  private double x;
+  private double y;
+  private double z;
+  private boolean onGround;
+
+  @Override
+  public void decode(ByteBuf buf, ProtocolUtils.Direction direction, ProtocolVersion protocolVersion) {
+    this.x = buf.readDouble();
+    this.y = buf.readDouble();
+    this.z = buf.readDouble();
+    this.onGround = buf.readBoolean();
+  }
+
+  @Override
+  public boolean handle(MinecraftSessionHandler handler) {
+    return ((VirtualSessionHandler) handler).handle(this);
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/PlayerPositionAndLook.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/PlayerPositionAndLook.java
similarity index 93%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/PlayerPositionAndLook.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/PlayerPositionAndLook.java
index 23f3a7cb..6c75fd27 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/PlayerPositionAndLook.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/PlayerPositionAndLook.java
@@ -17,7 +17,7 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.packet;
+package net.elytrium.elytraproxy.virtual.protocol.packet;
 
 import com.velocitypowered.api.network.ProtocolVersion;
 import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
@@ -30,6 +30,7 @@ import lombok.Getter;
 import lombok.NoArgsConstructor;
 import lombok.Setter;
 import lombok.ToString;
+import net.elytrium.elytraproxy.virtual.server.VirtualSessionHandler;
 
 @Getter
 @Setter
@@ -83,6 +84,6 @@ public class PlayerPositionAndLook implements MinecraftPacket {
 
   @Override
   public boolean handle(MinecraftSessionHandler handler) {
-    return handler.handle(this);
+    return ((VirtualSessionHandler) handler).handle(this);
   }
 }
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/SetExp.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/SetExp.java
new file mode 100644
index 00000000..db09ae96
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/SetExp.java
@@ -0,0 +1,59 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.protocol.packet;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
+import com.velocitypowered.proxy.protocol.MinecraftPacket;
+import com.velocitypowered.proxy.protocol.ProtocolUtils;
+import io.netty.buffer.ByteBuf;
+import lombok.AllArgsConstructor;
+import lombok.Data;
+import lombok.EqualsAndHashCode;
+import lombok.NoArgsConstructor;
+
+@Data
+@NoArgsConstructor
+@AllArgsConstructor
+@EqualsAndHashCode(callSuper = false)
+public class SetExp implements MinecraftPacket {
+
+  float expBar;
+  int level;
+  int totalExp;
+
+  @Override
+  public void encode(ByteBuf buf, ProtocolUtils.Direction direction, ProtocolVersion protocolVersion) {
+    if (protocolVersion.isAfterOrEq(ProtocolVersion.MINECRAFT_1_8)) {
+      buf.writeFloat(this.expBar);
+      ProtocolUtils.writeVarInt(buf, this.level);
+      ProtocolUtils.writeVarInt(buf, this.totalExp);
+    } else {
+      buf.writeByte((int) this.expBar); // or? buf.writeFloat(this.expBar);
+      buf.writeByte(this.level); // or? buf.writeShort(this.level);
+      buf.writeShort(this.totalExp);
+    }
+  }
+
+  @Override
+  public boolean handle(MinecraftSessionHandler handler) {
+    return true;
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/SetSlot.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/SetSlot.java
new file mode 100644
index 00000000..37e7796a
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/SetSlot.java
@@ -0,0 +1,98 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.protocol.packet;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.protocol.MinecraftPacket;
+import com.velocitypowered.proxy.protocol.ProtocolUtils;
+import io.netty.buffer.ByteBuf;
+import lombok.AllArgsConstructor;
+import lombok.Data;
+import lombok.EqualsAndHashCode;
+import lombok.NoArgsConstructor;
+import net.kyori.adventure.nbt.CompoundBinaryTag;
+import net.kyori.adventure.nbt.IntBinaryTag;
+
+@Data
+@NoArgsConstructor
+@AllArgsConstructor
+@EqualsAndHashCode(callSuper = false)
+public class SetSlot implements MinecraftPacket {
+
+  private int windowId;
+  private int slot;
+  private int item;
+  private int count;
+  private int data;
+
+  @Override
+  public void encode(ByteBuf buf, ProtocolUtils.Direction direction, ProtocolVersion version) {
+    buf.writeByte(this.windowId);
+    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_17_1)) {
+      ProtocolUtils.writeVarInt(buf, 0);
+    }
+    buf.writeShort(this.slot);
+    int id = this.item == 358 ? getCaptchaId(version) : this.item;
+    boolean present = id > 0;
+
+    if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_13_2)) {
+      buf.writeBoolean(present);
+    }
+
+    if (!present && version.isBefore(ProtocolVersion.MINECRAFT_1_13_2)) {
+      buf.writeShort(-1);
+    }
+
+    if (present) {
+      if (version.isBefore(ProtocolVersion.MINECRAFT_1_13_2)) {
+        buf.writeShort(id);
+      } else {
+        ProtocolUtils.writeVarInt(buf, id);
+      }
+      buf.writeByte(this.count);
+      if (version.isBefore(ProtocolVersion.MINECRAFT_1_13)) {
+        buf.writeShort(this.data);
+      }
+
+      if (version.isBefore(ProtocolVersion.MINECRAFT_1_17)) {
+        buf.writeByte(0); //No Nbt
+      } else {
+        CompoundBinaryTag nbt = CompoundBinaryTag.builder().put("map", IntBinaryTag.of(0)).build();
+        ProtocolUtils.writeCompoundTag(buf, nbt);
+      }
+    }
+  }
+
+  private int getCaptchaId(ProtocolVersion version) {
+    if (version.isBeforeOrEq(ProtocolVersion.MINECRAFT_1_12_2)) {
+      return 358;
+    } else if (version.equals(ProtocolVersion.MINECRAFT_1_13)) {
+      return 608;
+    } else if (version.isBeforeOrEq(ProtocolVersion.MINECRAFT_1_13_2)) {
+      return 613;
+    } else if (version.isBeforeOrEq(ProtocolVersion.MINECRAFT_1_15_2)) {
+      return 671;
+    } else if (version.isBeforeOrEq(ProtocolVersion.MINECRAFT_1_16_4)) {
+      return 733;
+    } else {
+      return 847;
+    }
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/TeleportConfirm.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/TeleportConfirm.java
new file mode 100644
index 00000000..e3af0ac8
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/TeleportConfirm.java
@@ -0,0 +1,50 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.protocol.packet;
+
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
+import com.velocitypowered.proxy.protocol.MinecraftPacket;
+import com.velocitypowered.proxy.protocol.ProtocolUtils;
+import io.netty.buffer.ByteBuf;
+import lombok.AllArgsConstructor;
+import lombok.Data;
+import lombok.EqualsAndHashCode;
+import lombok.NoArgsConstructor;
+import net.elytrium.elytraproxy.virtual.server.VirtualSessionHandler;
+
+@Data
+@NoArgsConstructor
+@AllArgsConstructor
+@EqualsAndHashCode(callSuper = false)
+public class TeleportConfirm implements MinecraftPacket {
+
+  int teleportId;
+
+  @Override
+  public void decode(ByteBuf buf, ProtocolUtils.Direction direction, ProtocolVersion protocolVersion) {
+    teleportId = ProtocolUtils.readVarInt(buf);
+  }
+
+  @Override
+  public boolean handle(MinecraftSessionHandler handler) {
+    return ((VirtualSessionHandler) handler).handle(this);
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/UpdateViewPosition.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/UpdateViewPosition.java
similarity index 73%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/UpdateViewPosition.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/UpdateViewPosition.java
index 4e17995a..ca83525f 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/UpdateViewPosition.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/UpdateViewPosition.java
@@ -17,32 +17,29 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.packet;
+package net.elytrium.elytraproxy.virtual.protocol.packet;
 
 import com.velocitypowered.api.network.ProtocolVersion;
 import com.velocitypowered.proxy.protocol.MinecraftPacket;
 import com.velocitypowered.proxy.protocol.ProtocolUtils;
-import com.velocitypowered.proxy.protocol.ProtocolUtils.Direction;
 import io.netty.buffer.ByteBuf;
 import lombok.AllArgsConstructor;
-import lombok.Getter;
+import lombok.Data;
+import lombok.EqualsAndHashCode;
 import lombok.NoArgsConstructor;
-import lombok.Setter;
-import lombok.ToString;
 
-@Getter
-@Setter
-@AllArgsConstructor
+@Data
 @NoArgsConstructor
-@ToString
+@AllArgsConstructor
+@EqualsAndHashCode(callSuper = false)
 public class UpdateViewPosition implements MinecraftPacket {
 
-  private int chunkX;
-  private int chunkZ;
+  private int x;
+  private int z;
 
   @Override
-  public void encode(ByteBuf buf, Direction direction, ProtocolVersion protocolVersion) {
-    ProtocolUtils.writeVarInt(buf, chunkX);
-    ProtocolUtils.writeVarInt(buf, chunkZ);
+  public void encode(ByteBuf buf, ProtocolUtils.Direction direction, ProtocolVersion protocolVersion) {
+    ProtocolUtils.writeVarInt(buf, this.x);
+    ProtocolUtils.writeVarInt(buf, this.z);
   }
 }
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/world/ChunkData.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/world/ChunkData.java
similarity index 90%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/world/ChunkData.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/world/ChunkData.java
index 3b4b1af0..2381cb65 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/packet/world/ChunkData.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/packet/world/ChunkData.java
@@ -17,7 +17,7 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.packet.world;
+package net.elytrium.elytraproxy.virtual.protocol.packet.world;
 
 import com.google.common.base.Preconditions;
 import com.velocitypowered.api.network.ProtocolVersion;
@@ -36,16 +36,16 @@ import java.util.Map;
 import java.util.Map.Entry;
 import java.util.zip.Deflater;
 import lombok.Getter;
-import net.elytrium.elytraproxy.botfilter.protocol.data.registry.Biome;
+import net.elytrium.elytraproxy.virtual.protocol.data.registry.Biome;
+import net.elytrium.elytraproxy.virtual.protocol.util.CompactStorage;
+import net.elytrium.elytraproxy.virtual.protocol.util.NetworkSection;
+import net.elytrium.elytraproxy.virtual.protocol.util.mcprotocollib.BitStorage116;
+import net.elytrium.elytraproxy.virtual.protocol.util.mcprotocollib.BitStorage19;
+import net.elytrium.elytraproxy.virtual.server.world.SimpleBlock;
+import net.elytrium.elytraproxy.virtual.server.world.chunk.ChunkSnapshot;
+import net.elytrium.elytraproxy.virtual.server.world.chunk.LightSection;
+import net.elytrium.elytraproxy.virtual.server.world.chunk.SimpleChunk;
 import net.kyori.adventure.nbt.CompoundBinaryTag;
-import net.elytrium.elytraproxy.botfilter.protocol.util.CompactStorage;
-import net.elytrium.elytraproxy.botfilter.protocol.util.NetworkSection;
-import net.elytrium.elytraproxy.botfilter.protocol.util.mcprotocollib.BitStorage116;
-import net.elytrium.elytraproxy.botfilter.protocol.util.mcprotocollib.BitStorage19;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock;
-import net.elytrium.elytraproxy.botfilter.server.world.chunk.ChunkSnapshot;
-import net.elytrium.elytraproxy.botfilter.server.world.chunk.LightSection;
-import net.elytrium.elytraproxy.botfilter.server.world.chunk.SimpleChunk;
 
 public class ChunkData implements MinecraftPacket {
 
@@ -89,8 +89,8 @@ public class ChunkData implements MinecraftPacket {
     if (version.isBefore(ProtocolVersion.MINECRAFT_1_17)) {
       buf.writeBoolean(chunk.isFullChunk());
 
-      if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_16) &&
-          version.isBefore(ProtocolVersion.MINECRAFT_1_16_2)) {
+      if (version.isAfterOrEq(ProtocolVersion.MINECRAFT_1_16)
+          && version.isBefore(ProtocolVersion.MINECRAFT_1_16_2)) {
         buf.writeBoolean(true); //ignore old data
       }
 
@@ -203,7 +203,7 @@ public class ChunkData implements MinecraftPacket {
   }
 
   private long[] create117Mask() {
-    BitSet bitSet = BitSet.valueOf(new long[]{mask});
+    BitSet bitSet = BitSet.valueOf(new long[] {mask});
     return bitSet.toLongArray();
   }
 
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/CompactStorage.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/CompactStorage.java
similarity index 95%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/CompactStorage.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/CompactStorage.java
index 0be862f1..aca3b339 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/CompactStorage.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/CompactStorage.java
@@ -17,7 +17,7 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.util;
+package net.elytrium.elytraproxy.virtual.protocol.util;
 
 import com.velocitypowered.api.network.ProtocolVersion;
 import io.netty.buffer.ByteBuf;
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/NetworkSection.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/NetworkSection.java
similarity index 89%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/NetworkSection.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/NetworkSection.java
index f4fa8d89..5bd70f76 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/NetworkSection.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/NetworkSection.java
@@ -17,18 +17,18 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.util;
+package net.elytrium.elytraproxy.virtual.protocol.util;
 
 import com.velocitypowered.api.network.ProtocolVersion;
 import io.netty.buffer.ByteBuf;
 import java.util.EnumMap;
 import java.util.Map;
 import lombok.NonNull;
-import net.elytrium.elytraproxy.botfilter.protocol.data.storage.BlockStorage;
-import net.elytrium.elytraproxy.botfilter.protocol.util.mcprotocollib.NibbleArray3d;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version;
-import net.elytrium.elytraproxy.botfilter.server.world.chunk.SimpleSection;
+import net.elytrium.elytraproxy.virtual.protocol.data.storage.BlockStorage;
+import net.elytrium.elytraproxy.virtual.protocol.util.mcprotocollib.NibbleArray3d;
+import net.elytrium.elytraproxy.virtual.server.world.SimpleBlock;
+import net.elytrium.elytraproxy.virtual.server.world.SimpleBlock.Version;
+import net.elytrium.elytraproxy.virtual.server.world.chunk.SimpleSection;
 
 public class NetworkSection {
 
@@ -38,8 +38,7 @@ public class NetworkSection {
   private final SimpleSection section;
   private int blockCount = -1;
 
-  public NetworkSection(SimpleSection section, @NonNull NibbleArray3d blockLight,
-      NibbleArray3d skyLight) {
+  public NetworkSection(SimpleSection section, @NonNull NibbleArray3d blockLight, NibbleArray3d skyLight) {
     this.section = section;
     this.blockLight = blockLight;
     this.skyLight = skyLight;
@@ -50,7 +49,7 @@ public class NetworkSection {
     if (storage == null) {
       synchronized (storages) {
         Version bVersion = Version.map(version);
-        BlockStorage blockStorage = BlockStorage.create(bVersion);
+        BlockStorage blockStorage = BlockStorage.create(version);
         fillBlocks(blockStorage);
         for (ProtocolVersion pVersion : bVersion.getVersions()) {
           storages.put(pVersion, blockStorage);
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/mcprotocollib/BitStorage116.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/mcprotocollib/BitStorage116.java
similarity index 97%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/mcprotocollib/BitStorage116.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/mcprotocollib/BitStorage116.java
index 24f1099f..2e965f4e 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/mcprotocollib/BitStorage116.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/mcprotocollib/BitStorage116.java
@@ -22,7 +22,7 @@
  * OR OTHER DEALINGS IN THE SOFTWARE.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.util.mcprotocollib;
+package net.elytrium.elytraproxy.virtual.protocol.util.mcprotocollib;
 
 import com.velocitypowered.api.network.ProtocolVersion;
 import com.velocitypowered.proxy.protocol.ProtocolUtils;
@@ -30,7 +30,7 @@ import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
 import io.netty.buffer.ByteBuf;
 import java.util.Arrays;
 import lombok.Getter;
-import net.elytrium.elytraproxy.botfilter.protocol.util.CompactStorage;
+import net.elytrium.elytraproxy.virtual.protocol.util.CompactStorage;
 
 public class BitStorage116 implements CompactStorage {
 
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/mcprotocollib/BitStorage19.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/mcprotocollib/BitStorage19.java
similarity index 96%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/mcprotocollib/BitStorage19.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/mcprotocollib/BitStorage19.java
index 9ad241f9..dcf42f5b 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/mcprotocollib/BitStorage19.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/mcprotocollib/BitStorage19.java
@@ -22,14 +22,14 @@
  * OR OTHER DEALINGS IN THE SOFTWARE.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.util.mcprotocollib;
+package net.elytrium.elytraproxy.virtual.protocol.util.mcprotocollib;
 
 import com.velocitypowered.api.network.ProtocolVersion;
 import com.velocitypowered.proxy.protocol.ProtocolUtils;
 import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
 import io.netty.buffer.ByteBuf;
 import java.util.Arrays;
-import net.elytrium.elytraproxy.botfilter.protocol.util.CompactStorage;
+import net.elytrium.elytraproxy.virtual.protocol.util.CompactStorage;
 
 @SuppressFBWarnings({"EI_EXPOSE_REP2", "EI_EXPOSE_REP"})
 public class BitStorage19 implements CompactStorage {
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/mcprotocollib/NibbleArray3d.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/mcprotocollib/NibbleArray3d.java
similarity index 97%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/mcprotocollib/NibbleArray3d.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/mcprotocollib/NibbleArray3d.java
index 596c987c..896a5bdb 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/protocol/util/mcprotocollib/NibbleArray3d.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/protocol/util/mcprotocollib/NibbleArray3d.java
@@ -22,7 +22,7 @@
  * OR OTHER DEALINGS IN THE SOFTWARE.
  */
 
-package net.elytrium.elytraproxy.botfilter.protocol.util.mcprotocollib;
+package net.elytrium.elytraproxy.virtual.protocol.util.mcprotocollib;
 
 import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
 import java.util.Arrays;
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/ServerPackets.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/ServerPackets.java
new file mode 100644
index 00000000..e5af91d5
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/ServerPackets.java
@@ -0,0 +1,294 @@
+/*
+ * This file is part of Velocity-BotFilter, licensed under the AGPLv3 License (AGPLv3).
+ *
+ * Copyright (C) 2021 Vjateslav Maspanov <Leymooo>
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.server;
+
+import com.google.common.collect.ImmutableSet;
+import com.velocitypowered.api.network.ProtocolVersion;
+import com.velocitypowered.proxy.connection.registry.DimensionData;
+import com.velocitypowered.proxy.connection.registry.DimensionInfo;
+import com.velocitypowered.proxy.connection.registry.DimensionRegistry;
+import com.velocitypowered.proxy.protocol.MinecraftPacket;
+import com.velocitypowered.proxy.protocol.ProtocolUtils;
+import com.velocitypowered.proxy.protocol.packet.Chat;
+import com.velocitypowered.proxy.protocol.packet.Disconnect;
+import com.velocitypowered.proxy.protocol.packet.JoinGame;
+import com.velocitypowered.proxy.protocol.packet.PluginMessage;
+import io.netty.buffer.ByteBuf;
+import io.netty.buffer.ByteBufAllocator;
+import java.io.IOException;
+import java.nio.file.Path;
+import java.util.ArrayList;
+import java.util.List;
+import java.util.function.Supplier;
+import lombok.Getter;
+import net.elytrium.elytraproxy.botfilter.handler.BotFilterSessionHandler;
+import net.elytrium.elytraproxy.config.Settings;
+import net.elytrium.elytraproxy.virtual.file.SchematicFile;
+import net.elytrium.elytraproxy.virtual.file.WorldFile;
+import net.elytrium.elytraproxy.virtual.protocol.cache.PreparedPacket;
+import net.elytrium.elytraproxy.virtual.protocol.data.registry.Biome;
+import net.elytrium.elytraproxy.virtual.protocol.packet.PlayerAbilities;
+import net.elytrium.elytraproxy.virtual.protocol.packet.PlayerPositionAndLook;
+import net.elytrium.elytraproxy.virtual.protocol.packet.SetExp;
+import net.elytrium.elytraproxy.virtual.protocol.packet.SetSlot;
+import net.elytrium.elytraproxy.virtual.protocol.packet.UpdateViewPosition;
+import net.elytrium.elytraproxy.virtual.protocol.packet.world.ChunkData;
+import net.elytrium.elytraproxy.virtual.server.world.VirtualWorld;
+import net.elytrium.elytraproxy.virtual.server.world.chunk.SimpleChunk;
+import net.kyori.adventure.text.Component;
+import net.kyori.adventure.text.serializer.legacy.LegacyComponentSerializer;
+
+@Getter
+public class ServerPackets {
+
+  private final VirtualServer virtualServer;
+  private final String key = Settings.IMP.ANTIBOT.BOTFILTER_DIMENSION.MODERN_KEY;
+  private final String hardcodedBrandString = Settings.IMP.ANTIBOT.BRAND + " (ely.su/github)";
+  private final int dimensionId = Settings.IMP.ANTIBOT.BOTFILTER_DIMENSION.ID;
+  private final int legacyDimensionId = Settings.IMP.ANTIBOT.BOTFILTER_DIMENSION.LEGACY_ID;
+  private DimensionData dimension;
+  private DimensionData legacyDimension;
+  private VirtualWorld virtualWorld;
+  private PreparedPacket staticWorldPacket;
+  private PreparedPacket joinPacket;
+  private PreparedPacket alreadyConnected;
+  private PreparedPacket tooBigPacket;
+  private PreparedPacket captchaFailed;
+  private PreparedPacket fallingCheckFailed;
+  private PreparedPacket setSlot;
+  private PreparedPacket resetSlot;
+  private PreparedPacket checkingChat;
+  private PreparedPacket checkingCaptchaChat;
+  private PreparedPacket loginChat;
+  private PreparedPacket totpChat;
+  private PreparedPacket registerChat;
+  private PreparedPacket wrongPasswordChat;
+  private PreparedPacket successfulBotFilterChat;
+  private PreparedPacket nicknamePremium;
+  private PreparedPacket nicknameInvalid;
+  private PreparedPacket ipLimit;
+  private PreparedPacket wrongPassword;
+  private PreparedPacket wrongNicknameCase;
+  private PreparedPacket successfulBotFilterDisconnect;
+  private PreparedPacket captchaPosition;
+  private PreparedPacket authPosition;
+  private PreparedPacket noAbilities;
+  private PreparedPacket antiBotBrand;
+  private List<SetExp> experience;
+
+  public ServerPackets(VirtualServer virtualServer) {
+    this.virtualServer = virtualServer;
+  }
+
+  public void createPackets() {
+    Settings.ANTIBOT.CAPTCHA_COORDS captchaCoords = Settings.IMP.ANTIBOT.CAPTCHA_COORDS;
+    Settings.AUTH.AUTH_COORDS authCoords = Settings.IMP.AUTH.AUTH_COORDS;
+    // TODO:    
+    dimension = new DimensionData(key, dimensionId, true,
+        0.0f, false, false, false, true,
+        true, true, false, false, 256,
+        "minecraft:infiniburn_nether",
+        0L, false, 1.0, key, 0, 256);
+    legacyDimension = new DimensionData(key, legacyDimensionId, true,
+        0.0f, false, false, false, true,
+        true, true, false, false, 256,
+        "minecraft:infiniburn_nether",
+        0L, false, 1.0, key, 0, 256);
+    this.virtualWorld = new VirtualWorld(dimension,
+        new DimensionInfo(key, key, true, false), (int) captchaCoords.X, (int) captchaCoords.Y);
+
+    if (Settings.IMP.VIRTUAL.LOAD_WORLD) {
+      try {
+        Path path = Path.of(Settings.IMP.VIRTUAL.WORLD_FILE_PATH);
+        WorldFile file;
+        switch (Settings.IMP.VIRTUAL.WORLD_FILE_TYPE) {
+          case "schematic":
+          default:
+            file = new SchematicFile(path);
+            break;
+        }
+
+        Settings.VIRTUAL.VIRTUAL_COORDS coords = Settings.IMP.VIRTUAL.VIRTUAL_COORDS;
+        file.toWorld(virtualWorld, coords.X, coords.Y, coords.Z);
+      } catch (IOException e) {
+        e.printStackTrace();
+      }
+    }
+
+    experience = createExpPackets();
+    captchaPosition = new PreparedPacket()
+        .prepare(createPlayerPosAndLookPacket(
+            captchaCoords.X, captchaCoords.Y, captchaCoords.Z, (float) captchaCoords.YAW, (float) captchaCoords.PITCH))
+        .prepare(createUpdateViewPosition((int) captchaCoords.X, (int) captchaCoords.Z), ProtocolVersion.MINECRAFT_1_14);
+    authPosition = new PreparedPacket()
+        .prepare(createPlayerPosAndLookPacket(
+            authCoords.X, authCoords.Y, authCoords.Z, (float) authCoords.YAW, (float) authCoords.PITCH))
+        .prepare(createUpdateViewPosition((int) authCoords.X, (int) authCoords.Z), ProtocolVersion.MINECRAFT_1_14);
+
+    joinPacket = new PreparedPacket()
+        .prepare(createLegacyJoinGamePacket(), ProtocolVersion.MINIMUM_VERSION, ProtocolVersion.MINECRAFT_1_15_2)
+        .prepare(createJoinGamePacket(), ProtocolVersion.MINECRAFT_1_16);
+
+    staticWorldPacket = prepare(createChunksPackets(60));
+
+    noAbilities = prepare(createAbilitiesPacket());
+    alreadyConnected = prepare(createDisconnectPacket(Settings.IMP.MESSAGES.VELOCITY.ERROR.ALREADY_CONNECTED_PROXY));
+    tooBigPacket = prepare(createDisconnectPacket(Settings.IMP.ANTIBOT.STRINGS.TOO_BIG_PACKET));
+    captchaFailed = prepare(createDisconnectPacket(Settings.IMP.ANTIBOT.STRINGS.CAPTCHA_FAILED));
+    fallingCheckFailed = prepare(createDisconnectPacket(Settings.IMP.ANTIBOT.STRINGS.FALLING_CHECK_FAILED));
+    setSlot = prepare(createSetSlotPacket(0, 36, 358, 1, 0));
+    resetSlot = prepare(createSetSlotPacket(0, 36, -1, 0, 0));
+    checkingChat = createChatPacket(Settings.IMP.ANTIBOT.STRINGS.CHECKING);
+    checkingCaptchaChat = createChatPacket(Settings.IMP.ANTIBOT.STRINGS.CHECKING_CAPTCHA);
+    loginChat = createChatPacket(Settings.IMP.AUTH.STRINGS.LOGIN);
+    totpChat = createChatPacket(Settings.IMP.AUTH.STRINGS.TOTP);
+    registerChat = createChatPacket(Settings.IMP.AUTH.STRINGS.REGISTER);
+    wrongPasswordChat = createChatPacket(Settings.IMP.AUTH.STRINGS.PASSWORD_WRONG);
+    wrongPassword = prepare(createDisconnectPacket(Settings.IMP.AUTH.STRINGS.PASSWORD_WRONG));
+    wrongNicknameCase = prepare(createDisconnectPacket(Settings.IMP.AUTH.STRINGS.WRONG_NICKNAME_CASE));
+    nicknamePremium = prepare(createDisconnectPacket(Settings.IMP.AUTH.STRINGS.NICKNAME_PREMIUM));
+    nicknameInvalid = prepare(createDisconnectPacket(Settings.IMP.AUTH.STRINGS.NICKNAME_INVALID));
+    successfulBotFilterChat = createChatPacket(Settings.IMP.ANTIBOT.STRINGS.SUCCESSFUL_CRACKED);
+    successfulBotFilterDisconnect = prepare(createDisconnectPacket(Settings.IMP.ANTIBOT.STRINGS.SUCCESSFUL_PREMIUM));
+    ipLimit = prepare(createDisconnectPacket(Settings.IMP.AUTH.STRINGS.IP_LIMIT));
+    antiBotBrand = prepare(() -> createBrandPacket(createBrandBuf(hardcodedBrandString)));
+  }
+
+  private PlayerAbilities createAbilitiesPacket() {
+    return new PlayerAbilities((byte) 6, 0f, 0f);
+  }
+
+  private JoinGame createJoinGamePacket() {
+    DimensionRegistry dimensionRegistry = new DimensionRegistry(ImmutableSet.of(dimension), ImmutableSet.of(key));
+
+    JoinGame joinGame = new JoinGame();
+    joinGame.setEntityId(0);
+    joinGame.setGamemode((short) 2);
+    joinGame.setPreviousGamemode((short) 2);
+    joinGame.setDimension(dimensionId);
+    joinGame.setDifficulty((short) 0);
+    joinGame.setMaxPlayers(1);
+    joinGame.setPartialHashedSeed(System.currentTimeMillis());
+    joinGame.setLevelType("flat");
+    joinGame.setViewDistance(4);
+    joinGame.setReducedDebugInfo(true);
+    joinGame.setIsHardcore(Settings.IMP.ANTIBOT.BOTFILTER_DIMENSION.HARDCORE_HEARTS);
+    joinGame.setDimensionRegistry(dimensionRegistry);
+    joinGame.setDimensionInfo(new DimensionInfo(key, key, false, false));
+    joinGame.setCurrentDimensionData(dimension);
+    joinGame.setBiomeRegistry(Biome.getRegistry());
+    return joinGame;
+  }
+
+  private JoinGame createLegacyJoinGamePacket() {
+    JoinGame joinGame = createJoinGamePacket();
+    joinGame.setDimension(legacyDimensionId);
+    return joinGame;
+  }
+
+  public PlayerPositionAndLook createPlayerPosAndLookPacket(double x, double y, double z, float yaw, float pitch) {
+    return new PlayerPositionAndLook(x, y, z, yaw, pitch, -133, false, true);
+  }
+
+  private List<ChunkData> createChunksPackets(int skyLightY) {
+    List<ChunkData> packets = new ArrayList<>();
+    for (SimpleChunk chunk : virtualWorld.getChunks()) {
+      packets.add(createChunkDataPacket(chunk, skyLightY));
+    }
+    return packets;
+  }
+
+  private List<SetExp> createExpPackets() {
+    List<SetExp> packets = new ArrayList<>();
+    long ticks = BotFilterSessionHandler.TOTAL_TICKS;
+    float expInterval = 1f / (float) ticks;
+    for (int i = 0; i < ticks; ++i) {
+      packets.add(new SetExp(i * expInterval, i, 0));
+    }
+    return packets;
+  }
+
+  public ChunkData createChunkDataPacket(SimpleChunk chunk, int skyLightY) {
+    chunk.setSkyLight(chunk.getX() % 16, skyLightY, chunk.getZ() % 16, (byte) 1);
+    return new ChunkData(chunk.getFullChunkSnapshot(), true);
+  }
+
+  public UpdateViewPosition createUpdateViewPosition(int x, int z) {
+    return new UpdateViewPosition(Math.floorDiv(x, 16), Math.floorDiv(z, 16));
+  }
+
+  private SetSlot createSetSlotPacket(int windowId, int slot, int item, int count, int data) {
+    return new SetSlot(windowId, slot, item, count, data);
+  }
+
+  private <T extends MinecraftPacket> PreparedPacket prepare(Supplier<T> packets) {
+    return new PreparedPacket().prepare(packets);
+  }
+
+  @SafeVarargs
+  private <T extends MinecraftPacket> PreparedPacket prepare(T... packets) {
+    PreparedPacket preparedPacket = new PreparedPacket();
+
+    for (T packet : packets) {
+      preparedPacket.prepare(packet);
+    }
+
+    return preparedPacket;
+  }
+
+  private <T extends MinecraftPacket> PreparedPacket prepare(List<T> packets) {
+    PreparedPacket preparedPacket = new PreparedPacket();
+    packets.forEach(preparedPacket::prepare);
+    return preparedPacket;
+  }
+
+  private PluginMessage createBrandPacket(ByteBuf brandBuf) {
+    return new PluginMessage("MC|Brand", brandBuf);
+  }
+
+  private ByteBuf createBrandBuf(String brand) {
+    ByteBuf brandBuf = ByteBufAllocator.DEFAULT.heapBuffer();
+    ProtocolUtils.writeString(brandBuf, brand);
+    return brandBuf;
+  }
+
+  private PreparedPacket createChatPacket(String text) {
+    return new PreparedPacket()
+        .prepare(new Chat(
+            ProtocolUtils.getJsonChatSerializer(ProtocolVersion.MINIMUM_VERSION).serialize(
+                LegacyComponentSerializer
+                    .legacyAmpersand()
+                    .deserialize(text)
+            ), Chat.CHAT_TYPE, null
+        ), ProtocolVersion.MINIMUM_VERSION, ProtocolVersion.MINECRAFT_1_15_2)
+        .prepare(new Chat(
+            ProtocolUtils.getJsonChatSerializer(ProtocolVersion.MINECRAFT_1_16).serialize(
+                LegacyComponentSerializer
+                    .legacyAmpersand()
+                    .deserialize(text)
+            ), Chat.CHAT_TYPE, null
+        ), ProtocolVersion.MINECRAFT_1_16);
+  }
+
+  private Disconnect createDisconnectPacket(String message) {
+    Component component = LegacyComponentSerializer.legacyAmpersand().deserialize(message);
+    return Disconnect.create(component, ProtocolVersion.MINIMUM_VERSION);
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/VirtualServer.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/VirtualServer.java
similarity index 50%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/VirtualServer.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/VirtualServer.java
index d9b75a41..b48599ef 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/VirtualServer.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/VirtualServer.java
@@ -17,54 +17,61 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.server;
+package net.elytrium.elytraproxy.virtual.server;
 
 import com.velocitypowered.proxy.connection.MinecraftConnection;
+import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
 import com.velocitypowered.proxy.connection.client.ConnectedPlayer;
+import com.velocitypowered.proxy.network.Connections;
 import com.velocitypowered.proxy.protocol.StateRegistry;
-import java.util.concurrent.ConcurrentHashMap;
-import java.util.concurrent.ConcurrentMap;
+import io.netty.channel.ChannelPipeline;
 import lombok.Getter;
 import net.elytrium.elytraproxy.ElytraProxy;
-import net.elytrium.elytraproxy.botfilter.protocol.cache.PacketCompressor;
+import net.elytrium.elytraproxy.virtual.protocol.cache.PreparedPacketEncoder;
 
-public class VirtualServer {
+public class VirtualServer implements MinecraftSessionHandler {
 
   @Getter
   private final ElytraProxy elytraProxy;
-  private final ConcurrentMap<String, BotFilterSessionHandler>
-      activeConnections = new ConcurrentHashMap<>();
+  @Getter
   private final ServerPackets packets;
 
   public VirtualServer(ElytraProxy elytraProxy) {
     this.elytraProxy = elytraProxy;
-    this.packets = new ServerPackets(
-        new PacketCompressor(elytraProxy.getVelocityServer()::getConfiguration), this);
+    this.packets = new ServerPackets(this);
   }
 
   public void reload() {
-    for (BotFilterSessionHandler session : activeConnections.values()) {
-      session.getPlayer().getConnection().close();
-    }
     packets.createPackets();
   }
 
-  public void spawnPlayer(BotFilterSessionHandler user) {
-    String username = user.getPlayer().getUsername().toLowerCase();
-    ConnectedPlayer player = user.getPlayer();
+  public void spawnPlayer(VirtualSessionHandler handler) {
+    ConnectedPlayer player = handler.getPlayer();
     MinecraftConnection connection = player.getConnection();
-    if (activeConnections.putIfAbsent(username, user) != null) {
-      connection.closeWith(packets.getAlreadyConnected());
-      //user.closeWith(preparedPackets.getAlreadyConnected());
-      return;
-    }
-    user.getOriginalHandler().completeLoginProtocol(player, false);
-    connection.setState(StateRegistry.BotFilter);
-    packets.getSpawnPackets().write(connection, player.isOnlineMode());
-    connection.flush();
+    ChannelPipeline pipeline = connection.getChannel().pipeline();
+
+    pipeline.addAfter(Connections.MINECRAFT_ENCODER,
+        "prepared-encoder", new PreparedPacketEncoder(connection.getProtocolVersion()));
+
+    player.setVirtualServerJoined(true);
+    connection.setSessionHandler(handler);
+    handler.onSpawn();
+  }
+
+  public void sendJoinPacket(VirtualSessionHandler handler) {
+    ConnectedPlayer player = handler.getPlayer();
+    MinecraftConnection connection = player.getConnection();
+
+    connection.write(packets.getJoinPacket());
   }
 
-  public void disconnected(BotFilterSessionHandler botFilterConnection) {
-    activeConnections.remove(botFilterConnection.getPlayer().getUsername().toLowerCase());
+  public void loginComplete(VirtualSessionHandler handler) {
+    ConnectedPlayer player = handler.getPlayer();
+    MinecraftConnection connection = player.getConnection();
+
+    if (connection.getState() != StateRegistry.VIRTUAL) {
+      connection.setState(StateRegistry.VIRTUAL);
+      sendJoinPacket(handler);
+    }
   }
 }
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/VirtualSessionHandler.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/VirtualSessionHandler.java
new file mode 100644
index 00000000..3b9f5fa9
--- /dev/null
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/VirtualSessionHandler.java
@@ -0,0 +1,70 @@
+/*
+ * Copyright (C) 2021 Elytrium
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU Affero General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU Affero General Public License for more details.
+ *
+ * You should have received a copy of the GNU Affero General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ */
+
+package net.elytrium.elytraproxy.virtual.server;
+
+import com.velocitypowered.proxy.connection.MinecraftSessionHandler;
+import com.velocitypowered.proxy.connection.client.ConnectedPlayer;
+import io.netty.channel.ChannelPipeline;
+import java.util.Locale;
+import lombok.Getter;
+import net.elytrium.elytraproxy.virtual.protocol.cache.PreparedPacketEncoder;
+import net.elytrium.elytraproxy.virtual.protocol.packet.Player;
+import net.elytrium.elytraproxy.virtual.protocol.packet.PlayerPosition;
+import net.elytrium.elytraproxy.virtual.protocol.packet.PlayerPositionAndLook;
+import net.elytrium.elytraproxy.virtual.protocol.packet.TeleportConfirm;
+
+@Getter
+public abstract class VirtualSessionHandler implements MinecraftSessionHandler {
+  public final ConnectedPlayer player;
+  public final MinecraftSessionHandler originalHandler;
+  public final VirtualServer virtualServer;
+  public final String lowercaseNickname;
+
+  public VirtualSessionHandler(
+      ConnectedPlayer player, MinecraftSessionHandler originalHandler, VirtualServer virtualServer) {
+    this.player = player;
+    this.originalHandler = originalHandler;
+    this.virtualServer = virtualServer;
+    this.lowercaseNickname = player.getUsername().toLowerCase(Locale.ROOT);
+  }
+
+  public abstract void onSpawn();
+
+  public boolean handle(Player packet) {
+    return false;
+  }
+
+  public boolean handle(PlayerPosition packet) {
+    return false;
+  }
+
+  public boolean handle(PlayerPositionAndLook packet) {
+    return false;
+  }
+
+  public boolean handle(TeleportConfirm packet) {
+    return false;
+  }
+
+  public void disconnected() {
+    ChannelPipeline pipeline = player.getConnection().getChannel().pipeline();
+    if (pipeline.names().contains("prepared-encoder")) {
+      pipeline.remove(PreparedPacketEncoder.class);
+    }
+  }
+}
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/SimpleBlock.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/SimpleBlock.java
similarity index 67%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/SimpleBlock.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/SimpleBlock.java
index fe06742f..7cb44c84 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/SimpleBlock.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/SimpleBlock.java
@@ -17,23 +17,23 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.server.world;
-
-import static net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.BlockInfo.fallback;
-import static net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.BlockInfo.info;
-import static net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version.MINECRAFT_1_13;
-import static net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version.MINECRAFT_1_13_1;
-import static net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version.MINECRAFT_1_14;
-import static net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version.MINECRAFT_1_16;
-import static net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version.MINECRAFT_1_16_2;
-import static net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version.MINECRAFT_1_17;
-import static net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version.MINECRAFT_1_7;
-import static net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock.Version.MINECRAFT_1_8;
+package net.elytrium.elytraproxy.virtual.server.world;
 
+import static net.elytrium.elytraproxy.virtual.server.world.SimpleBlock.BlockInfo.info;
+import static net.elytrium.elytraproxy.virtual.server.world.SimpleBlock.Version.LEGACY;
+import static net.elytrium.elytraproxy.virtual.server.world.SimpleBlock.Version.MINECRAFT_1_17;
+
+import com.google.gson.Gson;
+import com.google.gson.internal.LinkedTreeMap;
 import com.velocitypowered.api.network.ProtocolVersion;
+import java.io.IOException;
+import java.io.InputStreamReader;
+import java.net.URL;
+import java.nio.charset.StandardCharsets;
 import java.util.Arrays;
 import java.util.EnumMap;
 import java.util.EnumSet;
+import java.util.HashMap;
 import java.util.Map;
 import java.util.Set;
 import lombok.NonNull;
@@ -42,41 +42,32 @@ import org.jetbrains.annotations.NotNull;
 public class SimpleBlock {
 
   public static final SimpleBlock AIR = air(
-      info(MINECRAFT_1_7, 0)
-  );
-  public static final SimpleBlock STONE = solid(
-      info(MINECRAFT_1_7, 1)
-  );
-  public static final SimpleBlock GRANITE = solid(
-      fallback(MINECRAFT_1_7, STONE),
-      info(MINECRAFT_1_8, 1, 1),
-      info(MINECRAFT_1_13, 2)
-  );
-  public static final SimpleBlock GLASS = solid(
-      info(MINECRAFT_1_7, 20),
-      info(MINECRAFT_1_13, 230),
-      info(MINECRAFT_1_16, 231),
-      info(MINECRAFT_1_17, 262)
-  );
-  public static final SimpleBlock TORCH = nonSolid(false,
-      info(MINECRAFT_1_7, 50, 14),
-      info(MINECRAFT_1_13, 1130),
-      info(MINECRAFT_1_13_1, 1131),
-      info(MINECRAFT_1_14, 1134),
-      info(MINECRAFT_1_16, 1435),
-      info(MINECRAFT_1_17, 1491)
-  );
-  public static final SimpleBlock BARRIER = solid(
-      fallback(MINECRAFT_1_7, GLASS),
-      info(MINECRAFT_1_8, 166),
-      info(MINECRAFT_1_13, 6493),
-      info(MINECRAFT_1_13_1, 6494),
-      info(MINECRAFT_1_14, 7000),
-      info(MINECRAFT_1_16, 7536),
-      info(MINECRAFT_1_16_2, 7540),
-      info(MINECRAFT_1_17, 7754)
+      info(LEGACY, 0)
   );
 
+  private static final Gson gson = new Gson();
+  private static final HashMap<Short, SimpleBlock> legacyIDsMap = new HashMap<>();
+
+  static {
+    try {
+      URL file = ClassLoader.getSystemResource("net/elytrium/elytraproxy/virtual/ids.json");
+      LinkedTreeMap<String, LinkedTreeMap<String, String>> map = gson.fromJson(
+          new InputStreamReader(file.openStream(), StandardCharsets.UTF_8), LinkedTreeMap.class);
+
+      map.forEach((legacyBlockId, versionMap) -> {
+        BlockInfo[] info = versionMap.entrySet().stream()
+            .map(e -> info(Version.parse(e.getKey()), Integer.parseInt(e.getValue())))
+            .toArray(BlockInfo[]::new);
+
+        legacyIDsMap.put(Short.valueOf(legacyBlockId), solid(info));
+      });
+
+      legacyIDsMap.put((short) 0, AIR);
+    } catch (IOException e) {
+      e.printStackTrace();
+    }
+  }
+
   private final Map<Version, BlockInfo> blockInfos = new EnumMap<>(Version.class);
   private final boolean solid;
   private final boolean air;
@@ -101,6 +92,14 @@ public class SimpleBlock {
     return blockInfos.get(version).getData();
   }
 
+  public short getId(ProtocolVersion version) {
+    return getId(Version.map(version));
+  }
+
+  public byte getData(ProtocolVersion version) {
+    return getData(Version.map(version));
+  }
+
   public boolean isSolid() {
     return solid;
   }
@@ -129,29 +128,58 @@ public class SimpleBlock {
     return new SimpleBlock(false, false, motionBlocking, infos);
   }
 
+  public static @NotNull SimpleBlock fromLegacyId(short id) {
+    return legacyIDsMap.get(id);
+  }
+
   public static @NotNull SimpleBlock air(BlockInfo... infos) {
     return new SimpleBlock(false, true, false, infos);
   }
 
   public enum Version {
+    /*
     MINECRAFT_1_7(ProtocolVersion.MINECRAFT_1_7_2, ProtocolVersion.MINECRAFT_1_7_6),
     MINECRAFT_1_8(ProtocolVersion.MINECRAFT_1_8),
     MINECRAFT_1_9(EnumSet.range(ProtocolVersion.MINECRAFT_1_9, ProtocolVersion.MINECRAFT_1_9_4)),
     MINECRAFT_1_10(ProtocolVersion.MINECRAFT_1_10),
     MINECRAFT_1_11(ProtocolVersion.MINECRAFT_1_11, ProtocolVersion.MINECRAFT_1_11_1),
+    */
+    LEGACY(EnumSet.range(ProtocolVersion.MINECRAFT_1_7_2, ProtocolVersion.MINECRAFT_1_12_2)),
     MINECRAFT_1_12(EnumSet.range(ProtocolVersion.MINECRAFT_1_12, ProtocolVersion.MINECRAFT_1_12_2)),
     MINECRAFT_1_13(ProtocolVersion.MINECRAFT_1_13),
-    MINECRAFT_1_13_1(ProtocolVersion.MINECRAFT_1_13_1, ProtocolVersion.MINECRAFT_1_13_2),
+    MINECRAFT_1_13_2(ProtocolVersion.MINECRAFT_1_13_1, ProtocolVersion.MINECRAFT_1_13_2),
     MINECRAFT_1_14(EnumSet.range(ProtocolVersion.MINECRAFT_1_14, ProtocolVersion.MINECRAFT_1_14_4)),
     MINECRAFT_1_15(EnumSet.range(ProtocolVersion.MINECRAFT_1_15, ProtocolVersion.MINECRAFT_1_15_2)),
     MINECRAFT_1_16(ProtocolVersion.MINECRAFT_1_16, ProtocolVersion.MINECRAFT_1_16_1),
-    MINECRAFT_1_16_2(ProtocolVersion.MINECRAFT_1_16_2, ProtocolVersion.MINECRAFT_1_16_3),
-    MINECRAFT_1_16_4(ProtocolVersion.MINECRAFT_1_16_4),
-    MINECRAFT_1_17(ProtocolVersion.MINECRAFT_1_17);
+    MINECRAFT_1_16_2(EnumSet.range(ProtocolVersion.MINECRAFT_1_16_2, ProtocolVersion.MINECRAFT_1_16_4)),
+    MINECRAFT_1_17(EnumSet.range(ProtocolVersion.MINECRAFT_1_17, ProtocolVersion.MINECRAFT_1_17_1));
 
-    private static EnumMap<ProtocolVersion, Version> mcVersionToBlockVersions = new EnumMap<>(
+    private static final EnumMap<ProtocolVersion, Version> mcVersionToBlockVersions = new EnumMap<>(
         ProtocolVersion.class);
 
+    public static Version parse(String from) {
+      switch (from) {
+        case "1.12":
+          return MINECRAFT_1_12;
+        case "1.13":
+          return MINECRAFT_1_13;
+        case "1.13.2":
+          return MINECRAFT_1_13_2;
+        case "1.14":
+          return MINECRAFT_1_14;
+        case "1.15":
+          return MINECRAFT_1_15;
+        case "1.16":
+          return MINECRAFT_1_16;
+        case "1.16.2":
+          return MINECRAFT_1_16_2;
+        case "1.17":
+          return MINECRAFT_1_17;
+        default:
+          return LEGACY;
+      }
+    }
+
     static {
       for (Version version : Version.values()) {
         for (ProtocolVersion protocolVersion : version.versions) {
@@ -160,7 +188,7 @@ public class SimpleBlock {
       }
     }
 
-    private Set<ProtocolVersion> versions;
+    private final Set<ProtocolVersion> versions;
 
     Version(ProtocolVersion... versions) {
       this.versions = EnumSet.copyOf(Arrays.asList(versions));
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/VirtualWorld.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/VirtualWorld.java
similarity index 81%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/VirtualWorld.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/VirtualWorld.java
index e92d6019..008561e8 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/VirtualWorld.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/VirtualWorld.java
@@ -17,9 +17,10 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.server.world;
+package net.elytrium.elytraproxy.virtual.server.world;
 
 import com.google.common.collect.ImmutableList;
+import com.velocitypowered.proxy.connection.registry.DimensionData;
 import com.velocitypowered.proxy.connection.registry.DimensionInfo;
 import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
 import java.util.HashMap;
@@ -29,26 +30,25 @@ import java.util.function.Function;
 import java.util.function.Supplier;
 import lombok.Getter;
 import lombok.NonNull;
-import net.elytrium.elytraproxy.botfilter.protocol.data.registry.Biome;
-import net.elytrium.elytraproxy.botfilter.protocol.data.registry.Dimension;
+import net.elytrium.elytraproxy.virtual.protocol.data.registry.Biome;
+import net.elytrium.elytraproxy.virtual.server.world.chunk.SimpleChunk;
 import org.jetbrains.annotations.NotNull;
 import org.jetbrains.annotations.Nullable;
-import net.elytrium.elytraproxy.botfilter.server.world.chunk.SimpleChunk;
 
 public class VirtualWorld {
 
   @NonNull
   @Getter
-  private final Dimension dimension;
+  private final DimensionData dimension;
   @NonNull
   @Getter
   private final DimensionInfo dimensionInfo;
   private final Map<Long, SimpleChunk> chunks = new HashMap<>();
 
-  public VirtualWorld(@NonNull Dimension dimension, @NonNull DimensionInfo dimensionInfo) {
+  public VirtualWorld(@NonNull DimensionData dimension, @NonNull DimensionInfo dimensionInfo, int x, int z) {
     this.dimension = dimension;
     this.dimensionInfo = dimensionInfo;
-    getChunkOrNew(0, 0);
+    getChunkOrNew(x, z);
   }
 
   public void setBlock(int x, int y, int z, @Nullable SimpleBlock block) {
@@ -71,7 +71,7 @@ public class VirtualWorld {
   }
 
   public Biome getBiome(int x, int y, int z) {
-    return chunkAction(x, z, (c) -> c.getBiome(x, y, z), () -> Biome.PLAINTS);
+    return chunkAction(x, z, (c) -> c.getBiome(x, y, z), () -> Biome.PLAINS);
   }
 
   public byte getBlockLight(int x, int y, int z) {
@@ -83,15 +83,6 @@ public class VirtualWorld {
     getChunkOrNew(x, z).setBlockLight(getChunkCoordinate(x), y, getChunkCoordinate(z), light);
   }
 
-  public byte getSkyLight(int x, int y, int z) {
-    return chunkAction(x, z,
-        (c) -> c.getSkyLight(getChunkCoordinate(x), y, getChunkCoordinate(z)), () -> (byte) 0);
-  }
-
-  public void setSkyLight(int x, int y, int z, byte light) {
-    getChunkOrNew(x, z).setSkyLight(getChunkCoordinate(x), y, getChunkCoordinate(z), light);
-  }
-
   public List<SimpleChunk> getChunks() {
     return ImmutableList.copyOf(chunks.values());
   }
@@ -115,7 +106,7 @@ public class VirtualWorld {
     long index = getChunkIndex(x, z);
     SimpleChunk simpleChunk = chunks.get(index);
     if (simpleChunk == null) {
-      chunks.put(index, simpleChunk = new SimpleChunk(this, x, z));
+      chunks.put(index, simpleChunk = new SimpleChunk(x, z));
     }
     return simpleChunk;
   }
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/ChunkSnapshot.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/ChunkSnapshot.java
similarity index 86%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/ChunkSnapshot.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/ChunkSnapshot.java
index 385bf6e9..9c2c3ca4 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/ChunkSnapshot.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/ChunkSnapshot.java
@@ -17,12 +17,12 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.server.world.chunk;
+package net.elytrium.elytraproxy.virtual.server.world.chunk;
 
 import lombok.Getter;
 import lombok.RequiredArgsConstructor;
-import net.elytrium.elytraproxy.botfilter.protocol.data.registry.Biome;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock;
+import net.elytrium.elytraproxy.virtual.protocol.data.registry.Biome;
+import net.elytrium.elytraproxy.virtual.server.world.SimpleBlock;
 
 @RequiredArgsConstructor
 @Getter
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/LightSection.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/LightSection.java
similarity index 95%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/LightSection.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/LightSection.java
index a39a8098..7c899885 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/LightSection.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/LightSection.java
@@ -17,14 +17,14 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.server.world.chunk;
+package net.elytrium.elytraproxy.virtual.server.world.chunk;
 
 import com.google.common.base.Preconditions;
 import lombok.AccessLevel;
 import lombok.AllArgsConstructor;
 import lombok.Getter;
 import lombok.NoArgsConstructor;
-import net.elytrium.elytraproxy.botfilter.protocol.util.mcprotocollib.NibbleArray3d;
+import net.elytrium.elytraproxy.virtual.protocol.util.mcprotocollib.NibbleArray3d;
 
 @AllArgsConstructor(access = AccessLevel.PRIVATE)
 @NoArgsConstructor
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/SimpleChunk.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/SimpleChunk.java
similarity index 91%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/SimpleChunk.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/SimpleChunk.java
index db6ca3a7..db6a8cca 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/SimpleChunk.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/SimpleChunk.java
@@ -17,7 +17,7 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.server.world.chunk;
+package net.elytrium.elytraproxy.virtual.server.world.chunk;
 
 import edu.umd.cs.findbugs.annotations.SuppressFBWarnings;
 import java.util.Arrays;
@@ -25,9 +25,8 @@ import java.util.function.Function;
 import java.util.function.Supplier;
 import lombok.Getter;
 import lombok.NonNull;
-import net.elytrium.elytraproxy.botfilter.protocol.data.registry.Biome;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock;
-import net.elytrium.elytraproxy.botfilter.server.world.VirtualWorld;
+import net.elytrium.elytraproxy.virtual.protocol.data.registry.Biome;
+import net.elytrium.elytraproxy.virtual.server.world.SimpleBlock;
 import org.jetbrains.annotations.NotNull;
 import org.jetbrains.annotations.Nullable;
 
@@ -36,8 +35,6 @@ public class SimpleChunk {
 
   public static final int MAX_BLOCKS_PER_SECTION = 16 * 16 * 16;
 
-  @Getter
-  private final VirtualWorld world;
   @Getter
   private final int x;
   @Getter
@@ -46,11 +43,10 @@ public class SimpleChunk {
   private final LightSection[] light = new LightSection[18];
   private final Biome[] biomes = new Biome[1024];
 
-  public SimpleChunk(VirtualWorld world, int x, int z) {
-    this.world = world;
+  public SimpleChunk(int x, int z) {
     this.x = x;
     this.z = z;
-    Arrays.fill(biomes, Biome.PLAINTS);
+    Arrays.fill(biomes, Biome.PLAINS);
     //Arrays.fill(light, LightSection.DEFAULT);
   }
 
diff --git a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/SimpleSection.java b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/SimpleSection.java
similarity index 83%
rename from proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/SimpleSection.java
rename to proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/SimpleSection.java
index 1a062bd0..c4fbdf79 100644
--- a/proxy/src/main/java/net/elytrium/elytraproxy/botfilter/server/world/chunk/SimpleSection.java
+++ b/proxy/src/main/java/net/elytrium/elytraproxy/virtual/server/world/chunk/SimpleSection.java
@@ -17,15 +17,16 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  */
 
-package net.elytrium.elytraproxy.botfilter.server.world.chunk;
+package net.elytrium.elytraproxy.virtual.server.world.chunk;
 
 import com.google.common.base.Preconditions;
+import com.velocitypowered.api.network.ProtocolVersion;
 import lombok.AllArgsConstructor;
 import lombok.Getter;
 import lombok.RequiredArgsConstructor;
-import net.elytrium.elytraproxy.botfilter.protocol.data.storage.BlockStorage;
-import net.elytrium.elytraproxy.botfilter.protocol.data.storage.BlockStorage19;
-import net.elytrium.elytraproxy.botfilter.server.world.SimpleBlock;
+import net.elytrium.elytraproxy.virtual.protocol.data.storage.BlockStorage;
+import net.elytrium.elytraproxy.virtual.protocol.data.storage.BlockStorage19;
+import net.elytrium.elytraproxy.virtual.server.world.SimpleBlock;
 import org.jetbrains.annotations.Nullable;
 
 @RequiredArgsConstructor
@@ -37,7 +38,7 @@ public class SimpleSection {
   private long lastUpdate = System.nanoTime();
 
   public SimpleSection() {
-    this(new BlockStorage19(SimpleBlock.Version.MINECRAFT_1_17));
+    this(new BlockStorage19(ProtocolVersion.MINECRAFT_1_17));
   }
 
   public SimpleBlock getBlockAt(int x, int y, int z) {
diff --git a/proxy/src/main/resources/net/elytrium/elytraproxy/virtual/ids.json b/proxy/src/main/resources/net/elytrium/elytraproxy/virtual/ids.json
new file mode 100644
index 00000000..6258d9c0
--- /dev/null
+++ b/proxy/src/main/resources/net/elytrium/elytraproxy/virtual/ids.json
@@ -0,0 +1,2774 @@
+{
+  "0": {
+    "legacy": "0",
+    "1.12": "0",
+    "1.13": "0",
+    "1.13.2": "0",
+    "1.14": "0",
+    "1.15": "0",
+    "1.16": "0",
+    "1.16.2": "0",
+    "1.17": "0"
+  },
+  "1": {
+    "legacy": "1",
+    "1.12": "16",
+    "1.13": "1",
+    "1.13.2": "1",
+    "1.14": "1",
+    "1.15": "1",
+    "1.16": "1",
+    "1.16.2": "1",
+    "1.17": "1"
+  },
+  "2": {
+    "legacy": "2",
+    "1.12": "497",
+    "1.13": "1041",
+    "1.13.2": "1041",
+    "1.14": "1341",
+    "1.15": "1341",
+    "1.16": "1342",
+    "1.16.2": "1342",
+    "1.17": "1398"
+  },
+  "3": {
+    "legacy": "3",
+    "1.12": "48",
+    "1.13": "10",
+    "1.13.2": "10",
+    "1.14": "10",
+    "1.15": "10",
+    "1.16": "10",
+    "1.16.2": "10",
+    "1.17": "10"
+  },
+  "4": {
+    "legacy": "4",
+    "1.12": "64",
+    "1.13": "14",
+    "1.13.2": "14",
+    "1.14": "14",
+    "1.15": "14",
+    "1.16": "14",
+    "1.16.2": "14",
+    "1.17": "14"
+  },
+  "5": {
+    "legacy": "5",
+    "1.12": "80",
+    "1.13": "15",
+    "1.13.2": "15",
+    "1.14": "15",
+    "1.15": "15",
+    "1.16": "15",
+    "1.16.2": "15",
+    "1.17": "15"
+  },
+  "6": {
+    "legacy": "6",
+    "1.12": "96",
+    "1.13": "21",
+    "1.13.2": "21",
+    "1.14": "21",
+    "1.15": "21",
+    "1.16": "21",
+    "1.16.2": "21",
+    "1.17": "21"
+  },
+  "7": {
+    "legacy": "7",
+    "1.12": "112",
+    "1.13": "33",
+    "1.13.2": "33",
+    "1.14": "33",
+    "1.15": "33",
+    "1.16": "33",
+    "1.16.2": "33",
+    "1.17": "33"
+  },
+  "8": {
+    "legacy": "8",
+    "1.12": "158",
+    "1.13": "48",
+    "1.13.2": "48",
+    "1.14": "48",
+    "1.15": "48",
+    "1.16": "48",
+    "1.16.2": "48",
+    "1.17": "48"
+  },
+  "9": {
+    "legacy": "9",
+    "1.12": "159",
+    "1.13": "49",
+    "1.13.2": "49",
+    "1.14": "49",
+    "1.15": "49",
+    "1.16": "49",
+    "1.16.2": "49",
+    "1.17": "49"
+  },
+  "10": {
+    "legacy": "10",
+    "1.12": "191",
+    "1.13": "65",
+    "1.13.2": "65",
+    "1.14": "65",
+    "1.15": "65",
+    "1.16": "65",
+    "1.16.2": "65",
+    "1.17": "65"
+  },
+  "11": {
+    "legacy": "11",
+    "1.12": "190",
+    "1.13": "64",
+    "1.13.2": "64",
+    "1.14": "64",
+    "1.15": "64",
+    "1.16": "64",
+    "1.16.2": "64",
+    "1.17": "64"
+  },
+  "12": {
+    "legacy": "12",
+    "1.12": "192",
+    "1.13": "66",
+    "1.13.2": "66",
+    "1.14": "66",
+    "1.15": "66",
+    "1.16": "66",
+    "1.16.2": "66",
+    "1.17": "66"
+  },
+  "13": {
+    "legacy": "13",
+    "1.12": "208",
+    "1.13": "68",
+    "1.13.2": "68",
+    "1.14": "68",
+    "1.15": "68",
+    "1.16": "68",
+    "1.16.2": "68",
+    "1.17": "68"
+  },
+  "14": {
+    "legacy": "14",
+    "1.12": "224",
+    "1.13": "69",
+    "1.13.2": "69",
+    "1.14": "69",
+    "1.15": "69",
+    "1.16": "69",
+    "1.16.2": "69",
+    "1.17": "69"
+  },
+  "15": {
+    "legacy": "15",
+    "1.12": "240",
+    "1.13": "70",
+    "1.13.2": "70",
+    "1.14": "70",
+    "1.15": "70",
+    "1.16": "70",
+    "1.16.2": "70",
+    "1.17": "71"
+  },
+  "16": {
+    "legacy": "16",
+    "1.12": "256",
+    "1.13": "71",
+    "1.13.2": "71",
+    "1.14": "71",
+    "1.15": "71",
+    "1.16": "71",
+    "1.16.2": "71",
+    "1.17": "73"
+  },
+  "17": {
+    "legacy": "17",
+    "1.12": "272",
+    "1.13": "73",
+    "1.13.2": "73",
+    "1.14": "73",
+    "1.15": "73",
+    "1.16": "74",
+    "1.16.2": "74",
+    "1.17": "77"
+  },
+  "18": {
+    "legacy": "18",
+    "1.12": "292",
+    "1.13": "144",
+    "1.13.2": "144",
+    "1.14": "144",
+    "1.15": "144",
+    "1.16": "145",
+    "1.16.2": "145",
+    "1.17": "148"
+  },
+  "19": {
+    "legacy": "19",
+    "1.12": "304",
+    "1.13": "228",
+    "1.13.2": "228",
+    "1.14": "228",
+    "1.15": "228",
+    "1.16": "229",
+    "1.16.2": "229",
+    "1.17": "260"
+  },
+  "20": {
+    "legacy": "20",
+    "1.12": "320",
+    "1.13": "230",
+    "1.13.2": "230",
+    "1.14": "230",
+    "1.15": "230",
+    "1.16": "231",
+    "1.16.2": "231",
+    "1.17": "262"
+  },
+  "21": {
+    "legacy": "21",
+    "1.12": "336",
+    "1.13": "231",
+    "1.13.2": "231",
+    "1.14": "231",
+    "1.15": "231",
+    "1.16": "232",
+    "1.16.2": "232",
+    "1.17": "263"
+  },
+  "22": {
+    "legacy": "22",
+    "1.12": "352",
+    "1.13": "232",
+    "1.13.2": "232",
+    "1.14": "232",
+    "1.15": "232",
+    "1.16": "233",
+    "1.16.2": "233",
+    "1.17": "265"
+  },
+  "23": {
+    "legacy": "23",
+    "1.12": "370",
+    "1.13": "234",
+    "1.13.2": "234",
+    "1.14": "234",
+    "1.15": "234",
+    "1.16": "235",
+    "1.16.2": "235",
+    "1.17": "267"
+  },
+  "24": {
+    "legacy": "24",
+    "1.12": "384",
+    "1.13": "245",
+    "1.13.2": "245",
+    "1.14": "245",
+    "1.15": "245",
+    "1.16": "246",
+    "1.16.2": "246",
+    "1.17": "278"
+  },
+  "25": {
+    "legacy": "25",
+    "1.12": "400",
+    "1.13": "249",
+    "1.13.2": "249",
+    "1.14": "249",
+    "1.15": "249",
+    "1.16": "250",
+    "1.16.2": "250",
+    "1.17": "282"
+  },
+  "26": {
+    "legacy": "26",
+    "1.12": "416",
+    "1.13": "749",
+    "1.13.2": "749",
+    "1.14": "1049",
+    "1.15": "1049",
+    "1.16": "1050",
+    "1.16.2": "1050",
+    "1.17": "1082"
+  },
+  "27": {
+    "legacy": "27",
+    "1.12": "436",
+    "1.13": "1014",
+    "1.13.2": "1014",
+    "1.14": "1314",
+    "1.15": "1314",
+    "1.16": "1315",
+    "1.16.2": "1315",
+    "1.17": "1346"
+  },
+  "28": {
+    "legacy": "28",
+    "1.12": "452",
+    "1.13": "1026",
+    "1.13.2": "1026",
+    "1.14": "1326",
+    "1.15": "1326",
+    "1.16": "1327",
+    "1.16.2": "1327",
+    "1.17": "1384"
+  },
+  "29": {
+    "legacy": "29",
+    "1.12": "465",
+    "1.13": "1038",
+    "1.13.2": "1038",
+    "1.14": "1338",
+    "1.15": "1338",
+    "1.16": "1339",
+    "1.16.2": "1339",
+    "1.17": "1395"
+  },
+  "30": {
+    "legacy": "30",
+    "1.12": "480",
+    "1.13": "1040",
+    "1.13.2": "1040",
+    "1.14": "1340",
+    "1.15": "1340",
+    "1.16": "1341",
+    "1.16.2": "1341",
+    "1.17": "1397"
+  },
+  "31": {
+    "legacy": "31",
+    "1.12": "2802",
+    "1.13": "6851",
+    "1.13.2": "6852",
+    "1.14": "7358",
+    "1.15": "7358",
+    "1.16": "7894",
+    "1.16.2": "7898",
+    "1.17": "8144"
+  },
+  "32": {
+    "legacy": "32",
+    "1.12": "512",
+    "1.13": "1043",
+    "1.13.2": "1043",
+    "1.14": "1343",
+    "1.15": "1343",
+    "1.16": "1344",
+    "1.16.2": "1344",
+    "1.17": "1400"
+  },
+  "33": {
+    "legacy": "33",
+    "1.12": "529",
+    "1.13": "1057",
+    "1.13.2": "1057",
+    "1.14": "1357",
+    "1.15": "1357",
+    "1.16": "1358",
+    "1.16.2": "1358",
+    "1.17": "1414"
+  },
+  "34": {
+    "legacy": "34",
+    "1.12": "546",
+    "1.13": "1059",
+    "1.13.2": "1059",
+    "1.14": "1359",
+    "1.15": "1359",
+    "1.16": "1360",
+    "1.16.2": "1360",
+    "1.17": "1416"
+  },
+  "35": {
+    "legacy": "35",
+    "1.12": "560",
+    "1.13": "1083",
+    "1.13.2": "1083",
+    "1.14": "1383",
+    "1.15": "1383",
+    "1.16": "1384",
+    "1.16.2": "1384",
+    "1.17": "1440"
+  },
+  "37": {
+    "legacy": "37",
+    "1.12": "592",
+    "1.13": "1111",
+    "1.13.2": "1111",
+    "1.14": "1411",
+    "1.15": "1411",
+    "1.16": "1412",
+    "1.16.2": "1412",
+    "1.17": "1468"
+  },
+  "38": {
+    "legacy": "38",
+    "1.12": "608",
+    "1.13": "1112",
+    "1.13.2": "1112",
+    "1.14": "1412",
+    "1.15": "1412",
+    "1.16": "1413",
+    "1.16.2": "1413",
+    "1.17": "1469"
+  },
+  "39": {
+    "legacy": "39",
+    "1.12": "624",
+    "1.13": "1121",
+    "1.13.2": "1121",
+    "1.14": "1424",
+    "1.15": "1424",
+    "1.16": "1425",
+    "1.16.2": "1425",
+    "1.17": "1481"
+  },
+  "40": {
+    "legacy": "40",
+    "1.12": "640",
+    "1.13": "1122",
+    "1.13.2": "1122",
+    "1.14": "1425",
+    "1.15": "1425",
+    "1.16": "1426",
+    "1.16.2": "1426",
+    "1.17": "1482"
+  },
+  "41": {
+    "legacy": "41",
+    "1.12": "656",
+    "1.13": "1123",
+    "1.13.2": "1123",
+    "1.14": "1426",
+    "1.15": "1426",
+    "1.16": "1427",
+    "1.16.2": "1427",
+    "1.17": "1483"
+  },
+  "42": {
+    "legacy": "42",
+    "1.12": "672",
+    "1.13": "1124",
+    "1.13.2": "1124",
+    "1.14": "1427",
+    "1.15": "1427",
+    "1.16": "1428",
+    "1.16.2": "1428",
+    "1.17": "1484"
+  },
+  "43": {
+    "legacy": "43",
+    "1.12": "688",
+    "1.13": "7298",
+    "1.13.2": "7317",
+    "1.14": "7805",
+    "1.15": "7805",
+    "1.16": "8341",
+    "1.16.2": "8345",
+    "1.17": "8591"
+  },
+  "44": {
+    "legacy": "44",
+    "1.12": "704",
+    "1.13": "7296",
+    "1.13.2": "7315",
+    "1.14": "7803",
+    "1.15": "7803",
+    "1.16": "8339",
+    "1.16.2": "8343",
+    "1.17": "8589"
+  },
+  "45": {
+    "legacy": "45",
+    "1.12": "720",
+    "1.13": "1125",
+    "1.13.2": "1125",
+    "1.14": "1428",
+    "1.15": "1428",
+    "1.16": "1429",
+    "1.16.2": "1429",
+    "1.17": "1485"
+  },
+  "46": {
+    "legacy": "46",
+    "1.12": "736",
+    "1.13": "1126",
+    "1.13.2": "1127",
+    "1.14": "1430",
+    "1.15": "1430",
+    "1.16": "1431",
+    "1.16.2": "1431",
+    "1.17": "1487"
+  },
+  "47": {
+    "legacy": "47",
+    "1.12": "752",
+    "1.13": "1127",
+    "1.13.2": "1128",
+    "1.14": "1431",
+    "1.15": "1431",
+    "1.16": "1432",
+    "1.16.2": "1432",
+    "1.17": "1488"
+  },
+  "48": {
+    "legacy": "48",
+    "1.12": "768",
+    "1.13": "1128",
+    "1.13.2": "1129",
+    "1.14": "1432",
+    "1.15": "1432",
+    "1.16": "1433",
+    "1.16.2": "1433",
+    "1.17": "1489"
+  },
+  "49": {
+    "legacy": "49",
+    "1.12": "784",
+    "1.13": "1129",
+    "1.13.2": "1130",
+    "1.14": "1433",
+    "1.15": "1433",
+    "1.16": "1434",
+    "1.16.2": "1434",
+    "1.17": "1490"
+  },
+  "50": {
+    "legacy": "50",
+    "1.12": "805",
+    "1.13": "1130",
+    "1.13.2": "1131",
+    "1.14": "1434",
+    "1.15": "1434",
+    "1.16": "1435",
+    "1.16.2": "1435",
+    "1.17": "1491"
+  },
+  "51": {
+    "legacy": "51",
+    "1.12": "816",
+    "1.13": "1135",
+    "1.13.2": "1136",
+    "1.14": "1439",
+    "1.15": "1439",
+    "1.16": "1440",
+    "1.16.2": "1440",
+    "1.17": "1496"
+  },
+  "52": {
+    "legacy": "52",
+    "1.12": "832",
+    "1.13": "1647",
+    "1.13.2": "1648",
+    "1.14": "1951",
+    "1.15": "1951",
+    "1.16": "1953",
+    "1.16.2": "1953",
+    "1.17": "2009"
+  },
+  "53": {
+    "legacy": "53",
+    "1.12": "855",
+    "1.13": "1649",
+    "1.13.2": "1650",
+    "1.14": "1953",
+    "1.15": "1953",
+    "1.16": "1955",
+    "1.16.2": "1955",
+    "1.17": "2011"
+  },
+  "54": {
+    "legacy": "54",
+    "1.12": "866",
+    "1.13": "1729",
+    "1.13.2": "1730",
+    "1.14": "2033",
+    "1.15": "2033",
+    "1.16": "2035",
+    "1.16.2": "2035",
+    "1.17": "2091"
+  },
+  "55": {
+    "legacy": "55",
+    "1.12": "880",
+    "1.13": "1752",
+    "1.13.2": "1753",
+    "1.14": "2056",
+    "1.15": "2056",
+    "1.16": "2058",
+    "1.16.2": "2058",
+    "1.17": "2114"
+  },
+  "56": {
+    "legacy": "56",
+    "1.12": "896",
+    "1.13": "3048",
+    "1.13.2": "3049",
+    "1.14": "3352",
+    "1.15": "3352",
+    "1.16": "3354",
+    "1.16.2": "3354",
+    "1.17": "3410"
+  },
+  "57": {
+    "legacy": "57",
+    "1.12": "912",
+    "1.13": "3049",
+    "1.13.2": "3050",
+    "1.14": "3353",
+    "1.15": "3353",
+    "1.16": "3355",
+    "1.16.2": "3355",
+    "1.17": "3412"
+  },
+  "58": {
+    "legacy": "58",
+    "1.12": "928",
+    "1.13": "3050",
+    "1.13.2": "3051",
+    "1.14": "3354",
+    "1.15": "3354",
+    "1.16": "3356",
+    "1.16.2": "3356",
+    "1.17": "3413"
+  },
+  "59": {
+    "legacy": "59",
+    "1.12": "944",
+    "1.13": "3051",
+    "1.13.2": "3052",
+    "1.14": "3355",
+    "1.15": "3355",
+    "1.16": "3357",
+    "1.16.2": "3357",
+    "1.17": "3414"
+  },
+  "60": {
+    "legacy": "60",
+    "1.12": "960",
+    "1.13": "3059",
+    "1.13.2": "3060",
+    "1.14": "3363",
+    "1.15": "3363",
+    "1.16": "3365",
+    "1.16.2": "3365",
+    "1.17": "3422"
+  },
+  "61": {
+    "legacy": "61",
+    "1.12": "978",
+    "1.13": "3068",
+    "1.13.2": "3069",
+    "1.14": "3372",
+    "1.15": "3372",
+    "1.16": "3374",
+    "1.16.2": "3374",
+    "1.17": "3431"
+  },
+  "62": {
+    "legacy": "62",
+    "1.12": "994",
+    "1.13": "3067",
+    "1.13.2": "3068",
+    "1.14": "3371",
+    "1.15": "3371",
+    "1.16": "3373",
+    "1.16.2": "3373",
+    "1.17": "3430"
+  },
+  "63": {
+    "legacy": "63",
+    "1.12": "1008",
+    "1.13": "3076",
+    "1.13.2": "3077",
+    "1.14": "3380",
+    "1.15": "3380",
+    "1.16": "3382",
+    "1.16.2": "3382",
+    "1.17": "3439"
+  },
+  "64": {
+    "legacy": "64",
+    "1.12": "1024",
+    "1.13": "3107",
+    "1.13.2": "3108",
+    "1.14": "3571",
+    "1.15": "3571",
+    "1.16": "3573",
+    "1.16.2": "3573",
+    "1.17": "3630"
+  },
+  "65": {
+    "legacy": "65",
+    "1.12": "1042",
+    "1.13": "3171",
+    "1.13.2": "3172",
+    "1.14": "3635",
+    "1.15": "3635",
+    "1.16": "3637",
+    "1.16.2": "3637",
+    "1.17": "3694"
+  },
+  "66": {
+    "legacy": "66",
+    "1.12": "1056",
+    "1.13": "3179",
+    "1.13.2": "3180",
+    "1.14": "3643",
+    "1.15": "3643",
+    "1.16": "3645",
+    "1.16.2": "3645",
+    "1.17": "3702"
+  },
+  "67": {
+    "legacy": "67",
+    "1.12": "1075",
+    "1.13": "3200",
+    "1.13.2": "3201",
+    "1.14": "9614",
+    "1.15": "9614",
+    "1.16": "10150",
+    "1.16.2": "10154",
+    "1.17": "10400"
+  },
+  "68": {
+    "legacy": "68",
+    "1.12": "1090",
+    "1.13": "3270",
+    "1.13.2": "3270",
+    "1.14": "3733",
+    "1.15": "3733",
+    "1.16": "3735",
+    "1.16.2": "3735",
+    "1.17": "3802"
+  },
+  "69": {
+    "legacy": "69",
+    "1.12": "1104",
+    "1.13": "3277",
+    "1.13.2": "3278",
+    "1.14": "3781",
+    "1.15": "3781",
+    "1.16": "3783",
+    "1.16.2": "3783",
+    "1.17": "3850"
+  },
+  "70": {
+    "legacy": "70",
+    "1.12": "1120",
+    "1.13": "3301",
+    "1.13.2": "3302",
+    "1.14": "3805",
+    "1.15": "3805",
+    "1.16": "3807",
+    "1.16.2": "3807",
+    "1.17": "3874"
+  },
+  "71": {
+    "legacy": "71",
+    "1.12": "1136",
+    "1.13": "3303",
+    "1.13.2": "3304",
+    "1.14": "3807",
+    "1.15": "3807",
+    "1.16": "3809",
+    "1.16.2": "3809",
+    "1.17": "3876"
+  },
+  "72": {
+    "legacy": "72",
+    "1.12": "1152",
+    "1.13": "3367",
+    "1.13.2": "3368",
+    "1.14": "3871",
+    "1.15": "3871",
+    "1.16": "3873",
+    "1.16.2": "3873",
+    "1.17": "3940"
+  },
+  "73": {
+    "legacy": "73",
+    "1.12": "1168",
+    "1.13": "3380",
+    "1.13.2": "3381",
+    "1.14": "3884",
+    "1.15": "3884",
+    "1.16": "3886",
+    "1.16.2": "3886",
+    "1.17": "3953"
+  },
+  "74": {
+    "legacy": "74",
+    "1.12": "1184",
+    "1.13": "3379",
+    "1.13.2": "3380",
+    "1.14": "3883",
+    "1.15": "3883",
+    "1.16": "3885",
+    "1.16.2": "3885",
+    "1.17": "3952"
+  },
+  "75": {
+    "legacy": "75",
+    "1.12": "1205",
+    "1.13": "3382",
+    "1.13.2": "3383",
+    "1.14": "3886",
+    "1.15": "3886",
+    "1.16": "3888",
+    "1.16.2": "3888",
+    "1.17": "3957"
+  },
+  "76": {
+    "legacy": "76",
+    "1.12": "1221",
+    "1.13": "3381",
+    "1.13.2": "3382",
+    "1.14": "3885",
+    "1.15": "3885",
+    "1.16": "3887",
+    "1.16.2": "3887",
+    "1.17": "3956"
+  },
+  "77": {
+    "legacy": "77",
+    "1.12": "1232",
+    "1.13": "3391",
+    "1.13.2": "3392",
+    "1.14": "3895",
+    "1.15": "3895",
+    "1.16": "3897",
+    "1.16.2": "3897",
+    "1.17": "3966"
+  },
+  "78": {
+    "legacy": "78",
+    "1.12": "1280",
+    "1.13": "3424",
+    "1.13.2": "3425",
+    "1.14": "3928",
+    "1.15": "3928",
+    "1.16": "3930",
+    "1.16.2": "3930",
+    "1.17": "3999"
+  },
+  "79": {
+    "legacy": "79",
+    "1.12": "1264",
+    "1.13": "3423",
+    "1.13.2": "3424",
+    "1.14": "3927",
+    "1.15": "3927",
+    "1.16": "3929",
+    "1.16.2": "3929",
+    "1.17": "3998"
+  },
+  "80": {
+    "legacy": "80",
+    "1.12": "1248",
+    "1.13": "3415",
+    "1.13.2": "3416",
+    "1.14": "3919",
+    "1.15": "3919",
+    "1.16": "3921",
+    "1.16.2": "3921",
+    "1.17": "3990"
+  },
+  "81": {
+    "legacy": "81",
+    "1.12": "1296",
+    "1.13": "3425",
+    "1.13.2": "3426",
+    "1.14": "3929",
+    "1.15": "3929",
+    "1.16": "3931",
+    "1.16.2": "3931",
+    "1.17": "4000"
+  },
+  "82": {
+    "legacy": "82",
+    "1.12": "1312",
+    "1.13": "3441",
+    "1.13.2": "3442",
+    "1.14": "3945",
+    "1.15": "3945",
+    "1.16": "3947",
+    "1.16.2": "3947",
+    "1.17": "4016"
+  },
+  "83": {
+    "legacy": "83",
+    "1.12": "1328",
+    "1.13": "3442",
+    "1.13.2": "3443",
+    "1.14": "3946",
+    "1.15": "3946",
+    "1.16": "3948",
+    "1.16.2": "3948",
+    "1.17": "4017"
+  },
+  "84": {
+    "legacy": "84",
+    "1.12": "1344",
+    "1.13": "3458",
+    "1.13.2": "3459",
+    "1.14": "3962",
+    "1.15": "3962",
+    "1.16": "3964",
+    "1.16.2": "3964",
+    "1.17": "4033"
+  },
+  "85": {
+    "legacy": "85",
+    "1.12": "1360",
+    "1.13": "3460",
+    "1.13.2": "3461",
+    "1.14": "3964",
+    "1.15": "3964",
+    "1.16": "3966",
+    "1.16.2": "3966",
+    "1.17": "4035"
+  },
+  "86": {
+    "legacy": "86",
+    "1.12": "1378",
+    "1.13": "3498",
+    "1.13.2": "3499",
+    "1.14": "4002",
+    "1.15": "4002",
+    "1.16": "4016",
+    "1.16.2": "4016",
+    "1.17": "4085"
+  },
+  "87": {
+    "legacy": "87",
+    "1.12": "1392",
+    "1.13": "3493",
+    "1.13.2": "3494",
+    "1.14": "3997",
+    "1.15": "3997",
+    "1.16": "3999",
+    "1.16.2": "3999",
+    "1.17": "4068"
+  },
+  "88": {
+    "legacy": "88",
+    "1.12": "1408",
+    "1.13": "3494",
+    "1.13.2": "3495",
+    "1.14": "3998",
+    "1.15": "3998",
+    "1.16": "4000",
+    "1.16.2": "4000",
+    "1.17": "4069"
+  },
+  "89": {
+    "legacy": "89",
+    "1.12": "1424",
+    "1.13": "3495",
+    "1.13.2": "3496",
+    "1.14": "3999",
+    "1.15": "3999",
+    "1.16": "4013",
+    "1.16.2": "4013",
+    "1.17": "4082"
+  },
+  "90": {
+    "legacy": "90",
+    "1.12": "1441",
+    "1.13": "3496",
+    "1.13.2": "3497",
+    "1.14": "4000",
+    "1.15": "4000",
+    "1.16": "4014",
+    "1.16.2": "4014",
+    "1.17": "4083"
+  },
+  "91": {
+    "legacy": "91",
+    "1.12": "1458",
+    "1.13": "3502",
+    "1.13.2": "3503",
+    "1.14": "4006",
+    "1.15": "4006",
+    "1.16": "4020",
+    "1.16.2": "4020",
+    "1.17": "4089"
+  },
+  "92": {
+    "legacy": "92",
+    "1.12": "1472",
+    "1.13": "3506",
+    "1.13.2": "3507",
+    "1.14": "4010",
+    "1.15": "4010",
+    "1.16": "4024",
+    "1.16.2": "4024",
+    "1.17": "4093"
+  },
+  "93": {
+    "legacy": "93",
+    "1.12": "1490",
+    "1.13": "3516",
+    "1.13.2": "3517",
+    "1.14": "4020",
+    "1.15": "4020",
+    "1.16": "4034",
+    "1.16.2": "4034",
+    "1.17": "4103"
+  },
+  "94": {
+    "legacy": "94",
+    "1.12": "1506",
+    "1.13": "3515",
+    "1.13.2": "3516",
+    "1.14": "4019",
+    "1.15": "4019",
+    "1.16": "4033",
+    "1.16.2": "4033",
+    "1.17": "4102"
+  },
+  "95": {
+    "legacy": "95",
+    "1.12": "1520",
+    "1.13": "3577",
+    "1.13.2": "3578",
+    "1.14": "4081",
+    "1.15": "4081",
+    "1.16": "4095",
+    "1.16.2": "4095",
+    "1.17": "4164"
+  },
+  "96": {
+    "legacy": "96",
+    "1.12": "1536",
+    "1.13": "3593",
+    "1.13.2": "3594",
+    "1.14": "4097",
+    "1.15": "4097",
+    "1.16": "4111",
+    "1.16.2": "4111",
+    "1.17": "4180"
+  },
+  "98": {
+    "legacy": "98",
+    "1.12": "1568",
+    "1.13": "3983",
+    "1.13.2": "3984",
+    "1.14": "4481",
+    "1.15": "4481",
+    "1.16": "4495",
+    "1.16.2": "4495",
+    "1.17": "4564"
+  },
+  "99": {
+    "legacy": "99",
+    "1.12": "1597",
+    "1.13": "3987",
+    "1.13.2": "3988",
+    "1.14": "4491",
+    "1.15": "4491",
+    "1.16": "4505",
+    "1.16.2": "4505",
+    "1.17": "4574"
+  },
+  "100": {
+    "legacy": "100",
+    "1.12": "1613",
+    "1.13": "4051",
+    "1.13.2": "4052",
+    "1.14": "4555",
+    "1.15": "4555",
+    "1.16": "4569",
+    "1.16.2": "4569",
+    "1.17": "4638"
+  },
+  "101": {
+    "legacy": "101",
+    "1.12": "1616",
+    "1.13": "4179",
+    "1.13.2": "4180",
+    "1.14": "4683",
+    "1.15": "4683",
+    "1.16": "4697",
+    "1.16.2": "4697",
+    "1.17": "4766"
+  },
+  "102": {
+    "legacy": "102",
+    "1.12": "1632",
+    "1.13": "4211",
+    "1.13.2": "4212",
+    "1.14": "4715",
+    "1.15": "4715",
+    "1.16": "4731",
+    "1.16.2": "4735",
+    "1.17": "4804"
+  },
+  "103": {
+    "legacy": "103",
+    "1.12": "1648",
+    "1.13": "4243",
+    "1.13.2": "4244",
+    "1.14": "4747",
+    "1.15": "4747",
+    "1.16": "4763",
+    "1.16.2": "4767",
+    "1.17": "4836"
+  },
+  "104": {
+    "legacy": "104",
+    "1.12": "1664",
+    "1.13": "4252",
+    "1.13.2": "4253",
+    "1.14": "4756",
+    "1.15": "4756",
+    "1.16": "4772",
+    "1.16.2": "4776",
+    "1.17": "4845"
+  },
+  "105": {
+    "legacy": "105",
+    "1.12": "1680",
+    "1.13": "4260",
+    "1.13.2": "4261",
+    "1.14": "4764",
+    "1.15": "4764",
+    "1.16": "4780",
+    "1.16.2": "4784",
+    "1.17": "4853"
+  },
+  "106": {
+    "legacy": "106",
+    "1.12": "1696",
+    "1.13": "4268",
+    "1.13.2": "4269",
+    "1.14": "4772",
+    "1.15": "4772",
+    "1.16": "4788",
+    "1.16.2": "4792",
+    "1.17": "4861"
+  },
+  "107": {
+    "legacy": "107",
+    "1.12": "1712",
+    "1.13": "4300",
+    "1.13.2": "4301",
+    "1.14": "4804",
+    "1.15": "4804",
+    "1.16": "4820",
+    "1.16.2": "4824",
+    "1.17": "5021"
+  },
+  "108": {
+    "legacy": "108",
+    "1.12": "1728",
+    "1.13": "4332",
+    "1.13.2": "4333",
+    "1.14": "4836",
+    "1.15": "4836",
+    "1.16": "4852",
+    "1.16.2": "4856",
+    "1.17": "5053"
+  },
+  "109": {
+    "legacy": "109",
+    "1.12": "1744",
+    "1.13": "4412",
+    "1.13.2": "4413",
+    "1.14": "4916",
+    "1.15": "4916",
+    "1.16": "4932",
+    "1.16.2": "4936",
+    "1.17": "5133"
+  },
+  "110": {
+    "legacy": "110",
+    "1.12": "1760",
+    "1.13": "4492",
+    "1.13.2": "4493",
+    "1.14": "4996",
+    "1.15": "4996",
+    "1.16": "5012",
+    "1.16.2": "5016",
+    "1.17": "5213"
+  },
+  "111": {
+    "legacy": "111",
+    "1.12": "1776",
+    "1.13": "4494",
+    "1.13.2": "4495",
+    "1.14": "4998",
+    "1.15": "4998",
+    "1.16": "5014",
+    "1.16.2": "5018",
+    "1.17": "5215"
+  },
+  "112": {
+    "legacy": "112",
+    "1.12": "1792",
+    "1.13": "4495",
+    "1.13.2": "4496",
+    "1.14": "4999",
+    "1.15": "4999",
+    "1.16": "5015",
+    "1.16.2": "5019",
+    "1.17": "5216"
+  },
+  "113": {
+    "legacy": "113",
+    "1.12": "1808",
+    "1.13": "4496",
+    "1.13.2": "4497",
+    "1.14": "5000",
+    "1.15": "5000",
+    "1.16": "5016",
+    "1.16.2": "5020",
+    "1.17": "5217"
+  },
+  "114": {
+    "legacy": "114",
+    "1.12": "1824",
+    "1.13": "4528",
+    "1.13.2": "4529",
+    "1.14": "5032",
+    "1.15": "5032",
+    "1.16": "5048",
+    "1.16.2": "5052",
+    "1.17": "5249"
+  },
+  "115": {
+    "legacy": "115",
+    "1.12": "1840",
+    "1.13": "4608",
+    "1.13.2": "4609",
+    "1.14": "5112",
+    "1.15": "5112",
+    "1.16": "5128",
+    "1.16.2": "5132",
+    "1.17": "5329"
+  },
+  "116": {
+    "legacy": "116",
+    "1.12": "1856",
+    "1.13": "4612",
+    "1.13.2": "4613",
+    "1.14": "5116",
+    "1.15": "5116",
+    "1.16": "5132",
+    "1.16.2": "5136",
+    "1.17": "5333"
+  },
+  "117": {
+    "legacy": "117",
+    "1.12": "1872",
+    "1.13": "4613",
+    "1.13.2": "4614",
+    "1.14": "5117",
+    "1.15": "5117",
+    "1.16": "5133",
+    "1.16.2": "5137",
+    "1.17": "5334"
+  },
+  "118": {
+    "legacy": "118",
+    "1.12": "1888",
+    "1.13": "4621",
+    "1.13.2": "4622",
+    "1.14": "5125",
+    "1.15": "5125",
+    "1.16": "5141",
+    "1.16.2": "5145",
+    "1.17": "5342"
+  },
+  "119": {
+    "legacy": "119",
+    "1.12": "1904",
+    "1.13": "4625",
+    "1.13.2": "4626",
+    "1.14": "5129",
+    "1.15": "5129",
+    "1.16": "5145",
+    "1.16.2": "5149",
+    "1.17": "5350"
+  },
+  "120": {
+    "legacy": "120",
+    "1.12": "1920",
+    "1.13": "4626",
+    "1.13.2": "4627",
+    "1.14": "5130",
+    "1.15": "5130",
+    "1.16": "5146",
+    "1.16.2": "5150",
+    "1.17": "5351"
+  },
+  "121": {
+    "legacy": "121",
+    "1.12": "1936",
+    "1.13": "4634",
+    "1.13.2": "4635",
+    "1.14": "5138",
+    "1.15": "5138",
+    "1.16": "5154",
+    "1.16.2": "5158",
+    "1.17": "5359"
+  },
+  "122": {
+    "legacy": "122",
+    "1.12": "1952",
+    "1.13": "4635",
+    "1.13.2": "4636",
+    "1.14": "5139",
+    "1.15": "5139",
+    "1.16": "5155",
+    "1.16.2": "5159",
+    "1.17": "5360"
+  },
+  "123": {
+    "legacy": "123",
+    "1.12": "1968",
+    "1.13": "4637",
+    "1.13.2": "4638",
+    "1.14": "5141",
+    "1.15": "5141",
+    "1.16": "5157",
+    "1.16.2": "5161",
+    "1.17": "5362"
+  },
+  "124": {
+    "legacy": "124",
+    "1.12": "1984",
+    "1.13": "4636",
+    "1.13.2": "4637",
+    "1.14": "5140",
+    "1.15": "5140",
+    "1.16": "5156",
+    "1.16.2": "5160",
+    "1.17": "5361"
+  },
+  "125": {
+    "legacy": "125",
+    "1.12": "2016",
+    "1.13": "7260",
+    "1.13.2": "7261",
+    "1.14": "7767",
+    "1.15": "7767",
+    "1.16": "8303",
+    "1.16.2": "8307",
+    "1.17": "8553"
+  },
+  "126": {
+    "legacy": "126",
+    "1.12": "2000",
+    "1.13": "7262",
+    "1.13.2": "7263",
+    "1.14": "7769",
+    "1.15": "7769",
+    "1.16": "8305",
+    "1.16.2": "8309",
+    "1.17": "8555"
+  },
+  "127": {
+    "legacy": "127",
+    "1.12": "2032",
+    "1.13": "4638",
+    "1.13.2": "4639",
+    "1.14": "5142",
+    "1.15": "5142",
+    "1.16": "5158",
+    "1.16.2": "5162",
+    "1.17": "5363"
+  },
+  "128": {
+    "legacy": "128",
+    "1.12": "2048",
+    "1.13": "4650",
+    "1.13.2": "4651",
+    "1.14": "5154",
+    "1.15": "5154",
+    "1.16": "5170",
+    "1.16.2": "5174",
+    "1.17": "5375"
+  },
+  "129": {
+    "legacy": "129",
+    "1.12": "2064",
+    "1.13": "4730",
+    "1.13.2": "4731",
+    "1.14": "5234",
+    "1.15": "5234",
+    "1.16": "5250",
+    "1.16.2": "5254",
+    "1.17": "5455"
+  },
+  "130": {
+    "legacy": "130",
+    "1.12": "2082",
+    "1.13": "4731",
+    "1.13.2": "4732",
+    "1.14": "5235",
+    "1.15": "5235",
+    "1.16": "5251",
+    "1.16.2": "5255",
+    "1.17": "5457"
+  },
+  "131": {
+    "legacy": "131",
+    "1.12": "2096",
+    "1.13": "4739",
+    "1.13.2": "4740",
+    "1.14": "5243",
+    "1.15": "5243",
+    "1.16": "5259",
+    "1.16.2": "5263",
+    "1.17": "5465"
+  },
+  "132": {
+    "legacy": "132",
+    "1.12": "2114",
+    "1.13": "4755",
+    "1.13.2": "4756",
+    "1.14": "5259",
+    "1.15": "5259",
+    "1.16": "5275",
+    "1.16.2": "5279",
+    "1.17": "5481"
+  },
+  "133": {
+    "legacy": "133",
+    "1.12": "2128",
+    "1.13": "4883",
+    "1.13.2": "4884",
+    "1.14": "5387",
+    "1.15": "5387",
+    "1.16": "5403",
+    "1.16.2": "5407",
+    "1.17": "5609"
+  },
+  "134": {
+    "legacy": "134",
+    "1.12": "2144",
+    "1.13": "4884",
+    "1.13.2": "4885",
+    "1.14": "5388",
+    "1.15": "5388",
+    "1.16": "5404",
+    "1.16.2": "5408",
+    "1.17": "5610"
+  },
+  "135": {
+    "legacy": "135",
+    "1.12": "2160",
+    "1.13": "4964",
+    "1.13.2": "4965",
+    "1.14": "5468",
+    "1.15": "5468",
+    "1.16": "5484",
+    "1.16.2": "5488",
+    "1.17": "5690"
+  },
+  "136": {
+    "legacy": "136",
+    "1.12": "2176",
+    "1.13": "5044",
+    "1.13.2": "5045",
+    "1.14": "5548",
+    "1.15": "5548",
+    "1.16": "5564",
+    "1.16.2": "5568",
+    "1.17": "5770"
+  },
+  "137": {
+    "legacy": "137",
+    "1.12": "2192",
+    "1.13": "5124",
+    "1.13.2": "5125",
+    "1.14": "5628",
+    "1.15": "5628",
+    "1.16": "5644",
+    "1.16.2": "5648",
+    "1.17": "5850"
+  },
+  "138": {
+    "legacy": "138",
+    "1.12": "2208",
+    "1.13": "5136",
+    "1.13.2": "5137",
+    "1.14": "5640",
+    "1.15": "5640",
+    "1.16": "5656",
+    "1.16.2": "5660",
+    "1.17": "5862"
+  },
+  "139": {
+    "legacy": "139",
+    "1.12": "2224",
+    "1.13": "5137",
+    "1.13.2": "5138",
+    "1.14": "5641",
+    "1.15": "5641",
+    "1.16": "5657",
+    "1.16.2": "5661",
+    "1.17": "5863"
+  },
+  "140": {
+    "legacy": "140",
+    "1.12": "2255",
+    "1.13": "5265",
+    "1.13.2": "5266",
+    "1.14": "5769",
+    "1.15": "5769",
+    "1.16": "6305",
+    "1.16.2": "6309",
+    "1.17": "6511"
+  },
+  "141": {
+    "legacy": "141",
+    "1.12": "2256",
+    "1.13": "5287",
+    "1.13.2": "5288",
+    "1.14": "5794",
+    "1.15": "5794",
+    "1.16": "6330",
+    "1.16.2": "6334",
+    "1.17": "6536"
+  },
+  "142": {
+    "legacy": "142",
+    "1.12": "2272",
+    "1.13": "5295",
+    "1.13.2": "5296",
+    "1.14": "5802",
+    "1.15": "5802",
+    "1.16": "6338",
+    "1.16.2": "6342",
+    "1.17": "6544"
+  },
+  "143": {
+    "legacy": "143",
+    "1.12": "2288",
+    "1.13": "5303",
+    "1.13.2": "5304",
+    "1.14": "5810",
+    "1.15": "5810",
+    "1.16": "6346",
+    "1.16.2": "6350",
+    "1.17": "6552"
+  },
+  "144": {
+    "legacy": "144",
+    "1.12": "2304",
+    "1.13": "5511",
+    "1.13.2": "5512",
+    "1.14": "6014",
+    "1.15": "6014",
+    "1.16": "6550",
+    "1.16.2": "6554",
+    "1.17": "6756"
+  },
+  "145": {
+    "legacy": "145",
+    "1.12": "2320",
+    "1.13": "5567",
+    "1.13.2": "5568",
+    "1.14": "6074",
+    "1.15": "6074",
+    "1.16": "6610",
+    "1.16.2": "6614",
+    "1.17": "6816"
+  },
+  "146": {
+    "legacy": "146",
+    "1.12": "2338",
+    "1.13": "5579",
+    "1.13.2": "5580",
+    "1.14": "6086",
+    "1.15": "6086",
+    "1.16": "6622",
+    "1.16.2": "6626",
+    "1.17": "6828"
+  },
+  "147": {
+    "legacy": "147",
+    "1.12": "2352",
+    "1.13": "5603",
+    "1.13.2": "5604",
+    "1.14": "6110",
+    "1.15": "6110",
+    "1.16": "6646",
+    "1.16.2": "6650",
+    "1.17": "6852"
+  },
+  "148": {
+    "legacy": "148",
+    "1.12": "2368",
+    "1.13": "5619",
+    "1.13.2": "5620",
+    "1.14": "6126",
+    "1.15": "6126",
+    "1.16": "6662",
+    "1.16.2": "6666",
+    "1.17": "6868"
+  },
+  "149": {
+    "legacy": "149",
+    "1.12": "2402",
+    "1.13": "5636",
+    "1.13.2": "5637",
+    "1.14": "6143",
+    "1.15": "6143",
+    "1.16": "6679",
+    "1.16.2": "6683",
+    "1.17": "6885"
+  },
+  "150": {
+    "legacy": "150",
+    "1.12": "2410",
+    "1.13": "5635",
+    "1.13.2": "5636",
+    "1.14": "6142",
+    "1.15": "6142",
+    "1.16": "6678",
+    "1.16.2": "6682",
+    "1.17": "6884"
+  },
+  "151": {
+    "legacy": "151",
+    "1.12": "2416",
+    "1.13": "5667",
+    "1.13.2": "5668",
+    "1.14": "6174",
+    "1.15": "6174",
+    "1.16": "6710",
+    "1.16.2": "6714",
+    "1.17": "6916"
+  },
+  "152": {
+    "legacy": "152",
+    "1.12": "2432",
+    "1.13": "5683",
+    "1.13.2": "5684",
+    "1.14": "6190",
+    "1.15": "6190",
+    "1.16": "6726",
+    "1.16.2": "6730",
+    "1.17": "6932"
+  },
+  "153": {
+    "legacy": "153",
+    "1.12": "2448",
+    "1.13": "5684",
+    "1.13.2": "5685",
+    "1.14": "6191",
+    "1.15": "6191",
+    "1.16": "6727",
+    "1.16.2": "6731",
+    "1.17": "6933"
+  },
+  "154": {
+    "legacy": "154",
+    "1.12": "2464",
+    "1.13": "5685",
+    "1.13.2": "5686",
+    "1.14": "6192",
+    "1.15": "6192",
+    "1.16": "6728",
+    "1.16.2": "6732",
+    "1.17": "6934"
+  },
+  "155": {
+    "legacy": "155",
+    "1.12": "2480",
+    "1.13": "5695",
+    "1.13.2": "5696",
+    "1.14": "6202",
+    "1.15": "6202",
+    "1.16": "6738",
+    "1.16.2": "6742",
+    "1.17": "6944"
+  },
+  "156": {
+    "legacy": "156",
+    "1.12": "2496",
+    "1.13": "5700",
+    "1.13.2": "5701",
+    "1.14": "6207",
+    "1.15": "6207",
+    "1.16": "6743",
+    "1.16.2": "6747",
+    "1.17": "6949"
+  },
+  "157": {
+    "legacy": "157",
+    "1.12": "2512",
+    "1.13": "5780",
+    "1.13.2": "5781",
+    "1.14": "6287",
+    "1.15": "6287",
+    "1.16": "6823",
+    "1.16.2": "6827",
+    "1.17": "7029"
+  },
+  "158": {
+    "legacy": "158",
+    "1.12": "2528",
+    "1.13": "5792",
+    "1.13.2": "5793",
+    "1.14": "6299",
+    "1.15": "6299",
+    "1.16": "6835",
+    "1.16.2": "6839",
+    "1.17": "7053"
+  },
+  "159": {
+    "legacy": "159",
+    "1.12": "4016",
+    "1.13": "8377",
+    "1.13.2": "8378",
+    "1.14": "8902",
+    "1.15": "8902",
+    "1.16": "9438",
+    "1.16.2": "9442",
+    "1.17": "9688"
+  },
+  "160": {
+    "legacy": "160",
+    "1.12": "2560",
+    "1.13": "5820",
+    "1.13.2": "5821",
+    "1.14": "6327",
+    "1.15": "6327",
+    "1.16": "6863",
+    "1.16.2": "6867",
+    "1.17": "7081"
+  },
+  "161": {
+    "legacy": "161",
+    "1.12": "2576",
+    "1.13": "200",
+    "1.13.2": "200",
+    "1.14": "200",
+    "1.15": "200",
+    "1.16": "201",
+    "1.16.2": "201",
+    "1.17": "204"
+  },
+  "162": {
+    "legacy": "162",
+    "1.12": "2592",
+    "1.13": "84",
+    "1.13.2": "84",
+    "1.14": "84",
+    "1.15": "84",
+    "1.16": "85",
+    "1.16.2": "85",
+    "1.17": "88"
+  },
+  "163": {
+    "legacy": "163",
+    "1.12": "2608",
+    "1.13": "6332",
+    "1.13.2": "6333",
+    "1.14": "6839",
+    "1.15": "6839",
+    "1.16": "7375",
+    "1.16.2": "7379",
+    "1.17": "7593"
+  },
+  "164": {
+    "legacy": "164",
+    "1.12": "2624",
+    "1.13": "6412",
+    "1.13.2": "6413",
+    "1.14": "6919",
+    "1.15": "6919",
+    "1.16": "7455",
+    "1.16.2": "7459",
+    "1.17": "7673"
+  },
+  "165": {
+    "legacy": "165",
+    "1.12": "2640",
+    "1.13": "6492",
+    "1.13.2": "6493",
+    "1.14": "6999",
+    "1.15": "6999",
+    "1.16": "7535",
+    "1.16.2": "7539",
+    "1.17": "7753"
+  },
+  "166": {
+    "legacy": "166",
+    "1.12": "2656",
+    "1.13": "6493",
+    "1.13.2": "6494",
+    "1.14": "7000",
+    "1.15": "7000",
+    "1.16": "7536",
+    "1.16.2": "7540",
+    "1.17": "7754"
+  },
+  "167": {
+    "legacy": "167",
+    "1.12": "2672",
+    "1.13": "6494",
+    "1.13.2": "6495",
+    "1.14": "7001",
+    "1.15": "7001",
+    "1.16": "7537",
+    "1.16.2": "7541",
+    "1.17": "7787"
+  },
+  "168": {
+    "legacy": "168",
+    "1.12": "2688",
+    "1.13": "6558",
+    "1.13.2": "6559",
+    "1.14": "7065",
+    "1.15": "7065",
+    "1.16": "7601",
+    "1.16.2": "7605",
+    "1.17": "7851"
+  },
+  "169": {
+    "legacy": "169",
+    "1.12": "2704",
+    "1.13": "6819",
+    "1.13.2": "6820",
+    "1.14": "7326",
+    "1.15": "7326",
+    "1.16": "7862",
+    "1.16.2": "7866",
+    "1.17": "8112"
+  },
+  "170": {
+    "legacy": "170",
+    "1.12": "2720",
+    "1.13": "6820",
+    "1.13.2": "6821",
+    "1.14": "7327",
+    "1.15": "7327",
+    "1.16": "7863",
+    "1.16.2": "7867",
+    "1.17": "8113"
+  },
+  "171": {
+    "legacy": "171",
+    "1.12": "2736",
+    "1.13": "6823",
+    "1.13.2": "6824",
+    "1.14": "7330",
+    "1.15": "7330",
+    "1.16": "7866",
+    "1.16.2": "7870",
+    "1.17": "8116"
+  },
+  "172": {
+    "legacy": "172",
+    "1.12": "4028",
+    "1.13": "8389",
+    "1.13.2": "8390",
+    "1.14": "8914",
+    "1.15": "8914",
+    "1.16": "9450",
+    "1.16.2": "9454",
+    "1.17": "9700"
+  },
+  "173": {
+    "legacy": "173",
+    "1.12": "2768",
+    "1.13": "6840",
+    "1.13.2": "6841",
+    "1.14": "7347",
+    "1.15": "7347",
+    "1.16": "7883",
+    "1.16.2": "7887",
+    "1.17": "8133"
+  },
+  "174": {
+    "legacy": "174",
+    "1.12": "2784",
+    "1.13": "6841",
+    "1.13.2": "6842",
+    "1.14": "7348",
+    "1.15": "7348",
+    "1.16": "7884",
+    "1.16.2": "7888",
+    "1.17": "8134"
+  },
+  "175": {
+    "legacy": "175",
+    "1.12": "2800",
+    "1.13": "6842",
+    "1.13.2": "6843",
+    "1.14": "7349",
+    "1.15": "7349",
+    "1.16": "7885",
+    "1.16.2": "7889",
+    "1.17": "8135"
+  },
+  "176": {
+    "legacy": "176",
+    "1.12": "2816",
+    "1.13": "6854",
+    "1.13.2": "6855",
+    "1.14": "7361",
+    "1.15": "7361",
+    "1.16": "7897",
+    "1.16.2": "7901",
+    "1.17": "8147"
+  },
+  "177": {
+    "legacy": "177",
+    "1.12": "2834",
+    "1.13": "7110",
+    "1.13.2": "7111",
+    "1.14": "7617",
+    "1.15": "7617",
+    "1.16": "8153",
+    "1.16.2": "8157",
+    "1.17": "8403"
+  },
+  "178": {
+    "legacy": "178",
+    "1.12": "2848",
+    "1.13": "5651",
+    "1.13.2": "5652",
+    "1.14": "6158",
+    "1.15": "6158",
+    "1.16": "6694",
+    "1.16.2": "6698",
+    "1.17": "6900"
+  },
+  "179": {
+    "legacy": "179",
+    "1.12": "2864",
+    "1.13": "7174",
+    "1.13.2": "7175",
+    "1.14": "7681",
+    "1.15": "7681",
+    "1.16": "8217",
+    "1.16.2": "8221",
+    "1.17": "8467"
+  },
+  "180": {
+    "legacy": "180",
+    "1.12": "2880",
+    "1.13": "7177",
+    "1.13.2": "7178",
+    "1.14": "7684",
+    "1.15": "7684",
+    "1.16": "8220",
+    "1.16.2": "8224",
+    "1.17": "8470"
+  },
+  "181": {
+    "legacy": "181",
+    "1.12": "699",
+    "1.13": "7311",
+    "1.13.2": "7312",
+    "1.14": "7830",
+    "1.15": "7830",
+    "1.16": "8366",
+    "1.16.2": "8370",
+    "1.17": "8616"
+  },
+  "182": {
+    "legacy": "182",
+    "1.12": "704",
+    "1.13": "7296",
+    "1.13.2": "7297",
+    "1.14": "7809",
+    "1.15": "7809",
+    "1.16": "8345",
+    "1.16.2": "8349",
+    "1.17": "8595"
+  },
+  "183": {
+    "legacy": "183",
+    "1.12": "2928",
+    "1.13": "7357",
+    "1.13.2": "7358",
+    "1.14": "7882",
+    "1.15": "7882",
+    "1.16": "8418",
+    "1.16.2": "8422",
+    "1.17": "8668"
+  },
+  "184": {
+    "legacy": "184",
+    "1.12": "2944",
+    "1.13": "7389",
+    "1.13.2": "7390",
+    "1.14": "7914",
+    "1.15": "7914",
+    "1.16": "8450",
+    "1.16.2": "8454",
+    "1.17": "8700"
+  },
+  "185": {
+    "legacy": "185",
+    "1.12": "2960",
+    "1.13": "7421",
+    "1.13.2": "7422",
+    "1.14": "7946",
+    "1.15": "7946",
+    "1.16": "8482",
+    "1.16.2": "8486",
+    "1.17": "8732"
+  },
+  "186": {
+    "legacy": "186",
+    "1.12": "2976",
+    "1.13": "7485",
+    "1.13.2": "7486",
+    "1.14": "8010",
+    "1.15": "8010",
+    "1.16": "8546",
+    "1.16.2": "8550",
+    "1.17": "8796"
+  },
+  "187": {
+    "legacy": "187",
+    "1.12": "2992",
+    "1.13": "7453",
+    "1.13.2": "7454",
+    "1.14": "7978",
+    "1.15": "7978",
+    "1.16": "8514",
+    "1.16.2": "8518",
+    "1.17": "8764"
+  },
+  "188": {
+    "legacy": "188",
+    "1.12": "3008",
+    "1.13": "7517",
+    "1.13.2": "7518",
+    "1.14": "8042",
+    "1.15": "8042",
+    "1.16": "8578",
+    "1.16.2": "8582",
+    "1.17": "8828"
+  },
+  "189": {
+    "legacy": "189",
+    "1.12": "3024",
+    "1.13": "7549",
+    "1.13.2": "7550",
+    "1.14": "8074",
+    "1.15": "8074",
+    "1.16": "8610",
+    "1.16.2": "8614",
+    "1.17": "8860"
+  },
+  "190": {
+    "legacy": "190",
+    "1.12": "3040",
+    "1.13": "7581",
+    "1.13.2": "7582",
+    "1.14": "8106",
+    "1.15": "8106",
+    "1.16": "8642",
+    "1.16.2": "8646",
+    "1.17": "8892"
+  },
+  "191": {
+    "legacy": "191",
+    "1.12": "3056",
+    "1.13": "7645",
+    "1.13.2": "7646",
+    "1.14": "8170",
+    "1.15": "8170",
+    "1.16": "8706",
+    "1.16.2": "8710",
+    "1.17": "8956"
+  },
+  "192": {
+    "legacy": "192",
+    "1.12": "3072",
+    "1.13": "7613",
+    "1.13.2": "7614",
+    "1.14": "8138",
+    "1.15": "8138",
+    "1.16": "8674",
+    "1.16.2": "8678",
+    "1.17": "8924"
+  },
+  "193": {
+    "legacy": "193",
+    "1.12": "3088",
+    "1.13": "7677",
+    "1.13.2": "7678",
+    "1.14": "8202",
+    "1.15": "8202",
+    "1.16": "8738",
+    "1.16.2": "8742",
+    "1.17": "8988"
+  },
+  "194": {
+    "legacy": "194",
+    "1.12": "3104",
+    "1.13": "7741",
+    "1.13.2": "7742",
+    "1.14": "8266",
+    "1.15": "8266",
+    "1.16": "8802",
+    "1.16.2": "8806",
+    "1.17": "9052"
+  },
+  "195": {
+    "legacy": "195",
+    "1.12": "3120",
+    "1.13": "7805",
+    "1.13.2": "7806",
+    "1.14": "8330",
+    "1.15": "8330",
+    "1.16": "8866",
+    "1.16.2": "8870",
+    "1.17": "9116"
+  },
+  "196": {
+    "legacy": "196",
+    "1.12": "3136",
+    "1.13": "7869",
+    "1.13.2": "7870",
+    "1.14": "8394",
+    "1.15": "8394",
+    "1.16": "8930",
+    "1.16.2": "8934",
+    "1.17": "9180"
+  },
+  "197": {
+    "legacy": "197",
+    "1.12": "3152",
+    "1.13": "7933",
+    "1.13.2": "7934",
+    "1.14": "8458",
+    "1.15": "8458",
+    "1.16": "8994",
+    "1.16.2": "8998",
+    "1.17": "9244"
+  },
+  "198": {
+    "legacy": "198",
+    "1.12": "3168",
+    "1.13": "7997",
+    "1.13.2": "7998",
+    "1.14": "8522",
+    "1.15": "8522",
+    "1.16": "9058",
+    "1.16.2": "9062",
+    "1.17": "9308"
+  },
+  "199": {
+    "legacy": "199",
+    "1.12": "3184",
+    "1.13": "8003",
+    "1.13.2": "8004",
+    "1.14": "8528",
+    "1.15": "8528",
+    "1.16": "9064",
+    "1.16.2": "9068",
+    "1.17": "9314"
+  },
+  "200": {
+    "legacy": "200",
+    "1.12": "3200",
+    "1.13": "8067",
+    "1.13.2": "8068",
+    "1.14": "8592",
+    "1.15": "8592",
+    "1.16": "9128",
+    "1.16.2": "9132",
+    "1.17": "9378"
+  },
+  "201": {
+    "legacy": "201",
+    "1.12": "3216",
+    "1.13": "8073",
+    "1.13.2": "8074",
+    "1.14": "8598",
+    "1.15": "8598",
+    "1.16": "9134",
+    "1.16.2": "9138",
+    "1.17": "9384"
+  },
+  "202": {
+    "legacy": "202",
+    "1.12": "3232",
+    "1.13": "8074",
+    "1.13.2": "8075",
+    "1.14": "8599",
+    "1.15": "8599",
+    "1.16": "9135",
+    "1.16.2": "9139",
+    "1.17": "9385"
+  },
+  "203": {
+    "legacy": "203",
+    "1.12": "3248",
+    "1.13": "8077",
+    "1.13.2": "8078",
+    "1.14": "8602",
+    "1.15": "8602",
+    "1.16": "9138",
+    "1.16.2": "9142",
+    "1.17": "9388"
+  },
+  "204": {
+    "legacy": "204",
+    "1.12": "3264",
+    "1.13": "7352",
+    "1.13.2": "7353",
+    "1.14": "7877",
+    "1.15": "7877",
+    "1.16": "8413",
+    "1.16.2": "8417",
+    "1.17": "8663"
+  },
+  "205": {
+    "legacy": "205",
+    "1.12": "3280",
+    "1.13": "7350",
+    "1.13.2": "7351",
+    "1.14": "7875",
+    "1.15": "7875",
+    "1.16": "8411",
+    "1.16.2": "8415",
+    "1.17": "8661"
+  },
+  "206": {
+    "legacy": "206",
+    "1.12": "3296",
+    "1.13": "8157",
+    "1.13.2": "8158",
+    "1.14": "8682",
+    "1.15": "8682",
+    "1.16": "9218",
+    "1.16.2": "9222",
+    "1.17": "9468"
+  },
+  "207": {
+    "legacy": "207",
+    "1.12": "3312",
+    "1.13": "8158",
+    "1.13.2": "8159",
+    "1.14": "8683",
+    "1.15": "8683",
+    "1.16": "9219",
+    "1.16.2": "9223",
+    "1.17": "9469"
+  },
+  "208": {
+    "legacy": "208",
+    "1.12": "3328",
+    "1.13": "8162",
+    "1.13.2": "8163",
+    "1.14": "8687",
+    "1.15": "8687",
+    "1.16": "9223",
+    "1.16.2": "9227",
+    "1.17": "9473"
+  },
+  "209": {
+    "legacy": "209",
+    "1.12": "3344",
+    "1.13": "8163",
+    "1.13.2": "8164",
+    "1.14": "8688",
+    "1.15": "8688",
+    "1.16": "9224",
+    "1.16.2": "9228",
+    "1.17": "9474"
+  },
+  "210": {
+    "legacy": "210",
+    "1.12": "3360",
+    "1.13": "8164",
+    "1.13.2": "8165",
+    "1.14": "8689",
+    "1.15": "8689",
+    "1.16": "9225",
+    "1.16.2": "9229",
+    "1.17": "9475"
+  },
+  "211": {
+    "legacy": "211",
+    "1.12": "3376",
+    "1.13": "8176",
+    "1.13.2": "8177",
+    "1.14": "8701",
+    "1.15": "8701",
+    "1.16": "9237",
+    "1.16.2": "9241",
+    "1.17": "9487"
+  },
+  "212": {
+    "legacy": "212",
+    "1.12": "3392",
+    "1.13": "8188",
+    "1.13.2": "8189",
+    "1.14": "8713",
+    "1.15": "8713",
+    "1.16": "9249",
+    "1.16.2": "9253",
+    "1.17": "9499"
+  },
+  "213": {
+    "legacy": "213",
+    "1.12": "3408",
+    "1.13": "8192",
+    "1.13.2": "8193",
+    "1.14": "8717",
+    "1.15": "8717",
+    "1.16": "9253",
+    "1.16.2": "9257",
+    "1.17": "9503"
+  },
+  "214": {
+    "legacy": "214",
+    "1.12": "3424",
+    "1.13": "8193",
+    "1.13.2": "8194",
+    "1.14": "8718",
+    "1.15": "8718",
+    "1.16": "9254",
+    "1.16.2": "9258",
+    "1.17": "9504"
+  },
+  "215": {
+    "legacy": "215",
+    "1.12": "3440",
+    "1.13": "8194",
+    "1.13.2": "8195",
+    "1.14": "8719",
+    "1.15": "8719",
+    "1.16": "9255",
+    "1.16.2": "9259",
+    "1.17": "9505"
+  },
+  "216": {
+    "legacy": "216",
+    "1.12": "3456",
+    "1.13": "8195",
+    "1.13.2": "8196",
+    "1.14": "8720",
+    "1.15": "8720",
+    "1.16": "9256",
+    "1.16.2": "9260",
+    "1.17": "9506"
+  },
+  "217": {
+    "legacy": "217",
+    "1.12": "3472",
+    "1.13": "8198",
+    "1.13.2": "8199",
+    "1.14": "8723",
+    "1.15": "8723",
+    "1.16": "9259",
+    "1.16.2": "9263",
+    "1.17": "9509"
+  },
+  "218": {
+    "legacy": "218",
+    "1.12": "3488",
+    "1.13": "8199",
+    "1.13.2": "8200",
+    "1.14": "8724",
+    "1.15": "8724",
+    "1.16": "9260",
+    "1.16.2": "9264",
+    "1.17": "9510"
+  },
+  "219": {
+    "legacy": "219",
+    "1.12": "3504",
+    "1.13": "8217",
+    "1.13.2": "8218",
+    "1.14": "8742",
+    "1.15": "8742",
+    "1.16": "9278",
+    "1.16.2": "9282",
+    "1.17": "9528"
+  },
+  "220": {
+    "legacy": "220",
+    "1.12": "3520",
+    "1.13": "8223",
+    "1.13.2": "8224",
+    "1.14": "8748",
+    "1.15": "8748",
+    "1.16": "9284",
+    "1.16.2": "9288",
+    "1.17": "9534"
+  },
+  "221": {
+    "legacy": "221",
+    "1.12": "3536",
+    "1.13": "8229",
+    "1.13.2": "8230",
+    "1.14": "8754",
+    "1.15": "8754",
+    "1.16": "9290",
+    "1.16.2": "9294",
+    "1.17": "9540"
+  },
+  "222": {
+    "legacy": "222",
+    "1.12": "3552",
+    "1.13": "8235",
+    "1.13.2": "8236",
+    "1.14": "8760",
+    "1.15": "8760",
+    "1.16": "9296",
+    "1.16.2": "9300",
+    "1.17": "9546"
+  },
+  "223": {
+    "legacy": "223",
+    "1.12": "3568",
+    "1.13": "8241",
+    "1.13.2": "8242",
+    "1.14": "8766",
+    "1.15": "8766",
+    "1.16": "9302",
+    "1.16.2": "9306",
+    "1.17": "9552"
+  },
+  "224": {
+    "legacy": "224",
+    "1.12": "3584",
+    "1.13": "8247",
+    "1.13.2": "8248",
+    "1.14": "8772",
+    "1.15": "8772",
+    "1.16": "9308",
+    "1.16.2": "9312",
+    "1.17": "9558"
+  },
+  "225": {
+    "legacy": "225",
+    "1.12": "3600",
+    "1.13": "8253",
+    "1.13.2": "8254",
+    "1.14": "8778",
+    "1.15": "8778",
+    "1.16": "9314",
+    "1.16.2": "9318",
+    "1.17": "9564"
+  },
+  "226": {
+    "legacy": "226",
+    "1.12": "3616",
+    "1.13": "8259",
+    "1.13.2": "8260",
+    "1.14": "8784",
+    "1.15": "8784",
+    "1.16": "9320",
+    "1.16.2": "9324",
+    "1.17": "9570"
+  },
+  "227": {
+    "legacy": "227",
+    "1.12": "3632",
+    "1.13": "8265",
+    "1.13.2": "8266",
+    "1.14": "8790",
+    "1.15": "8790",
+    "1.16": "9326",
+    "1.16.2": "9330",
+    "1.17": "9576"
+  },
+  "228": {
+    "legacy": "228",
+    "1.12": "3648",
+    "1.13": "8271",
+    "1.13.2": "8272",
+    "1.14": "8796",
+    "1.15": "8796",
+    "1.16": "9332",
+    "1.16.2": "9336",
+    "1.17": "9582"
+  },
+  "229": {
+    "legacy": "229",
+    "1.12": "3664",
+    "1.13": "8277",
+    "1.13.2": "8278",
+    "1.14": "8802",
+    "1.15": "8802",
+    "1.16": "9338",
+    "1.16.2": "9342",
+    "1.17": "9588"
+  },
+  "230": {
+    "legacy": "230",
+    "1.12": "3680",
+    "1.13": "8283",
+    "1.13.2": "8284",
+    "1.14": "8808",
+    "1.15": "8808",
+    "1.16": "9344",
+    "1.16.2": "9348",
+    "1.17": "9594"
+  },
+  "231": {
+    "legacy": "231",
+    "1.12": "3696",
+    "1.13": "8289",
+    "1.13.2": "8290",
+    "1.14": "8814",
+    "1.15": "8814",
+    "1.16": "9350",
+    "1.16.2": "9354",
+    "1.17": "9600"
+  },
+  "232": {
+    "legacy": "232",
+    "1.12": "3712",
+    "1.13": "8295",
+    "1.13.2": "8296",
+    "1.14": "8820",
+    "1.15": "8820",
+    "1.16": "9356",
+    "1.16.2": "9360",
+    "1.17": "9606"
+  },
+  "233": {
+    "legacy": "233",
+    "1.12": "3728",
+    "1.13": "8301",
+    "1.13.2": "8302",
+    "1.14": "8826",
+    "1.15": "8826",
+    "1.16": "9362",
+    "1.16.2": "9366",
+    "1.17": "9612"
+  },
+  "234": {
+    "legacy": "234",
+    "1.12": "3744",
+    "1.13": "8307",
+    "1.13.2": "8308",
+    "1.14": "8832",
+    "1.15": "8832",
+    "1.16": "9368",
+    "1.16.2": "9372",
+    "1.17": "9618"
+  },
+  "235": {
+    "legacy": "235",
+    "1.12": "3760",
+    "1.13": "8313",
+    "1.13.2": "8314",
+    "1.14": "8838",
+    "1.15": "8838",
+    "1.16": "9374",
+    "1.16.2": "9378",
+    "1.17": "9624"
+  },
+  "236": {
+    "legacy": "236",
+    "1.12": "3776",
+    "1.13": "8317",
+    "1.13.2": "8318",
+    "1.14": "8842",
+    "1.15": "8842",
+    "1.16": "9378",
+    "1.16.2": "9382",
+    "1.17": "9628"
+  },
+  "237": {
+    "legacy": "237",
+    "1.12": "3792",
+    "1.13": "8321",
+    "1.13.2": "8322",
+    "1.14": "8846",
+    "1.15": "8846",
+    "1.16": "9382",
+    "1.16.2": "9386",
+    "1.17": "9632"
+  },
+  "238": {
+    "legacy": "238",
+    "1.12": "3808",
+    "1.13": "8325",
+    "1.13.2": "8326",
+    "1.14": "8850",
+    "1.15": "8850",
+    "1.16": "9386",
+    "1.16.2": "9390",
+    "1.17": "9636"
+  },
+  "239": {
+    "legacy": "239",
+    "1.12": "3824",
+    "1.13": "8329",
+    "1.13.2": "8330",
+    "1.14": "8854",
+    "1.15": "8854",
+    "1.16": "9390",
+    "1.16.2": "9394",
+    "1.17": "9640"
+  },
+  "240": {
+    "legacy": "240",
+    "1.12": "3840",
+    "1.13": "8333",
+    "1.13.2": "8334",
+    "1.14": "8858",
+    "1.15": "8858",
+    "1.16": "9394",
+    "1.16.2": "9398",
+    "1.17": "9644"
+  },
+  "241": {
+    "legacy": "241",
+    "1.12": "3856",
+    "1.13": "8337",
+    "1.13.2": "8338",
+    "1.14": "8862",
+    "1.15": "8862",
+    "1.16": "9398",
+    "1.16.2": "9402",
+    "1.17": "9648"
+  },
+  "242": {
+    "legacy": "242",
+    "1.12": "3872",
+    "1.13": "8341",
+    "1.13.2": "8342",
+    "1.14": "8866",
+    "1.15": "8866",
+    "1.16": "9402",
+    "1.16.2": "9406",
+    "1.17": "9652"
+  },
+  "243": {
+    "legacy": "243",
+    "1.12": "3888",
+    "1.13": "8345",
+    "1.13.2": "8346",
+    "1.14": "8870",
+    "1.15": "8870",
+    "1.16": "9406",
+    "1.16.2": "9410",
+    "1.17": "9656"
+  },
+  "244": {
+    "legacy": "244",
+    "1.12": "3904",
+    "1.13": "8349",
+    "1.13.2": "8350",
+    "1.14": "8874",
+    "1.15": "8874",
+    "1.16": "9410",
+    "1.16.2": "9414",
+    "1.17": "9660"
+  },
+  "245": {
+    "legacy": "245",
+    "1.12": "3920",
+    "1.13": "8353",
+    "1.13.2": "8354",
+    "1.14": "8878",
+    "1.15": "8878",
+    "1.16": "9414",
+    "1.16.2": "9418",
+    "1.17": "9664"
+  },
+  "246": {
+    "legacy": "246",
+    "1.12": "3936",
+    "1.13": "8357",
+    "1.13.2": "8358",
+    "1.14": "8882",
+    "1.15": "8882",
+    "1.16": "9418",
+    "1.16.2": "9422",
+    "1.17": "9668"
+  },
+  "247": {
+    "legacy": "247",
+    "1.12": "3952",
+    "1.13": "8361",
+    "1.13.2": "8362",
+    "1.14": "8886",
+    "1.15": "8886",
+    "1.16": "9422",
+    "1.16.2": "9426",
+    "1.17": "9672"
+  },
+  "248": {
+    "legacy": "248",
+    "1.12": "3968",
+    "1.13": "8365",
+    "1.13.2": "8366",
+    "1.14": "8890",
+    "1.15": "8890",
+    "1.16": "9426",
+    "1.16.2": "9430",
+    "1.17": "9676"
+  },
+  "249": {
+    "legacy": "249",
+    "1.12": "3984",
+    "1.13": "8369",
+    "1.13.2": "8370",
+    "1.14": "8894",
+    "1.15": "8894",
+    "1.16": "9430",
+    "1.16.2": "9434",
+    "1.17": "9680"
+  },
+  "250": {
+    "legacy": "250",
+    "1.12": "4000",
+    "1.13": "8373",
+    "1.13.2": "8374",
+    "1.14": "8898",
+    "1.15": "8898",
+    "1.16": "9434",
+    "1.16.2": "9438",
+    "1.17": "9684"
+  },
+  "251": {
+    "legacy": "251",
+    "1.12": "4023",
+    "1.13": "8384",
+    "1.13.2": "8385",
+    "1.14": "8909",
+    "1.15": "8909",
+    "1.16": "9445",
+    "1.16.2": "9449",
+    "1.17": "9695"
+  },
+  "252": {
+    "legacy": "252",
+    "1.12": "4039",
+    "1.13": "8400",
+    "1.13.2": "8401",
+    "1.14": "8925",
+    "1.15": "8925",
+    "1.16": "9461",
+    "1.16.2": "9465",
+    "1.17": "9711"
+  },
+  "255": {
+    "legacy": "255",
+    "1.12": "4080",
+    "1.13": "8578",
+    "1.13.2": "8595",
+    "1.14": "11252",
+    "1.15": "11268",
+    "1.16": "15735",
+    "1.16.2": "15743",
+    "1.17": "15989"
+  }
+}
\ No newline at end of file
diff --git a/proxy/src/test/java/com/velocitypowered/proxy/util/ratelimit/GuavaCacheRatelimiterTest.java b/proxy/src/test/java/com/velocitypowered/proxy/util/ratelimit/GuavaCacheRatelimiterTest.java
index 7ed4618e..90508ee0 100644
--- a/proxy/src/test/java/com/velocitypowered/proxy/util/ratelimit/GuavaCacheRatelimiterTest.java
+++ b/proxy/src/test/java/com/velocitypowered/proxy/util/ratelimit/GuavaCacheRatelimiterTest.java
@@ -30,6 +30,8 @@ class GuavaCacheRatelimiterTest {
 
   @Test
   void attemptZero() {
+    // BotFilter BackPort Start: Global ip rate limiter
+    //Ratelimiter noRatelimiter = new GuavaCacheRatelimiter(0, TimeUnit.MILLISECONDS);
     Ratelimiter noRatelimiter = Ratelimiters.createWithMilliseconds(0, 0);
     assertTrue(noRatelimiter.attempt(InetAddress.getLoopbackAddress()));
     assertTrue(noRatelimiter.attempt(InetAddress.getLoopbackAddress()));
@@ -39,6 +41,7 @@ class GuavaCacheRatelimiterTest {
     noRatelimiter = Ratelimiters.createWithMilliseconds(20, 0);
     assertTrue(noRatelimiter.attempt(InetAddress.getLoopbackAddress()));
     assertTrue(noRatelimiter.attempt(InetAddress.getLoopbackAddress()));
+    // BotFilter BackPort End
   }
 
   @Test
@@ -51,6 +54,8 @@ class GuavaCacheRatelimiterTest {
         return base + extra.get();
       }
     };
+    // BotFilter BackPort Start: Global ip rate limiter
+    //Ratelimiter ratelimiter = new GuavaCacheRatelimiter(1000, TimeUnit.MILLISECONDS, testTicker);
     Ratelimiter ratelimiter = new GuavaCacheRatelimiter(1000, 3, TimeUnit.MILLISECONDS, testTicker);
     assertTrue(ratelimiter.attempt(InetAddress.getLoopbackAddress()));
     assertTrue(ratelimiter.attempt(InetAddress.getLoopbackAddress()));
@@ -96,5 +101,6 @@ class GuavaCacheRatelimiterTest {
     assertTrue(ratelimiter.attempt(InetAddress.getLoopbackAddress()));
     assertFalse(ratelimiter.attempt(InetAddress.getLoopbackAddress()));
   }
+  // BotFilter BackPort End
 
 }
-- 
2.32.0

